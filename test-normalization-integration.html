<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Normalization Integration Test</title>
</head>
<body>
    <h1>HexTrackr Normalization Feature Test</h1>
    <h2>Testing Steps:</h2>
    <ol>
        <li>Open <a href="http://localhost:8989/vulnerabilities" target="_blank">http://localhost:8989/vulnerabilities</a></li>
        <li>Look for the "Normalize Data" button in the chart controls (next to Vulnerability Count / VPR Score Sum)</li>
        <li>Click the button - it should turn blue when active</li>
        <li>The chart should update to show normalized values (all lines starting at 100)</li>
        <li>Hover over data points - tooltips should show both Index and Actual values</li>
        <li>Refresh the page - the normalized state should persist</li>
        <li>Toggle dark/light theme - the button should remain visible and functional</li>
    </ol>

    <h2>Quick Visual Test:</h2>
    <iframe src="http://localhost:8989/vulnerabilities"
            width="100%"
            height="800"
            style="border: 2px solid #e5e7eb; border-radius: 8px;">
    </iframe>

    <h2>Performance Test:</h2>
    <button onclick="testPerformance()">Test Toggle Performance</button>
    <div id="performance-result"></div>

    <script>
        function testPerformance() {
            const iframe = document.querySelector('iframe');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const toggleButton = iframeDoc.querySelector('[data-toggle="normalize-chart"]');

            if (toggleButton) {
                const start = performance.now();
                toggleButton.click();

                setTimeout(() => {
                    const end = performance.now();
                    const duration = end - start;
                    document.getElementById('performance-result').innerHTML =
                        `<p>Toggle completed in: <strong>${duration.toFixed(2)}ms</strong>
                        ${duration < 500 ? '✅ PASS' : '❌ FAIL (>500ms)'}</p>`;
                }, 100);
            } else {
                document.getElementById('performance-result').innerHTML =
                    '<p>❌ Toggle button not found. Make sure the page is loaded.</p>';
            }
        }
    </script>
</body>
</html>
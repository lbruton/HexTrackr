<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rEngine Health & Protocol Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-healthy { background: #4CAF50; }
        .status-warning { background: #FF9800; }
        .status-error { background: #F44336; }
        .status-unknown { background: #9E9E9E; }

        .service-list {
            list-style: none;
        }

        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .service-item:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .service-name {
            font-weight: 500;
        }

        .service-port {
            color: #666;
            font-size: 0.9em;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Protocol Stack Editor Styles */
        .protocol-editor {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .protocol-stack {
            min-height: 400px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
        }

        .protocol-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .protocol-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .protocol-item.sortable-ghost {
            opacity: 0.4;
        }

        .protocol-item.sortable-drag {
            transform: rotate(5deg);
        }

        .protocol-info {
            flex: 1;
        }

        .protocol-name {
            font-weight: bold;
            font-size: 1.1em;
        }

        .protocol-description {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .protocol-controls {
            display: flex;
            gap: 10px;
        }

        .protocol-controls button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .protocol-controls button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .add-protocol {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 123, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(0, 123, 255, 0.2);
        }

        .add-protocol input, .add-protocol textarea {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
        }

        .add-protocol textarea {
            resize: vertical;
            min-height: 40px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .log-viewer {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-line {
            margin: 2px 0;
            padding: 2px 0;
        }

        .log-error { color: #ff6b6b; }
        .log-warning { color: #feca57; }
        .log-info { color: #48dbfb; }
        .log-success { color: #1dd1a1; }

        /* Tasks & Roadmap Styles */
        .roadmap-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .roadmap-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .roadmap-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
            background: rgba(0, 0, 0, 0.02);
            transition: all 0.3s ease;
        }

        .task-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .task-item.priority-high {
            border-left-color: #F44336;
            background: rgba(244, 67, 54, 0.05);
        }

        .task-item.priority-medium {
            border-left-color: #FF9800;
            background: rgba(255, 152, 0, 0.05);
        }

        .task-item.priority-low {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.05);
        }

        .task-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .task-description {
            font-size: 0.9em;
            color: #666;
        }

        .task-controls {
            display: flex;
            gap: 5px;
        }

        .task-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }

        .task-btn:hover {
            background: rgba(0, 123, 255, 0.2);
        }

        .add-task-section {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 123, 255, 0.05);
            border-radius: 8px;
            border: 1px dashed rgba(0, 123, 255, 0.3);
        }

        .task-input, .task-select {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
        }

        .add-task-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-task-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .mobile-vision {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .vision-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 123, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(0, 123, 255, 0.1);
        }

        .vision-item i {
            font-size: 1.5em;
            color: #007bff;
            margin-top: 5px;
        }

        .vision-item strong {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        .vision-item p {
            margin: 0;
            color: #666;
            line-height: 1.4;
        }

        .vision-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .vision-category {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #2196F3;
        }

        .vision-category h4 {
            margin: 0 0 15px 0;
            color: #2196F3;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .vision-category .vision-item {
            margin-bottom: 15px;
            background-color: white;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .vision-category .vision-item:last-child {
            margin-bottom: 0;
        }

        /* Sprint & Task Board Styles */
        .sprint-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }

        .sprint-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .sprint-name {
            font-weight: bold;
            font-size: 16px;
            color: #2196F3;
        }

        .sprint-dates {
            font-size: 14px;
            color: #666;
        }

        .sprint-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            width: 120px;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 14px;
            font-weight: bold;
            color: #4CAF50;
        }

        .task-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            min-height: 500px;
        }

        .task-column {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            min-height: 400px;
        }

        .task-column.critical {
            border-top: 3px solid #f44336;
        }

        .task-column.high {
            border-top: 3px solid #FF9800;
        }

        .task-column.medium {
            border-top: 3px solid #2196F3;
        }

        .task-column.completed {
            border-top: 3px solid #4CAF50;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .column-header h4 {
            margin: 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .task-count {
            background-color: #2196F3;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
            min-width: 20px;
            text-align: center;
        }

        .task-cards {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 300px;
        }

        .task-card {
            background-color: white;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: move;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .task-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .task-card.critical {
            border-left-color: #f44336;
        }

        .task-card.high {
            border-left-color: #FF9800;
        }

        .task-card.medium {
            border-left-color: #2196F3;
        }

        .task-card.completed {
            border-left-color: #4CAF50;
            opacity: 0.8;
        }

        .task-card.dragging {
            opacity: 0.5;
            transform: rotate(3deg);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 10px;
        }

        .task-title {
            font-weight: bold;
            font-size: 14px;
            color: #333;
            flex: 1;
        }

        .task-project {
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            white-space: nowrap;
        }

        .task-description {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 11px;
        }

        .task-effort {
            color: #666;
        }

        .task-status {
            font-weight: bold;
        }

        .task-actions {
            display: flex;
            gap: 5px;
            justify-content: flex-end;
        }

        .task-actions button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            color: #666;
            border-radius: 3px;
            transition: all 0.2s ease;
        }

        .task-actions button:hover {
            background-color: #f0f0f0;
            color: #333;
        }

        /* Enhanced Protocol Stack Styles */
        .protocol-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .protocol-tab {
            padding: 10px 15px;
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .protocol-tab:hover {
            background-color: #f5f5f5;
        }

        .protocol-tab.active {
            border-bottom-color: #2196F3;
            color: #2196F3;
            background-color: #f8f9fa;
        }

        .protocol-view {
            display: none;
        }

        .protocol-view.active {
            display: block;
        }

        .protocol-categories {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .protocol-category {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #2196F3;
        }

        .protocol-category h4 {
            margin: 0 0 15px 0;
            color: #2196F3;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .numbered-protocols {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .protocol-card {
            background-color: white;
            border-radius: 6px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .protocol-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .protocol-card.critical {
            border-left-color: #f44336;
        }

        .protocol-card.high {
            border-left-color: #FF9800;
        }

        .protocol-card.active {
            border-left-color: #4CAF50;
        }

        .protocol-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .protocol-number {
            background-color: #2196F3;
            color: white;
            border-radius: 50%;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 14px;
            min-width: 40px;
            text-align: center;
        }

        .protocol-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            flex: 1;
        }

        .protocol-status {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .protocol-status.critical {
            background-color: #ffebee;
            color: #c62828;
        }

        .protocol-status.high {
            background-color: #fff3e0;
            color: #e65100;
        }

        .protocol-status.active {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .protocol-summary {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .protocol-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .protocol-actions button {
            background: none;
            border: 1px solid #ddd;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 4px;
            color: #666;
            transition: all 0.2s ease;
        }

        .protocol-actions button:hover {
            background-color: #f0f0f0;
            color: #333;
            border-color: #999;
        }

        /* Protocol Editor Styles */
        .protocol-editor-container {
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .editor-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .markdown-editor {
            flex: 1;
            margin-bottom: 15px;
        }

        #protocolMarkdown {
            width: 100%;
            height: 300px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }

        .editor-preview {
            flex: 1;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            overflow-y: auto;
            min-height: 200px;
        }

        /* Memory System Styles */
        .memory-system-status {
            padding: 20px;
        }

        .memory-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            text-align: center;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .memory-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .canvas-container {
            height: 400px;
            border: 1px solid #ddd;
            position: relative;
            background: #fafafa;
        }

        #workspaceCanvas {
            cursor: crosshair;
        }

        /* Master Roadmap Styles */
        .master-roadmap-section {
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        .master-roadmap-section h2 {
            margin: 0 0 20px 0;
            color: #2196F3;
            text-align: center;
        }

        .roadmap-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .priority-swim-lanes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .swim-lane {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 400px;
        }

        .lane-header {
            padding: 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid;
        }

        .critical-lane .lane-header {
            background-color: #ffebee;
            border-bottom-color: #f44336;
            color: #c62828;
        }

        .high-lane .lane-header {
            background-color: #fff3e0;
            border-bottom-color: #ff9800;
            color: #ef6c00;
        }

        .medium-lane .lane-header {
            background-color: #e8f5e8;
            border-bottom-color: #4caf50;
            color: #2e7d32;
        }

        .research-lane .lane-header {
            background-color: #e3f2fd;
            border-bottom-color: #2196f3;
            color: #1565c0;
        }

        .task-count {
            background: rgba(0,0,0,0.1);
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
            min-width: 20px;
            text-align: center;
        }

        .lane-content {
            padding: 15px;
            min-height: 350px;
            position: relative;
        }

        .project-task-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: move;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .project-task-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .project-task-card.dragging {
            opacity: 0.6;
            transform: rotate(3deg);
        }

        .task-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .task-card-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            flex: 1;
        }

        .task-card-project {
            font-size: 11px;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            color: #666;
            margin-left: 10px;
        }

        .task-card-description {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .task-card-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 12px;
            margin-bottom: 12px;
        }

        .task-detail {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .task-card-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-status-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }

        .status-planning {
            background: #e3f2fd;
            color: #1565c0;
        }

        .status-in-progress {
            background: #fff3e0;
            color: #ef6c00;
        }

        .status-testing {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .status-completed {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .task-card-actions button {
            background: none;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .task-card-actions button:hover {
            background: #f5f5f5;
        }

        .priority-critical { border-left: 4px solid #f44336; }
        .priority-high { border-left: 4px solid #ff9800; }
        .priority-medium { border-left: 4px solid #4caf50; }
        .priority-research { border-left: 4px solid #2196f3; }

        /* Workspace Styles */
        .workspace-container {
            padding: 20px;
        }

        .workspace-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .workspace-header h2 {
            margin: 0;
            color: #2196F3;
        }

        .workspace-controls {
            display: flex;
            gap: 10px;
        }

        .workspace-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .workspace-tab {
            padding: 10px 15px;
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .workspace-tab:hover {
            background-color: #f5f5f5;
        }

        .workspace-tab.active {
            border-bottom-color: #2196F3;
            color: #2196F3;
            background-color: #f8f9fa;
        }

        .workspace-content {
            min-height: 500px;
        }

        .workspace-section {
            display: none;
        }

        .workspace-section.active {
            display: block;
        }

        /* Notes Section */
        #notes-area {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
        }

        .notes-status {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        .save-status {
            padding: 2px 8px;
            border-radius: 3px;
            background-color: #4CAF50;
            color: white;
        }

        .save-status.saving {
            background-color: #FF9800;
        }

        .save-status.error {
            background-color: #f44336;
        }

        /* Kanban Board */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .kanban-column {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            min-height: 400px;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .column-header h4 {
            margin: 0;
            font-size: 16px;
        }

        .item-count {
            background-color: #2196F3;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
            min-width: 20px;
            text-align: center;
        }

        .kanban-items {
            min-height: 300px;
            margin-bottom: 15px;
        }

        .kanban-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: move;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .kanban-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .kanban-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .kanban-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .kanban-item-text {
            font-weight: bold;
            font-size: 14px;
        }

        .kanban-item-actions {
            display: flex;
            gap: 5px;
        }

        .kanban-item-actions button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 2px;
            color: #666;
            font-size: 12px;
        }

        .kanban-item-actions button:hover {
            color: #333;
        }

        .add-item-btn {
            width: 100%;
            padding: 10px;
            background-color: #e0e0e0;
            border: 2px dashed #999;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-item-btn:hover {
            background-color: #d0d0d0;
            border-color: #666;
        }

        /* Canvas Section */
        .canvas-container {
            text-align: center;
        }

        #freeform-canvas {
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: crosshair;
            background-color: white;
            display: block;
            margin: 0 auto 15px;
        }

        .canvas-tools {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            flex-wrap: wrap;
        }

        .canvas-tools label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }

        .tool-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            background-color: #e0e0e0;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .add-protocol {
                flex-direction: column;
            }

            .kanban-board {
                grid-template-columns: 1fr;
            }

            .workspace-controls {
                flex-direction: column;
                gap: 5px;
            }

            .canvas-tools {
                flex-direction: column;
                gap: 10px;
            }

            #freeform-canvas {
                width: 100%;
                height: 300px;
            }

            .task-board {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .sprint-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .sprint-progress {
                justify-content: center;
            }

            .task-card {
                margin-bottom: 10px;
            }

            .vision-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-heartbeat"></i> rEngine Health & Protocol Dashboard</h1>
            <p>Real-time monitoring and protocol stack management</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('health')">
                <i class="fas fa-heartbeat"></i> Health Monitor
            </button>
            <button class="nav-tab" onclick="showTab('tasks')">
                <i class="fas fa-tasks"></i> Tasks & Roadmap
            </button>
            <button class="nav-tab" onclick="showTab('workspace')">
                <i class="fas fa-clipboard-list"></i> My Workspace
            </button>
            <button class="nav-tab" onclick="showTab('protocols')">
                <i class="fas fa-layer-group"></i> Protocol Stack
            </button>
            <button class="nav-tab" onclick="showTab('memory')">
                <i class="fas fa-brain"></i> Memory System
            </button>
            <button class="nav-tab" onclick="showTab('logs')">
                <i class="fas fa-file-alt"></i> System Logs
            </button>
        </div>

        <!-- Health Monitor Tab -->
        <div id="health" class="tab-content active">
            <div class="dashboard-grid">
                <div class="card">
                    <h3><i class="fas fa-server"></i> Docker Services</h3>
                    <ul class="service-list" id="serviceList">
                        <li class="service-item">
                            <div>
                                <span class="status-indicator status-healthy"></span>
                                <span class="service-name">nginx</span>
                                <span class="service-port">:80</span>
                            </div>
                            <i class="fas fa-check-circle" style="color: #4CAF50;"></i>
                        </li>
                        <li class="service-item">
                            <div>
                                <span class="status-indicator status-healthy"></span>
                                <span class="service-name">mcp-memory-persistent</span>
                                <span class="service-port">:4041</span>
                            </div>
                            <i class="fas fa-check-circle" style="color: #4CAF50;"></i>
                        </li>
                        <li class="service-item">
                            <div>
                                <span class="status-indicator status-warning"></span>
                                <span class="service-name">project-dashboard</span>
                                <span class="service-port">:4043</span>
                            </div>
                            <i class="fas fa-exclamation-triangle" style="color: #FF9800;"></i>
                        </li>
                    </ul>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="refreshServices()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-success" onclick="startAllServices()">
                            <i class="fas fa-play"></i> Start All
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3><i class="fas fa-chart-bar"></i> System Metrics</h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="cpuUsage">23%</div>
                            <div class="metric-label">CPU Usage</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="memoryUsage">1.2GB</div>
                            <div class="metric-label">Memory</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="uptime">24h</div>
                            <div class="metric-label">Uptime</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="activeConnections">42</div>
                            <div class="metric-label">Connections</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3><i class="fas fa-network-wired"></i> Network Status</h3>
                    <ul class="service-list">
                        <li class="service-item">
                            <div>
                                <span class="status-indicator status-healthy"></span>
                                <span class="service-name">rengine-network</span>
                            </div>
                            <span style="color: #4CAF50;">Active</span>
                        </li>
                        <li class="service-item">
                            <div>
                                <span class="status-indicator status-healthy"></span>
                                <span class="service-name">Service Discovery</span>
                            </div>
                            <span style="color: #4CAF50;">Operational</span>
                        </li>
                    </ul>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="testConnectivity()">
                            <i class="fas fa-wifi"></i> Test Connectivity
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3><i class="fas fa-tools"></i> Quick Actions</h3>
                    <div class="action-buttons" style="flex-direction: column; gap: 10px;">
                        <button class="btn btn-primary" onclick="runHealthCheck()">
                            <i class="fas fa-stethoscope"></i> Run Full Health Check
                        </button>
                        <button class="btn btn-warning" onclick="restartServices()">
                            <i class="fas fa-redo"></i> Restart All Services
                        </button>
                        <button class="btn btn-success" onclick="generateReport()">
                            <i class="fas fa-file-download"></i> Generate Health Report
                        </button>
                        <button class="btn btn-danger" onclick="emergencyStop()">
                            <i class="fas fa-stop"></i> Emergency Stop
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks & Roadmap Tab -->
        <div id="tasks" class="tab-content">
            <!-- Master Roadmap Overview -->
            <div class="master-roadmap-section">
                <h2><i class="fas fa-project-diagram"></i> Master Project Roadmap</h2>
                
                <div class="roadmap-controls">
                    <button class="btn btn-primary" onclick="showAllProjects()">All Projects</button>
                    <button class="btn btn-secondary" onclick="filterByPriority('critical')">Critical Only</button>
                    <button class="btn btn-secondary" onclick="filterByPriority('high')">High Priority</button>
                    <button class="btn btn-success" onclick="addNewProjectTask()">+ Add Task</button>
                    <button class="btn btn-info" onclick="exportRoadmap()">Export Roadmap</button>
                    <button class="btn btn-workspace" onclick="openWorkspaceModal()">üìù Workspace</button>
                    <button class="btn btn-notes" onclick="openNotesModal()">üìÑ Notes</button>
                    <button class="btn btn-kanban" onclick="openKanbanModal()">üìã Kanban</button>
                    <button class="btn btn-canvas" onclick="openCanvasModal()">üé® Canvas</button>
                </div>

                <div class="priority-swim-lanes">
                    <!-- Critical Priority Lane -->
                    <div class="swim-lane critical-lane">
                        <div class="lane-header">
                            <h3><i class="fas fa-exclamation-triangle"></i> Critical Priority</h3>
                            <span class="task-count" id="critical-count">0</span>
                        </div>
                        <div class="lane-content" id="critical-tasks" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <!-- Critical tasks will be populated here -->
                        </div>
                    </div>

                    <!-- High Priority Lane -->
                    <div class="swim-lane high-lane">
                        <div class="lane-header">
                            <h3><i class="fas fa-arrow-up"></i> High Priority</h3>
                            <span class="task-count" id="high-count">0</span>
                        </div>
                        <div class="lane-content" id="high-tasks" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <!-- High priority tasks will be populated here -->
                        </div>
                    </div>

                    <!-- Medium Priority Lane -->
                    <div class="swim-lane medium-lane">
                        <div class="lane-header">
                            <h3><i class="fas fa-minus"></i> Medium Priority</h3>
                            <span class="task-count" id="medium-count">0</span>
                        </div>
                        <div class="lane-content" id="medium-tasks" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <!-- Medium priority tasks will be populated here -->
                        </div>
                    </div>

                    <!-- Research & Planning Lane -->
                    <div class="swim-lane research-lane">
                        <div class="lane-header">
                            <h3><i class="fas fa-lightbulb"></i> Research & Planning</h3>
                            <span class="task-count" id="research-count">0</span>
                        </div>
                        <div class="lane-content" id="research-tasks" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <!-- Research tasks will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <h3><i class="fas fa-map-marked-alt"></i> Product Roadmap</h3>
                    <div class="roadmap-links">
                        <a href="docs/PRACTICAL_LLM_GUIDE.md" target="_blank" class="roadmap-link">
                            <i class="fas fa-brain"></i> Enterprise LLM Strategy
                        </a>
                        <a href="docs/ENTERPRISE_LLM_STRATEGY.md" target="_blank" class="roadmap-link">
                            <i class="fas fa-shield-alt"></i> Government Air-Gap Solutions
                        </a>
                        <a href="PROJECT_STRUCTURE.md" target="_blank" class="roadmap-link">
                            <i class="fas fa-sitemap"></i> Project Architecture
                        </a>
                        <a href="STARTUP_USAGE_GUIDE.md" target="_blank" class="roadmap-link">
                            <i class="fas fa-rocket"></i> Quick Start Guide
                        </a>
                        <a href="ENHANCED_SCRIBE_SYSTEM.md" target="_blank" class="roadmap-link">
                            <i class="fas fa-pen-fancy"></i> Enhanced Scribe System
                        </a>
                    </div>
                </div>

                <div class="card">
                    <h3><i class="fas fa-list-check"></i> Current Sprint Tasks</h3>
                    <div class="sprint-header">
                        <div class="sprint-info">
                            <span class="sprint-name">üöÄ HexTrackr Launch + rEngine Stable</span>
                            <span class="sprint-dates">Target: September 1, 2025</span>
                        </div>
                        <div class="sprint-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 35%"></div>
                            </div>
                            <span class="progress-text">35% Complete</span>
                        </div>
                    </div>
                    
                    <div class="task-board" id="currentTasks">
                        <!-- Critical Priority Column -->
                        <div class="task-column critical">
                            <div class="column-header">
                                <h4><i class="fas fa-exclamation-triangle"></i> P0 - Critical</h4>
                                <span class="task-count" id="critical-count">2</span>
                            </div>
                            <div class="task-cards" id="critical-tasks">
                                <div class="task-card critical" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">HexTrackr Encryption Fix</span>
                                        <span class="task-project">HexTrackr</span>
                                    </div>
                                    <div class="task-description">
                                        BLOCKING: Fix critical encryption system issue preventing secure API connections
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê 4-6 hours</span>
                                        <span class="task-status">üî¥ Blocked</span>
                                    </div>
                                    <div class="task-actions">
                                        <button onclick="startTask(this)" title="Start Task"><i class="fas fa-play"></i></button>
                                        <button onclick="viewDetails(this)" title="Details"><i class="fas fa-info"></i></button>
                                    </div>
                                </div>
                                
                                <div class="task-card critical" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">rEngine Document Automation Fix</span>
                                        <span class="task-project">rEngine</span>
                                    </div>
                                    <div class="task-description">
                                        BLOCKING: Fix document sweep automation and ES module compatibility
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê 6-8 hours</span>
                                        <span class="task-status">üî¥ Blocked</span>
                                    </div>
                                    <div class="task-actions">
                                        <button onclick="startTask(this)" title="Start Task"><i class="fas fa-play"></i></button>
                                        <button onclick="viewDetails(this)" title="Details"><i class="fas fa-info"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- High Priority Column -->
                        <div class="task-column high">
                            <div class="column-header">
                                <h4><i class="fas fa-arrow-up"></i> P1 - High</h4>
                                <span class="task-count" id="high-count">3</span>
                            </div>
                            <div class="task-cards" id="high-tasks">
                                <div class="task-card high" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">HexTrackr UI/UX Polish</span>
                                        <span class="task-project">HexTrackr</span>
                                    </div>
                                    <div class="task-description">
                                        Clean up upload area layout and consolidate redundant CSS for launch
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê 8-12 hours</span>
                                        <span class="task-status">üü° In Progress</span>
                                    </div>
                                    <div class="task-actions">
                                        <button onclick="startTask(this)" title="Start Task"><i class="fas fa-play"></i></button>
                                        <button onclick="viewDetails(this)" title="Details"><i class="fas fa-info"></i></button>
                                    </div>
                                </div>
                                
                                <div class="task-card high" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">Filter System Overhaul</span>
                                        <span class="task-project">StackTrackr</span>
                                    </div>
                                    <div class="task-description">
                                        Complete filter system redesign for better UX and performance
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê 4-6 hours</span>
                                        <span class="task-status">üîµ Ready</span>
                                    </div>
                                    <div class="task-actions">
                                        <button onclick="startTask(this)" title="Start Task"><i class="fas fa-play"></i></button>
                                        <button onclick="viewDetails(this)" title="Details"><i class="fas fa-info"></i></button>
                                    </div>
                                </div>
                                
                                <div class="task-card high" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">rEngine Health Dashboard</span>
                                        <span class="task-project">rEngine</span>
                                    </div>
                                    <div class="task-description">
                                        Complete interactive control panel with real-time monitoring
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê 6-8 hours</span>
                                        <span class="task-status">üü° In Progress</span>
                                    </div>
                                    <div class="task-actions">
                                        <button onclick="startTask(this)" title="Start Task"><i class="fas fa-play"></i></button>
                                        <button onclick="viewDetails(this)" title="Details"><i class="fas fa-info"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Medium Priority Column -->
                        <div class="task-column medium">
                            <div class="column-header">
                                <h4><i class="fas fa-minus"></i> P2 - Medium</h4>
                                <span class="task-count" id="medium-count">2</span>
                            </div>
                            <div class="task-cards" id="medium-tasks">
                                <div class="task-card medium" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">Performance Optimization</span>
                                        <span class="task-project">StackTrackr</span>
                                    </div>
                                    <div class="task-description">
                                        Search debouncing, table rendering optimization, memory leak fixes
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê 2-3 hours</span>
                                        <span class="task-status">üîµ Ready</span>
                                    </div>
                                    <div class="task-actions">
                                        <button onclick="startTask(this)" title="Start Task"><i class="fas fa-play"></i></button>
                                        <button onclick="viewDetails(this)" title="Details"><i class="fas fa-info"></i></button>
                                    </div>
                                </div>
                                
                                <div class="task-card medium" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">SQLite Migration Prep</span>
                                        <span class="task-project">rEngine</span>
                                    </div>
                                    <div class="task-description">
                                        Prepare memory system for SQLite migration from JSON files
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê 4-6 hours</span>
                                        <span class="task-status">üîµ Ready</span>
                                    </div>
                                    <div class="task-actions">
                                        <button onclick="startTask(this)" title="Start Task"><i class="fas fa-play"></i></button>
                                        <button onclick="viewDetails(this)" title="Details"><i class="fas fa-info"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Completed Column -->
                        <div class="task-column completed">
                            <div class="column-header">
                                <h4><i class="fas fa-check"></i> Done</h4>
                                <span class="task-count" id="completed-count">4</span>
                            </div>
                            <div class="task-cards" id="completed-tasks">
                                <div class="task-card completed" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">Layout Optimization</span>
                                        <span class="task-project">StackTrackr</span>
                                    </div>
                                    <div class="task-description">
                                        Phase 1 & 2: Layout and popup cleanup complete
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê Completed</span>
                                        <span class="task-status">‚úÖ Done</span>
                                    </div>
                                </div>
                                
                                <div class="task-card completed" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">SQLite Bulk Insert</span>
                                        <span class="task-project">HexTrackr</span>
                                    </div>
                                    <div class="task-description">
                                        Optimized bulk insert operations for better performance
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê Completed</span>
                                        <span class="task-status">‚úÖ Done</span>
                                    </div>
                                </div>
                                
                                <div class="task-card completed" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">Tools Modal Fix</span>
                                        <span class="task-project">HexTrackr</span>
                                    </div>
                                    <div class="task-description">
                                        Restored Tools & Settings modal functionality
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê Completed</span>
                                        <span class="task-status">‚úÖ Done</span>
                                    </div>
                                </div>
                                
                                <div class="task-card completed" draggable="true">
                                    <div class="task-header">
                                        <span class="task-title">Button Repositioning</span>
                                        <span class="task-project">HexTrackr</span>
                                    </div>
                                    <div class="task-description">
                                        "Upload More Data" and "Connect APIs" button optimization
                                    </div>
                                    <div class="task-meta">
                                        <span class="task-effort">üïê Completed</span>
                                        <span class="task-status">‚úÖ Done</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                        <div class="task-item priority-high">
                            <div class="task-info">
                                <span class="task-title">Mobile Agent Architecture</span>
                                <span class="task-description">Design lightweight mobile API for remote server management</span>
                            </div>
                            <div class="task-controls">
                                <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="task-btn" onclick="updateTaskStatus(this, 'completed')" title="Complete Task">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="task-item priority-medium">
                            <div class="task-info">
                                <span class="task-title">Turso Memory Sync System</span>
                                <span class="task-description">Cloud backup for workspace data, secrets, and cross-device sync</span>
                            </div>
                            <div class="task-controls">
                                <button class="task-btn" onclick="updateTaskStatus(this, 'planning')" title="Planning Phase">
                                    <i class="fas fa-lightbulb"></i>
                                </button>
                                <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="task-item priority-medium">
                            <div class="task-info">
                                <span class="task-title">Personal Assistant Module</span>
                                <span class="task-description">Call-home agent for complex research tasks via mobile</span>
                            </div>
                            <div class="task-controls">
                                <button class="task-btn" onclick="updateTaskStatus(this, 'planning')" title="Planning Phase">
                                    <i class="fas fa-lightbulb"></i>
                                </button>
                                <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="task-item priority-high">
                            <div class="task-info">
                                <span class="task-title">GPT-4o 120B Enterprise Integration</span>
                                <span class="task-description">$20/month 120B models for enterprise clients</span>
                            </div>
                            <div class="task-controls">
                                <button class="task-btn" onclick="updateTaskStatus(this, 'planning')" title="Planning Phase">
                                    <i class="fas fa-lightbulb"></i>
                                </button>
                                <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="task-item priority-low">
                            <div class="task-info">
                                <span class="task-title">Workspace-to-Roadmap Integration</span>
                                <span class="task-description">"Add this to roadmap" voice command from workspace notes</span>
                            </div>
                            <div class="task-controls">
                                <button class="task-btn" onclick="updateTaskStatus(this, 'planning')" title="Planning Phase">
                                    <i class="fas fa-lightbulb"></i>
                                </button>
                                <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        <div class="task-item priority-high">
                            <div class="task-info">
                                <span class="task-title">Protocol Stack Visual Editor</span>
                                <span class="task-description">Complete drag-and-drop protocol management</span>
                            </div>
                            <div class="task-controls">
                                <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="task-btn" onclick="updateTaskStatus(this, 'completed')" title="Complete Task">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="task-item priority-medium">
                            <div class="task-info">
                                <span class="task-title">Enterprise LLM Integration</span>
                                <span class="task-description">Ollama + rEngine integration for air-gapped deployments</span>
                            </div>
                            <div class="task-controls">
                                <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="task-btn" onclick="updateTaskStatus(this, 'completed')" title="Complete Task">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="task-item priority-medium">
                            <div class="task-info">
                                <span class="task-title">Health Monitoring Enhancement</span>
                                <span class="task-description">Add performance metrics and alerting</span>
                            </div>
                            <div class="task-controls">
                                <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="task-btn" onclick="updateTaskStatus(this, 'completed')" title="Complete Task">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="task-item priority-low">
                            <div class="task-info">
                                <span class="task-title">Documentation Automation</span>
                                <span class="task-description">Auto-generate API docs and user guides</span>
                            </div>
                            <div class="task-controls">
                                <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="task-btn" onclick="updateTaskStatus(this, 'completed')" title="Complete Task">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="add-task-section">
                        <input type="text" id="newTaskTitle" placeholder="Task title..." class="task-input">
                        <input type="text" id="newTaskDescription" placeholder="Task description..." class="task-input">
                        <select id="newTaskPriority" class="task-select">
                            <option value="low">Low Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="high">High Priority</option>
                        </select>
                        <button onclick="addNewTask()" class="add-task-btn">
                            <i class="fas fa-plus"></i> Add Task
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3><i class="fas fa-mobile-alt"></i> Mobile Vision</h3>
                    <div class="mobile-vision">
                        <div class="vision-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <strong>Conference Debug Scenario</strong>
                                <p>Notice bug in demo ‚Üí Pull out phone ‚Üí Connect to rEngine ‚Üí Tell agent the issue ‚Üí Get fix in seconds</p>
                            </div>
                        </div>
                        <div class="vision-item">
                            <i class="fas fa-terminal"></i>
                            <div>
                                <strong>Remote Console Access</strong>
                                <p>Mobile-friendly terminal with voice commands and smart code completion</p>
                            </div>
                        </div>
                        <div class="vision-item">
                            <i class="fas fa-robot"></i>
                            <div>
                                <strong>AI-Powered Mobile Agent</strong>
                                <p>Lightweight client that offloads all heavy processing to your rEngine server</p>
                            </div>
                        </div>
                        <div class="vision-item">
                            <i class="fas fa-shield-alt"></i>
                            <div>
                                <strong>Secure Enterprise Access</strong>
                                <p>VPN + authentication for secure access to air-gapped enterprise deployments</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3><i class="fas fa-rocket"></i> Strategic Brainstorming</h3>
                    <div class="vision-group">
                        <div class="vision-category">
                            <h4><i class="fas fa-cloud"></i> Memory & Sync Vision</h4>
                            <div class="vision-item">
                                <i class="fas fa-database"></i>
                                <div>
                                    <strong>Turso Cloud Memory Sync</strong>
                                    <p>Laptop ‚Üí Lake scenario protection. Workspace syncs to Turso, accessible from any device</p>
                                </div>
                            </div>
                            <div class="vision-item">
                                <i class="fas fa-key"></i>
                                <div>
                                    <strong>Secure Secrets Sharing</strong>
                                    <p>Encrypted secrets sync via Turso for mobile/desktop seamless handoff</p>
                                </div>
                            </div>
                        </div>

                        <div class="vision-category">
                            <h4><i class="fas fa-mobile-alt"></i> Personal Assistant Evolution</h4>
                            <div class="vision-item">
                                <i class="fas fa-phone-volume"></i>
                                <div>
                                    <strong>Call-Home Research Agent</strong>
                                    <p>Mobile tells home server: "Research competitive analysis for Protocol Stack editors"</p>
                                </div>
                            </div>
                            <div class="vision-item">
                                <i class="fas fa-brain"></i>
                                <div>
                                    <strong>Cross-Device Memory</strong>
                                    <p>Start conversation on mobile, continue on laptop with full context</p>
                                </div>
                            </div>
                        </div>

                        <div class="vision-category">
                            <h4><i class="fas fa-building"></i> Enterprise Market Opportunity</h4>
                            <div class="vision-item">
                                <i class="fas fa-dollar-sign"></i>
                                <div>
                                    <strong>GPT-4o 120B @ $20/month</strong>
                                    <p>Enterprise clients get massive models at affordable pricing. Market is PRIME!</p>
                                </div>
                            </div>
                            <div class="vision-item">
                                <i class="fas fa-chart-line"></i>
                                <div>
                                    <strong>Competitive Advantage</strong>
                                    <p>Stealth ‚Üí HexTrackr ‚Üí rEngine pipeline captures enterprise before they know what hit them</p>
                                </div>
                            </div>
                        </div>

                        <div class="vision-category">
                            <h4><i class="fas fa-magic"></i> Future Integration Dreams</h4>
                            <div class="vision-item">
                                <i class="fas fa-microphone"></i>
                                <div>
                                    <strong>Voice-to-Roadmap</strong>
                                    <p>"Hey rEngine, add this brainstorm to our roadmap" ‚Üí Automatically categorized and prioritized</p>
                                </div>
                            </div>
                            <div class="vision-item">
                                <i class="fas fa-sync-alt"></i>
                                <div>
                                    <strong>Workspace Evolution</strong>
                                    <p>Current workspace tab ‚Üí Future: Full collaborative digital whiteboard with AI insights</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Protocol Stack Editor Tab -->
        <div id="protocols" class="tab-content">
            <div class="protocol-editor">
                <h3><i class="fas fa-layer-group"></i> rEngine Protocol Stack</h3>
                <p>Numbered protocols in execution order. Click any protocol to view/edit full markdown content.</p>
                
                <div class="protocol-tabs">
                    <button class="protocol-tab active" onclick="showProtocolView('stack')">
                        <i class="fas fa-list-ol"></i> Protocol Stack
                    </button>
                    <button class="protocol-tab" onclick="showProtocolView('editor')">
                        <i class="fas fa-edit"></i> Protocol Editor
                    </button>
                    <button class="protocol-tab" onclick="showProtocolView('memory')">
                        <i class="fas fa-brain"></i> Memory System
                    </button>
                </div>

                <div class="protocol-view active" id="stack-view">
                    <div class="protocol-categories">
                        <!-- Foundation Protocols -->
                        <div class="protocol-category">
                            <h4><i class="fas fa-foundation"></i> Foundation Protocols (Execute First)</h4>
                            <div class="numbered-protocols">
                                <div class="protocol-card critical" data-id="001">
                                    <div class="protocol-header">
                                        <span class="protocol-number">001</span>
                                        <span class="protocol-title">Memory Management & Synchronization</span>
                                        <span class="protocol-status critical">CRITICAL</span>
                                    </div>
                                    <div class="protocol-summary">
                                        Dual-memory architecture with MCP memory + local JSON. Manual sync required at session start/end.
                                    </div>
                                    <div class="protocol-actions">
                                        <button onclick="viewProtocol('001')" title="View Full Protocol">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button onclick="editProtocol('001')" title="Edit Protocol">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="executeProtocol('001')" title="Execute Protocol">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="protocol-card critical" data-id="002">
                                    <div class="protocol-header">
                                        <span class="protocol-number">002</span>
                                        <span class="protocol-title">rEngine Startup & Operations</span>
                                        <span class="protocol-status critical">CRITICAL</span>
                                    </div>
                                    <div class="protocol-summary">
                                        Core AI orchestration server startup/shutdown procedures. Docker-based system with health monitoring.
                                    </div>
                                    <div class="protocol-actions">
                                        <button onclick="viewProtocol('002')" title="View Full Protocol">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button onclick="editProtocol('002')" title="Edit Protocol">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="executeProtocol('002')" title="Execute Protocol">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="protocol-card critical" data-id="003">
                                    <div class="protocol-header">
                                        <span class="protocol-number">003</span>
                                        <span class="protocol-title">Enhanced Scribe System</span>
                                        <span class="protocol-status critical">CRITICAL</span>
                                    </div>
                                    <div class="protocol-summary">
                                        Background memory processing with Ollama. Monitors conversations, updates memory matrix automatically.
                                    </div>
                                    <div class="protocol-actions">
                                        <button onclick="viewProtocol('003')" title="View Full Protocol">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button onclick="editProtocol('003')" title="Edit Protocol">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="executeProtocol('003')" title="Execute Protocol">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="protocol-card critical" data-id="004">
                                    <div class="protocol-header">
                                        <span class="protocol-number">004</span>
                                        <span class="protocol-title">Git Safety & Requirements</span>
                                        <span class="protocol-status critical">CRITICAL</span>
                                    </div>
                                    <div class="protocol-summary">
                                        Automatic backup procedures, branch safety, and version control requirements for all operations.
                                    </div>
                                    <div class="protocol-actions">
                                        <button onclick="viewProtocol('004')" title="View Full Protocol">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button onclick="editProtocol('004')" title="Edit Protocol">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="executeProtocol('004')" title="Execute Protocol">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="protocol-card critical" data-id="005">
                                    <div class="protocol-header">
                                        <span class="protocol-number">005</span>
                                        <span class="protocol-title">ES Module Compatibility</span>
                                        <span class="protocol-status critical">CRITICAL</span>
                                    </div>
                                    <div class="protocol-summary">
                                        Ensure ES module compatibility across rEngine platform, preventing import/export conflicts.
                                    </div>
                                    <div class="protocol-actions">
                                        <button onclick="viewProtocol('005')" title="View Full Protocol">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button onclick="editProtocol('005')" title="Edit Protocol">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="executeProtocol('005')" title="Execute Protocol">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Coordination Protocols -->
                        <div class="protocol-category">
                            <h4><i class="fas fa-handshake"></i> Coordination Protocols</h4>
                            <div class="numbered-protocols">
                                <div class="protocol-card high" data-id="006">
                                    <div class="protocol-header">
                                        <span class="protocol-number">006</span>
                                        <span class="protocol-title">Session Handoff</span>
                                        <span class="protocol-status high">HIGH</span>
                                    </div>
                                    <div class="protocol-summary">
                                        Context preservation and agent handoff procedures for session continuity.
                                    </div>
                                    <div class="protocol-actions">
                                        <button onclick="viewProtocol('006')" title="View Full Protocol">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button onclick="editProtocol('006')" title="Edit Protocol">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="executeProtocol('006')" title="Execute Protocol">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="protocol-card high" data-id="019">
                                    <div class="protocol-header">
                                        <span class="protocol-number">019</span>
                                        <span class="protocol-title">Token Limit Management</span>
                                        <span class="protocol-status active">ACTIVE</span>
                                    </div>
                                    <div class="protocol-summary">
                                        Context window optimization and token management for large conversations.
                                    </div>
                                    <div class="protocol-actions">
                                        <button onclick="viewProtocol('019')" title="View Full Protocol">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button onclick="editProtocol('019')" title="Edit Protocol">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="executeProtocol('019')" title="Execute Protocol">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="protocol-view" id="editor-view">
                    <div class="protocol-editor-container">
                        <div class="editor-header">
                            <h4>Protocol Editor</h4>
                            <div class="editor-controls">
                                <select id="protocolSelect" onchange="loadProtocolForEdit()">
                                    <option value="">Select Protocol to Edit</option>
                                    <option value="001">001 - Memory Management</option>
                                    <option value="002">002 - rEngine Startup</option>
                                    <option value="003">003 - Enhanced Scribe</option>
                                    <option value="004">004 - Git Safety</option>
                                    <option value="005">005 - ES Module Compatibility</option>
                                    <option value="006">006 - Session Handoff</option>
                                    <option value="019">019 - Token Management</option>
                                </select>
                                <button onclick="saveProtocol()" class="btn btn-success">
                                    <i class="fas fa-save"></i> Save
                                </button>
                            </div>
                        </div>
                        <div class="markdown-editor">
                            <textarea id="protocolMarkdown" placeholder="Select a protocol to edit or create a new one..."></textarea>
                        </div>
                        <div class="editor-preview" id="markdownPreview">
                            <p>Select a protocol to see its content or start editing...</p>
                        </div>
                    </div>
                </div>

                <div class="protocol-view" id="memory-view">
                    <div class="memory-system-status">
                        <h4><i class="fas fa-brain"></i> Protocol Memory System</h4>
                        <div class="memory-stats">
                            <div class="stat-card">
                                <div class="stat-value">27</div>
                                <div class="stat-label">Total Protocols</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">5</div>
                                <div class="stat-label">Critical</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">100%</div>
                                <div class="stat-label">Memory Sync</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">Active</div>
                                <div class="stat-label">System Status</div>
                            </div>
                        </div>
                        <div class="memory-actions">
                            <button onclick="syncProtocolMemory()" class="btn btn-primary">
                                <i class="fas fa-sync"></i> Sync Memory
                            </button>
                            <button onclick="validateProtocols()" class="btn btn-warning">
                                <i class="fas fa-check-circle"></i> Validate All
                            </button>
                            <button onclick="exportProtocols()" class="btn btn-info">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                                <i class="fas fa-power-off"></i>
                            </button>
                            <button onclick="removeProtocol(this)" title="Remove">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="protocol-item" data-id="code-executor">
                        <div class="protocol-info">
                            <div class="protocol-name">Code Execution Protocol</div>
                            <div class="protocol-description">Sandboxed code execution and testing environment</div>
                        </div>
                        <div class="protocol-controls">
                            <button onclick="editProtocol(this)" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="toggleProtocol(this)" title="Enable/Disable">
                                <i class="fas fa-power-off"></i>
                            </button>
                            <button onclick="removeProtocol(this)" title="Remove">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-success" onclick="saveProtocolStack()">
                        <i class="fas fa-save"></i> Save Configuration
                    </button>
                    <button class="btn btn-warning" onclick="resetProtocolStack()">
                        <i class="fas fa-undo"></i> Reset to Default
                    </button>
                    <button class="btn btn-primary" onclick="exportProtocolStack()">
                        <i class="fas fa-download"></i> Export Configuration
                    </button>
                </div>
            </div>
        </div>

        <!-- Memory System Tab -->
        <div id="memory" class="tab-content">
            <div class="dashboard-grid">
                <div class="card">
                    <h3><i class="fas fa-brain"></i> Memory Health</h3>
                    <ul class="service-list">
                        <li class="service-item">
                            <div>
                                <span class="status-indicator status-healthy"></span>
                                <span class="service-name">Persistent Memory File</span>
                            </div>
                            <span style="color: #4CAF50;">2.3MB</span>
                        </li>
                        <li class="service-item">
                            <div>
                                <span class="status-indicator status-healthy"></span>
                                <span class="service-name">Memory Backups</span>
                            </div>
                            <span style="color: #4CAF50;">12 Files</span>
                        </li>
                        <li class="service-item">
                            <div>
                                <span class="status-indicator status-warning"></span>
                                <span class="service-name">Cross-Project Isolation</span>
                            </div>
                            <span style="color: #FF9800;">Testing</span>
                        </li>
                    </ul>
                </div>

                <div class="card">
                    <h3><i class="fas fa-project-diagram"></i> Project Contexts</h3>
                    <div id="projectContexts">
                        <div class="service-item">
                            <div>
                                <span class="status-indicator status-healthy"></span>
                                <span class="service-name">rEngine Platform</span>
                            </div>
                            <span>Active</span>
                        </div>
                        <div class="service-item">
                            <div>
                                <span class="status-indicator status-unknown"></span>
                                <span class="service-name">StackTrackr</span>
                            </div>
                            <span>Isolated</span>
                        </div>
                        <div class="service-item">
                            <div>
                                <span class="status-indicator status-unknown"></span>
                                <span class="service-name">HexTrackr</span>
                            </div>
                            <span>Isolated</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Logs Tab -->
        <div id="logs" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-file-alt"></i> Real-time System Logs</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="refreshLogs()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-warning" onclick="clearLogs()">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                    <button class="btn btn-success" onclick="downloadLogs()">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
                <div class="log-viewer" id="logViewer">
                    <div class="log-line log-info">[2025-08-23 12:34:56] INFO: rEngine Health Dashboard initialized</div>
                    <div class="log-line log-success">[2025-08-23 12:34:57] SUCCESS: Docker services health check completed</div>
                    <div class="log-line log-info">[2025-08-23 12:34:58] INFO: Memory system status verified</div>
                    <div class="log-line log-warning">[2025-08-23 12:34:59] WARNING: Protocol stack configuration pending</div>
                    <div class="log-line log-success">[2025-08-23 12:35:00] SUCCESS: Network connectivity established</div>
                </div>
            </div>
        </div>

        <!-- My Workspace Tab -->
        <div id="workspace" class="tab-content">
            <div class="workspace-container">
                <div class="workspace-header">
                    <h2><i class="fas fa-clipboard-list"></i> My Persistent Workspace</h2>
                    <div class="workspace-controls">
                        <button onclick="saveWorkspace()" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <button onclick="clearWorkspace()" class="btn btn-warning">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                        <button onclick="exportWorkspace()" class="btn btn-success">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                
                <div class="workspace-tabs">
                    <button class="workspace-tab active" onclick="showWorkspaceTab('notes')">
                        <i class="fas fa-sticky-note"></i> Notes
                    </button>
                    <button class="workspace-tab" onclick="showWorkspaceTab('kanban')">
                        <i class="fas fa-columns"></i> Kanban
                    </button>
                    <button class="workspace-tab" onclick="showWorkspaceTab('canvas')">
                        <i class="fas fa-paint-brush"></i> Canvas
                    </button>
                </div>
                
                <div class="workspace-content">
                    <div class="workspace-section active" id="notes-section">
                        <div class="card">
                            <h3><i class="fas fa-sticky-note"></i> Persistent Notes</h3>
                            <textarea id="notes-area" placeholder="Your persistent notes and thoughts... (Auto-saves every 30 seconds)"></textarea>
                            <div class="notes-status">
                                <span id="save-status" class="save-status">Ready</span>
                                <span id="word-count" class="word-count">0 words</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="workspace-section" id="kanban-section">
                        <div class="card">
                            <h3><i class="fas fa-columns"></i> Task Management</h3>
                            <div class="kanban-board">
                                <div class="kanban-column">
                                    <div class="column-header">
                                        <h4>üìã To Do</h4>
                                        <span class="item-count" id="todo-count">0</span>
                                    </div>
                                    <div class="kanban-items" id="todo-items"></div>
                                    <button onclick="addKanbanItem('todo')" class="add-item-btn">+ Add Task</button>
                                </div>
                                <div class="kanban-column">
                                    <div class="column-header">
                                        <h4>‚ö° In Progress</h4>
                                        <span class="item-count" id="progress-count">0</span>
                                    </div>
                                    <div class="kanban-items" id="progress-items"></div>
                                    <button onclick="addKanbanItem('progress')" class="add-item-btn">+ Add Task</button>
                                </div>
                                <div class="kanban-column">
                                    <div class="column-header">
                                        <h4>‚úÖ Done</h4>
                                        <span class="item-count" id="done-count">0</span>
                                    </div>
                                    <div class="kanban-items" id="done-items"></div>
                                    <button onclick="addKanbanItem('done')" class="add-item-btn">+ Add Task</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="workspace-section" id="canvas-section">
                        <div class="card">
                            <h3><i class="fas fa-paint-brush"></i> Freeform Canvas</h3>
                            <div class="canvas-container">
                                <canvas id="freeform-canvas" width="800" height="600"></canvas>
                                <div class="canvas-tools">
                                    <button onclick="clearCanvas()" class="tool-btn btn-warning">Clear Canvas</button>
                                    <label>Color: <input type="color" id="color-picker" value="#2196F3"></label>
                                    <label>Size: <input type="range" id="brush-size" min="1" max="20" value="3"></label>
                                    <button onclick="saveCanvas()" class="tool-btn btn-primary">Save Drawing</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Initialize Protocol Stack Sortable
        document.addEventListener('DOMContentLoaded', function() {
            const protocolStack = document.getElementById('protocolStack');
            new Sortable(protocolStack, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                onEnd: function(evt) {
                    console.log('Protocol order changed:', evt.oldIndex, '->', evt.newIndex);
                    saveProtocolOrder();
                }
            });
            
            // Initialize tasks with current priorities
            initializeTasks();
            
            // Start real-time updates
            startHealthMonitoring();
            
            // Initialize mobile API logging
            initMobileAPI();
        });

        // Protocol Stack Management
        function addProtocol() {
            const name = document.getElementById('protocolName').value;
            const description = document.getElementById('protocolDescription').value;
            
            if (!name) {
                alert('Please enter a protocol name');
                return;
            }
            
            const protocolStack = document.getElementById('protocolStack');
            const protocolItem = document.createElement('div');
            protocolItem.className = 'protocol-item';
            protocolItem.setAttribute('data-id', name.toLowerCase().replace(/\s+/g, '-'));
            
            protocolItem.innerHTML = `
                <div class="protocol-info">
                    <div class="protocol-name">${name}</div>
                    <div class="protocol-description">${description || 'No description provided'}</div>
                </div>
                <div class="protocol-controls">
                    <button onclick="editProtocol(this)" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="toggleProtocol(this)" title="Enable/Disable">
                        <i class="fas fa-power-off"></i>
                    </button>
                    <button onclick="removeProtocol(this)" title="Remove">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            protocolStack.appendChild(protocolItem);
            
            // Clear form
            document.getElementById('protocolName').value = '';
            document.getElementById('protocolDescription').value = '';
        }

        function editProtocol(button) {
            const protocolItem = button.closest('.protocol-item');
            const nameElement = protocolItem.querySelector('.protocol-name');
            const descElement = protocolItem.querySelector('.protocol-description');
            
            const newName = prompt('Edit protocol name:', nameElement.textContent);
            const newDesc = prompt('Edit protocol description:', descElement.textContent);
            
            if (newName) nameElement.textContent = newName;
            if (newDesc) descElement.textContent = newDesc;
        }

        function toggleProtocol(button) {
            const protocolItem = button.closest('.protocol-item');
            protocolItem.style.opacity = protocolItem.style.opacity === '0.5' ? '1' : '0.5';
        }

        function removeProtocol(button) {
            if (confirm('Are you sure you want to remove this protocol?')) {
                button.closest('.protocol-item').remove();
            }
        }

        function saveProtocolStack() {
            const protocols = Array.from(document.querySelectorAll('.protocol-item')).map(item => ({
                id: item.getAttribute('data-id'),
                name: item.querySelector('.protocol-name').textContent,
                description: item.querySelector('.protocol-description').textContent,
                enabled: item.style.opacity !== '0.5'
            }));
            
            localStorage.setItem('protocolStack', JSON.stringify(protocols));
            alert('Protocol stack saved successfully!');
        }

        function saveProtocolOrder() {
            // This would typically save to backend
            console.log('Protocol order saved');
        }

        function resetProtocolStack() {
            if (confirm('This will reset all protocols to default. Continue?')) {
                location.reload();
            }
        }

        function exportProtocolStack() {
            const protocols = Array.from(document.querySelectorAll('.protocol-item')).map(item => ({
                id: item.getAttribute('data-id'),
                name: item.querySelector('.protocol-name').textContent,
                description: item.querySelector('.protocol-description').textContent,
                enabled: item.style.opacity !== '0.5'
            }));
            
            const dataStr = JSON.stringify(protocols, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'protocol-stack-config.json';
            link.click();
        }

        // Health Monitoring Functions
        function startHealthMonitoring() {
            // Simulate real-time updates
            setInterval(updateMetrics, 5000);
            setInterval(updateLogs, 3000);
        }

        function updateMetrics() {
            // Simulate metric updates
            document.getElementById('cpuUsage').textContent = Math.floor(Math.random() * 50 + 10) + '%';
            document.getElementById('memoryUsage').textContent = (Math.random() * 2 + 0.5).toFixed(1) + 'GB';
            document.getElementById('activeConnections').textContent = Math.floor(Math.random() * 100 + 20);
        }

        function updateLogs() {
            const logViewer = document.getElementById('logViewer');
            const timestamp = new Date().toISOString().replace('T', ' ').split('.')[0];
            const logTypes = ['info', 'success', 'warning', 'error'];
            const logType = logTypes[Math.floor(Math.random() * logTypes.length)];
            
            const messages = {
                info: 'System heartbeat check completed',
                success: 'Service health verification passed',
                warning: 'Memory usage approaching threshold',
                error: 'Temporary connection timeout detected'
            };
            
            const logLine = document.createElement('div');
            logLine.className = `log-line log-${logType}`;
            logLine.textContent = `[${timestamp}] ${logType.toUpperCase()}: ${messages[logType]}`;
            
            logViewer.appendChild(logLine);
            
            // Keep only last 100 lines
            while (logViewer.children.length > 100) {
                logViewer.removeChild(logViewer.firstChild);
            }
            
            logViewer.scrollTop = logViewer.scrollHeight;
        }

        // Health Check Functions
        function refreshServices() {
            alert('Refreshing service status...');
            // This would typically make API calls to check actual service status
        }

        function startAllServices() {
            alert('Starting all services...');
            // This would execute: docker-compose -f docker-compose-enhanced.yml up -d
        }

        function runHealthCheck() {
            alert('Running comprehensive health check...');
            // This would execute the health-check.sh script
        }

        function restartServices() {
            if (confirm('This will restart all services. Continue?')) {
                alert('Restarting all services...');
                // This would execute: docker-compose -f docker-compose-enhanced.yml restart
            }
        }

        function generateReport() {
            alert('Generating health report...');
            // This would execute: ./health-check.sh --report
        }

        function emergencyStop() {
            if (confirm('This will stop all services immediately. Continue?')) {
                alert('Emergency stop initiated...');
                // This would execute: docker-compose -f docker-compose-enhanced.yml down
            }
        }

        function testConnectivity() {
            alert('Testing network connectivity...');
        }

        function refreshLogs() {
            document.getElementById('logViewer').innerHTML = '<div class="log-line log-info">[' + new Date().toISOString().replace('T', ' ').split('.')[0] + '] INFO: Logs refreshed</div>';
        }

        function clearLogs() {
            if (confirm('Clear all logs?')) {
                document.getElementById('logViewer').innerHTML = '';
            }
        }

        function downloadLogs() {
            const logs = document.getElementById('logViewer').textContent;
            const dataBlob = new Blob([logs], {type: 'text/plain'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'system-logs-' + new Date().toISOString().split('T')[0] + '.txt';
            link.click();
        }

        // Task Management Functions
        function updateTaskStatus(button, newStatus) {
            const taskItem = button.closest('.task-item');
            const taskTitle = taskItem.querySelector('.task-title').textContent;
            
            // Remove existing status classes
            taskItem.classList.remove('completed', 'in-progress', 'pending');
            
            // Add new status
            switch(newStatus) {
                case 'completed':
                    taskItem.classList.add('completed');
                    button.innerHTML = '<i class="fas fa-check"></i>';
                    button.style.background = 'rgba(76, 175, 80, 0.2)';
                    button.style.color = '#4CAF50';
                    break;
                case 'in-progress':
                    taskItem.classList.add('in-progress');
                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    button.style.background = 'rgba(255, 152, 0, 0.2)';
                    button.style.color = '#FF9800';
                    break;
                case 'pending':
                    taskItem.classList.add('pending');
                    button.innerHTML = '<i class="fas fa-clock"></i>';
                    button.style.background = 'rgba(0, 123, 255, 0.2)';
                    button.style.color = '#007bff';
                    break;
            }
            
            console.log(`Task "${taskTitle}" status updated to: ${newStatus}`);
            saveTasks();
        }

        function addNewTask() {
            const title = document.getElementById('newTaskTitle').value;
            const description = document.getElementById('newTaskDescription').value;
            const priority = document.getElementById('newTaskPriority').value;
            
            if (!title.trim()) {
                alert('Please enter a task title');
                return;
            }
            
            const taskList = document.getElementById('criticalTasks');
            const taskItem = document.createElement('div');
            taskItem.className = `task-item priority-${priority}`;
            
            taskItem.innerHTML = `
                <div class="task-info">
                    <span class="task-title">${title}</span>
                    <span class="task-description">${description || 'No description'}</span>
                </div>
                <div class="task-controls">
                    <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="task-btn" onclick="updateTaskStatus(this, 'completed')" title="Complete Task">
                        <i class="fas fa-check"></i>
                    </button>
                    <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            // Insert based on priority
            const existingTasks = taskList.querySelectorAll('.task-item');
            let inserted = false;
            
            for (let i = 0; i < existingTasks.length; i++) {
                const existingPriority = existingTasks[i].classList.contains('priority-high') ? 'high' :
                                       existingTasks[i].classList.contains('priority-medium') ? 'medium' : 'low';
                
                if (shouldInsertBefore(priority, existingPriority)) {
                    taskList.insertBefore(taskItem, existingTasks[i]);
                    inserted = true;
                    break;
                }
            }
            
            if (!inserted) {
                taskList.appendChild(taskItem);
            }
            
            // Clear form
            document.getElementById('newTaskTitle').value = '';
            document.getElementById('newTaskDescription').value = '';
            document.getElementById('newTaskPriority').value = 'low';
            
            saveTasks();
        }

        function shouldInsertBefore(newPriority, existingPriority) {
            const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
            return priorityOrder[newPriority] > priorityOrder[existingPriority];
        }

        function removeTask(button) {
            const taskItem = button.closest('.task-item');
            const taskTitle = taskItem.querySelector('.task-title').textContent;
            
            if (confirm(`Remove task: "${taskTitle}"?`)) {
                taskItem.remove();
                saveTasks();
            }
        }

        function saveTasks() {
            const tasks = Array.from(document.querySelectorAll('#criticalTasks .task-item')).map(item => ({
                title: item.querySelector('.task-title').textContent,
                description: item.querySelector('.task-description').textContent,
                priority: item.classList.contains('priority-high') ? 'high' :
                         item.classList.contains('priority-medium') ? 'medium' : 'low',
                status: item.classList.contains('completed') ? 'completed' :
                       item.classList.contains('in-progress') ? 'in-progress' : 'pending'
            }));
            
            localStorage.setItem('rEngineTasks', JSON.stringify(tasks));
            console.log('Tasks saved to localStorage');
        }

        function loadTasks() {
            const saved = localStorage.getItem('rEngineTasks');
            if (saved) {
                const tasks = JSON.parse(saved);
                // This would restore tasks from localStorage
                console.log('Loaded tasks:', tasks);
            }
        }

        // Initialize with current priority tasks (August 2025)
        function initializeTasks() {
            const sampleTasks = [
                {
                    title: 'Self-Hosted LLM Integration',
                    description: 'Implement Llama 70B/405B as Claude assistant - save massive token costs while maintaining quality',
                    priority: 'high'
                },
                {
                    title: 'Hardware Upgrade: 16GB ‚Üí 64GB+ RAM',
                    description: 'Scale system to support local LLM inference and multi-model operations',
                    priority: 'high'
                },
                {
                    title: 'Hybrid AI Architecture',
                    description: 'Claude sends prompts to local Llama ‚Üí inspects results ‚Üí everyone wins (token savings)',
                    priority: 'high'
                },
                {
                    title: 'Mobile Agent API for Conference Debugging',
                    description: 'Phone-based agent to dial into rEngine, identify bugs, deploy fixes in seconds',
                    priority: 'medium'
                },
                {
                    title: 'Enterprise Air-Gap Deployment',
                    description: 'Government-ready offline deployment with local LLM for classified environments',
                    priority: 'medium'
                },
                {
                    title: 'Complete Protocol Stack Visual Editor',
                    description: 'Finalize drag-and-drop interface for AI development workflow management',
                    priority: 'low'
                }
            ];

            // Clear existing tasks and add sample tasks
            const taskList = document.getElementById('criticalTasks');
            taskList.innerHTML = '';
            
            sampleTasks.forEach(task => {
                addTaskToList(task.title, task.description, task.priority);
            });
        }

        function addTaskToList(title, description, priority) {
            const taskList = document.getElementById('criticalTasks');
            const taskItem = document.createElement('div');
            taskItem.className = `task-item priority-${priority}`;
            
            taskItem.innerHTML = `
                <div class="task-info">
                    <span class="task-title">${title}</span>
                    <span class="task-description">${description}</span>
                </div>
                <div class="task-controls">
                    <button class="task-btn" onclick="updateTaskStatus(this, 'in-progress')" title="Start Task">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="task-btn" onclick="updateTaskStatus(this, 'completed')" title="Complete Task">
                        <i class="fas fa-check"></i>
                    </button>
                    <button class="task-btn" onclick="removeTask(this)" title="Remove Task">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            // Insert based on priority (high priority first)
            const existingTasks = taskList.querySelectorAll('.task-item');
            let inserted = false;
            
            for (let existingTask of existingTasks) {
                const existingPriority = existingTask.classList.contains('priority-high') ? 'high' :
                                       existingTask.classList.contains('priority-medium') ? 'medium' : 'low';
                
                if (shouldInsertBefore(priority, existingPriority)) {
                    taskList.insertBefore(taskItem, existingTask);
                    inserted = true;
                    break;
                }
            }
            
            if (!inserted) {
                taskList.appendChild(taskItem);
            }
        }

        // Task Board Functions
        function startTask(button) {
            const card = button.closest('.task-card');
            const title = card.querySelector('.task-title').textContent;
            const status = card.querySelector('.task-status');
            
            status.textContent = 'üü° In Progress';
            status.style.color = '#FF9800';
            
            console.log(`üöÄ Started task: ${title}`);
            
            // Update task counts
            updateTaskCounts();
        }

        function viewDetails(button) {
            const card = button.closest('.task-card');
            const title = card.querySelector('.task-title').textContent;
            const description = card.querySelector('.task-description').textContent;
            const project = card.querySelector('.task-project').textContent;
            const effort = card.querySelector('.task-effort').textContent;
            
            alert(`Task Details:\n\nTitle: ${title}\nProject: ${project}\nEffort: ${effort}\n\nDescription:\n${description}`);
        }

        function updateTaskCounts() {
            ['critical', 'high', 'medium', 'completed'].forEach(priority => {
                const tasks = document.querySelectorAll(`#${priority}-tasks .task-card`);
                document.getElementById(`${priority}-count`).textContent = tasks.length;
            });
        }

        // Task Drag and Drop
        let draggedTaskCard = null;

        function initTaskDragDrop() {
            const taskCards = document.querySelectorAll('.task-card');
            const taskColumns = document.querySelectorAll('.task-cards');
            
            taskCards.forEach(card => {
                card.addEventListener('dragstart', function(e) {
                    draggedTaskCard = this;
                    this.classList.add('dragging');
                });
                
                card.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                });
            });
            
            taskColumns.forEach(column => {
                column.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = '#e3f2fd';
                });
                
                column.addEventListener('dragleave', function(e) {
                    this.style.backgroundColor = '';
                });
                
                column.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = '';
                    
                    if (draggedTaskCard && draggedTaskCard.parentElement !== this) {
                        this.appendChild(draggedTaskCard);
                        updateTaskCounts();
                        updateSprintProgress();
                        console.log('‚úÖ Task moved successfully');
                    }
                });
            });
        }

        function updateSprintProgress() {
            const totalTasks = document.querySelectorAll('.task-card').length;
            const completedTasks = document.querySelectorAll('#completed-tasks .task-card').length;
            const progressPercent = Math.round((completedTasks / totalTasks) * 100);
            
            document.querySelector('.progress-fill').style.width = `${progressPercent}%`;
            document.querySelector('.progress-text').textContent = `${progressPercent}% Complete`;
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initTaskDragDrop();
            updateTaskCounts();
            updateSprintProgress();
        });

        // Workspace Functions
        let workspaceData = {
            notes: '',
            kanban: {
                todo: [],
                progress: [],
                done: []
            },
            canvas: null
        };

        // Auto-save interval
        let autoSaveInterval;

        function showWorkspaceTab(tabName) {
            // Hide all workspace sections
            const sections = document.querySelectorAll('.workspace-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Remove active class from all workspace tabs
            const tabs = document.querySelectorAll('.workspace-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected section
            document.getElementById(`${tabName}-section`).classList.add('active');
            
            // Activate selected tab
            event.target.classList.add('active');
            
            // Initialize specific workspace features
            if (tabName === 'canvas') {
                initCanvas();
            }
        }

        function saveWorkspace() {
            try {
                // Save notes
                workspaceData.notes = document.getElementById('notes-area').value;
                
                // Save kanban data
                ['todo', 'progress', 'done'].forEach(status => {
                    const items = document.querySelectorAll(`#${status}-items .kanban-item`);
                    workspaceData.kanban[status] = Array.from(items).map(item => item.querySelector('.kanban-item-text').textContent);
                });
                
                // Save canvas data
                const canvas = document.getElementById('freeform-canvas');
                if (canvas) {
                    workspaceData.canvas = canvas.toDataURL();
                }
                
                // Store in localStorage
                localStorage.setItem('rEngine-workspace', JSON.stringify(workspaceData));
                
                // Update save status
                const saveStatus = document.getElementById('save-status');
                saveStatus.textContent = 'Saved';
                saveStatus.className = 'save-status';
                
                console.log('‚úÖ Workspace saved successfully');
            } catch (error) {
                console.error('‚ùå Failed to save workspace:', error);
                const saveStatus = document.getElementById('save-status');
                saveStatus.textContent = 'Error';
                saveStatus.className = 'save-status error';
            }
        }

        function loadWorkspace() {
            try {
                const saved = localStorage.getItem('rEngine-workspace');
                if (saved) {
                    workspaceData = JSON.parse(saved);
                    
                    // Load notes
                    if (workspaceData.notes) {
                        document.getElementById('notes-area').value = workspaceData.notes;
                        updateWordCount();
                    }
                    
                    // Load kanban boards
                    if (workspaceData.kanban) {
                        Object.keys(workspaceData.kanban).forEach(status => {
                            const items = workspaceData.kanban[status];
                            const container = document.getElementById(`${status}-items`);
                            container.innerHTML = '';
                            items.forEach(itemText => {
                                addKanbanItemWithText(status, itemText);
                            });
                            updateItemCount(status);
                        });
                    }
                    
                    // Load canvas
                    if (workspaceData.canvas) {
                        const canvas = document.getElementById('freeform-canvas');
                        const ctx = canvas.getContext('2d');
                        const img = new Image();
                        img.onload = function() {
                            ctx.drawImage(img, 0, 0);
                        };
                        img.src = workspaceData.canvas;
                    }
                    
                    console.log('‚úÖ Workspace loaded successfully');
                }
            } catch (error) {
                console.error('‚ùå Failed to load workspace:', error);
            }
        }

        function clearWorkspace() {
            if (confirm('Are you sure you want to clear all workspace data? This cannot be undone.')) {
                // Clear notes
                document.getElementById('notes-area').value = '';
                
                // Clear kanban boards
                ['todo', 'progress', 'done'].forEach(status => {
                    document.getElementById(`${status}-items`).innerHTML = '';
                    updateItemCount(status);
                });
                
                // Clear canvas
                const canvas = document.getElementById('freeform-canvas');
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
                
                // Clear localStorage
                localStorage.removeItem('rEngine-workspace');
                
                // Reset workspace data
                workspaceData = {
                    notes: '',
                    kanban: { todo: [], progress: [], done: [] },
                    canvas: null
                };
                
                updateWordCount();
                console.log('‚úÖ Workspace cleared');
            }
        }

        function exportWorkspace() {
            const dataStr = JSON.stringify(workspaceData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `rEngine-workspace-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            console.log('‚úÖ Workspace exported');
        }

        // Notes Functions
        function updateWordCount() {
            const notes = document.getElementById('notes-area').value;
            const wordCount = notes.trim().split(/\s+/).filter(word => word.length > 0).length;
            document.getElementById('word-count').textContent = `${wordCount} words`;
        }

        // Kanban Functions
        function addKanbanItem(status) {
            const text = prompt(`Enter task for ${status.replace('-', ' ')}:`);
            if (text && text.trim()) {
                addKanbanItemWithText(status, text.trim());
                updateItemCount(status);
                saveWorkspace();
            }
        }

        function addKanbanItemWithText(status, text) {
            const container = document.getElementById(`${status}-items`);
            const item = document.createElement('div');
            item.className = 'kanban-item';
            item.draggable = true;
            item.innerHTML = `
                <div class="kanban-item-header">
                    <span class="kanban-item-text">${text}</span>
                    <div class="kanban-item-actions">
                        <button onclick="editKanbanItem(this)" title="Edit">‚úèÔ∏è</button>
                        <button onclick="deleteKanbanItem(this)" title="Delete">üóëÔ∏è</button>
                    </div>
                </div>
            `;
            
            // Add drag and drop functionality
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('dragend', handleDragEnd);
            
            container.appendChild(item);
        }

        function editKanbanItem(button) {
            const textElement = button.closest('.kanban-item').querySelector('.kanban-item-text');
            const currentText = textElement.textContent;
            const newText = prompt('Edit task:', currentText);
            if (newText && newText.trim() && newText !== currentText) {
                textElement.textContent = newText.trim();
                saveWorkspace();
            }
        }

        function deleteKanbanItem(button) {
            if (confirm('Delete this task?')) {
                const item = button.closest('.kanban-item');
                const container = item.parentElement;
                const status = container.id.replace('-items', '');
                item.remove();
                updateItemCount(status);
                saveWorkspace();
            }
        }

        function updateItemCount(status) {
            const items = document.querySelectorAll(`#${status}-items .kanban-item`);
            document.getElementById(`${status}-count`).textContent = items.length;
        }

        // Drag and Drop for Kanban
        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }

        // Canvas Functions
        let isDrawing = false;
        let canvas, ctx;

        function initCanvas() {
            canvas = document.getElementById('freeform-canvas');
            if (!canvas) return;
            
            ctx = canvas.getContext('2d');
            
            // Set up drawing
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
            
            // Set initial brush properties
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }

        function startDrawing(e) {
            isDrawing = true;
            draw(e);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const color = document.getElementById('color-picker').value;
            const size = document.getElementById('brush-size').value;
            
            ctx.globalCompositeOperation = 'source-over';
            ctx.strokeStyle = color;
            ctx.lineWidth = size;
            
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                ctx.beginPath();
                saveWorkspace();
            }
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type.replace('touch', 'mouse'), {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function clearCanvas() {
            if (confirm('Clear the canvas? This cannot be undone.')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                saveWorkspace();
            }
        }

        function saveCanvas() {
            workspaceData.canvas = canvas.toDataURL();
            localStorage.setItem('rEngine-workspace', JSON.stringify(workspaceData));
            console.log('‚úÖ Canvas saved');
        }

        // Initialize workspace on load
        document.addEventListener('DOMContentLoaded', function() {
            // Set up notes auto-save and word count
            const notesArea = document.getElementById('notes-area');
            if (notesArea) {
                notesArea.addEventListener('input', function() {
                    updateWordCount();
                    const saveStatus = document.getElementById('save-status');
                    saveStatus.textContent = 'Saving...';
                    saveStatus.className = 'save-status saving';
                    
                    clearTimeout(autoSaveInterval);
                    autoSaveInterval = setTimeout(saveWorkspace, 2000);
                });
            }
            
            // Set up drag and drop for kanban columns
            ['todo', 'progress', 'done'].forEach(status => {
                const column = document.getElementById(`${status}-items`);
                if (column) {
                    column.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        this.style.backgroundColor = '#e3f2fd';
                    });
                    
                    column.addEventListener('dragleave', function(e) {
                        this.style.backgroundColor = '';
                    });
                    
                    column.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.style.backgroundColor = '';
                        
                        if (draggedElement && draggedElement.parentElement !== this) {
                            // Update counts
                            const oldStatus = draggedElement.parentElement.id.replace('-items', '');
                            const newStatus = this.id.replace('-items', '');
                            
                            this.appendChild(draggedElement);
                            updateItemCount(oldStatus);
                            updateItemCount(newStatus);
                            saveWorkspace();
                        }
                    });
                }
            });
            
            // Load saved workspace data
            loadWorkspace();
        });

        // Mobile Agent API Functions (placeholder for future development)
        function initMobileAPI() {
            console.log('üîó Mobile API endpoint would be: /api/mobile/connect');
            console.log('üì± Features to implement:');
            console.log('  - Lightweight authentication');
            console.log('  - Voice command processing');
            console.log('  - Real-time terminal access');
            console.log('  - File editing capabilities');
            console.log('  - Emergency bug fix workflows');
            console.log('  - Conference demo emergency debugging');
            console.log('  - Hybrid LLM orchestration (Claude + Local Llama)');
        }

        // Protocol Stack Management Functions
        function switchProtocolTab(tab) {
            const tabs = document.querySelectorAll('.protocol-tab');
            const views = document.querySelectorAll('.protocol-view');
            
            tabs.forEach(t => t.classList.remove('active'));
            views.forEach(v => v.classList.remove('active'));
            
            document.querySelector(`[onclick="switchProtocolTab('${tab}')"]`).classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        function viewProtocol(number) {
            switchProtocolTab('protocolEditor');
            loadProtocolForEditing(number);
        }

        function editProtocol(number) {
            switchProtocolTab('protocolEditor');
            loadProtocolForEditing(number);
            setTimeout(() => {
                document.getElementById('protocolMarkdown').focus();
            }, 100);
        }

        async function loadProtocolForEditing(number) {
            const protocols = {
                '001': {
                    title: '001-FOUNDATION-001 - Core Foundation Protocol',
                    content: `# 001-FOUNDATION-001: Core Foundation Protocol

## Purpose
Establishes the foundational framework for all rEngine operations and agent interactions.

## Key Components
- Agent initialization procedures
- Core system validation
- Base protocol hierarchy
- Foundation safety checks

## Validation Checklist
- [ ] Core systems initialized
- [ ] Base protocols loaded
- [ ] Agent framework ready
- [ ] Foundation validation complete

## Implementation
This protocol runs automatically on system startup and establishes the base framework for all subsequent operations.`
                },
                '005': {
                    title: '005-ES-MODULE-001 - ES Module Compatibility',
                    content: `# 005-ES-MODULE-001: ES Module Compatibility Protocol

## Purpose
Ensure ES module compatibility across the rEngine platform to prevent import/export conflicts and enable seamless module integration.

## Critical Validation
Before proceeding with any file operations:
- [ ] Check file extension (.js vs .mjs vs .cjs)
- [ ] Verify package.json "type" field
- [ ] Validate import/export syntax consistency
- [ ] Test module resolution paths

## Common ES Module Violations & Fixes
1. **Mixed Module Syntax**
   - Issue: Using require() in ES modules or import in CommonJS
   - Fix: Consistent syntax per module type
   
2. **Missing File Extensions**
   - Issue: import './file' instead of './file.js'
   - Fix: Always specify .js extension for ES modules

3. **Package.json Misconfiguration**
   - Issue: Missing or incorrect "type": "module"
   - Fix: Add proper type declaration

## Emergency Rollback
If ES module changes break the system:
1. Revert package.json changes
2. Restore .cjs extensions where needed
3. Use emergency-recovery.sh protocol`
                }
            };

            const protocol = protocols[number.toString().padStart(3, '0')];
            if (protocol) {
                document.getElementById('currentProtocolTitle').textContent = protocol.title;
                document.getElementById('protocolMarkdown').value = protocol.content;
                updateProtocolPreview();
            }
        }

        function updateProtocolPreview() {
            const markdown = document.getElementById('protocolMarkdown').value;
            const preview = document.getElementById('protocolPreview');
            
            // Simple markdown to HTML conversion
            let html = markdown
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^\- \[ \] (.*$)/gm, '<input type="checkbox" disabled> $1<br>')
                .replace(/^\- \[x\] (.*$)/gm, '<input type="checkbox" checked disabled> $1<br>')
                .replace(/^\- (.*$)/gm, '‚Ä¢ $1<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
            
            preview.innerHTML = html;
        }

        function saveProtocol() {
            const title = document.getElementById('currentProtocolTitle').textContent;
            const content = document.getElementById('protocolMarkdown').value;
            
            // Simulate saving
            showNotification(`Protocol saved: ${title}`, 'success');
        }

        function previewProtocol() {
            updateProtocolPreview();
            showNotification('Preview updated!', 'success');
        }

        function exportProtocol() {
            const title = document.getElementById('currentProtocolTitle').textContent;
            const content = document.getElementById('protocolMarkdown').value;
            
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = title.replace(/[^a-zA-Z0-9]/g, '_') + '.md';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Memory System Functions
        function syncMemory() {
            showNotification('Memory sync initiated...', 'info');
            setTimeout(() => {
                showNotification('Memory sync completed successfully!', 'success');
                updateMemoryStats();
            }, 2000);
        }

        function validateMemory() {
            showNotification('Memory validation in progress...', 'info');
            setTimeout(() => {
                showNotification('Memory validation completed - All protocols verified!', 'success');
            }, 1500);
        }

        function backupMemory() {
            showNotification('Creating memory backup...', 'info');
            setTimeout(() => {
                showNotification('Memory backup created successfully!', 'success');
            }, 1000);
        }

        function updateMemoryStats() {
            // Simulate updating memory statistics
            const statCards = document.querySelectorAll('.stat-card .stat-value');
            if (statCards.length >= 4) {
                statCards[0].textContent = '27';
                statCards[1].textContent = '94%';
                statCards[2].textContent = new Date().toLocaleTimeString();
                statCards[3].textContent = '2.1MB';
            }
        }

        // Initialize Protocol System on load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize protocol markdown editor if it exists
            const markdownEditor = document.getElementById('protocolMarkdown');
            if (markdownEditor) {
                markdownEditor.addEventListener('input', updateProtocolPreview);
            }
            
            // Update memory stats on load
            setTimeout(updateMemoryStats, 1000);
            
            // Set up auto-refresh for memory stats
            setInterval(updateMemoryStats, 30000); // Update every 30 seconds
        });
    </script>
</body>
</html>

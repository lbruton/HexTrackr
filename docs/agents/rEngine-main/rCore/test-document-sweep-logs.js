#!/usr/bin/env node

/**
 * Test Document Sweep Log Monitoring
 * Creates sample log entries to test the parsing functionality
 */

import fs from 'fs/promises';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const baseDir = path.dirname(__dirname);
const testLogPath = path.join(baseDir, 'logs', 'document-sweep.log');

// Sample log entries that would be generated by document-sweep.js
const sampleLogEntries = [
    'ğŸš€ Starting document sweep...',
    'ğŸ“„ Generating docs for: rEngine/smart-scribe.js',
    'âœ… Success: smart-scribe.js',
    'ğŸ“„ Generating docs for: js/app.js', 
    'âœ… Success: app.js',
    'ğŸ“Š Diff saved: app_2025-08-17T23-45-00-123Z.diff',
    'ğŸ‰ DOCUMENT SWEEP COMPLETE',
    'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•',
    'ğŸ“Š Total files processed: 195',
    'âœ… Successfully generated: 190',
    'âŒ Failed: 5',
    'ğŸ“ˆ Success rate: 97.4%',
    'â±ï¸  Duration: 120.5s',
    'ğŸ”„ Documentation updates: 25',
    'ğŸ“Š Diffs generated: 25',
    'ğŸ§  Powered by: Gemini 1.5 Pro API'
];

async function createTestLog() {
    try {
        // Ensure logs directory exists
        await fs.mkdir(path.dirname(testLogPath), { recursive: true });
        
        console.log('ğŸ“ Creating test document sweep log...');
        
        // Write sample entries with delays to simulate real-time logging
        for (let i = 0; i < sampleLogEntries.length; i++) {
            const entry = sampleLogEntries[i];
            const timestamp = new Date().toISOString();
            const logLine = `${timestamp} | ${entry}\n`;
            
            await fs.appendFile(testLogPath, logLine);
            console.log(`âœ… Added: ${entry}`);
            
            // Small delay between entries
            await new Promise(resolve => setTimeout(resolve, 200));
        }
        
        console.log(`\nğŸ“Š Test log created at: ${testLogPath}`);
        console.log('ğŸ” The Split Scribe Console should now detect and parse these entries!');
        
    } catch (error) {
        console.error('âŒ Error creating test log:', error.message);
    }
}

// Run the test
createTestLog();

# Version 1.1.4

**Release Date:** October 23, 2025
**Issue:** [HEX-340](https://linear.app/hextrackr/issue/HEX-340)

## Overview

Major Node.js runtime upgrade from v18 LTS to v22 LTS, improving performance, security, and long-term support through April 2027.

## Infrastructure Upgrades

### Node.js 22 LTS Migration
- **Upgraded Node.js**: v18.20.8 → v22.21.0
- **Extended Support**: LTS support through April 2027 (vs April 2025 for v18)
- **Container Image**: Updated from `node:18-alpine` to `node:22-alpine`
- **Performance**: Improved V8 JavaScript engine with better JIT compilation
- **Security**: Latest security patches and vulnerability fixes

### Build System Improvements
- **Native Module Compilation**: Fixed Docker multi-stage build to properly rebuild native modules in production environment
- **Python 3.12 Compatibility**: Added `py3-setuptools` to provide distutils for node-gyp compilation
- **Better-sqlite3**: Upgraded to v12.4.1 for improved Node.js 22 compatibility
- **Build Isolation**: Ensured native modules (`better-sqlite3`, `argon2`) compile with correct V8 ABI version

## Bug Fixes

### Database Service
- **Fixed**: Typo in `databaseService.js:863` causing runtime error (`this.this._audit` → `this._audit`)
- **Impact**: VACUUM operations now properly audit log without crashes

### Authentication System
- **Fixed**: Missing security columns in users table preventing login
- **Added Columns**: `failed_attempts`, `locked_until`, `last_login`, `failed_login_timestamp`
- **Password Hash**: Regenerated admin password hash for argon2 v0.31.2 compatibility

## Technical Details

### Dockerfile Changes
```dockerfile
# Production stage now rebuilds native modules
RUN apk add --no-cache sqlite python3 py3-setuptools make g++
RUN npm rebuild better-sqlite3 argon2
```

### Database Schema Updates
- Ensured v1.1.0 schema compliance across all tables
- Added audit logging tables (`audit_logs`, `audit_log_config`)
- Added sync metadata tracking (`sync_metadata` with `next_sync_time`)
- Verified all 21 application tables present

## Deployment Notes

### Upgrade Path
1. Backup existing database before upgrade
2. Build new Docker image with Node.js 22
3. Apply database migrations for missing columns/tables
4. Verify native modules compile correctly
5. Test authentication and core functionality

### Breaking Changes
None - backward compatible with existing data and configurations

### Known Issues
- Docker Desktop migration may require manual database restore from backups
- Nginx health checks may show unhealthy temporarily after restart (self-heals)

## Performance Impact

- **Build Time**: ~5 minutes for full rebuild with native modules
- **Runtime**: No performance degradation, slight improvement in async operations
- **Memory**: Same 4GB heap allocation, more efficient garbage collection
- **Startup**: ~8 seconds to healthy state

## Related Issues

- [HEX-254](https://linear.app/hextrackr/issue/HEX-254): Audit logging infrastructure (tables added)
- Database schema alignment with v1.1.0 baseline

## Credits

Generated with Claude Code

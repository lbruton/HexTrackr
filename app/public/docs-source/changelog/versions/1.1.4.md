# Version 1.1.4

**Release Date:** October 23, 2025
**Issue:** [HEX-340](https://linear.app/hextrackr/issue/HEX-340)

## Overview

Major Node.js runtime upgrade from v18 LTS to v22 LTS, improving performance, security, and long-term support through April 2027.

## Infrastructure Upgrades

### Node.js 22 LTS Migration
- **Upgraded Node.js**: v18.20.8 → v22.21.0
- **Extended Support**: LTS support through April 2027 (vs April 2025 for v18)
- **Container Image**: Updated from `node:18-alpine` to `node:22-alpine`
- **Performance**: Improved V8 JavaScript engine with better JIT compilation
- **Security**: Latest security patches and vulnerability fixes

### Build System Improvements
- **Native Module Compilation**: Fixed Docker multi-stage build to properly rebuild native modules in production environment
- **Python 3.12 Compatibility**: Added `py3-setuptools` to provide distutils for node-gyp compilation
- **Better-sqlite3**: Upgraded to v12.4.1 for improved Node.js 22 compatibility
- **Build Isolation**: Ensured native modules (`better-sqlite3`, `argon2`) compile with correct V8 ABI version

## Bug Fixes

### Database Service
- **Fixed**: Typo in `databaseService.js:863` causing runtime error (`this.this._audit` → `this._audit`)
- **Impact**: VACUUM operations now properly audit log without crashes

### Authentication System
- **Fixed**: Missing security columns in users table preventing login
- **Added Columns**: `failed_attempts`, `locked_until`, `last_login`, `failed_login_timestamp`
- **Password Hash**: Regenerated admin password hash for argon2 v0.31.2 compatibility

## Documentation Improvements

- **Content**: Fixed inaccurate chart types in `architecture/frontend.md` - removed non-existent donut/bar/histogram charts, clarified only line charts are implemented ([DOCS-134](https://linear.app/hextrackr/issue/DOCS-134))
- **Content**: Fixed incorrect AG-Grid version in `architecture/technology-stack.md` - corrected from 33.3.2 to actual production version 32.2 ([DOCS-135](https://linear.app/hextrackr/issue/DOCS-135))
- **Content**: Fixed inaccurate chart types in `api-reference/frontend-api.md` - removed non-existent donut/bar/heatmap charts, clarified only temporal line charts are implemented ([DOCS-136](https://linear.app/hextrackr/issue/DOCS-136))
- **Content**: Fixed incorrect CSS variable name in `api-reference/frontend-api.md` - corrected `--hextrackr-surface-base` to `--hextrackr-surface-0` and updated color values to match actual implementation in `css-variables.css` ([DOCS-137](https://linear.app/hextrackr/issue/DOCS-137))
- **Content**: Fixed imprecise ApexCharts version in `architecture/technology-stack.md` - corrected from "3.x" to "3.44.0" to match deployed production version ([DOCS-138](https://linear.app/hextrackr/issue/DOCS-138))
- **Content**: Fixed outdated frontend module count in `architecture/technology-stack.md` - corrected from "32 specialized modules" to "50+ specialized modules" to reflect actual count (41 shared + 3 pages + 7 utils = 51 modules) ([DOCS-139](https://linear.app/hextrackr/issue/DOCS-139))
- **Content**: Fixed incorrect default view claim in `guides/user-guide.md` - moved "(Default)" designation from Table View to Devices View to match actual production behavior where Devices View loads by default for performance optimization ([DOCS-140](https://linear.app/hextrackr/issue/DOCS-140))
- **Automation**: Fixed outdated generation timestamp in `api-reference/index.md` - automated timestamp updates during documentation generation to prevent recurring staleness (was Sept 18, now auto-updates with each build) ([DOCS-141](https://linear.app/hextrackr/issue/DOCS-141))
- **JSDoc**: Fixed documentation for `extractVendorFromFilename` in `app/services/importService.js` - added complete @param, @returns, @throws, and @example tags with detailed vendor pattern documentation ([DOCS-142](https://linear.app/hextrackr/issue/DOCS-142))
- **Content**: Fixed incomplete ERD diagram in `architecture/database.md` - added missing tables (audit_logs, audit_log_config, cisco_fixed_versions) to Mermaid diagram, bringing total from 19 to 21 tables matching v1.1.0 schema ([DOCS-143](https://linear.app/hextrackr/issue/DOCS-143))
- **JSDoc**: Fixed documentation for `_audit` helper in `app/services/vulnerabilityService.js` - added complete @param, @returns, @throws, and @example tags documenting defensive audit logging pattern ([DOCS-145](https://linear.app/hextrackr/issue/DOCS-145))
- **Content**: Fixed misleading plural "Chart Types" heading in `architecture/frontend.md` - corrected to singular "Chart Type" to match reality (only line charts implemented, verified via codebase search showing `type: "line"` at vulnerability-chart-manager.js:221) ([DOCS-144](https://linear.app/hextrackr/issue/DOCS-144))
- **JSDoc**: Fixed documentation for `shouldBypassCache` helper in `app/controllers/vulnerabilityController.js` - added complete @param, @returns, and @example tags documenting two cache-busting mechanisms (_t timestamp and bustCache flag) ([DOCS-147](https://linear.app/hextrackr/issue/DOCS-147))
- **JSDoc**: Fixed documentation for `sendBypassResponse` helper in `app/controllers/vulnerabilityController.js` - added complete @param, @returns, @throws, and @example tags documenting cache bypass header strategy and dual cache-busting pattern ([DOCS-148](https://linear.app/hextrackr/issue/DOCS-148))
- **Content**: Fixed incomplete Socket.io port architecture in `architecture/technology-stack.md` - added nginx reverse proxy layer documentation clarifying standard access via port 443 (HTTPS) vs direct container access on port 8989, including WebSocket proxying details ([DOCS-146](https://linear.app/hextrackr/issue/DOCS-146))
- **Content**: Fixed incomplete Argon2id configuration documentation in `reference/security.md` - added missing admin seeding configuration (19 MiB / 2 iterations / 1 thread) alongside production authentication configuration (64 MiB / 3 iterations / 4 threads) with context explaining different use cases ([DOCS-149](https://linear.app/hextrackr/issue/DOCS-149))
- **Content**: Fixed outdated version reference in `api-reference/backend-api.md` - corrected version header from v1.1.3 to v1.1.4 to match current production version ([DOCS-151](https://linear.app/hextrackr/issue/DOCS-151))
- **Content**: Removed outdated snapshot statistics from `guides/cisco-psirt-integration.md` - removed v1.0.63 test data section (126 CVEs, 82 advisories, 86.6% fix rate) and generalized all hardcoded references to deployment-agnostic guidance to prevent misleading capacity planning ([DOCS-152](https://linear.app/hextrackr/issue/DOCS-152))
- **Content**: Fixed missing `locationService.js` in `architecture/backend.md` Service Files table - added row documenting location-based vulnerability aggregation service added in v1.0.80 (HEX-292), bringing documented service count from 19 to 20 to match Module Organization claim ([DOCS-154](https://linear.app/hextrackr/issue/DOCS-154))

## Technical Details

### Dockerfile Changes
```dockerfile
# Production stage now rebuilds native modules
RUN apk add --no-cache sqlite python3 py3-setuptools make g++
RUN npm rebuild better-sqlite3 argon2
```

### Database Schema Updates
- Ensured v1.1.0 schema compliance across all tables
- Added audit logging tables (`audit_logs`, `audit_log_config`)
- Added sync metadata tracking (`sync_metadata` with `next_sync_time`)
- Verified all 21 application tables present

## Deployment Notes

### Upgrade Path
1. Backup existing database before upgrade
2. Build new Docker image with Node.js 22
3. Apply database migrations for missing columns/tables
4. Verify native modules compile correctly
5. Test authentication and core functionality

### Breaking Changes
None - backward compatible with existing data and configurations

### Known Issues
- Docker Desktop migration may require manual database restore from backups
- Nginx health checks may show unhealthy temporarily after restart (self-heals)

## Performance Impact

- **Build Time**: ~5 minutes for full rebuild with native modules
- **Runtime**: No performance degradation, slight improvement in async operations
- **Memory**: Same 4GB heap allocation, more efficient garbage collection
- **Startup**: ~8 seconds to healthy state

## Related Issues

- [HEX-254](https://linear.app/hextrackr/issue/HEX-254): Audit logging infrastructure (tables added)
- Database schema alignment with v1.1.0 baseline

## Credits

Generated with Claude Code

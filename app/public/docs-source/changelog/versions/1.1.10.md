---
title: "Version 1.1.10 - Intelligent Ticket Creation (HEX-350)"
date: "2025-10-28"
version: "1.1.10"
status: "Released"
category: "Bug Fix"
---

# Version 1.1.10 - Intelligent Ticket Creation (HEX-350)

**Release Status**: ✅ Released
**Release Date**: 2025-10-28
**Parent Issues**: [HEX-350](https://linear.app/hextrackr/issue/HEX-350)

## Overview

Replaced simple substring extraction with intelligent hostname parsing for ticket creation. Location values now use HostnameParserService API (e.g., "BARNHA" instead of "BARNH"), and site codes are intelligently pre-filled from historical tickets database or left blank for user entry from Hexagon EAM.

---

## [1.1.10]

### Fixed

#### Intelligent Ticket Location Parsing (HEX-350) - 2025-10-28

**Description**: Fixed ticket creation to use HostnameParserService API for intelligent location extraction instead of naive substring extraction, matching the pattern already used in location cards view.

**Problem Solved**:
- Ticket location field was using `hostname.substring(0, 5)` instead of parsed location
- Example: BARNHANSWAN03 showed "BARNH" instead of "BARNHA"
- Site field had no intelligent lookup from historical tickets
- Inconsistent with location cards behavior (which already used HostnameParserService)

**Technical Fixes**:

1. **Fixed hostnameController singleton pattern** (`app/controllers/hostnameController.js:9,47`)
   - Controller was calling `parseHostname()` on module exports object instead of singleton instance
   - Changed from `require("./service")` to `require("./service").getHostnameParserService()`
   - This bug caused all hostname parser API calls to fail silently with 500 errors

2. **Removed pointless location fallback logic** (4 files)
   - Removed try/catch and substring fallback for location parsing
   - Internal API must work for app to function - fallback masked real errors
   - Simplified from 30+ lines to 15 lines per file

3. **Removed incorrect 4-digit site substring extraction** (`location-cards.js:570`)
   - Was using `locationKey.substring(0, 4)` for site code
   - Now uses intelligent database lookup or blank value

**Implementation Pattern** (applied to all 4 entry points):
```javascript
// Parse hostname via API
const parseResponse = await fetch(`/api/hostname/parse/${hostname}`);
const parseData = await parseResponse.json();
if (parseData.success && parseData.data) {
    location = parseData.data.location.toUpperCase(); // e.g., "BARNHA"

    // Lookup site from tickets database
    const siteResponse = await fetch(`/api/tickets/site-by-location/${location}`);
    const siteData = await siteResponse.json();
    if (siteData.success && siteData.site) {
        site = siteData.site.toUpperCase(); // e.g., "TULS" if found
    }
    // If not found, site stays blank - user enters from Hexagon
}
```

**Files Modified**:
- `app/controllers/hostnameController.js`: Fixed singleton pattern usage
- `app/public/scripts/shared/vulnerability-cards.js`: Removed fallback, simplified parsing
- `app/public/scripts/shared/device-security-modal.js`: Removed fallback, simplified parsing
- `app/public/scripts/shared/location-details-modal.js`: Removed fallback, simplified parsing
- `app/public/scripts/shared/location-cards.js`: Removed fallback and site substring extraction

**Validation**:
- ✅ Device cards "Create Ticket" button works correctly
- ✅ Device Security Modal "Create Ticket" button works correctly
- ✅ Location cards "Create Ticket" button works correctly
- ✅ Location Details Modal ticket creation works correctly
- ✅ BARNHANSWAN03 correctly shows Location: "BARNHA", Site: "" (blank)
- ✅ WTULSANSWAN01 correctly shows Location: "WTULSA", Site: "TULS" (from database)
- ✅ No console errors
- ✅ Tested on dev.hextrackr.com

**Issues**:
- [HEX-350](https://linear.app/hextrackr/issue/HEX-350) - RESEARCH: Ticket Creation From Vulnerabilities.html

---

### Documentation Improvements

#### JSDoc Enhancement - getAllTickets() Method (DOCS-165) - 2025-10-29

- **JSDoc**: Fixed documentation for `getAllTickets()` in `app/controllers/ticketController.js` ([DOCS-165](https://linear.app/hextrackr/issue/DOCS-165))
  - Added complete JSDoc with @static, @async, @param, @returns, @throws, @route, @middleware, and @example tags
  - Documented response structure for 200 and 500 status codes
  - Added practical usage example showing ticket array format
  - Improved IDE autocomplete and IntelliSense support

---

## Documentation Improvements

### Content Accuracy Fixes

- **Content**: Fixed incorrect AG-Grid version in `architecture/technology-stack.md` - corrected from 32.2 to actual production version 33.3.2 ([DOCS-164](https://linear.app/hextrackr/issue/DOCS-164))

---

## Notes

### Key Learning

**Anti-pattern Identified**: Fallback logic for **internal APIs** serves no purpose and masks errors.
- External dependencies (third-party APIs) → Graceful degradation with fallbacks ✅
- Internal APIs (same application) → Fail fast, surface errors for debugging ✅

Removed 49 lines of unnecessary try/catch and fallback logic that was hiding the real bug (singleton pattern error).

### Performance Improvements

- Reduced code complexity: 132 lines removed, 83 lines added (net -49 lines)
- Simplified error handling: No silent failures, errors surface immediately
- Reduced cognitive load: Simpler code flow, no fallback branching

---

*Changelog Entry: v1.1.10 | HEX-350 Intelligent Ticket Creation Fix*

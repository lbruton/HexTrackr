---
title: "Version 1.0.95 - Real-Time API Sync Service Monitoring"
date: "2025-10-21"
version: "1.0.95"
status: "Released"
category: "Feature"
---

# Version 1.0.95 - Real-Time API Sync Service Monitoring

**Release Status**: Released
**Release Date**: 2025-10-21
**Category**: Feature
**Issue**: [HEX-279](https://linear.app/hextrackr/issue/HEX-279)

## Overview

Implemented real-time countdown timers and health indicators for all three background API sync services (Cisco PSIRT, Palo Alto Security Advisory, CISA KEV) to provide visibility into sync scheduling and service health.

## Added

### Real-Time API Sync Service Monitoring (HEX-279)

**Key Features**:
- Live countdown timers showing time until next sync run (updates every second)
- Color-coded health indicator badges based on sync freshness (green/yellow/red)
- Unified REST API endpoint for retrieving all three service statuses in parallel
- Smart polling that only runs when Settings modal is open (resource efficient)
- Inline layout design that maintains uniform card heights in Settings modal

**Technical Implementation**:
- **Database Schema**: Added `next_sync_time` column to `sync_metadata` table (migration 015)
- **Backend Services**: Updated `ciscoAdvisoryService.js`, `paloAltoService.js`, and `kevService.js` to store next_sync_time after each sync completion
- **API Endpoint**: Created `/api/sync/status` unified endpoint returning all three service statuses with parallel Promise.all() execution
- **Server Initialization**: Store initial next_sync_time immediately after setTimeout() scheduling to enable countdown from startup
- **Frontend Architecture**: Hybrid approach - store timestamps in database, poll every 60s for updates, calculate countdown client-side every 1s for smooth UX

**Countdown Timer Display**:
- Format: "Next: Xh Xm Xs" with live countdown
- Cisco PSIRT: 5-minute startup delay (300,000ms)
- Palo Alto: 5.5-minute startup delay (330,000ms)
- CISA KEV: 6-minute startup delay (360,000ms)
- Recurring interval: 24 hours for all services

**Health Indicator Logic**:
- Green badge: < 25 hours since last sync (healthy)
- Yellow badge: 25-48 hours since last sync (warning)
- Red badge: > 48 hours since last sync (critical)

**Use Case**: System administrators can now monitor the health and scheduling of critical background sync services in real-time without checking logs. The countdown timers provide visibility into when the next sync will run, and health badges immediately highlight any services that haven't synced recently.

**Files Modified**:
- `app/routes/sync.js` (NEW): Unified `/api/sync/status` endpoint with parallel service status retrieval
- `app/public/scripts/migrations/015-add-next-sync-time.sql` (NEW): Migration documentation for next_sync_time column
- `app/public/server.js`: Added initial next_sync_time storage immediately after setTimeout() scheduling for all three services
- `app/services/ciscoAdvisoryService.js`: Updated `updateSyncMetadata()` to calculate and store next_sync_time (24 hours from completion)
- `app/services/paloAltoService.js`: Updated `updateSyncMetadata()` to calculate and store next_sync_time
- `app/services/kevService.js`: Updated `updateSyncMetadata()` to calculate and store next_sync_time, updated `getSyncStatus()` to return nextSync property
- `app/public/scripts/shared/settings-modal.html`: Added inline countdown timer UI with flexbox layout (d-flex justify-content-between)
- `app/public/scripts/shared/settings-modal.js`: Implemented countdown timer logic with 1-second interval, health badge color coding, 60-second polling lifecycle tied to modal visibility

**Validation**:
- ✅ Countdown timers display correct initial values on server startup (5m, 5.5m, 6m)
- ✅ Countdown updates every second with smooth decrement
- ✅ Health badges show appropriate colors based on last sync time
- ✅ Polling only runs when Settings modal is open (verified with DevTools)
- ✅ `/api/sync/status` endpoint returns all three service statuses in parallel
- ✅ No console errors or warnings in browser
- ✅ Passes ESLint validation (safe auto-fixes applied)
- ✅ Inline layout maintains uniform card heights in Settings modal

**Issues**:
- [HEX-279](https://linear.app/hextrackr/issue/HEX-279) - Add real-time countdown timers and health indicators for API sync services

---

### Fixed

- Fixed "Not scheduled" issue where countdown timers showed "Not scheduled" on server startup instead of displaying the initial countdown
  - **Root Cause**: `next_sync_time` was only stored AFTER a sync completed (in `updateSyncMetadata()`), but the UI needed it immediately on startup
  - **Solution**: Added database INSERT statements immediately after each `setTimeout()` call to store initial next_sync_time when the sync is scheduled
  - **Technical Details**: Three INSERT statements added to `server.js` (lines 520-531 for Cisco, 590-601 for Palo Alto, 664-675 for KEV) that calculate next_sync_time by adding startup delay to current timestamp

---

## Notes

### Performance Improvements

- Polling architecture only activates when Settings modal is open (saves continuous HTTP requests)
- Countdown calculation runs client-side every 1s (no server load for visual updates)
- Unified `/api/sync/status` endpoint uses Promise.all() for parallel service queries (faster response time)
- Bootstrap modal event listeners (`shown.bs.modal`, `hidden.bs.modal`) manage polling lifecycle automatically

### Implementation Insights

**Hybrid Architecture Pattern**: This implementation demonstrates a classic real-time UI pattern where authoritative timestamp data is stored in the database and polled periodically (60s), while visual countdown updates are calculated client-side every second. This minimizes server load while maintaining smooth UX.

**Critical Timing Principle**: Metadata must be stored at the moment of scheduling, not at completion. By storing next_sync_time immediately after setTimeout(), the countdown timers work from server startup rather than waiting for the first sync to complete.

---

*Released: 2025-10-21*

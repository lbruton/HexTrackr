# Version 1.0.48

**Release Date**: 2025-10-06

---

## [1.0.48] - 2025-10-06

### Added - Authentication v1.0 üîê

#### Complete Session-Based Authentication System

**Achievement**: Implemented enterprise-grade session-based authentication with Argon2id password hashing, protecting all 62 data API endpoints and WebSocket connections.

**Features Implemented**:

- **Login Page**: Beautiful dark mode login interface with Tabler.io styling
  - "Remember me" functionality (24-hour default, 30-day extended sessions)
  - Return URL preservation for seamless post-login navigation
  - Real-time validation and error messaging

- **User Menu Integration**: Dropdown menu with authenticated user display
  - Avatar with username display
  - Change Password modal with validation
  - Secure sign-out functionality
  - Preserved all existing settings menu items

- **API Protection**: All 62 data endpoints now require authentication
  - 401 Unauthorized responses for unauthenticated requests
  - Session validation middleware on all protected routes
  - Public endpoints remain accessible (/health, /, /docs-html/*)

- **WebSocket Authentication**: Real-time connections secured with session validation
  - Handshake-level authentication check
  - Progress tracking requires valid session
  - Enhanced logging with authenticated username

- **Session Management**: Persistent sessions with SQLite storage
  - Sessions survive server restarts
  - Automatic cleanup of expired sessions
  - Secure cookie configuration (httpOnly, secure, sameSite=strict)

- **Authentication State Manager**: Client-side session handling
  - Automatic redirect to login for unauthenticated users
  - Protected route handling on all pages
  - Session expiry detection with modal prompt
  - CSRF token integration for all mutations

**Security Features**:

- **Password Hashing**: Argon2id with OWASP 2025-compliant parameters
  - Memory cost: 19456 KiB (19 MiB)
  - Time cost: 2 iterations
  - Parallelism: 1 thread

- **Session Security**:
  - HttpOnly cookies (JavaScript cannot access)
  - Secure flag (HTTPS-only in production)
  - SameSite=strict (CSRF protection)
  - 256-bit cryptographically random SESSION_SECRET

- **Account Protection**:
  - Account lockout after 5 failed login attempts
  - 15-minute lockout duration
  - Failed attempt tracking in database

- **Database Security**:
  - Moved from /app/public/data to /app/data (prevents public downloads)
  - All queries use parameterized statements
  - Password hashes never exposed in API responses

**Files Added** (6 new files):

1. `app/middleware/auth.js` - Authentication middleware with session validation
2. `app/services/authService.js` - Authentication business logic layer
3. `app/routes/auth.js` - Login, logout, session, password change endpoints
4. `app/public/scripts/shared/auth-state.js` - Client-side authentication state manager
5. `app/public/login.html` - Beautiful dark mode login page
6. `app/data/.gitkeep` - New secure database location

**Files Modified** (18 files):

- All route files (vulnerabilities, tickets, settings, imports, etc.) - Added requireAuth middleware
- All page HTML files - Added AuthState integration for protected routes
- server.js - Session middleware, WebSocket authentication, database path update
- config/server.js - Rate limiting configuration
- All supporting scripts and utilities

**Testing Completed**:

- ‚úÖ 15/15 integration tests passed (curl-based)
- ‚úÖ 7/7 E2E scenarios validated (Chrome DevTools)
- ‚úÖ 43/43 OWASP 2025 security requirements met
- ‚úÖ SQL injection attempts blocked
- ‚úÖ XSS attempts blocked
- ‚úÖ CSRF protection verified
- ‚úÖ Session timeout tested
- ‚úÖ Multi-tab session handling verified

**Performance**:

- Login time: <2 seconds
- Session validation: <10ms per request
- WebSocket auth: <50ms handshake
- Zero memory leaks (session cleanup verified)

**Related Issues**: HEX-126 (PRD), HEX-127 (Backend), HEX-128 (Frontend), HEX-129 (Testing), HEX-130 (Master Checklist), HEX-133 (Security Hardening)

### Added - Infrastructure

#### HEX-134: Automated Daily Backup System

**Achievement**: Implemented automated daily backups with 30-day retention, backported from production (HEXP-7).

**Features**:

- **Backup Script**: `/app/scripts/hextrackr-backup.sh`
  - SQLite online backup using `.backup` command
  - Integrity verification via `PRAGMA integrity_check`
  - Gzip compression (reduces to ~16 MB)
  - 30-day retention policy
  - Comprehensive logging

- **Automation**: macOS launchd configuration
  - Daily execution at 2:00 AM
  - Automatic startup on boot
  - Error logging to backup directory

- **Recovery Tools**: Database restoration utilities
  - `restore-backup.sql` - SQLite CLI restoration script
  - `restore-from-backup.js` - Node.js restoration utility
  - `set-admin-password.js` - Argon2id password reset tool
  - `test-password-verify.js` - Password verification utility

**Testing**:

- ‚úÖ Manual backup execution successful (16 MB compressed)
- ‚úÖ Integrity check: PRAGMA integrity_check = ok
- ‚úÖ Restore validation: 36 tickets, 26,180 vulnerabilities restored
- ‚úÖ Launchd job loaded and scheduled

**Context**: Created in response to database recovery incident where init-db accidentally wiped data. These tools prevent future data loss and enable rapid recovery from backups.

**Related**: HEX-134, HEX-130, HEXP-7

### Changed

- **Rate Limiting**: Increased from 100 to 1000 requests per 30 minutes
  - Allows ~33 requests/minute for authenticated single-user operations
  - Prevents legitimate API usage from triggering rate limits

- **Database Location**: Moved from /app/public/data to /app/data
  - Prevents public download of database file
  - Critical security hardening (HEX-133)

- **All Pages**: Now redirect to login when unauthenticated
  - Seamless authentication flow with return URL preservation
  - Consistent user experience across all pages

### Security

- **OWASP 2025 Compliance**: 100% compliance with applicable security standards
  - A01:2025 Broken Access Control - ‚úÖ Protected (session validation on all endpoints)
  - A02:2025 Cryptographic Failures - ‚úÖ Protected (Argon2id hashing, secure cookies)
  - A03:2025 Injection - ‚úÖ Protected (parameterized queries)
  - A04:2025 Insecure Design - ‚úÖ Protected (session-based auth, account lockout)
  - A05:2025 Security Misconfiguration - ‚úÖ Protected (secure defaults, hardened config)
  - A07:2025 Identification and Authentication Failures - ‚úÖ Protected (enterprise auth)
  - A08:2025 Software and Data Integrity Failures - ‚úÖ Protected (CSRF protection)
  - A09:2025 Security Logging and Monitoring - ‚úÖ Protected (auth logging enabled)

- **Zero Authentication Vulnerabilities**: Comprehensive security validation passed
  - Session fixation prevention
  - Timing attack mitigation
  - CSRF protection (Synchronizer Token Pattern)
  - XSS protection (DOMPurify + CSP)

### Developer Notes

- **Initial Admin Credentials**: Logged on first database initialization with `npm run init-db`
  - Username: `admin`
  - Password: Randomly generated, displayed in console
  - **CRITICAL**: Change default password immediately after first login

- **Environment Variables**: SESSION_SECRET required in .env
  - Generate with: `openssl rand -hex 32`
  - Minimum 32 characters (256 bits)
  - Never commit to version control

- **Production Deployment**: Requires nginx reverse proxy configuration
  - Must set `X-Forwarded-Proto` header
  - HTTPS enforcement via nginx
  - Secure cookie flag requires HTTPS

- **Testing Environment**: Always test via nginx reverse proxy
  - Development: https://dev.hextrackr.com or https://localhost
  - Never use http://localhost:8080 (bypasses nginx, breaks cookies)

### Documentation

See comprehensive authentication documentation:

- **HEX-126**: Product Requirements Document (PRD)
- **HEX-127**: Backend Implementation Sprint
- **HEX-128**: Frontend Implementation Sprint
- **HEX-129**: Testing & Deployment Sprint
- **HEX-130**: Master Task Checklist
- **HEX-133**: Critical Security Hardening
- **SECURITY.md**: Complete security policy and features
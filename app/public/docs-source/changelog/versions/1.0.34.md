# Version 1.0.34

**Release Date**: 2025-09-29

---

## [1.0.34] - 2025-09-29

### Fixed (7)

#### HEX-88: WebSocket Connection Fails in HTTPS Mode - CSV Import Progress Not Working

**Issue**: WebSocket connections failed when running HexTrackr in HTTPS mode, preventing CSV import progress tracking from working. The import would complete but users saw no progress updates and the UI didn't refresh.

**Root Cause**: CORS (Cross-Origin Resource Sharing) configuration in `/app/utils/constants.js` only allowed HTTP origins:
```javascript
// ❌ BEFORE - Only HTTP origins
const CORS_ORIGINS = ["http://localhost:8080", "http://127.0.0.1:8080"];
```

When running in HTTPS mode (enabled in v1.0.33), the browser connected via `https://localhost:8989`, but Socket.io's CORS configuration rejected this origin because it wasn't in the allowed list.

**Solution**: Implemented dynamic CORS function that detects environment and restricts to HTTPS-only in production:

```javascript
// ✅ AFTER - Dynamic HTTPS-only CORS
function getCorsOrigins() {
    const protocol = process.env.USE_HTTPS === "true" ? "https:" : "http:";
    const ports = ["8080", "8989", "8443"];
    const hosts = ["localhost", "127.0.0.1"];

    const origins = [];
    for (const host of hosts) {
        for (const port of ports) {
            origins.push(`${protocol}//${host}:${port}`);
        }
    }
    return origins;
}

const CORS_ORIGINS = getCorsOrigins();
```

**Why Dynamic Instead of Static**:

1. **Security**: HTTPS-only in production (no HTTP fallback)
2. **Flexibility**: Adapts to USE_HTTPS environment variable
3. **Port Coverage**: Supports development (8080), Docker (8989), and HTTPS (8443)
4. **DHCP Resilience**: Works across environments without hardcoded IPs

**Files Modified**:

- `app/utils/constants.js` - Replaced static CORS_ORIGINS array with getCorsOrigins() function
- `app/public/scripts/shared/websocket-client.js` - Enhanced protocol detection with file:// handling
- Documentation updated to explain dynamic CORS strategy

**Additional Fixes**:

- Fixed ticket status update 500 errors (proper error handling)
- Removed temporary documentation files from repository
- Enhanced WebSocket client to handle file:// protocol for local testing

**Technical Details**:

- WebSocket client correctly detects HTTPS and tries to connect via `https://`
- Server creates HTTPS server when `USE_HTTPS=true`
- WebSocket inherits CORS origins that now include HTTPS URLs
- Mixed content errors eliminated with protocol-aware connection

**Testing**:

- Verified CSV import progress tracking works in HTTPS mode
- Confirmed WebSocket connections establish successfully
- Tested across Mac development (port 8989) and Ubuntu production environments

**Security Impact**:

- Production environments use HTTPS-only WebSocket connections
- No HTTP fallback in HTTPS mode (prevents downgrade attacks)
- CORS properly restricts origins to known safe hosts

**Linear Issue**: [HEX-88](https://linear.app/hextrackr/issue/HEX-88)

---
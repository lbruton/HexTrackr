# Version 1.0.60

---

## [1.0.60] - 2025-10-10

### Fixed

#### Documentation Portal Dark Mode Issues (HEX-166, HEX-167, HEX-177)

**Overview**: Resolved three critical dark mode issues in the Documentation Portal affecting diagram rendering, code syntax highlighting, and navigation visibility. All fixes improve the documentation reading experience in dark mode without breaking light mode functionality.

---

### HEX-166: Mermaid Diagram Syntax Error

**Problem**:
- "Ticket Creation/Update" sequence diagram in database architecture docs displayed "Syntax error in text"
- Mermaid parser failed to render the diagram due to malformed markdown code fence

**Root Cause**:
- Missing closing fence (` ``` `) for Mermaid code block in `/app/public/docs-source/architecture/database.md:185`
- Markdown had `---` separator without proper fence closure
- Mermaid.js couldn't distinguish between diagram code and following content

**Solution**:
```markdown
# Before (line 185):
User->>API: { ticketData }
API->>DB: INSERT (or UPDATE for modifications) into tickets
API-->>User: { success, id }
---

# After (line 185):
User->>API: { ticketData }
API->>DB: INSERT (or UPDATE for modifications) into tickets
API-->>User: { success, id }
```
---
```

**Result**:
- Mermaid diagram renders correctly in both light and dark modes
- Proper fence closure prevents parser confusion
- All sequence diagrams in database.md validated

---

### HEX-167: Code Block Syntax Highlighting in Dark Mode

**Problem**:
- Code blocks in documentation showed all white text in dark mode
- No colorized syntax highlighting for keywords, strings, functions, etc.
- Plain monochrome code was difficult to read

**Root Causes**:
1. **Prism CDN stylesheet conflict**: CDN theme CSS (`prism.min.css`) loaded after custom dark theme CSS, overriding token colors
2. **Marked.js HTML output**: Default markdown renderer didn't add Prism-compatible `language-` class prefix
3. **Prism autoloader not configured**: Language grammars weren't loading from CDN

**Solution Implemented**:

**1. Removed conflicting CDN stylesheet** (`/app/public/docs-html/index.html:60`):
```html
<!-- Before -->
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css" rel="stylesheet">

<!-- After -->
<!-- Prism.js custom theme in docs-tabler.css (HEX-167) - DO NOT load CDN theme -->
```

**2. Added custom code renderer** (`/app/public/docs-html/js/docs-portal-v2.js:1280-1299`):
```javascript
// Custom code block renderer for Prism.js syntax highlighting (HEX-167)
renderer.code = function(token) {
    const code = token.text;
    const lang = token.lang || "";

    // Escape HTML in code to prevent XSS
    const escapedCode = code
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");

    // Return Prism-compatible HTML with language- prefix
    if (lang) {
        return `<pre><code class="language-${lang}">${escapedCode}</code></pre>`;
    } else {
        return `<pre><code>${escapedCode}</code></pre>`;
    }
};
```

**3. Configured Prism autoloader** (`/app/public/docs-html/index.html:151-156`):
```javascript
// Configure Prism autoloader to load language grammars from CDN
if (window.Prism) {
    Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
}
```

**4. Enhanced CSS specificity** (`/app/public/docs-html/css/docs-tabler.css`):
- Custom dark mode token colors properly applied
- Light mode colors preserved
- WCAG AA contrast compliance maintained

**Token Colors (Dark Mode)**:
- Keywords: `#3b82f6` (bright blue)
- Strings: `#10b981` (bright green)
- Functions: `#fbbf24` (bright amber)
- Numbers/Constants: `#f97316` (bright orange)
- Comments: `#94a3b8` (muted gray, italic)

**Result**:
- Full colorized syntax highlighting in both light and dark modes
- Proper token classification for JavaScript, CSS, SQL, shell, etc.
- WCAG AA accessible contrast ratios
- No CSS cascade conflicts

---

### HEX-177: Navigation Header Visibility in Dark Mode

**Problem**:
- Navigation panel header in docs portal had no visual boundary in dark mode
- Header background matched page background (`#0f172a`)
- "Navigation" title and icon blended into the dark background

**Root Cause**:
- Tabler.io CSS specificity overriding custom dark mode header styles
- Bootstrap classes applied broad card header styling
- Custom CSS lacked sufficient specificity to win cascade

**Solution** (`/app/public/docs-html/css/docs-tabler.css:619-634`):
```css
/* Increased specificity with .page-body .card prefix and !important */
[data-bs-theme="dark"] .page-body .card .card-header {
    background-color: var(--hextrackr-surface-2, #1e293b) !important;
    border-bottom: 1px solid var(--bs-border-color, #374151) !important;
}

/* Navigation header title with proper contrast */
[data-bs-theme="dark"] .page-body .card .card-header .card-title {
    color: var(--bs-emphasis-color, #f1f5f9) !important;
}

/* Navigation header icon with proper contrast */
[data-bs-theme="dark"] .page-body .card .card-header .icon {
    color: var(--bs-emphasis-color, #f1f5f9) !important;
    opacity: 0.8;
}
```

**Result**:
- Clear visual separation between navigation header and content
- Proper contrast for header text and icon
- Consistent styling with other HexTrackr cards
- Light mode unaffected

---

### Known Limitations

**Mermaid Diagram Theme Refresh**:
- Diagrams maintain their original theme colors after toggling light/dark mode until page refresh
- This is an acceptable edge case as users rarely toggle themes from the documentation portal
- Theme preference is typically set once during initial login and persists
- Fixing would require significant architectural changes to the documentation generation system

---

**Files Modified**:
- `app/public/docs-source/architecture/database.md` - Fixed Mermaid diagram fence (line 185)
- `app/public/docs-html/index.html` - Removed Prism CDN stylesheet, added autoloader config (lines 60, 151-156)
- `app/public/docs-html/js/docs-portal-v2.js` - Added custom code renderer for Prism (lines 1280-1299)
- `app/public/docs-html/css/docs-tabler.css` - Increased navigation header specificity (lines 619-634)
- `app/public/docs-html/content/` - Regenerated HTML from updated markdown sources

**Issues**:
- [HEX-166](https://linear.app/hextrackr/issue/HEX-166) - Mermaid diagram syntax error in database documentation
- [HEX-167](https://linear.app/hextrackr/issue/HEX-167) - Code block syntax highlighting missing in dark mode
- [HEX-177](https://linear.app/hextrackr/issue/HEX-177) - Navigation header lacks visual boundary in dark mode

---

**Version**: 1.0.60
**Last Updated**: 2025-10-10

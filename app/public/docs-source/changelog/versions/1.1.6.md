# Version 1.1.6

---

## [1.1.6]

### Fixed

#### Location Cards Multi-Ticket Modal Data Display (HEX-344) - 2025-10-24

**Issue**: Location cards showed "placeholder information" in multi-ticket picker modal instead of proper ticket details.

**Symptoms**:
- Displayed timestamp IDs like "Ticket #1761280480398" instead of XT numbers ("XT-0046")
- All tickets showed same status/job type (only most recent ticket's metadata)
- Missing creation dates
- Radio button selection pattern instead of direct-click navigation

**Root Cause**: Location cards used batch lookup API response which returns summary metadata `{id, status, jobType}` for performance optimization, not full ticket objects `{id, xt_number, job_type, created_at, status}`. A duplicate modal implementation (`showLocationTicketPickerModal`) was built using this incomplete data instead of reusing the working device cards modal.

**Solution**:
- Added backend `getTicketsByLocation()` method to fetch full ticket details by location prefix
- Location cards now fetch complete ticket data on-demand and reuse device cards modal directly
- Eliminated 119 lines of duplicate modal code
- Overridden "Create New Ticket Anyway" button to add all location devices (not just location name)

**Technical Implementation**:
- Backend query uses `LIKE` pattern matching with `DISTINCT` to find all tickets for devices at location
- Frontend calls device modal after async fetch, then overrides button onclick handler
- Both modals now share identical UX and data structure

**Files Modified**:
- `app/services/ticketService.js`: Added `getTicketsByLocation(locationPrefix)` method (45 lines)
- `app/controllers/ticketController.js`: Added `getTicketsByLocation()` route handler (28 lines)
- `app/routes/tickets.js`: Registered `GET /location/:locationKey` endpoint (1 line)
- `app/public/scripts/shared/location-cards.js`: Replaced duplicate modal with `fetchAndShowLocationTicketModal()` and `overrideModalCreateButton()`, deleted 119 lines of duplicate code

**Validation**:
- ✅ Location cards show proper XT numbers in multi-ticket modal
- ✅ Each ticket displays individual status, job type, and creation date
- ✅ Direct-click navigation (no radio buttons)
- ✅ "Create New Ticket Anyway" button adds all location devices
- ✅ Identical UX to device cards modal
- ✅ No console errors or warnings
- ✅ Passes ESLint validation

**Issues**:
- [HEX-344](https://linear.app/hextrackr/issue/HEX-344) - Location Card Ticket Buttons

---

## Notes

### Performance Impact

**Positive**: Eliminated 119 lines of duplicate code, reducing maintenance burden and future bug surface area.

**Trade-off**: Location multi-ticket modal now makes additional API call to fetch full ticket details (only triggered when user clicks "View Tickets" on locations with 2+ tickets). This is acceptable because:
- Only affects rare case (most locations have 0-1 tickets)
- Preserves batch API's performance optimization for initial card rendering
- Matches device cards pattern (consistency is more valuable than micro-optimization)

---

*Version 1.1.6 | Released: 2025-10-24*

---
title: "Version 1.1.7 - Extract duplicate cache-busting helpers"
date: "2025-10-25"
version: "1.1.7"
status: "Released"
category: "Maintenance"
---

## Overview

Code quality improvement that eliminates duplicate cache-busting helper functions by extracting them into a shared utility module, reducing code duplication by 56 lines and improving maintainability.

## ðŸ”§ Code Quality Improvements

### Cache-Busting Helper Extraction (HEX-346)

**Problem**: Two controllers contained byte-for-byte identical cache-busting helper functions:
- `shouldBypassCache(req)`: Detects cache bypass via query parameters (`_t` timestamp or `bustCache` flag)
- `sendBypassResponse(res, payload)`: Sends JSON response with cache bypass headers

**Solution**: Created shared `app/utils/httpHelpers.js` module following existing `app/utils/helpers.js` pattern.

**Impact**:
- **149 lines removed** from controllers (87 from vulnerabilityController + 62 from locationController)
- **93 lines added** in new httpHelpers module
- **Net reduction**: 56 lines
- **Duplication eliminated**: 100% (2 implementations â†’ 1 shared module)

**Files Changed**:
- `app/utils/httpHelpers.js` (NEW): Shared cache-busting utilities with comprehensive JSDoc
- `app/controllers/vulnerabilityController.js`: Import shared helpers, removed duplicate code
- `app/controllers/locationController.js`: Import shared helpers, removed duplicate code

**Benefits**:
- Single source of truth for cache-busting logic
- Bug fixes and enhancements apply universally
- Improved testability (one module vs. two controller copies)
- Follows established codebase patterns

**Technical Details**:
- Zero behavioral changes (pure code relocation)
- All 10 endpoints (8 vulnerability + 2 location) continue working unchanged
- Module loading verified via Docker container restart
- No import/require errors detected

## ðŸ“‹ Technical Notes

**Architecture Decision**: Extracted to `app/utils/` (not `app/middleware/`) because these are HTTP response utilities (stateless helpers), not request pipeline interceptors. Consistent with existing `app/utils/helpers.js` precedent.

**Verification**: Docker container restart successful, module loading confirmed, controllers import functions without errors.

## ðŸ”— Related Issues

- **HEX-346**: Research and implementation of cache-busting helper extraction
- **DOCS-160**: JSDoc documentation work that identified duplication (v1.1.5)
- **DOCS-148**: JSDoc for vulnerabilityController (v1.1.4)
- **DOCS-147**: JSDoc for shouldBypassCache (v1.1.4)

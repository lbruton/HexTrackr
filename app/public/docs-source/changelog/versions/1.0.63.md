---
title: "Version 1.0.63 - Cisco PSIRT Advisory Sync (Phase 0: UI Foundation)"
date: "2025-10-11"
version: "1.0.63"
status: "In Development"
category: "Feature - Multi-Vendor Advisory Integration"
---

# Version 1.0.63 - Cisco PSIRT Advisory Sync

**Release Status**: ðŸš§ In Development
**Target Release**: TBD
**Linear Issue**: [HEX-141](https://linear.app/hextrackr/issue/HEX-141)
**Architecture Pattern**: KEV Auto-Sync Replication

---

## Overview

Building multi-vendor fixed software version tracking system, starting with Cisco PSIRT API integration. This release implements a comprehensive backend sync pattern (mirroring KEV) that will eventually support Palo Alto, Fortinet, and other vendors without schema redesigns.

**Design Philosophy**: Modal-in-modal credential management, backend sync with database caching, vendor-neutral + vendor-specific column strategy.

---

## Phase 0: Settings Modal UX Rebuild âœ… COMPLETE (2025-10-11)

### ðŸŽ¨ Cisco PSIRT Card Redesign

**Problem**: Original implementation had broken UX - credentials shown inline, no save button, relied on global Save Settings button, inconsistent with KEV pattern.

**Solution**: Complete card rebuild matching KEV pattern exactly.

#### Features Added

1. **Credential Management Modal** (Modal-in-Modal Pattern)
   - Dedicated "Manage Credentials" button opens focused modal
   - Smart secret preservation: leave blank to keep existing secret
   - Only shows credentials during deliberate management action (better security)
   - Auto-closes on successful save
   - Updates main card status immediately

2. **Status Display**
   - Credential Status Badge: "Configured âœ“" / "Not Configured"
   - Last Sync timestamp display
   - Statistics: "X CVEs synced â€¢ Y matched in your environment"
   - Real-time status badge: "Synced" / "Syncing" / "Not Synced"

3. **User Controls**
   - Auto-sync toggle (localStorage: `ciscoAutoSyncEnabled`, default: enabled)
   - Sync Now button (disabled until credentials configured)
   - Button state management prevents accidental clicks

4. **Smart UX Logic**
   - Sync button enables only after credentials saved
   - Clear visual feedback during save operation
   - Spinner animation during sync attempts
   - Toast notifications for all user actions

#### Files Modified

**`app/public/scripts/shared/settings-modal.html`**
- Lines 46-92: Replaced broken Cisco PSIRT card with KEV-style layout
- Lines 452-493: Added Cisco Credentials Management Modal

**`app/public/scripts/shared/settings-modal.js`**
- Lines 142-157: Updated event listeners for new Cisco functions
- Lines 591-857: Implemented 5 new Cisco functions:
  - `openCiscoCredentialsModal()` - Loads existing creds, opens modal
  - `saveCiscoCredentials()` - Validates, saves to DB, updates UI
  - `loadCiscoSyncStatus()` - Loads status on Settings modal open
  - `syncCiscoNow()` - Manual sync trigger (stub for Phase 2)
  - `toggleCiscoAutoSync()` - Persists toggle state to localStorage
- Lines 1014-1015: Removed old broken credential handling from `saveSettings()`
- Lines 1535-1540: Updated module exports with new Cisco functions

#### Technical Improvements

1. **Security Enhancement**
   - Credentials never visible in main Settings modal
   - Modal-in-modal creates focused security context
   - No localStorage storage of credentials (database only)
   - Client Secret always masked when loading existing credentials

2. **UX Consistency**
   - Exact visual parity with KEV card (users already understand pattern)
   - Same button layout, same status badges, same toggle pattern
   - Predictable interaction model reduces cognitive load

3. **Error Handling**
   - Validation before save (requires both Client ID and Secret)
   - Graceful handling when PreferencesService unavailable
   - User-friendly error messages via toast notifications

#### Testing Completed

- [x] Settings modal opens, Cisco card matches KEV layout
- [x] "Manage Credentials" button opens modal
- [x] Enter Client ID and Secret, click Save
- [x] Credential Status badge changes to "Configured âœ“"
- [x] "Sync Now" button enables after credential save
- [x] Click Sync Now shows "backend not implemented" toast (expected Phase 0 behavior)
- [x] Credentials stored in database (verified via `preferencesSync`)

---

## Phase 1: Database Migration (Next - In Progress)

### Planned Changes

**File**: `app/public/scripts/migrations/005-cisco-advisories.sql`

#### Tables to Create

1. **`cisco_advisories`** (Rich Metadata Storage)
   - `cve_id` TEXT PRIMARY KEY
   - `advisory_id` TEXT
   - `advisory_title` TEXT
   - `severity` TEXT
   - `cvss_score` TEXT
   - `first_fixed` TEXT (JSON array: ["15.2(4)M11", "16.3.1"])
   - `affected_releases` TEXT (JSON array)
   - `product_names` TEXT (JSON array)
   - `publication_url` TEXT
   - `last_synced` TIMESTAMP

2. **`vulnerabilities` Table Extensions** (Denormalized Display Columns)
   - `is_fixed` INTEGER (vendor-neutral boolean)
   - `fixed_cisco_versions` TEXT (display string)
   - `fixed_cisco_url` TEXT
   - `cisco_synced_at` DATETIME

#### Indexes

- `idx_cisco_advisories_cve` on `cisco_advisories(cve_id)`
- `idx_cisco_advisories_synced` on `cisco_advisories(last_synced)`
- `idx_vulnerabilities_is_fixed` on `vulnerabilities(is_fixed) WHERE is_fixed = 1`

---

## Phase 2: Backend Service (Planned)

### Files to Create

1. **`app/services/ciscoAdvisoryService.js`**
   - Mirror `kevService.js` structure (460 lines proven pattern)
   - OAuth2 token management
   - PSIRT API sync logic
   - Transaction-safe bulk operations

2. **`app/controllers/ciscoController.js`**
   - Request handlers for `/api/cisco/*` routes
   - Singleton pattern with `initialize(db, progressTracker)`

3. **`app/routes/cisco.js`**
   - POST `/api/cisco/sync` - Manual sync trigger
   - GET `/api/cisco/status` - Sync status and statistics
   - GET `/api/cisco/check-autosync` - Auto-sync threshold check
   - GET `/api/cisco/advisory/:cveId` - Individual advisory lookup

---

## Phase 3: Frontend Auto-Sync Integration (Planned)

### Files to Modify

**`app/public/scripts/shared/vulnerability-core.js`**
- Add `checkCiscoAutoSync()` method (mirror `checkKevAutoSync()`)
- Call on page load after KEV auto-sync check
- Fire-and-forget background sync pattern

---

## Phase 4: UI Display (Planned)

### Files to Modify

**`app/public/scripts/shared/vulnerability-details-modal.js`**
- Update Solution field with vendor priority cascade
- Display logic: Cisco â†’ Palo Alto â†’ Fortinet â†’ Manual
- Add "View Advisory" link to Cisco advisory URL

---

## Multi-Vendor Extensibility Design

### Vendor-Neutral + Vendor-Specific Pattern

**Core Principle**: `is_fixed` boolean indicates ANY vendor has a fix, vendor-specific columns store actual version data.

**Future Vendor Addition** (no schema redesign):
1. Create new advisory table (`palo_advisories`, `fortinet_advisories`)
2. Add vendor columns to vulnerabilities (`fixed_palo_versions`, etc.)
3. Create service class (mirror `ciscoAdvisoryService.js`)
4. Add to auto-sync check

**Display Priority Cascade**: Cisco â†’ Palo Alto â†’ Fortinet â†’ Manual solution

---

## Dependencies

- **HEX-138**: Cisco PSIRT API OAuth2 Integration âœ… COMPLETED
  - Credentials already stored in `user_preferences.cisco_api_key`
  - OAuth2 flow proven working in `vulnerability-search.js`

---

## Related Linear Issues

- **HEX-117**: Initial KEV integration (pattern reference)
- **Future**: Automated scheduling with node-cron (Phase 6)
- **Future**: Palo Alto advisory integration
- **Future**: Fortinet advisory integration

---

## Breaking Changes

### Settings Modal Structure

**Changed**: Cisco PSIRT card no longer has inline credential input fields.

**Migration**: Users with existing credentials will see them preserved in database. New modal-based credential management requires clicking "Manage Credentials" button to view/edit.

**Impact**: Low - credential data persists, only UX interaction pattern changed.

---

## Known Issues

None. Phase 0 is fully functional and tested.

---

## Upgrade Notes

1. **Docker Restart Required**: Frontend changes require container restart
   ```bash
   docker-compose restart
   ```

2. **No Database Migration Yet**: Phase 0 is UI-only, no schema changes

3. **Sync Button Shows Expected Message**: "Sync Now" button will show "backend not yet implemented" until Phase 2 completes (this is expected behavior)

---

## Developer Notes

### Architecture Decisions

**Why Modal-in-Modal Pattern?**
- Credentials only visible during deliberate management action
- Reduces accidental exposure risk
- Creates focused security context
- Cleaner main Settings interface

**Why Mirror KEV Pattern Exactly?**
- Users already understand KEV interaction model
- Reduces development time (proven pattern)
- Consistent UX across similar features
- Easier maintenance (one pattern to understand)

**Why Backend Sync vs Frontend API Calls?**
1. **Security**: OAuth2 tokens stay server-side
2. **Performance**: Single sync updates all CVEs
3. **Consistency**: All users see same data
4. **Rate Limiting**: Avoids per-user Cisco API calls

### Testing Strategy

**Phase 0 Focus**: UI/UX validation only
- Credential save/load flow
- Button state management
- Modal open/close behavior
- Toast notification display

**Future Phase Focus**: Backend integration, data accuracy, performance

---

## Timeline

- **2025-10-11**: Phase 0 Complete (Settings Modal UX)
- **TBD**: Phase 1 (Database Migration)
- **TBD**: Phase 2 (Backend Service)
- **TBD**: Phase 3 (Auto-Sync Integration)
- **TBD**: Phase 4 (UI Display)
- **TBD**: Phase 5 (Polish & Documentation)

---

**Status**: âœ… Phase 0 Complete - Backend Development In Progress
**Next Milestone**: Database Migration (Phase 1)

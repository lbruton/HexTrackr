---
title: "Version 1.1.2 - ESLint Bug Fixes"
date: "2025-10-23"
version: "1.1.2"
status: "Released"
category: "Bug Fix"
---

# Version 1.1.2 - ESLint Bug Fixes

**Release Status**: ✅ Released
**Release Date**: 2025-10-23
**Parent Issues**: [HEX-318](https://linear.app/hextrackr/issue/HEX-318/bug-fix-userid-undefined-in-authcontroller-error-logging), [HEX-319](https://linear.app/hextrackr/issue/HEX-319/bug-fix-event-parameter-missing-in-backup-modal-createfreshbackup)

## Overview

HexTrackr v1.1.2 addresses two ESLint-detected bugs that represent real code quality issues: undefined variable usage in error logging (auth controller) and deprecated event handling patterns (backup modal). These fixes improve error diagnostics and ensure modern JavaScript compatibility.

## Bug Fixes

### Bug Fix #1: userId Undefined in authController Error Logging (HEX-318)

**Priority**: Medium
**Impact**: Error logs missing user identification, reduced audit trail quality

**Problem**: ESLint error `'userId' is not defined` at `app/controllers/authController.js:416`
- Variable `userId` used in catch block error logging
- Defined inside try block at line 372: `const userId = req.user.id;`
- When exceptions occur before line 372 (e.g., validation failures), `userId` is undefined
- Error logs fail to capture which user experienced the issue

**Solution**: Extract `userId` before try block with fallback
- Moved userId extraction to beginning of `changePassword()` method
- Uses optional chaining and fallback: `const userId = req.user?.id || "unknown";`
- Now available in both success and error logging paths
- Maintains audit trail even for early validation failures

**Files Modified**:
- `app/controllers/authController.js:352-353` - userId extraction before try block

**Validation**:
- ✅ ESLint validation passed (no-undef error resolved)
- ✅ userId now captured in all error logging scenarios
- ✅ Fallback to "unknown" for edge cases (should never occur with requireAuth middleware)

---

### Bug Fix #2: Event Parameter Missing in backup-modal (HEX-319)

**Priority**: High
**Impact**: Code relies on deprecated implicit `event` global, breaks in strict mode

**Problem**: ESLint error `'event' is not defined` at `app/public/scripts/shared/backup-modal.js:305`
- Method `createFreshBackup(type)` uses `event.target.closest("button")` without declaring `event` parameter
- Relies on deprecated implicit global `window.event` in onclick handlers
- Fragile pattern that fails in strict mode and modern JavaScript environments
- Anti-pattern violating explicit parameter passing

**Solution**: Backward-compatible dual-signature pattern
- Updated method signature: `createFreshBackup(eventOrType, type)`
- Supports both modern and legacy call patterns:
  - **Modern**: `createFreshBackup(event, type)` - explicit event parameter
  - **Legacy**: `createFreshBackup(type)` - falls back to `window.event`
- Uses optional chaining for safety: `btn = evt?.target?.closest("button")`
- Declared `btn` outside try block for finally block access

**Files Modified**:
- `app/public/scripts/shared/backup-modal.js:299-319` - Dual-signature method with backward compatibility
- `app/public/scripts/shared/backup-modal.js:310` - btn variable declared outside try block
- `app/public/scripts/shared/backup-modal.js:324,348-354` - Updated to use `backupType` variable

**Validation**:
- ✅ ESLint validation passed (no-undef error resolved)
- ✅ Backward compatible with existing onclick handlers
- ✅ Works in strict mode
- ✅ Modern event handling pattern available for future refactoring

---

## Technical Details

### ESLint Rules Enforced

Both fixes address violations of ESLint's `no-undef` rule, which prevents:
- Usage of undeclared variables
- Reliance on implicit global variables
- Scope-related bugs that break code in strict mode

### Backward Compatibility Strategy

**HEX-319 (backup-modal)**: Implemented graceful degradation
- Detects call signature via `typeof` check
- Falls back to `window.event` for legacy onclick handlers
- Maintains existing functionality while enabling modern usage
- Future refactoring can migrate to explicit event parameters

**HEX-318 (authController)**: Simple early extraction
- No backward compatibility needed (internal controller method)
- Uses optional chaining (`req.user?.id`) for safety
- Fallback value ensures logs always have context

### Code Quality Improvements

**Before v1.1.2**:
- ❌ Error logs missing user context when early validation fails
- ❌ Backup modal relies on deprecated `window.event` global
- ❌ Code breaks in strict mode
- ❌ ESLint errors blocking CI/CD

**After v1.1.2**:
- ✅ All error logs include user identification
- ✅ Event handling follows modern JavaScript patterns
- ✅ Strict mode compatible
- ✅ ESLint clean on both files

---

## User Impact

**For Developers**:
- Cleaner ESLint output (2 fewer errors)
- Better error diagnostics in production logs
- Code follows modern JavaScript best practices

**For System Administrators**:
- Improved audit trail quality (all password change errors now include userId)
- Better troubleshooting when backup operations fail
- More reliable error tracking

**For End Users**:
- No visible changes (bug fixes are internal code quality improvements)
- More stable backup functionality (strict mode compatible)

---

## Notes

### Why These Fixes Matter

Both bugs were **functional issues**, not just style violations:

1. **HEX-318 (userId)**: Missing user context in error logs makes production debugging significantly harder. When password change fails, we need to know WHICH user experienced the problem.

2. **HEX-319 (event)**: Relying on implicit `window.event` is a ticking time bomb. It works in legacy browsers but fails in:
   - Strict mode JavaScript
   - Modern bundlers with tree-shaking
   - Server-side rendering contexts
   - Future browser versions

### ESLint as Safety Net

These catches demonstrate the value of static analysis:
- `no-undef` rule caught real bugs, not just style issues
- Both would cause runtime errors in specific conditions
- Better to catch at lint time than in production

---

*Release Notes Generated: 2025-10-23*

---
title: "Version 1.1.2 - ESLint Bug Fixes + Documentation Portal Script Dependency"
date: "2025-10-23"
version: "1.1.2"
status: "Released"
category: "Bug Fix"
---

# Version 1.1.2 - ESLint Bug Fixes + Documentation Portal Script Dependency

**Release Status**: ✅ Released
**Release Date**: 2025-10-23
**Parent Issues**: [HEX-318](https://linear.app/hextrackr/issue/HEX-318/bug-fix-userid-undefined-in-authcontroller-error-logging), [HEX-319](https://linear.app/hextrackr/issue/HEX-319/bug-fix-event-parameter-missing-in-backup-modal-createfreshbackup), [HEX-320](https://linear.app/hextrackr/issue/HEX-320/bug-fix-btn-variable-scope-issue-in-backup-modal-createfreshbackup), [HEX-332](https://linear.app/hextrackr/issue/HEX-332/bug-fix-documentation-portal-missing-backup-modaljs-script-dependency)

## Overview

HexTrackr v1.1.2 addresses four bugs: three ESLint-detected code quality issues (undefined variable usage in error logging, deprecated event handling patterns, and variable scoping in try/catch/finally blocks) and one missing script dependency in the documentation portal that prevented backup modal buttons from working. These fixes improve error diagnostics, ensure modern JavaScript compatibility, and restore full functionality to the documentation portal settings modal.

## Bug Fixes

### Bug Fix #1: userId Undefined in authController Error Logging (HEX-318)

**Priority**: Medium
**Impact**: Error logs missing user identification, reduced audit trail quality

**Problem**: ESLint error `'userId' is not defined` at `app/controllers/authController.js:416`
- Variable `userId` used in catch block error logging
- Defined inside try block at line 372: `const userId = req.user.id;`
- When exceptions occur before line 372 (e.g., validation failures), `userId` is undefined
- Error logs fail to capture which user experienced the issue

**Solution**: Extract `userId` before try block with fallback
- Moved userId extraction to beginning of `changePassword()` method
- Uses optional chaining and fallback: `const userId = req.user?.id || "unknown";`
- Now available in both success and error logging paths
- Maintains audit trail even for early validation failures

**Files Modified**:
- `app/controllers/authController.js:352-353` - userId extraction before try block

**Validation**:
- ✅ ESLint validation passed (no-undef error resolved)
- ✅ userId now captured in all error logging scenarios
- ✅ Fallback to "unknown" for edge cases (should never occur with requireAuth middleware)

---

### Bug Fix #2: Event Parameter Missing in backup-modal (HEX-319)

**Priority**: High
**Impact**: Code relies on deprecated implicit `event` global, breaks in strict mode

**Problem**: ESLint error `'event' is not defined` at `app/public/scripts/shared/backup-modal.js:305`
- Method `createFreshBackup(type)` uses `event.target.closest("button")` without declaring `event` parameter
- Relies on deprecated implicit global `window.event` in onclick handlers
- Fragile pattern that fails in strict mode and modern JavaScript environments
- Anti-pattern violating explicit parameter passing

**Solution**: Backward-compatible dual-signature pattern
- Updated method signature: `createFreshBackup(eventOrType, type)`
- Supports both modern and legacy call patterns:
  - **Modern**: `createFreshBackup(event, type)` - explicit event parameter
  - **Legacy**: `createFreshBackup(type)` - falls back to `window.event`
- Uses optional chaining for safety: `btn = evt?.target?.closest("button")`
- Declared `btn` outside try block for finally block access

**Files Modified**:
- `app/public/scripts/shared/backup-modal.js:299-319` - Dual-signature method with backward compatibility
- `app/public/scripts/shared/backup-modal.js:310` - btn variable declared outside try block
- `app/public/scripts/shared/backup-modal.js:324,348-354` - Updated to use `backupType` variable

**Validation**:
- ✅ ESLint validation passed (no-undef error resolved)
- ✅ Backward compatible with existing onclick handlers
- ✅ Works in strict mode
- ✅ Modern event handling pattern available for future refactoring

---

### Bug Fix #3: btn Variable Scope Issue in backup-modal (HEX-320)

**Priority**: Medium
**Impact**: Variable scoping violation in try/catch/finally blocks

**Problem**: ESLint error `'btn' is not defined` at `app/public/scripts/shared/backup-modal.js:347-349`
- Variable `btn` declared inside try block with `const btn = event.target.closest("button")`
- Block-scoped variables not accessible in finally block
- Used in finally block to restore button state after backup completion
- Violates JavaScript block scoping rules
- Discovered during ESLint validation after fixing HEX-319

**Solution**: Declare `btn` outside try block for proper scope
- Declared `let btn = null;` before try block (line 310)
- Changed from `const btn = ...` to `btn = ...` inside try block
- Now accessible in try, catch, and finally blocks
- Follows JavaScript best practices for try/catch/finally patterns

**Files Modified**:
- `app/public/scripts/shared/backup-modal.js:310` - btn variable declared outside try block

**Validation**:
- ✅ ESLint validation passed (all 3 no-undef errors on lines 347-349 resolved)
- ✅ Button state properly restored on both success and failure
- ✅ Follows modern JavaScript block scoping rules

**Note**: Fixed in same commit as HEX-319. ESLint validation after fixing event parameter immediately caught this scoping issue, allowing both bugs to be resolved together.

---

### Bug Fix #4: Documentation Portal Missing backup-modal.js Script (HEX-332)

**Priority**: High
**Impact**: Backup modal buttons completely non-functional in documentation portal

**Problem**: User-reported bug - backup buttons failed in documentation portal only
- Settings modal contains buttons calling `window.backupModalManager.showTicketsBackupModal()`
- Documentation portal (`app/public/docs-html/index.html`) loads `settings-modal.js` but not `backup-modal.js`
- BackupModalManager class never instantiated, causing `window.backupModalManager is undefined`
- Console error: `Uncaught TypeError: can't access property 'showTicketsBackupModal', window.backupModalManager is undefined`
- Worked correctly in `tickets.html` and `vulnerabilities.html` (they load backup-modal.js)
- Pre-existing bug uncovered during v1.1.2 testing

**Solution**: Add missing script dependency with correct load order
- Added `<script src="../scripts/shared/backup-modal.js"></script>` to docs-html/index.html
- Placed BEFORE `settings-modal.js` (line 214) to ensure BackupModalManager exists before settings modal loads
- Follows same pattern as tickets.html and vulnerabilities.html

**Files Modified**:
- `app/public/docs-html/index.html:214` - Added backup-modal.js script reference

**Validation**:
- ✅ Script dependency now matches tickets.html and vulnerabilities.html
- ✅ Correct load order ensures BackupModalManager instantiation before usage
- ✅ Backup buttons now functional in documentation portal settings modal

---

## Technical Details

### ESLint Rules Enforced

HEX-318 and HEX-319 address violations of ESLint's `no-undef` rule, which prevents:
- Usage of undeclared variables
- Reliance on implicit global variables
- Scope-related bugs that break code in strict mode

### Script Dependency Management

HEX-320 (Documentation Portal) addresses missing script dependencies:
- Settings modal buttons require BackupModalManager class to be instantiated
- Script load order matters: backup-modal.js must load BEFORE settings-modal.js
- Consistency across all HTML pages (tickets, vulnerabilities, docs portal)
- Prevents runtime TypeError from undefined class instances

### Backward Compatibility Strategy

**HEX-319 (backup-modal)**: Implemented graceful degradation
- Detects call signature via `typeof` check
- Falls back to `window.event` for legacy onclick handlers
- Maintains existing functionality while enabling modern usage
- Future refactoring can migrate to explicit event parameters

**HEX-318 (authController)**: Simple early extraction
- No backward compatibility needed (internal controller method)
- Uses optional chaining (`req.user?.id`) for safety
- Fallback value ensures logs always have context

### Code Quality Improvements

**Before v1.1.2**:
- ❌ Error logs missing user context when early validation fails
- ❌ Backup modal relies on deprecated `window.event` global
- ❌ Documentation portal backup buttons completely broken
- ❌ Code breaks in strict mode
- ❌ ESLint errors blocking CI/CD

**After v1.1.2**:
- ✅ All error logs include user identification
- ✅ Event handling follows modern JavaScript patterns
- ✅ Documentation portal fully functional (backup modals work)
- ✅ Strict mode compatible
- ✅ ESLint clean on all affected files

---

## User Impact

**For Developers**:
- Cleaner ESLint output (6 fewer errors: 1 from HEX-318, 1 from HEX-319, 3 from HEX-320, 1 from implicit window.event)
- Better error diagnostics in production logs
- Code follows modern JavaScript best practices
- Proper try/catch/finally variable scoping
- Consistent script dependencies across all HTML pages

**For System Administrators**:
- Improved audit trail quality (all password change errors now include userId)
- Better troubleshooting when backup operations fail
- More reliable error tracking
- **FIXED**: Backup buttons now work in documentation portal settings modal

**For End Users**:
- **FIXED**: Backup and restore functionality fully available from documentation portal
- More stable backup functionality (strict mode compatible)
- Improved user experience when accessing backups from docs portal

---

## Documentation Improvements

- **Content**: Fixed inaccurate Node.js version in `architecture/technology-stack.md` - Corrected from "Node.js 22.11.0 LTS" to "Node.js 18.20.8 LTS (Alpine)" with environment-specific details ([DOCS-75](https://linear.app/hextrackr/issue/DOCS-75/docs-content-fix-incorrect-nodejs-version-in-technology-stackmd))
- **JSDoc**: Fixed documentation for `getResolvedVulnerabilities` in `app/controllers/vulnerabilityController.js` - Added complete @async, @param, @returns, @throws, @route, and @example tags ([DOCS-74](https://linear.app/hextrackr/issue/DOCS-74/jsdoc-fix-add-comprehensive-documentation-to))

---

## Notes

### Why These Fixes Matter

All four bugs were **functional issues**, not just style violations:

1. **HEX-318 (userId)**: Missing user context in error logs makes production debugging significantly harder. When password change fails, we need to know WHICH user experienced the problem.

2. **HEX-319 (event)**: Relying on implicit `window.event` is a ticking time bomb. It works in legacy browsers but fails in:
   - Strict mode JavaScript
   - Modern bundlers with tree-shaking
   - Server-side rendering contexts
   - Future browser versions

3. **HEX-320 (btn scoping)**: Block-scoped variable in try block but used in finally block. While currently functional due to JavaScript engine quirks, violates block scoping rules and could break with stricter engines or optimization passes. Demonstrates importance of following language semantics.

4. **HEX-332 (Documentation Portal backup-modal.js)**: Missing script dependency created complete functional failure. Backup buttons appeared clickable but threw console errors. User-reported bug discovered during v1.1.2 testing - demonstrates importance of testing all code paths, not just primary workflows.

### ESLint as Safety Net

ESLint catches demonstrate the value of static analysis:
- `no-undef` rule caught real bugs, not just style issues
- HEX-318, HEX-319, and HEX-320 would cause runtime errors in specific conditions
- Better to catch at lint time than in production
- Incremental testing (validating after each fix) caught HEX-320 immediately after fixing HEX-319

### User Testing Importance

The documentation portal bug was caught through actual user workflow testing:
- Unit tests would not catch missing script dependencies
- Integration tests focus on primary user paths (tickets.html, vulnerabilities.html)
- Real-world usage revealed edge case (documentation portal settings modal)
- Demonstrates value of dogfooding your own product

---

*Release Notes Generated: 2025-10-23*

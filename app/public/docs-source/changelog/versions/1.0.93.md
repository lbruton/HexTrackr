---
title: "Version 1.0.93 - Unified Modal Design System"
date: "2025-10-21"
version: "1.0.93"
status: "Released"
category: "Enhancement"
---

# Version 1.0.93 - Unified Modal Design System

**Release Status**: ✅ Released
**Release Date**: 2025-10-21
**Issues**: [HEX-269](https://linear.app/hextrackr/issue/HEX-269), [HEX-298](https://linear.app/hextrackr/issue/HEX-298), [HEX-308](https://linear.app/hextrackr/issue/HEX-308)

## Overview

Established a unified design system across all HexTrackr modals with consistent icon-first layouts, prominent severity-based borders, and centralized CSS variables. This release includes cache-busting cleanup, VPR Risk Breakdown card redesign in the Device Security Modal, and Risk Summary card redesign in the Vulnerability Details Modal.

## Features

### HEX-308: Vulnerability Details Modal - Risk Summary Card Redesign

**Description**: Redesigned the Risk Summary cards in the Vulnerability Details Modal to match the visual design pattern established in the Location Details Modal.

**Key Features**:
- **Icon-first layout**: Font Awesome icons (`fas fa-*`) at 2x size for visual hierarchy
- **Total VPR calculation**: Shows aggregate VPR (individual score × affected devices) instead of individual score
- **Prominent severity borders**: 2px colored borders using centralized CSS variables
- **Equal card sizing**: Uniform heights across all 4 cards (VPR, Devices, First Seen, Last Seen)
- **Severity-based theming**: VPR-Critical (red), VPR-High (orange), VPR-Medium (blue), VPR-Low (green)

**Icons Used**:
- Total VPR: `fas fa-chart-line` (dynamic color based on severity)
- Affected Devices: `fas fa-server text-azure`
- First Seen: `fas fa-calendar-plus text-orange`
- Last Seen: `fas fa-calendar-check text-blue`

**Technical Implementation**:
```javascript
// Calculate total VPR (individual score × affected devices)
const totalVPR = (vprScore * affectedDevices).toFixed(1);

// Determine VPR severity for color coding
const vprSeverity = vprScore >= 9 ? 'critical' :
                   vprScore >= 7 ? 'high' :
                   vprScore >= 4 ? 'medium' : 'low';
const vprColor = vprScore >= 9 ? 'red' :
                vprScore >= 7 ? 'orange' :
                vprScore >= 4 ? 'blue' : 'green';

// Apply data-severity attribute for CSS styling
<div class="card card-sm risk-summary-card" data-severity="vpr-${vprSeverity}">
    <div class="card-body text-center">
        <div class="mb-2">
            <i class="fas fa-chart-line fa-2x text-${vprColor}"></i>
        </div>
        <div class="text-muted small text-uppercase">Total VPR</div>
        <div class="h3 mb-0">${totalVPR}</div>
    </div>
</div>
```

**CSS Implementation**:
```css
/* Risk Summary Cards (Vulnerability Details Modal) */
.risk-summary-card {
    transition: all 0.2s ease;
    border: 2px solid transparent;
}

.modal-body .risk-summary-card[data-severity="vpr-critical"],
.risk-summary-card[data-severity="vpr-critical"] {
    border-color: var(--vpr-critical) !important;
    background-color: var(--vpr-critical-bg) !important;
}
/* Similar for vpr-high, vpr-medium, vpr-low, first-seen, last-seen */
```

**Files Modified**:
- `app/public/scripts/shared/vulnerability-details-modal.js:177-226` - Risk Summary card rendering with icons and Total VPR calculation
- `app/public/styles/shared/cards.css:557-605` - `.risk-summary-card` CSS with centralized theme tokens

### HEX-298: Device Security Modal - VPR Risk Breakdown Card Redesign

**Description**: Applied the unified modal design system to the Device Security Modal's VPR Risk Breakdown cards, replacing inline styles with CSS classes and adding severity icons.

**Key Features**:
- **Icon-first layout**: Font Awesome icons for each severity level (fa-2x size)
- **CSS class-based state management**: Replaced inline `card.style.*` with `classList.add/remove` for active states
- **Centralized theme variables**: All colors sourced from `css-variables.css` (--vpr-critical, --vpr-high, etc.)
- **Active state enhancements**: 3px borders with box-shadows on selected severity
- **Interactive feedback**: 2px hover transform for better UX

**Icons Used**:
- Critical: `fas fa-exclamation-triangle text-red`
- High: `fas fa-exclamation-circle text-orange`
- Medium: `fas fa-info-circle text-blue`
- Low: `fas fa-check-circle text-green`

**Technical Implementation**:
```javascript
populateVprSummary(device) {
    // HEX-298: Updated VPR cards with icons and centralized theme tokens
    document.getElementById("deviceVprSummary").innerHTML = `
        <div class="col-lg-3 col-6">
            <div class="card card-sm vpr-filter-card"
                 data-severity="Critical"
                 onclick="window.deviceSecurityModal.filterBySeverity('Critical')">
                <div class="card-body text-center">
                    <div class="mb-2">
                        <i class="fas fa-exclamation-triangle fa-2x text-red"></i>
                    </div>
                    <div class="text-muted small text-uppercase">Critical</div>
                    <div class="h3 mb-0">${device.criticalCount}</div>
                    <div class="text-red fw-bold">${(device.criticalVPR || 0).toFixed(1)} VPR</div>
                </div>
            </div>
        </div>
        <!-- Similar for High, Medium, Low -->
    `;
}

filterBySeverity(severity) {
    // HEX-298: Reset all card styles using CSS classes
    document.querySelectorAll(".vpr-filter-card").forEach(card => {
        card.classList.remove("active-critical", "active-high", "active-medium", "active-low");
    });

    if (this.currentFilter === severity) {
        this.currentFilter = null;
        this.gridApi.setFilterModel(null);
    } else {
        this.currentFilter = severity;

        // HEX-298: Update card visual states using CSS classes
        document.querySelectorAll(".vpr-filter-card").forEach(card => {
            const cardSeverity = card.getAttribute("data-severity");
            const activeClass = `active-${cardSeverity.toLowerCase()}`;
            if (cardSeverity === severity) {
                card.classList.add(activeClass);
            }
        });

        this.gridApi.setFilterModel({
            vprSeverity: {
                type: "equals",
                filter: severity
            }
        });
    }
}
```

**CSS Implementation**:
```css
/* VPR Filter Cards (Device Security Modal) */
.vpr-filter-card {
    cursor: pointer;
    transition: all 0.2s ease;
    border: 2px solid transparent;
}

.modal-body .vpr-filter-card[data-severity="Critical"],
.vpr-filter-card[data-severity="Critical"] {
    border-color: var(--vpr-critical) !important;
    background-color: var(--vpr-critical-bg) !important;
}

/* Active state - Critical (Red) */
.modal-body .vpr-filter-card.active-critical,
.vpr-filter-card.active-critical {
    border-color: var(--vpr-critical) !important;
    border-width: 3px !important;
    background-color: var(--vpr-critical-bg) !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4) !important;
}
/* Similar for active-high, active-medium, active-low */
```

**Files Modified**:
- `app/public/scripts/shared/device-security-modal.js:317-368` - VPR card rendering with icons and CSS classes
- `app/public/scripts/shared/device-security-modal.js:383-422` - Filter function using `classList` instead of inline styles
- `app/public/styles/shared/cards.css:607-688` - `.vpr-filter-card` CSS with active state management

### HEX-269: Cache-Busting Version Drift Cleanup

**Description**: Removed redundant cache-busting version query strings from script includes, as ETag-based cache validation handles automatic cache invalidation.

**Key Insights**:
- Express.static() automatically sends `Cache-Control: public, max-age=0` and `ETag` headers based on file modification time
- Browsers perform conditional GET requests using `If-None-Match: <etag>` header
- Server responds with `304 Not Modified` if file unchanged, `200 OK` with new content if modified
- Version query strings (`?v=1.0.48-session-fix`) were redundant and created maintenance burden

**Technical Implementation**:
```html
<!-- BEFORE (vulnerabilities.html:977, tickets.html:1258) -->
<script src="scripts/shared/auth-state.js?v=1.0.48-session-fix"></script>

<!-- AFTER -->
<script src="scripts/shared/auth-state.js"></script>
```

**Files Modified**:
- `app/public/vulnerabilities.html:977` - Removed version query string from auth-state.js
- `app/public/tickets.html:1258` - Removed version query string from auth-state.js

## Implementation Tasks

### Completed
- [X] HEX-269: Remove version query strings from auth-state.js includes
- [X] HEX-308: Add Font Awesome icons to Risk Summary cards
- [X] HEX-308: Implement Total VPR calculation (score × devices)
- [X] HEX-308: Create `.risk-summary-card` CSS with centralized theme tokens
- [X] HEX-308: Apply equal card sizing with `mb-0` and `fa-2x`
- [X] HEX-298: Add Font Awesome icons to VPR Risk Breakdown cards
- [X] HEX-298: Replace inline styles with CSS classes for state management
- [X] HEX-298: Create `.vpr-filter-card` CSS with active state enhancements
- [X] HEX-298: Update filter function to use `classList` API
- [X] ESLint compliance verified (no errors)
- [X] Docker restart confirmed functionality
- [X] Version bumped to v1.0.93 across 5 files

## Success Criteria

### HEX-308: Vulnerability Details Modal
- [X] Icons load correctly (Font Awesome, not Tabler)
- [X] All 4 cards have equal heights
- [X] VPR shows Total VPR (7.4 × 306 = 2,264.4), not individual score
- [X] Borders match severity colors (2px baseline)
- [X] Consistent with Location Details Modal design pattern

### HEX-298: Device Security Modal
- [X] Icons display for all 4 severity levels
- [X] Active state uses CSS classes (not inline styles)
- [X] 3px borders with box-shadows on active cards
- [X] Colors source from centralized CSS variables
- [X] No inline `card.style.*` manipulation

### HEX-269: Cache-Busting Cleanup
- [X] Version query strings removed from auth-state.js includes
- [X] ETags handle cache invalidation automatically
- [X] No impact on functionality or caching behavior

## User Impact

**Before**:
- **Vulnerability Details Modal**: Risk Summary cards lacked visual hierarchy, showed individual VPR instead of total, and had inconsistent sizing
- **Device Security Modal**: VPR cards used inline styles, had no icons, and lacked visual feedback on selection
- **Cache-busting**: Version query strings required manual updates and created maintenance burden

**After**:
- **Vulnerability Details Modal**: Icon-first layout with prominent severity borders, Total VPR calculation, and equal card sizing
- **Device Security Modal**: Unified design with icons, CSS class-based state management, and enhanced active states (3px borders + shadows)
- **Cache-busting**: Automatic ETag-based validation reduces maintenance and ensures correct caching behavior

## Pattern References

- Icon-first layout: `location-details-modal.js` (Location Details Modal card design)
- Font Awesome icons: `fas fa-chart-line`, `fas fa-exclamation-triangle`, etc.
- CSS variables: `css-variables.css` (--vpr-critical, --vpr-high, --vpr-medium, --vpr-low)
- Active state management: `classList.add/remove` pattern (Bootstrap 5 standard)
- Total VPR calculation: `vprScore * affectedDevices` (aggregate risk metric)

## Related Issues

- [HEX-269](https://linear.app/hextrackr/issue/HEX-269) - Cache-busting version drift cleanup
- [HEX-298](https://linear.app/hextrackr/issue/HEX-298) - Device Security Modal VPR Risk Breakdown redesign
- [HEX-308](https://linear.app/hextrackr/issue/HEX-308) - Vulnerability Details Modal Risk Summary redesign
- [HEX-307](https://linear.app/hextrackr/issue/HEX-307) - Accidentally completed during HEX-298 implementation

---

★ Insight ─────────────────────────────────────
1. **Design System Unification**: Establishing consistent patterns across modals (icon-first, severity borders, CSS variables) reduces cognitive load and improves maintainability
2. **CSS Class Over Inline Styles**: Using `classList` API with predefined CSS classes enables theme switching, A/B testing, and better performance than runtime style manipulation
3. **ETag-based Caching**: Modern browsers handle cache invalidation automatically via ETags - version query strings are legacy artifacts that add maintenance burden without benefit
─────────────────────────────────────────────────

*Changelog Version: 1.0.93 | Release Date: 2025-10-21*

/**
 * Vulnerability Table Container CSS - AG-Grid Overflow Fix
 * 
 * This file implements the container overflow fix for AG-Grid tables
 * as specified in hextrackr-specs/specs/004-ag-grid-table-overflow-fix/
 * 
 * Key Requirements:
 * - 16px (1rem) consistent padding on all sides
 * - Smooth 200ms transitions for height changes
 * - Text truncation with ellipsis for overflow content
 * - Responsive behavior maintaining containment
 * - CSS-first solution with minimal JavaScript
 * 
 * @version 1.0.0
 * @spec 004-ag-grid-table-overflow-fix
 */

/* CSS Variables for consistent spacing and timing */
:root {
  --vuln-table-padding: 1rem;      /* 16px padding requirement from research.md */
  --vuln-table-transition: 200ms;  /* 200ms transition requirement */
  --vuln-table-max-height: 80vh;   /* Maximum height constraint */
  --vuln-table-border-radius: 0.5rem;
  --vuln-table-gap: 0.5rem;
}

/**
 * Main AG-Grid Container Wrapper
 * 
 * This wrapper provides the containment boundary and ensures proper
 * padding around the AG-Grid table. It uses flexbox for responsive
 * height management and overflow containment.
 */
.ag-grid-container-wrapper {
  /* Flexbox container for dynamic height management */
  display: flex;
  flex-direction: column;
  
  /* Containment - Core requirement from FR-007 */
  padding: var(--vuln-table-padding);
  margin: 0;
  
  /* Overflow handling - prevents horizontal page scroll but allows vertical */
  overflow: hidden visible;
  
  /* Height management - let AG-Grid manage its own height with domLayout: autoHeight */
  min-height: 200px;
  
  /* Border and visual styling */
  border-radius: var(--vuln-table-border-radius);
  
  /* Transition for smooth height changes - FR-010 requirement */
  transition: 
    height var(--vuln-table-transition) ease-out,
    min-height var(--vuln-table-transition) ease-out,
    max-height var(--vuln-table-transition) ease-out;
  
  /* Performance optimization */
  will-change: height;
  
  /* Ensure proper positioning context */
  position: relative;
}

/**
 * AG-Grid Theme Enhancements
 * 
 * These styles enhance the Alpine theme to work better within
 * our constrained container environment.
 */
.ag-grid-container-wrapper .ag-theme-alpine {
  /* Fill the wrapper container */
  width: 100%;
  height: 100%;
  flex: 1;
  
  /* Remove default margins that could cause overflow */
  margin: 0;
  
  /* Allow content to display properly */
  overflow: visible;
  
  /* Border styling to match container */
  border-radius: calc(var(--vuln-table-border-radius) - 2px);
  
  /* Typography enhancements for long content */
  font-size: 14px;
  line-height: 1.4;
}

/**
 * Container Height Management
 * 
 * Dynamic height classes that can be applied based on content
 * and pagination settings. These work with AG-Grid's domLayout: 'autoHeight'.
 */
.ag-grid-container-wrapper.height-small {
  min-height: 300px;
  max-height: 400px;
}

.ag-grid-container-wrapper.height-medium {
  min-height: 400px;
  max-height: 600px;
}

.ag-grid-container-wrapper.height-large {
  min-height: 600px;
  max-height: var(--vuln-table-max-height);
}

/**
 * Cell Content Overflow Handling - FR-008 Requirement
 * 
 * Ensures long content is properly truncated with ellipsis
 * while maintaining table structure and readability.
 */
.ag-grid-container-wrapper .ag-cell {
  /* Text truncation for long content */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  
  /* Padding for readability */
  padding: 0.5rem 0.75rem;
  
  /* Ensure proper box sizing */
  box-sizing: border-box;
  
  /* Prevent content from bleeding outside cell boundaries */
  max-width: 100%;
}

/**
 * Special handling for description/plugin_name columns
 * which are most likely to have long content
 */
.ag-grid-container-wrapper .ag-cell[col-id="plugin_name"],
.ag-grid-container-wrapper .ag-cell[col-id="description"] {
  /* More aggressive truncation for description fields */
  max-width: 300px;
  
  /* Ensure tooltip accessibility */
  cursor: help;
}

/**
 * Header Cell Enhancements
 * 
 * Ensures headers also respect container boundaries
 */
.ag-grid-container-wrapper .ag-header-cell {
  /* Text truncation for long header names */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  
  /* Consistent padding with body cells */
  padding: 0.75rem;
  
  /* Typography improvements */
  font-weight: 600;
  font-size: 13px;
}

/**
 * Pagination Controls Integration
 * 
 * Ensures pagination controls work properly within the container
 * and don't cause overflow issues.
 */
.ag-grid-container-wrapper .ag-paging-panel {
  /* Prevent pagination from causing horizontal overflow */
  overflow: hidden;
  
  /* Padding alignment with container */
  padding: 0.5rem 0.75rem;
  
  /* Flexible layout for responsive behavior */
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--vuln-table-gap);
}

/**
 * Responsive Breakpoint Styles - FR-009 Requirement
 * 
 * Handles different screen sizes while maintaining containment.
 * Supports 1024px to 4K (3840px) as specified in research.md.
 */

/* Large Desktop (1920px and up) */
@media (min-width: 1920px) {
  .ag-grid-container-wrapper {
    --vuln-table-padding: 1.5rem; /* Slightly more padding on large screens */
  }
}

/* Standard Desktop (1200px to 1920px) */
@media (min-width: 1200px) and (max-width: 1919px) {
  .ag-grid-container-wrapper {
    --vuln-table-padding: 1rem;
  }
  
  .ag-grid-container-wrapper .ag-cell {
    font-size: 14px;
  }
}

/* Small Desktop/Large Tablet (1024px to 1199px) */
@media (min-width: 1024px) and (max-width: 1199px) {
  .ag-grid-container-wrapper {
    --vuln-table-padding: 0.75rem; /* Reduce padding on smaller screens */
  }
  
  .ag-grid-container-wrapper .ag-cell {
    padding: 0.4rem 0.6rem;
    font-size: 13px;
  }
  
  /* Hide less critical columns on smaller screens */
  .ag-grid-container-wrapper .ag-cell[col-id="vendor"],
  .ag-grid-container-wrapper .ag-cell[col-id="ip_address"] {
    display: none;
  }
}

/* Ultra-wide displays (2560px and up) */
@media (min-width: 2560px) {
  .ag-grid-container-wrapper {
    --vuln-table-padding: 2rem;
    --vuln-table-max-height: 85vh; /* More space available */
  }
  
  .ag-grid-container-wrapper .ag-cell[col-id="plugin_name"],
  .ag-grid-container-wrapper .ag-cell[col-id="description"] {
    max-width: 400px; /* Allow more content on ultra-wide */
  }
}

/**
 * Animation and Performance Optimizations
 * 
 * Ensures smooth transitions while maintaining 60fps performance
 * as required by the performance specifications.
 */

/* Reduced motion accessibility */
@media (prefers-reduced-motion: reduce) {
  .ag-grid-container-wrapper {
    transition: none;
  }
}

/* Performance optimizations for large datasets */
.ag-grid-container-wrapper.large-dataset {
  /* Disable transitions during rapid data updates */
  transition: none;
}

.ag-grid-container-wrapper.large-dataset.transition-enabled {
  /* Re-enable transitions after data settles */
  transition: height var(--vuln-table-transition) ease-out;
}

/**
 * Loading and Empty States
 * 
 * Provides proper container sizing during loading and empty states
 */
.ag-grid-container-wrapper .ag-overlay-loading-wrapper,
.ag-grid-container-wrapper .ag-overlay-no-rows-wrapper {
  /* Center loading/empty indicators */
  display: flex;
  align-items: center;
  justify-content: center;
  
  /* Minimum height for proper display */
  min-height: 200px;
  
  /* Typography styling */
  font-size: 16px;
  color: #6c757d;
}

/**
 * Focus and Accessibility Enhancements
 * 
 * Ensures proper focus management and keyboard navigation
 * within the constrained container.
 */
.ag-grid-container-wrapper .ag-cell:focus,
.ag-grid-container-wrapper .ag-header-cell:focus {
  /* Visible focus indicator */
  outline: 2px solid #007bff;
  outline-offset: -2px;
  
  /* Ensure focus doesn't cause overflow */
  overflow: visible;
  z-index: 10;
  position: relative;
}

/**
 * Print Styles
 * 
 * Ensures proper printing behavior when tables are printed
 */
@media print {
  .ag-grid-container-wrapper {
    /* Remove padding and transitions for print */
    padding: 0;
    transition: none;
    
    /* Full width/height for print */
    max-height: none;
    min-height: auto;
    height: auto;
  }
  
  .ag-grid-container-wrapper .ag-cell {
    /* Prevent text truncation in print */
    white-space: normal;
    text-overflow: unset;
    overflow: visible;
  }
}

/**
 * Debug and Development Styles
 * 
 * These styles can be enabled during development to visualize
 * container boundaries and debug overflow issues.
 */
.ag-grid-container-wrapper.debug {
  /* Visual container boundary */
  border: 2px dashed #ff6b6b;
  background: rgb(255, 107, 107, 0.1);
}

.ag-grid-container-wrapper.debug .ag-cell {
  /* Cell boundary visualization */
  border: 1px dotted #4ecdc4;
}

.ag-grid-container-wrapper.debug::before {
  /* Container info overlay */
  content: 'Container: ' attr(data-width) 'px Ã— ' attr(data-height) 'px';
  position: absolute;
  top: 4px;
  right: 4px;
  background: rgb(0, 0, 0, 0.8);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 11px;
  z-index: 1000;
  pointer-events: none;
}
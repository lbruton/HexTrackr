<!-- Fragment template for documentation content injected by docs-tabler.js -->
<section class="doc-fragment">
    <hr>
<h2>title: "Version 1.1.5 - JSDoc Dark Mode Theme Injection Fix"
date: "2025-10-24"
version: "1.1.5"
status: "Released"
category: "Bug Fix"</h2><h1>Version 1.1.5 - JSDoc Dark Mode Theme Injection Fix</h1><p><strong>Release Status</strong>: ‚úÖ Released<br><strong>Release Date</strong>: 2025-10-24<br><strong>Parent Issues</strong>: <a href="https://linear.app/hextrackr/issue/HEX-341">HEX-341</a></p>
<h2>Overview</h2><p>Resolved JSDoc developer documentation portal failing to apply HexTrackr&#39;s dark mode theme by integrating theme injection into the automated documentation build workflow.</p>
<hr>
<h2>[1.1.5] - 2025-10-24</h2><h3>Fixed</h3><h4>JSDoc Dark Mode Theme Injection (HEX-341) - 2025-10-24</h4><p><strong>Description</strong>: Resolved critical bug where JSDoc developer documentation portal (<code>/app/dev-docs-html/</code>) failed to detect and apply HexTrackr&#39;s dark mode theme, forcing users into light mode regardless of their theme preference.</p>
<p><strong>Root Cause</strong>:</p>
<ul>
<li>Theme injection script (<code>inject-jsdoc-theme.js</code>) worked perfectly when executed manually (185/185 files)</li>
<li>Bash wrapper script (<code>inject-jsdoc-theme-wrapper.sh</code>) also worked when run directly</li>
<li><strong>BUT</strong> the automated <code>npm run docs:dev</code> workflow silently failed to execute the injection</li>
<li>Shell command chaining with <code>&amp;&amp;</code> operator masked the failure (exit code 0 despite no injection)</li>
<li>Result: 185 generated HTML files contained <strong>zero</strong> theme injection code</li>
</ul>
<p><strong>Solution Implemented</strong>:</p>
<ul>
<li>Integrated theme injection into unified documentation workflow (<code>html-content-updater.js</code>)</li>
<li>Added <code>injectJSDocTheme()</code> method as Step 9 in release pipeline</li>
<li>Removed bash wrapper dependency from <code>package.json</code> script</li>
<li>Non-fatal error handling with clear emoji-based console output</li>
<li>Automatic file count reporting: <code>‚úÖ JSDoc theme injection complete! (190 files processed)</code></li>
</ul>
<p><strong>Technical Implementation</strong>:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// html-content-updater.js:1243-1280</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">injectJSDocTheme</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> { exec } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;child_process&quot;</span>);
    <span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;util&quot;</span>);
    <span class="hljs-keyword">const</span> execPromise = util.<span class="hljs-title function_">promisify</span>(exec);

    <span class="hljs-keyword">try</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;\nüé® Injecting dark mode theme into JSDoc HTML...&quot;</span>);

        <span class="hljs-keyword">const</span> { stdout } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">execPromise</span>(<span class="hljs-string">&quot;node app/scripts/inject-jsdoc-theme.js&quot;</span>, {
            <span class="hljs-attr">cwd</span>: process.<span class="hljs-title function_">cwd</span>(),
            <span class="hljs-attr">maxBuffer</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>
        });

        <span class="hljs-keyword">const</span> fileCount = (stdout.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/‚úì/g</span>) || []).<span class="hljs-property">length</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`‚úÖ JSDoc theme injection complete! (<span class="hljs-subst">${fileCount}</span> files processed)`</span>);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`‚ùå JSDoc theme injection failed: <span class="hljs-subst">${error.message}</span>`</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&quot;‚ö†Ô∏è  JSDoc documentation will display in light mode only&quot;</span>);
    }
}</code></pre><p><strong>Build Process (New Workflow)</strong>:</p>
<ol>
<li>JSDoc generates 185 HTML documentation files</li>
<li><code>HtmlContentUpdater.injectJSDocTheme()</code> executes injection script</li>
<li>Theme detection code inserted before <code>&lt;/head&gt;</code> tag in all files</li>
<li>Console reports success with file count</li>
<li>Documentation automatically syncs with user&#39;s theme preference</li>
</ol>
<p><strong>Theme Detection Logic</strong>:</p>
<ul>
<li>Checks <code>localStorage.getItem(&#39;hextrackr-theme&#39;)</code> for theme preference</li>
<li>Supports JSON format <code>{theme: &quot;dark&quot;, timestamp: ...}</code> and legacy string format</li>
<li>Falls back to <code>&#39;dark&#39;</code> as default theme</li>
<li>Applies 350+ lines of comprehensive dark mode CSS variables when <code>theme === &#39;dark&#39;</code></li>
</ul>
<p><strong>Benefits</strong>:</p>
<ul>
<li>‚úÖ <strong>100% Reliability</strong> - All 185/185 HTML files receive theme injection</li>
<li>‚úÖ <strong>Unified Pipeline</strong> - Follows v1.0.56 unified workflow architecture</li>
<li>‚úÖ <strong>Better Error Handling</strong> - Non-fatal failures with clear logging</li>
<li>‚úÖ <strong>No Shell Dependencies</strong> - Pure Node.js orchestration</li>
<li>‚úÖ <strong>Atomic Operations</strong> - Theme injection guaranteed to run after JSDoc generation</li>
<li>‚úÖ <strong>Clear Visibility</strong> - Console output shows exactly what&#39;s happening</li>
</ul>
<p><strong>Files Modified</strong>:</p>
<ul>
<li><code>app/public/docs-html/html-content-updater.js</code>: Added <code>injectJSDocTheme()</code> method (38 lines) + workflow integration</li>
<li><code>package.json</code>: Simplified <code>docs:dev</code> script (removed bash wrapper)</li>
<li><code>app/public/docs-source/architecture/theme-architecture.md</code>: Updated JSDoc integration documentation</li>
<li><code>app/scripts/inject-jsdoc-theme-wrapper.sh</code>: Deprecated (added deprecation notice)</li>
</ul>
<p><strong>Validation</strong>:</p>
<ul>
<li>‚úÖ <code>npm run release</code> completes successfully with clear console output</li>
<li>‚úÖ All 185 HTML files contain theme injection code (verified with grep)</li>
<li>‚úÖ Theme detection script present in sample files (verified AGGridThemeManager.html)</li>
<li>‚úÖ Console output: <code>‚úÖ JSDoc theme injection complete! (190 files processed)</code></li>
<li>‚úÖ No errors or warnings during documentation generation</li>
<li>‚úÖ Follows unified workflow pattern from v1.0.56</li>
</ul>
<p><strong>Testing Results</strong>:</p>
<pre><code class="language-bash"><span class="hljs-comment"># Verification - All files have theme injection</span>
$ grep -l <span class="hljs-string">&quot;jsdoc-dark-theme&quot;</span> app/dev-docs-html/*.html | <span class="hljs-built_in">wc</span> -l
185

$ <span class="hljs-built_in">ls</span> app/dev-docs-html/*.html | <span class="hljs-built_in">wc</span> -l
185

<span class="hljs-comment"># 185/185 = 100% success rate</span></code></pre><p><strong>Issues</strong>:</p>
<ul>
<li><a href="https://linear.app/hextrackr/issue/HEX-341">HEX-341</a> - JSDoc HTML portal not detecting dark mode theme</li>
</ul>
<hr>
<h3>Documentation Improvements</h3><h4>JSDoc Enhancement for TicketController.getInstance() (DOCS-155)</h4><p><strong>Description</strong>: Added complete JSDoc documentation to <code>getInstance()</code> static method in TicketController, improving API reference completeness.</p>
<p><strong>File Modified</strong>: <code>app/controllers/ticketController.js:46-73</code></p>
<p><strong>Improvements</strong>:</p>
<ul>
<li>Added <code>@static</code> tag to indicate static method pattern</li>
<li>Added <code>@returns</code> tag documenting the TicketController singleton instance return type</li>
<li>Added <code>@throws</code> tag documenting initialization dependency error</li>
<li>Added two <code>@example</code> tags showing:<ul>
<li>Typical usage pattern in route handlers</li>
<li>Error handling when called before initialization</li>
</ul>
</li>
</ul>
<p><strong>Before</strong> (Minimal Documentation):</p>
<pre><code class="language-javascript"><span class="hljs-comment">/**
 * Get singleton instance (for use in routes)
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(<span class="hljs-params"></span>) { ... }</code></pre><p><strong>After</strong> (Complete Documentation):</p>
<pre><code class="language-javascript"><span class="hljs-comment">/**
 * Get singleton TicketController instance for use in route handlers
 * Returns the initialized singleton instance created by initialize().
 * Used by route modules to access controller methods without managing lifecycle.
 *
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">TicketController</span>} The singleton TicketController instance
 * <span class="hljs-doctag">@throws</span> {<span class="hljs-type">Error</span>} &quot;TicketController not initialized. Call initialize() first.&quot; - If initialize() was never called
 *
 * <span class="hljs-doctag">@example</span>
 * // In app/routes/tickets.js
 * const controller = TicketController.getInstance();
 * const tickets = await controller.ticketService.getAllTickets();
 *
 * <span class="hljs-doctag">@example</span>
 * // Error case - calling before initialization
 * try {
 *     TicketController.getInstance(); // Throws error
 * } catch (error) {
 *     console.error(error.message); // &quot;TicketController not initialized...&quot;
 * }
 */</span></code></pre><p><strong>Impact</strong>: Developers consulting API documentation or using IDE autocomplete will now see complete parameter types, return values, error conditions, and usage examples for this critical singleton accessor method.</p>
<p><strong>Linear Issue</strong>: <a href="https://linear.app/hextrackr/issue/DOCS-155/jsdoc-fix-add-complete-jsdoc-to-getinstance-in-ticketcontroller">DOCS-155</a></p>
<hr>
<h4>JSDoc Enhancement for TemplateController.getAllTemplates() (DOCS-156)</h4><p><strong>Description</strong>: Added complete JSDoc documentation to <code>getAllTemplates()</code> method in TemplateController, correcting misleading description and adding comprehensive API documentation.</p>
<p><strong>File Modified</strong>: <code>app/controllers/templateController.js:47-81</code></p>
<p><strong>Improvements</strong>:</p>
<ul>
<li>Corrected description from &quot;Get all email templates&quot; to &quot;Get all templates across all types (email, ticket, vulnerability)&quot;</li>
<li>Added <code>@async</code> tag to indicate asynchronous method</li>
<li>Added detailed <code>@returns</code> tag documenting complete response structure with all fields</li>
<li>Added <code>@throws</code> tag documenting error conditions (service failures, database errors, JSON parsing)</li>
<li>Added <code>@route</code> tag documenting the API endpoint (GET /api/templates)</li>
<li>Added <code>@example</code> tag showing typical response structure with all three template types</li>
</ul>
<p><strong>Before</strong> (Incomplete and Misleading):</p>
<pre><code class="language-javascript"><span class="hljs-comment">/**
 * Get all email templates
 * GET /api/templates
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Request</span>} <span class="hljs-variable">req</span> - Express request
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Response</span>} <span class="hljs-variable">res</span> - Express response
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">getAllTemplates</span>(<span class="hljs-params">req, res</span>) { ... }</code></pre><p><strong>After</strong> (Complete and Accurate):</p>
<pre><code class="language-javascript"><span class="hljs-comment">/**
 * Get all templates across all types (email, ticket, vulnerability)
 * Retrieves active templates from email_templates, ticket_templates, and vulnerability_templates
 * via UNION query, returning unified array with parsed JSON variables
 *
 * <span class="hljs-doctag">@async</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">req</span> - Express request object (no parameters required)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">res</span> - Express response object
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;void&gt;</span>} Sends JSON response:
 *   - 200: {success: true, data: Array&lt;Object&gt;, count: number} - All active templates
 *     Each template object contains:
 *       - id {number} - Template ID
 *       - name {string} - Template name
 *       - template_type {string} - Type: &#x27;email&#x27;, &#x27;ticket&#x27;, or &#x27;vulnerability&#x27;
 *       - content {string} - Template content with variable placeholders
 *       - variables {Array&lt;string&gt;} - Parsed array of available variables
 *       - is_active {number} - Always 1 (inactive templates excluded)
 *   - 500: {success: false, error: &quot;Failed to fetch templates&quot;, details: string}
 * <span class="hljs-doctag">@throws</span> {<span class="hljs-type">Error</span>} Caught and returned as 500 response if:
 *   - TemplateService.getAllTemplates() fails
 *   - Database UNION query fails across template tables
 *   - JSON parsing of variables field fails
 * <span class="hljs-doctag">@route</span> GET /api/templates
 * <span class="hljs-doctag">@example</span>
 * // GET /api/templates
 * // Returns: {
 * //   success: true,
 * //   data: [
 * //     {id: 1, name: &quot;default_email&quot;, template_type: &quot;email&quot;, variables: [&quot;{{subject}}&quot;, ...]},
 * //     {id: 5, name: &quot;default_ticket&quot;, template_type: &quot;ticket&quot;, variables: [&quot;{{description}}&quot;, ...]},
 * //     {id: 8, name: &quot;default_vulnerability&quot;, template_type: &quot;vulnerability&quot;, variables: [...]}
 * //   ],
 * //   count: 12
 * // }
 */</span></code></pre><p><strong>Impact</strong>:</p>
<ul>
<li>Corrects misleading documentation that suggested only email templates were returned</li>
<li>Developers now see accurate multi-table UNION query behavior</li>
<li>Complete response structure documentation aids API consumers</li>
<li>Proper error handling documentation improves debugging</li>
</ul>
<p><strong>Linear Issue</strong>: <a href="https://linear.app/hextrackr/issue/DOCS-156/jsdoc-fix-add-complete-jsdoc-to-getalltemplates-in-templatecontroller">DOCS-156</a></p>
<hr>
<h3>Changed</h3><h4>Documentation Workflow Integration</h4><p><strong>Changed</strong>: JSDoc theme injection from standalone bash script to integrated documentation workflow step.</p>
<p><strong>Before</strong> (v1.0.29 - v1.1.4):</p>
<pre><code class="language-json"><span class="hljs-attr">&quot;docs:dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jsdoc -c jsdoc.dev.json &amp;&amp; bash app/scripts/inject-jsdoc-theme-wrapper.sh&quot;</span></code></pre><ul>
<li>Bash wrapper executed after JSDoc generation</li>
<li>Silent failures due to shell command chaining</li>
<li>No error visibility or file count reporting</li>
</ul>
<p><strong>After</strong> (v1.1.5+):</p>
<pre><code class="language-json"><span class="hljs-attr">&quot;docs:dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jsdoc -c jsdoc.dev.json&quot;</span></code></pre><ul>
<li>Theme injection handled by <code>html-content-updater.js</code> (Step 9)</li>
<li>Executed automatically during <code>npm run release</code></li>
<li>Clear console output with emoji indicators and file counts</li>
<li>Non-fatal error handling with warnings</li>
</ul>
<p><strong>Impact</strong>: Developer documentation now reliably respects dark mode theme preferences with guaranteed execution during release workflow.</p>
<hr>
<h3>Deprecated</h3><h4>inject-jsdoc-theme-wrapper.sh</h4><p><strong>Deprecated</strong>: Shell wrapper script <code>app/scripts/inject-jsdoc-theme-wrapper.sh</code> in favor of native Node.js integration in <code>html-content-updater.js</code>.</p>
<p><strong>Reason</strong>:</p>
<ul>
<li>Shell script chaining with <code>&amp;&amp;</code> operator hides failures</li>
<li>No visibility into execution status</li>
<li>Cross-platform compatibility concerns</li>
<li>Redundant with unified documentation workflow</li>
</ul>
<p><strong>Migration</strong>: No action required. Theme injection now executes automatically during <code>npm run release</code>.</p>
<p><strong>Removal Timeline</strong>: Script marked deprecated in v1.1.5, scheduled for removal in v1.2.0.</p>
<hr>
<h2>Notes</h2><h3>Architecture Improvements</h3><p><strong>Unified Documentation Pipeline Evolution</strong>:</p>
<p>v1.0.56 introduced the unified documentation workflow combining:</p>
<ul>
<li>Version sync across 5 files</li>
<li>Markdown ‚Üí HTML conversion</li>
<li>JSDoc generation</li>
</ul>
<p>v1.1.5 completes the pipeline with:</p>
<ul>
<li>JSDoc theme injection as atomic Step 9</li>
<li>Single command: <code>npm run release</code></li>
<li>Full error handling at each stage</li>
<li>Clear console output for debugging</li>
</ul>
<p><strong>Console Output Example</strong>:</p>
<pre><code class="language-bash">üöÄ Starting complete documentation generation workflow...

üîÑ Updating all version references to v1.1.5...
‚ú® Version <span class="hljs-built_in">sync</span> complete: 5 files updated

üìä Found 128 markdown <span class="hljs-built_in">source</span> files to convert.
‚úÖ Markdown HTML generation complete!

üìö Generating JSDoc HTML documentation...
‚úÖ JSDoc HTML generation complete!

üé® Injecting dark mode theme into JSDoc HTML...
‚úÖ JSDoc theme injection complete! (190 files processed)

‚ú® Complete documentation workflow finished successfully!</code></pre><h3>Performance Impact</h3><ul>
<li><strong>Build Time</strong>: +1.2 seconds (theme injection processing)</li>
<li><strong>File Count</strong>: 185 HTML files processed</li>
<li><strong>Success Rate</strong>: 100% (185/185 files)</li>
<li><strong>Error Rate</strong>: 0% (no failures)</li>
</ul>
<h3>Related Issues</h3><ul>
<li><strong>Original Bug Report</strong>: <a href="https://linear.app/hextrackr/issue/HEX-341">HEX-341</a></li>
<li><strong>Original Implementation</strong>: v1.0.29 - Fixed theme injection from 6/121 ‚Üí 121/121 files</li>
<li><strong>Unified Workflow Foundation</strong>: v1.0.56 - Merged version sync + docs generation</li>
</ul>
<hr>
<p><em>Changelog Entry | Version: 1.1.5 | Release Date: 2025-10-24</em></p>

    <!-- Note: This file is intentionally minimal. The full page scaffold, header, footer, and scripts
             are provided by docs-html/index.html. Content generated using this template will be
             fetched and injected into #content-container by docs-html/js/docs-portal-v2.js. -->
</section>

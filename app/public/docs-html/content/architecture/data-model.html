<!-- Fragment template for documentation content injected by docs-tabler.js -->
<section class="doc-fragment">
    <h1>HexTrackr Data Model</h1><p>This document provides a definitive overview of the HexTrackr database schema. As of v1.1.0, the primary bootstrap is <code>scripts/init-database-v1.1.0.js</code>, which consolidates all 21 application tables into a single initialization script (see <a href="https://linear.app/hextrackr/issue/HEX-324">HEX-324</a>). The schema may evolve further via incremental migrations in the <code>migrations/</code> directory. The authoritative state is the <strong>live SQLite schema</strong> captured in this document and the v1.1.0 baseline script.</p>
<p><strong>Schema Summary</strong> (v1.1.0 baseline):</p>
<ul>
<li><strong>21 Core Tables</strong>: Organized into 6 functional categories</li>
<li><strong>68 Indexes</strong>: Performance-optimized queries on critical fields (67 user-created + 1 auto-generated trigger index)</li>
<li><strong>4-Tier Deduplication</strong>: Enhanced unique key generation with confidence scoring</li>
<li><strong>KEV Integration</strong>: CISA Known Exploited Vulnerabilities catalog synchronization</li>
<li><strong>Template System</strong>: Email, ticket, and vulnerability report templates with variable substitution</li>
<li><strong>Authentication</strong>: Argon2id password hashing with account lockout protection</li>
<li><strong>Vendor Intelligence</strong>: Cisco PSIRT and Palo Alto advisory integration with 3NF normalization</li>
<li><strong>Audit Logging</strong>: Encrypted audit trail with configurable retention policy</li>
</ul>
<h2>Database Engine</h2><ul>
<li><strong>Engine</strong>: SQLite 3</li>
<li><strong>Database File</strong>: <code>/app/data/hextrackr.db</code> (Docker named volume: <code>hextrackr-database</code>)</li>
<li><strong>Local Path</strong>: Not accessible from host filesystem (isolated in Docker volume for SQLite integrity)</li>
</ul>
<hr>
<h2>Schema Organization (v1.1.0)</h2><p>The 21 application tables are organized into 6 functional categories:</p>
<p><strong>Core Business</strong> (3 tables):</p>
<ul>
<li><code>tickets</code> - Field operations ticketing system</li>
<li><code>ticket_templates</code> - Ticket creation templates</li>
<li><code>ticket_vulnerabilities</code> - Junction table linking tickets to vulnerabilities</li>
</ul>
<p><strong>Vulnerability Management</strong> (9 tables):</p>
<ul>
<li><code>vulnerabilities</code> - Legacy vulnerability data (pre-rollover, backup/export only)</li>
<li><code>vulnerabilities_current</code> - Current deduplicated vulnerability state</li>
<li><code>vulnerability_snapshots</code> - Historical append-only vulnerability log</li>
<li><code>vulnerability_staging</code> - Bulk import staging area</li>
<li><code>vulnerability_daily_totals</code> - Pre-calculated daily aggregates</li>
<li><code>vulnerability_imports</code> - CSV import audit trail</li>
<li><code>vulnerability_templates</code> - Vulnerability report templates</li>
<li><code>vendor_daily_totals</code> - Vendor-specific daily aggregates</li>
</ul>
<p><strong>Vendor Intelligence</strong> (3 tables):</p>
<ul>
<li><code>cisco_advisories</code> - Cisco PSIRT security advisories (OAuth2 synced)</li>
<li><code>cisco_fixed_versions</code> - Normalized Cisco fix versions (3NF, addresses multi-OS-family CVE corruption)</li>
<li><code>palo_alto_advisories</code> - Palo Alto security bulletins (web scraped)</li>
</ul>
<p><strong>CISA Integration</strong> (2 tables):</p>
<ul>
<li><code>kev_status</code> - CISA Known Exploited Vulnerabilities catalog</li>
<li><code>sync_metadata</code> - KEV synchronization history and status</li>
</ul>
<p><strong>Authentication &amp; Preferences</strong> (2 tables):</p>
<ul>
<li><code>users</code> - User accounts with Argon2id password hashing</li>
<li><code>user_preferences</code> - Cross-device user settings (JSON blob storage)</li>
</ul>
<p><strong>Security &amp; Audit</strong> (2 tables):</p>
<ul>
<li><code>audit_logs</code> - Encrypted audit trail with retention policy</li>
<li><code>audit_log_config</code> - Singleton configuration for audit logging</li>
</ul>
<p><strong>Note</strong>: The <code>email_templates</code> table (part of the Template System category) is included in the Vulnerability Management count above for organizational clarity.</p>
<hr>
<h2>Core Tables</h2><h3>`tickets`</h3><p>Stores all ticketing information. This table has <strong>indexes for query performance</strong> on dates, status, site codes, and external ticket numbers. Site and location tracking uses TEXT fields (<code>site</code>, <code>site_id</code>, <code>location</code>, <code>location_id</code>) for flexible data storage.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>TEXT</td>
<td>PK</td>
<td>Stable unique identifier supplied by UI (string, not auto-increment).</td>
</tr>
<tr>
<td><code>xt_number</code></td>
<td>TEXT</td>
<td>UNIQUE</td>
<td>Alternate human-friendly number (used when <code>id</code> absent in legacy imports).</td>
</tr>
<tr>
<td><code>date_submitted</code></td>
<td>TEXT</td>
<td></td>
<td>Submission date (ISO date) - nullable.</td>
</tr>
<tr>
<td><code>date_due</code></td>
<td>TEXT</td>
<td></td>
<td>Due date (ISO date) - nullable.</td>
</tr>
<tr>
<td><code>hexagon_ticket</code></td>
<td>TEXT</td>
<td></td>
<td>External Hexagon reference.</td>
</tr>
<tr>
<td><code>service_now_ticket</code></td>
<td>TEXT</td>
<td></td>
<td>External ServiceNow reference.</td>
</tr>
<tr>
<td><code>location</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Human readable location label.</td>
</tr>
<tr>
<td><code>devices</code></td>
<td>TEXT</td>
<td></td>
<td>Semicolon-delimited device names preserving boot order (imports accept JSON arrays and are normalised).</td>
</tr>
<tr>
<td><code>supervisor</code></td>
<td>TEXT</td>
<td></td>
<td>Supervisor name (can be semicolon-delimited for multiple).</td>
</tr>
<tr>
<td><code>tech</code></td>
<td>TEXT</td>
<td></td>
<td>Assigned technician.</td>
</tr>
<tr>
<td><code>status</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;Open&#39;</td>
<td>Workflow status (Open, Completed, etc.).</td>
</tr>
<tr>
<td><code>notes</code></td>
<td>TEXT</td>
<td></td>
<td>Free form notes.</td>
</tr>
<tr>
<td><code>attachments</code></td>
<td>TEXT</td>
<td></td>
<td>JSON array of attachment metadata.</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Creation timestamp.</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last update timestamp.</td>
</tr>
<tr>
<td><code>site</code></td>
<td>TEXT</td>
<td></td>
<td>Higher-level site grouping.</td>
</tr>
<tr>
<td><code>site_id</code></td>
<td>TEXT</td>
<td></td>
<td>Optional site identifier (TEXT, not FK).</td>
</tr>
<tr>
<td><code>location_id</code></td>
<td>TEXT</td>
<td></td>
<td>Optional location identifier (TEXT, not FK).</td>
</tr>
</tbody></table>
<p><strong>Ticket Indexes</strong> (all created automatically): location, status, date_submitted, date_due, hexagon_ticket, service_now_ticket, site, xt_number, site_id, location_id.</p>
<h3>`vulnerability_imports`</h3><p>Audit log of each ingested CSV batch.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Batch identifier.</td>
</tr>
<tr>
<td><code>filename</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Uploaded filename.</td>
</tr>
<tr>
<td><code>import_date</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Import timestamp (ISO).</td>
</tr>
<tr>
<td><code>row_count</code></td>
<td>INTEGER</td>
<td>NOT NULL</td>
<td>Rows parsed (after filtering empties).</td>
</tr>
<tr>
<td><code>vendor</code></td>
<td>TEXT</td>
<td></td>
<td>Source label (cisco, tenable, web-import, etc.).</td>
</tr>
<tr>
<td><code>file_size</code></td>
<td>INTEGER</td>
<td></td>
<td>Size in bytes.</td>
</tr>
<tr>
<td><code>processing_time</code></td>
<td>INTEGER</td>
<td></td>
<td>Milliseconds to process.</td>
</tr>
<tr>
<td><code>raw_headers</code></td>
<td>TEXT</td>
<td></td>
<td>JSON array of original column names.</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Record creation time.</td>
</tr>
</tbody></table>
<hr>
<h2>Vulnerability Rollover Architecture</h2><p>HexTrackr uses a &quot;rollover&quot; architecture to manage vulnerability data over time. This allows for accurate daily trending and historical analysis. It consists of three main tables.</p>
<p>For a detailed walkthrough of the rollover process, see <a href="./backend.md#vulnerability-rollover-workflow">Backend Architecture</a>.</p>
<h3>`vulnerabilities_current`</h3><p>Current deduplicated state (one row per active unique vulnerability for the most recent scan date it appeared in). Added during rollover processing.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td></td>
</tr>
<tr>
<td><code>import_id</code></td>
<td>INTEGER</td>
<td>FK to <code>vulnerability_imports.id</code></td>
<td>Batch that introduced or last updated this row.</td>
</tr>
<tr>
<td><code>scan_date</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Date of the scan (YYYY-MM-DD).</td>
</tr>
<tr>
<td><code>hostname</code></td>
<td>TEXT</td>
<td></td>
<td>Raw hostname (pre-normalization retained).</td>
</tr>
<tr>
<td><code>ip_address</code></td>
<td>TEXT</td>
<td></td>
<td>Optional IP (may be blank).</td>
</tr>
<tr>
<td><code>cve</code></td>
<td>TEXT</td>
<td></td>
<td>CVE identifier if present.</td>
</tr>
<tr>
<td><code>severity</code></td>
<td>TEXT</td>
<td></td>
<td>Critical/High/Medium/Low (case-insensitive input).</td>
</tr>
<tr>
<td><code>vpr_score</code></td>
<td>REAL</td>
<td></td>
<td>Vulnerability Priority Rating.</td>
</tr>
<tr>
<td><code>cvss_score</code></td>
<td>REAL</td>
<td></td>
<td>CVSS Base score.</td>
</tr>
<tr>
<td><code>first_seen</code></td>
<td>TEXT</td>
<td></td>
<td>First observed date (fallback to <code>scan_date</code> if missing).</td>
</tr>
<tr>
<td><code>last_seen</code></td>
<td>TEXT</td>
<td></td>
<td>Last observed date (updated each scan presence).</td>
</tr>
<tr>
<td><code>plugin_id</code></td>
<td>TEXT</td>
<td></td>
<td>Scanner plugin id.</td>
</tr>
<tr>
<td><code>plugin_name</code></td>
<td>TEXT</td>
<td></td>
<td>Scanner plugin name.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td></td>
<td>Short description (duplicate of plugin_name in some feeds).</td>
</tr>
<tr>
<td><code>solution</code></td>
<td>TEXT</td>
<td></td>
<td>Remediation guidance.</td>
</tr>
<tr>
<td><code>vendor_reference</code></td>
<td>TEXT</td>
<td></td>
<td>Original vendor family string.</td>
</tr>
<tr>
<td><code>vendor</code></td>
<td>TEXT</td>
<td></td>
<td>Normalized vendor (currently mirrors vendor_reference).</td>
</tr>
<tr>
<td><code>vulnerability_date</code></td>
<td>TEXT</td>
<td></td>
<td>Publication date.</td>
</tr>
<tr>
<td><code>state</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;open&#39;</td>
<td>Physical state (open/closed).</td>
</tr>
<tr>
<td><code>lifecycle_state</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;active&#39;</td>
<td>Logical state (active/resolved/reopened).</td>
</tr>
<tr>
<td><code>resolved_date</code></td>
<td>TEXT</td>
<td></td>
<td>Date when marked as resolved.</td>
</tr>
<tr>
<td><code>resolution_reason</code></td>
<td>TEXT</td>
<td></td>
<td>Reason why vulnerability was resolved.</td>
</tr>
<tr>
<td><code>confidence_score</code></td>
<td>INTEGER</td>
<td>DEFAULT 50</td>
<td>Deduplication confidence (0-100).</td>
</tr>
<tr>
<td><code>dedup_tier</code></td>
<td>INTEGER</td>
<td>DEFAULT 4</td>
<td>Deduplication tier level (1-4).</td>
</tr>
<tr>
<td><code>enhanced_unique_key</code></td>
<td>TEXT</td>
<td></td>
<td>Enhanced 4-tier deduplication key.</td>
</tr>
<tr>
<td><code>operating_system</code></td>
<td>TEXT</td>
<td></td>
<td>Operating system information (added Migration 006).</td>
</tr>
<tr>
<td><code>solution_text</code></td>
<td>TEXT</td>
<td></td>
<td>Extended solution details (added Migration 006).</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Insert timestamp.</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>DATETIME</td>
<td></td>
<td>Last update timestamp.</td>
</tr>
<tr>
<td><code>unique_key</code></td>
<td>TEXT</td>
<td>UNIQUE</td>
<td>Composite key (see Rollover section).</td>
</tr>
</tbody></table>
<h3>`vulnerability_snapshots`</h3><p>This table is an append-only log of <strong>all vulnerabilities from every scan</strong>. It serves as the historical record for trend analysis.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Snapshot record identifier.</td>
</tr>
<tr>
<td><code>import_id</code></td>
<td>INTEGER</td>
<td>FK to <code>vulnerability_imports.id</code>, NOT NULL</td>
<td>Associated import batch.</td>
</tr>
<tr>
<td><code>scan_date</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Date of the scan (YYYY-MM-DD).</td>
</tr>
<tr>
<td><code>hostname</code></td>
<td>TEXT</td>
<td></td>
<td>Raw hostname (pre-normalization retained).</td>
</tr>
<tr>
<td><code>ip_address</code></td>
<td>TEXT</td>
<td></td>
<td>Optional IP (may be blank).</td>
</tr>
<tr>
<td><code>cve</code></td>
<td>TEXT</td>
<td></td>
<td>CVE identifier if present.</td>
</tr>
<tr>
<td><code>severity</code></td>
<td>TEXT</td>
<td></td>
<td>Critical/High/Medium/Low (case-insensitive input).</td>
</tr>
<tr>
<td><code>vpr_score</code></td>
<td>REAL</td>
<td></td>
<td>Vulnerability Priority Rating.</td>
</tr>
<tr>
<td><code>cvss_score</code></td>
<td>REAL</td>
<td></td>
<td>CVSS Base score.</td>
</tr>
<tr>
<td><code>first_seen</code></td>
<td>TEXT</td>
<td></td>
<td>First observed date.</td>
</tr>
<tr>
<td><code>last_seen</code></td>
<td>TEXT</td>
<td></td>
<td>Last observed date.</td>
</tr>
<tr>
<td><code>plugin_id</code></td>
<td>TEXT</td>
<td></td>
<td>Scanner plugin id.</td>
</tr>
<tr>
<td><code>plugin_name</code></td>
<td>TEXT</td>
<td></td>
<td>Scanner plugin name.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td></td>
<td>Short description (duplicate of plugin_name in some feeds).</td>
</tr>
<tr>
<td><code>solution</code></td>
<td>TEXT</td>
<td></td>
<td>Remediation guidance.</td>
</tr>
<tr>
<td><code>vendor_reference</code></td>
<td>TEXT</td>
<td></td>
<td>Original vendor family string.</td>
</tr>
<tr>
<td><code>vendor</code></td>
<td>TEXT</td>
<td></td>
<td>Normalized vendor.</td>
</tr>
<tr>
<td><code>vulnerability_date</code></td>
<td>TEXT</td>
<td></td>
<td>Publication date.</td>
</tr>
<tr>
<td><code>state</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;open&#39;</td>
<td>Physical state (open/closed).</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Insert timestamp.</td>
</tr>
<tr>
<td><code>unique_key</code></td>
<td>TEXT</td>
<td></td>
<td>Composite key (not unique - allows duplicates across scan dates).</td>
</tr>
<tr>
<td><code>confidence_score</code></td>
<td>INTEGER</td>
<td>DEFAULT 50</td>
<td>Deduplication confidence (0-100).</td>
</tr>
<tr>
<td><code>dedup_tier</code></td>
<td>INTEGER</td>
<td>DEFAULT 4</td>
<td>Deduplication tier level (1-4).</td>
</tr>
<tr>
<td><code>enhanced_unique_key</code></td>
<td>TEXT</td>
<td></td>
<td>Enhanced 4-tier deduplication key.</td>
</tr>
<tr>
<td><code>operating_system</code></td>
<td>TEXT</td>
<td></td>
<td>Operating system information (added Migration 006).</td>
</tr>
<tr>
<td><code>solution_text</code></td>
<td>TEXT</td>
<td></td>
<td>Extended solution details (added Migration 006).</td>
</tr>
</tbody></table>
<p><strong>Key Differences from <code>vulnerabilities_current</code></strong>:</p>
<ul>
<li><code>unique_key</code> is <strong>not unique</strong> (allows duplicate vulnerabilities across scan dates)</li>
<li>Missing lifecycle management columns: <code>lifecycle_state</code>, <code>resolved_date</code>, <code>resolution_reason</code></li>
<li>Missing <code>updated_at</code> column (append-only, never updated)</li>
<li>Acts as append-only historical log for every scan ingestion</li>
</ul>
<h3>`vulnerability_daily_totals`</h3><p>This table stores pre-calculated daily aggregates to power the dashboard charts efficiently.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td><strong>Primary Key</strong>.</td>
</tr>
<tr>
<td><code>scan_date</code></td>
<td>TEXT</td>
<td><strong>UNIQUE</strong>. The date for which the totals are calculated.</td>
</tr>
<tr>
<td><code>critical_count</code></td>
<td>INTEGER</td>
<td>Total count of Critical vulnerabilities on this date.</td>
</tr>
<tr>
<td><code>critical_total_vpr</code></td>
<td>REAL</td>
<td>Sum of VPR scores for all Critical vulnerabilities.</td>
</tr>
<tr>
<td><code>high_count</code></td>
<td>INTEGER</td>
<td>Total count of High vulnerabilities.</td>
</tr>
<tr>
<td><code>high_total_vpr</code></td>
<td>REAL</td>
<td>Sum of VPR scores for High vulnerabilities.</td>
</tr>
<tr>
<td><code>medium_count</code></td>
<td>INTEGER</td>
<td>Total count of Medium vulnerabilities.</td>
</tr>
<tr>
<td><code>medium_total_vpr</code></td>
<td>REAL</td>
<td>Sum of VPR scores for Medium vulnerabilities.</td>
</tr>
<tr>
<td><code>low_count</code></td>
<td>INTEGER</td>
<td>Total count of Low vulnerabilities.</td>
</tr>
<tr>
<td><code>low_total_vpr</code></td>
<td>REAL</td>
<td>Sum of VPR scores for Low vulnerabilities.</td>
</tr>
<tr>
<td><code>total_vulnerabilities</code></td>
<td>INTEGER</td>
<td>The sum of all vulnerability counts for the day.</td>
</tr>
<tr>
<td><code>total_vpr</code></td>
<td>REAL</td>
<td>The sum of all VPR scores for the day.</td>
</tr>
<tr>
<td><code>resolved_count</code></td>
<td>INTEGER</td>
<td>Count of vulnerabilities marked resolved this day.</td>
</tr>
<tr>
<td><code>reopened_count</code></td>
<td>INTEGER</td>
<td>Count of previously resolved vulnerabilities that reappeared.</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>Record creation timestamp.</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>DATETIME</td>
<td>Last update timestamp.</td>
</tr>
</tbody></table>
<h3>`vendor_daily_totals` *(v1.0.62 - Migration 008)*</h3><p>Vendor-specific daily aggregates for trend analysis and vendor comparison. This table provides granular insights into vulnerability distribution across different vendors (Cisco, Palo Alto, etc.).</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td><strong>Primary Key</strong>.</td>
</tr>
<tr>
<td><code>scan_date</code></td>
<td>TEXT</td>
<td>The date for which the totals are calculated.</td>
</tr>
<tr>
<td><code>vendor</code></td>
<td>TEXT</td>
<td>Vendor name (cisco, paloalto, etc.).</td>
</tr>
<tr>
<td><code>critical_count</code></td>
<td>INTEGER</td>
<td>Count of Critical vulnerabilities for this vendor on this date.</td>
</tr>
<tr>
<td><code>critical_total_vpr</code></td>
<td>REAL</td>
<td>Sum of VPR scores for Critical vulnerabilities.</td>
</tr>
<tr>
<td><code>high_count</code></td>
<td>INTEGER</td>
<td>Count of High vulnerabilities.</td>
</tr>
<tr>
<td><code>high_total_vpr</code></td>
<td>REAL</td>
<td>Sum of VPR scores for High vulnerabilities.</td>
</tr>
<tr>
<td><code>medium_count</code></td>
<td>INTEGER</td>
<td>Count of Medium vulnerabilities.</td>
</tr>
<tr>
<td><code>medium_total_vpr</code></td>
<td>REAL</td>
<td>Sum of VPR scores for Medium vulnerabilities.</td>
</tr>
<tr>
<td><code>low_count</code></td>
<td>INTEGER</td>
<td>Count of Low vulnerabilities.</td>
</tr>
<tr>
<td><code>low_total_vpr</code></td>
<td>REAL</td>
<td>Sum of VPR scores for Low vulnerabilities.</td>
</tr>
<tr>
<td><code>total_vulnerabilities</code></td>
<td>INTEGER</td>
<td>Sum of all vulnerability counts for this vendor/date.</td>
</tr>
<tr>
<td><code>total_vpr</code></td>
<td>REAL</td>
<td>Sum of all VPR scores for this vendor/date.</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>Record creation timestamp.</td>
</tr>
<tr>
<td><strong>UNIQUE</strong></td>
<td>(scan_date, vendor)</td>
<td>One record per vendor per date.</td>
</tr>
</tbody></table>
<p><strong>Indexes</strong>:</p>
<ul>
<li><code>idx_vendor_daily_scan_date</code> (scan_date)</li>
<li><code>idx_vendor_daily_vendor</code> (vendor)</li>
<li><code>idx_vendor_daily_composite</code> (vendor, scan_date)</li>
</ul>
<p><strong>Purpose</strong>: Permanent storage for vendor-specific trend data. Unlike <code>vulnerability_daily_totals</code>, this table is <strong>never cleaned up</strong> by db-snapshot-cleanup.js, providing long-term vendor performance tracking.</p>
<h3>`vulnerability_staging`</h3><p>This table serves as a <strong>bulk import staging area</strong> for high-performance CSV processing with enhanced deduplication scoring.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Staging row identifier.</td>
</tr>
<tr>
<td><code>import_id</code></td>
<td>INTEGER</td>
<td>FK to <code>vulnerability_imports.id</code>, NOT NULL</td>
<td>Associated import batch.</td>
</tr>
<tr>
<td><code>hostname</code></td>
<td>TEXT</td>
<td></td>
<td>Raw hostname (pre-normalization).</td>
</tr>
<tr>
<td><code>ip_address</code></td>
<td>TEXT</td>
<td></td>
<td>Optional IP address.</td>
</tr>
<tr>
<td><code>cve</code></td>
<td>TEXT</td>
<td></td>
<td>CVE identifier if present.</td>
</tr>
<tr>
<td><code>severity</code></td>
<td>TEXT</td>
<td></td>
<td>Critical/High/Medium/Low.</td>
</tr>
<tr>
<td><code>vpr_score</code></td>
<td>REAL</td>
<td></td>
<td>Vulnerability Priority Rating.</td>
</tr>
<tr>
<td><code>cvss_score</code></td>
<td>REAL</td>
<td></td>
<td>CVSS Base score.</td>
</tr>
<tr>
<td><code>plugin_id</code></td>
<td>TEXT</td>
<td></td>
<td>Scanner plugin identifier.</td>
</tr>
<tr>
<td><code>plugin_name</code></td>
<td>TEXT</td>
<td></td>
<td>Scanner plugin name.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td></td>
<td>Vulnerability description.</td>
</tr>
<tr>
<td><code>solution</code></td>
<td>TEXT</td>
<td></td>
<td>Remediation guidance.</td>
</tr>
<tr>
<td><code>vendor_reference</code></td>
<td>TEXT</td>
<td></td>
<td>Original vendor family string.</td>
</tr>
<tr>
<td><code>vendor</code></td>
<td>TEXT</td>
<td></td>
<td>Normalized vendor.</td>
</tr>
<tr>
<td><code>vulnerability_date</code></td>
<td>TEXT</td>
<td></td>
<td>Publication date.</td>
</tr>
<tr>
<td><code>state</code></td>
<td>TEXT</td>
<td></td>
<td>Physical state (open/closed).</td>
</tr>
<tr>
<td><code>enhanced_unique_key</code></td>
<td>TEXT</td>
<td></td>
<td>4-tier deduplication key (see Rollover section).</td>
</tr>
<tr>
<td><code>confidence_score</code></td>
<td>REAL</td>
<td></td>
<td>Deduplication confidence (0.0-1.0): Tier 1 = 0.95, Tier 2 = 0.75, Tier 3 = 0.50, Tier 4 = 0.25.</td>
</tr>
<tr>
<td><code>dedup_tier</code></td>
<td>INTEGER</td>
<td></td>
<td>Tier level (1-4): 1 = Asset+Plugin (highest), 2 = CVE+Host, 3 = Plugin+Host+Vendor, 4 = Desc Hash (lowest).</td>
</tr>
<tr>
<td><code>lifecycle_state</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;staging&#39;</td>
<td>Processing state (staging/processed/error).</td>
</tr>
<tr>
<td><code>raw_csv_row</code></td>
<td>JSON</td>
<td></td>
<td>Complete original CSV row for audit trail.</td>
</tr>
<tr>
<td><code>processed</code></td>
<td>BOOLEAN</td>
<td>DEFAULT 0</td>
<td>Whether row has been processed into <code>vulnerabilities_current</code>.</td>
</tr>
<tr>
<td><code>batch_id</code></td>
<td>INTEGER</td>
<td></td>
<td>Sub-batch identifier for parallel processing.</td>
</tr>
<tr>
<td><code>processing_error</code></td>
<td>TEXT</td>
<td></td>
<td>Error message if processing failed.</td>
</tr>
<tr>
<td><code>operating_system</code></td>
<td>TEXT</td>
<td></td>
<td>Operating system information (added Migration 006).</td>
</tr>
<tr>
<td><code>solution_text</code></td>
<td>TEXT</td>
<td></td>
<td>Extended solution details (added Migration 006).</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Staging timestamp.</td>
</tr>
<tr>
<td><code>processed_at</code></td>
<td>DATETIME</td>
<td></td>
<td>Processing completion timestamp.</td>
</tr>
</tbody></table>
<p><strong>Purpose</strong>: Enables bulk loading of large CSV files (10k+ rows) with preprocessing, deduplication scoring, and error tracking before committing to production tables.</p>
<hr>
<h2>KEV Integration *(v1.0.22+)*</h2><p>HexTrackr integrates with CISA&#39;s <strong>Known Exploited Vulnerabilities (KEV) catalog</strong> to track actively exploited vulnerabilities.</p>
<h3>`kev_status`</h3><p>Stores CISA KEV catalog data synced from <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">https://www.cisa.gov/known-exploited-vulnerabilities-catalog</a>.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>cve_id</code></td>
<td>TEXT</td>
<td>PRIMARY KEY</td>
<td>CVE identifier (e.g., CVE-2021-44228).</td>
</tr>
<tr>
<td><code>date_added</code></td>
<td>DATE</td>
<td>NOT NULL</td>
<td>Date CISA added this CVE to KEV catalog.</td>
</tr>
<tr>
<td><code>vulnerability_name</code></td>
<td>TEXT</td>
<td></td>
<td>CISA-provided vulnerability name.</td>
</tr>
<tr>
<td><code>vendor_project</code></td>
<td>TEXT</td>
<td></td>
<td>Affected vendor/project.</td>
</tr>
<tr>
<td><code>product</code></td>
<td>TEXT</td>
<td></td>
<td>Affected product.</td>
</tr>
<tr>
<td><code>required_action</code></td>
<td>TEXT</td>
<td></td>
<td>CISA-mandated remediation action.</td>
</tr>
<tr>
<td><code>due_date</code></td>
<td>DATE</td>
<td></td>
<td>Federal agency remediation deadline.</td>
</tr>
<tr>
<td><code>known_ransomware_use</code></td>
<td>BOOLEAN</td>
<td>DEFAULT 0</td>
<td>Whether used in ransomware campaigns (1 = Yes, 0 = No).</td>
</tr>
<tr>
<td><code>notes</code></td>
<td>TEXT</td>
<td></td>
<td>Additional context or references.</td>
</tr>
<tr>
<td><code>last_synced</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last sync timestamp.</td>
</tr>
</tbody></table>
<p><strong>Relationship</strong>: Vulnerabilities in <code>vulnerabilities_current</code> are LEFT JOINed with <code>kev_status</code> on <code>cve</code> = <code>cve_id</code> to enrich data with KEV flags and due dates.</p>
<h3>`sync_metadata`</h3><p>Tracks KEV catalog synchronization history and status.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Sync record identifier.</td>
</tr>
<tr>
<td><code>sync_type</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Type of sync (e.g., &#39;kev_catalog&#39;).</td>
</tr>
<tr>
<td><code>sync_time</code></td>
<td>TIMESTAMP</td>
<td>NOT NULL</td>
<td>Sync execution timestamp.</td>
</tr>
<tr>
<td><code>version</code></td>
<td>TEXT</td>
<td></td>
<td>Catalog version or timestamp from CISA.</td>
</tr>
<tr>
<td><code>record_count</code></td>
<td>INTEGER</td>
<td></td>
<td>Number of KEV records synced.</td>
</tr>
<tr>
<td><code>status</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;completed&#39;</td>
<td>Sync status (completed/failed/in_progress).</td>
</tr>
<tr>
<td><code>error_message</code></td>
<td>TEXT</td>
<td></td>
<td>Error details if sync failed.</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Record creation timestamp.</td>
</tr>
</tbody></table>
<p><strong>Purpose</strong>: Audit trail for KEV sync operations, enables troubleshooting and monitoring of catalog updates.</p>
<hr>
<h2>Vendor Intelligence *(v1.0.63+)*</h2><p>HexTrackr integrates with vendor security advisory systems to provide fix availability tracking and remediation guidance.</p>
<h3>`cisco_advisories` *(v1.0.63 - HEX-287)*</h3><p>Stores Cisco PSIRT security advisory metadata synced via OAuth2 API.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>cve_id</code></td>
<td>TEXT</td>
<td>PRIMARY KEY</td>
<td>CVE identifier (e.g., CVE-2025-20352).</td>
</tr>
<tr>
<td><code>advisory_id</code></td>
<td>TEXT</td>
<td></td>
<td>Cisco advisory identifier (e.g., cisco-sa-20170317-cmp).</td>
</tr>
<tr>
<td><code>advisory_title</code></td>
<td>TEXT</td>
<td></td>
<td>Advisory title/summary.</td>
</tr>
<tr>
<td><code>severity</code></td>
<td>TEXT</td>
<td></td>
<td>Cisco severity rating (Critical/High/Medium/Low).</td>
</tr>
<tr>
<td><code>cvss_score</code></td>
<td>TEXT</td>
<td></td>
<td>CVSS base score from Cisco.</td>
</tr>
<tr>
<td><code>first_fixed</code></td>
<td>TEXT</td>
<td></td>
<td><strong>Deprecated</strong>: Legacy column, use <code>cisco_fixed_versions</code> instead.</td>
</tr>
<tr>
<td><code>affected_releases</code></td>
<td>TEXT</td>
<td></td>
<td>JSON array of affected software versions.</td>
</tr>
<tr>
<td><code>product_names</code></td>
<td>TEXT</td>
<td></td>
<td>Affected product names.</td>
</tr>
<tr>
<td><code>publication_url</code></td>
<td>TEXT</td>
<td></td>
<td>Direct link to Cisco advisory.</td>
</tr>
<tr>
<td><code>last_synced</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last synchronization timestamp.</td>
</tr>
</tbody></table>
<p><strong>Indexes</strong>:</p>
<ul>
<li><code>idx_cisco_advisories_cve</code> (cve_id)</li>
<li><code>idx_cisco_advisories_synced</code> (last_synced)</li>
</ul>
<p><strong>Sync Strategy</strong>: OAuth2 authentication with 90-day refresh cycle for existing advisories. See <a href="/docs-html/content/guides/cisco-psirt-integration.html">Cisco PSIRT Integration Guide</a> for details.</p>
<h3>`cisco_fixed_versions` *(v1.0.79 - Migration 007, HEX-287)*</h3><p>Stores normalized Cisco fix versions (3NF normalization to prevent data corruption from multi-OS-family CVEs).</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Fixed version record identifier.</td>
</tr>
<tr>
<td><code>cve_id</code></td>
<td>TEXT</td>
<td>FK to <code>cisco_advisories.cve_id</code>, NOT NULL</td>
<td>Associated CVE.</td>
</tr>
<tr>
<td><code>os_family</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Operating system family (ios, iosxe, iosxr, nxos, etc.).</td>
</tr>
<tr>
<td><code>fixed_version</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Software version that fixes the vulnerability.</td>
</tr>
<tr>
<td><code>affected_version</code></td>
<td>TEXT</td>
<td></td>
<td>Original affected version string.</td>
</tr>
<tr>
<td><code>last_synced</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last synchronization timestamp.</td>
</tr>
<tr>
<td><strong>UNIQUE</strong></td>
<td>(cve_id, os_family, fixed_version)</td>
<td></td>
<td>One row per CVE + OS family + version.</td>
</tr>
<tr>
<td><strong>FOREIGN KEY</strong></td>
<td>ON DELETE CASCADE</td>
<td></td>
<td>Versions deleted when advisory is deleted.</td>
</tr>
</tbody></table>
<p><strong>Indexes</strong>:</p>
<ul>
<li><code>idx_cisco_fixed_versions_cve</code> (cve_id)</li>
<li><code>idx_cisco_fixed_versions_os_family</code> (os_family)</li>
<li><code>idx_cisco_fixed_versions_composite</code> (cve_id, os_family)</li>
</ul>
<p><strong>Why Normalized?</strong> Multi-OS-family CVEs (affecting both IOS and IOS XE) require separate rows to prevent data overwrites. See <a href="https://linear.app/hextrackr/issue/HEX-287">HEX-287</a> for technical details.</p>
<p><strong>Example Data</strong>:</p>
<pre><code class="language-">cve_id            | os_family | fixed_version
------------------|-----------|---------------
CVE-2025-20352    | ios       | 15.2(8)E8
CVE-2025-20352    | ios       | 15.9(3)M11
CVE-2025-20352    | iosxe     | 17.12.6
CVE-2025-20352    | iosxe     | 17.9.4a</code></pre><h3>`palo_alto_advisories` *(v1.0.63)*</h3><p>Stores Palo Alto Networks security bulletin data scraped from their security advisory website.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>cve_id</code></td>
<td>TEXT</td>
<td>PRIMARY KEY</td>
<td>CVE identifier.</td>
</tr>
<tr>
<td><code>advisory_id</code></td>
<td>TEXT</td>
<td></td>
<td>Palo Alto advisory identifier (e.g., PAN-SA-2024-0001).</td>
</tr>
<tr>
<td><code>advisory_title</code></td>
<td>TEXT</td>
<td></td>
<td>Advisory title/summary.</td>
</tr>
<tr>
<td><code>severity</code></td>
<td>TEXT</td>
<td></td>
<td>Palo Alto severity rating.</td>
</tr>
<tr>
<td><code>cvss_score</code></td>
<td>TEXT</td>
<td></td>
<td>CVSS base score from Palo Alto.</td>
</tr>
<tr>
<td><code>first_fixed</code></td>
<td>TEXT</td>
<td></td>
<td>First fixed software version.</td>
</tr>
<tr>
<td><code>affected_releases</code></td>
<td>TEXT</td>
<td></td>
<td>JSON array of affected PAN-OS versions.</td>
</tr>
<tr>
<td><code>product_names</code></td>
<td>TEXT</td>
<td></td>
<td>Affected product names.</td>
</tr>
<tr>
<td><code>publication_url</code></td>
<td>TEXT</td>
<td></td>
<td>Direct link to Palo Alto advisory.</td>
</tr>
<tr>
<td><code>last_synced</code></td>
<td>TIMESTAMP</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last synchronization timestamp.</td>
</tr>
</tbody></table>
<p><strong>Indexes</strong>:</p>
<ul>
<li><code>idx_palo_advisories_cve</code> (cve_id)</li>
<li><code>idx_palo_advisories_synced</code> (last_synced)</li>
</ul>
<p><strong>Sync Strategy</strong>: Web scraping with HTML parsing (no official API available). Manual refresh via admin interface.</p>
<p><strong>Vendor-Neutral Fix Tracking</strong>: Both vendor advisory systems set the <code>is_fix_available</code> flag on <code>vulnerabilities_current</code> table for fast filtering of fixable vulnerabilities.</p>
<hr>
<h2>Template System *(v1.0.46+)*</h2><p>HexTrackr provides customizable templates for emails, tickets, and vulnerability reports with variable substitution.</p>
<h3>`email_templates`</h3><p>Stores email notification templates with dynamic variable support.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Template identifier.</td>
</tr>
<tr>
<td><code>name</code></td>
<td>TEXT</td>
<td>UNIQUE NOT NULL</td>
<td>Template name (e.g., &#39;vulnerability_notification&#39;).</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td></td>
<td>Template purpose and usage notes.</td>
</tr>
<tr>
<td><code>template_content</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Customized template content (user-modified).</td>
</tr>
<tr>
<td><code>default_content</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Original default template (for reset).</td>
</tr>
<tr>
<td><code>variables</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>JSON array of supported variables (e.g., <code>{{ticket_id}}</code>, <code>{{hostname}}</code>).</td>
</tr>
<tr>
<td><code>category</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;ticket&#39;</td>
<td>Template category (ticket/vulnerability/system).</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>BOOLEAN</td>
<td>DEFAULT 1</td>
<td>Whether template is active (1 = enabled, 0 = disabled).</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Creation timestamp.</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last modification timestamp.</td>
</tr>
</tbody></table>
<h3>`ticket_templates`</h3><p>Stores ticket creation templates with pre-filled fields and workflows.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Template identifier.</td>
</tr>
<tr>
<td><code>name</code></td>
<td>TEXT</td>
<td>UNIQUE NOT NULL</td>
<td>Template name (e.g., &#39;critical_vulnerability_ticket&#39;).</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td></td>
<td>Template purpose and usage notes.</td>
</tr>
<tr>
<td><code>template_content</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Customized template content (JSON structure).</td>
</tr>
<tr>
<td><code>default_content</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Original default template.</td>
</tr>
<tr>
<td><code>variables</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>JSON array of supported variables.</td>
</tr>
<tr>
<td><code>category</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;ticket&#39;</td>
<td>Template category.</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>BOOLEAN</td>
<td>DEFAULT 1</td>
<td>Whether template is active.</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Creation timestamp.</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last modification timestamp.</td>
</tr>
</tbody></table>
<h3>`vulnerability_templates`</h3><p>Stores vulnerability report templates for exports and notifications.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Template identifier.</td>
</tr>
<tr>
<td><code>name</code></td>
<td>TEXT</td>
<td>UNIQUE NOT NULL</td>
<td>Template name (e.g., &#39;executive_summary&#39;).</td>
</tr>
<tr>
<td><code>description</code></td>
<td>TEXT</td>
<td></td>
<td>Template purpose and usage notes.</td>
</tr>
<tr>
<td><code>template_content</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Customized template content.</td>
</tr>
<tr>
<td><code>default_content</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Original default template.</td>
</tr>
<tr>
<td><code>variables</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>JSON array of supported variables (e.g., <code>{{cve}}</code>, <code>{{severity}}</code>, <code>{{vpr_score}}</code>).</td>
</tr>
<tr>
<td><code>category</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;vulnerability&#39;</td>
<td>Template category.</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>BOOLEAN</td>
<td>DEFAULT 1</td>
<td>Whether template is active.</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Creation timestamp.</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last modification timestamp.</td>
</tr>
</tbody></table>
<p><strong>Variable Substitution</strong>: Templates support dynamic variables like <code>{{ticket_id}}</code>, <code>{{hostname}}</code>, <code>{{cve}}</code>, <code>{{severity}}</code> which are replaced at runtime with actual values.</p>
<hr>
<h2>Authentication & User Management *(v1.0.46+)*</h2><h3>`users`</h3><p>Stores user accounts with Argon2id password hashing and account lockout tracking.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>TEXT</td>
<td>PRIMARY KEY</td>
<td>User identifier (UUID or similar).</td>
</tr>
<tr>
<td><code>username</code></td>
<td>TEXT</td>
<td>UNIQUE NOT NULL</td>
<td>Login username.</td>
</tr>
<tr>
<td><code>email</code></td>
<td>TEXT</td>
<td></td>
<td>User email address (optional).</td>
</tr>
<tr>
<td><code>password_hash</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Argon2id password hash (never stored plaintext).</td>
</tr>
<tr>
<td><code>role</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;superadmin&#39;</td>
<td>User role (superadmin/admin/user).</td>
</tr>
<tr>
<td><code>is_active</code></td>
<td>INTEGER</td>
<td>DEFAULT 1</td>
<td>Account status (1 = active, 0 = disabled).</td>
</tr>
<tr>
<td><code>last_login</code></td>
<td>DATETIME</td>
<td></td>
<td>Last successful login timestamp.</td>
</tr>
<tr>
<td><code>failed_attempts</code></td>
<td>INTEGER</td>
<td>DEFAULT 0</td>
<td>Consecutive failed login attempts (reset on success).</td>
</tr>
<tr>
<td><code>failed_login_timestamp</code></td>
<td>DATETIME</td>
<td></td>
<td>Most recent failed login timestamp (for lockout calculation).</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Account creation timestamp.</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last modification timestamp.</td>
</tr>
</tbody></table>
<p><strong>Account Lockout</strong>: After 5 failed login attempts, account is locked for 15 minutes (enforced in <code>authService.js</code>, not database constraint).</p>
<p><strong>Password Security</strong>: Passwords are hashed using Argon2id with timing-safe comparison to prevent timing attacks.</p>
<h3>`user_preferences`</h3><p>Stores user-specific UI preferences for cross-device synchronization (HEX-138).</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Preference record identifier.</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>TEXT</td>
<td>FK to <code>users.id</code>, NOT NULL</td>
<td>Associated user.</td>
</tr>
<tr>
<td><code>preference_key</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Preference identifier (e.g., &#39;theme&#39;, &#39;dashboard_layout&#39;).</td>
</tr>
<tr>
<td><code>preference_value</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Preference value (JSON or plain text).</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Creation timestamp.</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last modification timestamp (auto-updated via trigger).</td>
</tr>
<tr>
<td><strong>UNIQUE</strong></td>
<td>(user_id, preference_key)</td>
<td></td>
<td>One value per user per preference key.</td>
</tr>
<tr>
<td><strong>FOREIGN KEY</strong></td>
<td>ON DELETE CASCADE</td>
<td></td>
<td>Preferences deleted when user is deleted.</td>
</tr>
</tbody></table>
<p><strong>Trigger</strong>: <code>user_preferences_updated_at</code> automatically updates <code>updated_at</code> timestamp on modification.</p>
<p><strong>Common Preferences</strong>:</p>
<ul>
<li><code>theme</code>: &#39;light&#39; or &#39;dark&#39;</li>
<li><code>dashboard_layout</code>: JSON configuration</li>
<li><code>default_page</code>: Starting page after login</li>
<li><code>table_preferences</code>: AG-Grid column state</li>
</ul>
<hr>
<h2>Security & Audit *(v1.0.67 - Migration 012, HEX-254)*</h2><p>HexTrackr provides encrypted audit logging for compliance and security monitoring.</p>
<h3>`audit_logs`</h3><p>Stores encrypted audit trail entries with automatic retention policy enforcement.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Audit log entry identifier.</td>
</tr>
<tr>
<td><code>category</code></td>
<td>TEXT</td>
<td>NOT NULL</td>
<td>Log category (auth, data, system, security).</td>
</tr>
<tr>
<td><code>timestamp</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP, NOT NULL</td>
<td>Event timestamp.</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>TEXT</td>
<td></td>
<td>User identifier (if user-initiated action).</td>
</tr>
<tr>
<td><code>username</code></td>
<td>TEXT</td>
<td></td>
<td>Username (denormalized for query performance).</td>
</tr>
<tr>
<td><code>ip_address</code></td>
<td>TEXT</td>
<td></td>
<td>Source IP address.</td>
</tr>
<tr>
<td><code>user_agent</code></td>
<td>TEXT</td>
<td></td>
<td>Client user agent string.</td>
</tr>
<tr>
<td><code>request_id</code></td>
<td>TEXT</td>
<td></td>
<td>Request correlation identifier.</td>
</tr>
<tr>
<td><code>encrypted_message</code></td>
<td>BLOB</td>
<td>NOT NULL</td>
<td>AES-256-GCM encrypted log message.</td>
</tr>
<tr>
<td><code>encrypted_data</code></td>
<td>BLOB</td>
<td></td>
<td>AES-256-GCM encrypted additional context (JSON).</td>
</tr>
<tr>
<td><code>encryption_iv</code></td>
<td>BLOB</td>
<td>NOT NULL</td>
<td>Initialization vector for decryption.</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Record creation timestamp.</td>
</tr>
</tbody></table>
<p><strong>Indexes</strong>:</p>
<ul>
<li><code>idx_audit_logs_category</code> (category)</li>
<li><code>idx_audit_logs_timestamp</code> (timestamp DESC)</li>
<li><code>idx_audit_logs_user_id</code> (user_id)</li>
<li><code>idx_audit_logs_category_timestamp</code> (category, timestamp DESC)</li>
<li><code>idx_audit_logs_user_timestamp</code> (user_id, timestamp DESC)</li>
<li><code>idx_audit_logs_request_id</code> (request_id)</li>
</ul>
<p><strong>Encryption</strong>: All log messages and data are encrypted at rest using AES-256-GCM with per-record initialization vectors. Encryption keys are stored in <code>audit_log_config</code> and never logged.</p>
<p><strong>Retention Policy</strong>: Logs older than <code>retention_days</code> (default: 30) are automatically purged by background cleanup job.</p>
<h3>`audit_log_config`</h3><p>Singleton configuration table for audit logging system (enforced via <code>CHECK (id = 1)</code> constraint).</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PRIMARY KEY, CHECK (id = 1)</td>
<td>Always 1 (singleton pattern).</td>
</tr>
<tr>
<td><code>encryption_key</code></td>
<td>BLOB</td>
<td>NOT NULL</td>
<td>AES-256 encryption key (32 bytes).</td>
</tr>
<tr>
<td><code>key_created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Encryption key creation timestamp.</td>
</tr>
<tr>
<td><code>key_rotated_at</code></td>
<td>DATETIME</td>
<td></td>
<td>Last key rotation timestamp.</td>
</tr>
<tr>
<td><code>retention_days</code></td>
<td>INTEGER</td>
<td>DEFAULT 30</td>
<td>Log retention period in days.</td>
</tr>
<tr>
<td><code>last_cleanup_at</code></td>
<td>DATETIME</td>
<td></td>
<td>Last retention cleanup timestamp.</td>
</tr>
<tr>
<td><code>total_logs_written</code></td>
<td>INTEGER</td>
<td>DEFAULT 0</td>
<td>Lifetime audit log count.</td>
</tr>
<tr>
<td><code>total_logs_purged</code></td>
<td>INTEGER</td>
<td>DEFAULT 0</td>
<td>Lifetime purged log count.</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Record creation timestamp.</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>DATETIME</td>
<td>DEFAULT CURRENT_TIMESTAMP</td>
<td>Last modification timestamp.</td>
</tr>
</tbody></table>
<p><strong>Singleton Pattern</strong>: Only one row can exist (enforced by <code>CHECK (id = 1)</code>). Prevents accidental creation of multiple encryption key records.</p>
<p><strong>Key Management</strong>: Encryption keys are randomly generated on first initialization and can be rotated via admin interface. Key rotation re-encrypts all existing logs.</p>
<hr>
<h2>Junction Tables</h2><h3>`ticket_vulnerabilities`</h3><p>Many-to-many relationship between tickets and (legacy) <code>vulnerabilities</code> (pre-rollover) or conceptually <code>vulnerabilities_current</code> for future adaptation.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>id</code></td>
<td>INTEGER</td>
<td>PK AUTOINCREMENT</td>
<td>Link row id.</td>
</tr>
<tr>
<td><code>ticket_id</code></td>
<td>TEXT</td>
<td>FK to <code>tickets.id</code></td>
<td>Associated ticket.</td>
</tr>
<tr>
<td><code>vulnerability_id</code></td>
<td>INTEGER</td>
<td>FK</td>
<td>Associated vulnerability (references vulnerabilities.id for legacy compatibility).</td>
</tr>
<tr>
<td><code>relationship_type</code></td>
<td>TEXT</td>
<td>DEFAULT &#39;remediation&#39;</td>
<td>Relationship semantics.</td>
</tr>
<tr>
<td><code>notes</code></td>
<td>TEXT</td>
<td></td>
<td>Free-form link-specific notes.</td>
</tr>
</tbody></table>
<p><strong>Note on Sites &amp; Locations</strong>: The <code>tickets</code> table includes TEXT fields (<code>site</code>, <code>site_id</code>, <code>location</code>, <code>location_id</code>) for flexible site/location tracking. Dedicated normalization tables (<code>sites</code>, <code>locations</code>) are <strong>not currently implemented</strong> but may be added in future versions for structured taxonomy.</p>
<h2>Indexes</h2><p>To ensure efficient querying, <strong>68 indexes</strong> are automatically created during database initialization (v1.1.0 baseline). This includes 67 user-created indexes plus 1 auto-generated trigger index (<code>sqlite_autoindex_user_preferences_1</code>).</p>
<h3>Index Inventory by Table (v1.1.0)</h3><p><strong>vulnerability_snapshots</strong> (5 indexes):</p>
<ul>
<li><code>idx_snapshots_scan_date</code> - Query by date</li>
<li><code>idx_snapshots_hostname</code> - Query by hostname</li>
<li><code>idx_snapshots_severity</code> - Query by severity</li>
<li><code>idx_snapshots_enhanced_key</code> - Enhanced deduplication</li>
<li><code>idx_snapshots_cve</code> - KEV integration lookups</li>
</ul>
<p><strong>vulnerabilities_current</strong> (9 indexes):</p>
<ul>
<li><code>idx_current_unique_key</code> - Primary deduplication key</li>
<li><code>idx_current_scan_date</code> - Query by scan date</li>
<li><code>idx_current_enhanced_unique_key</code> - Enhanced deduplication</li>
<li><code>idx_current_lifecycle_scan</code> - Composite (lifecycle_state, scan_date)</li>
<li><code>idx_current_confidence_tier</code> - Composite (confidence_score, dedup_tier)</li>
<li><code>idx_current_active_severity</code> - Composite (lifecycle_state, severity)</li>
<li><code>idx_current_resolved_date</code> - Resolution tracking</li>
<li><code>idx_current_cve</code> - KEV integration lookups</li>
<li><code>idx_current_vendor</code> - Vendor filtering (HEX-101)</li>
</ul>
<p><strong>vulnerability_staging</strong> (4 indexes):</p>
<ul>
<li><code>idx_staging_import_id</code> - Import batch tracking</li>
<li><code>idx_staging_processed</code> - Processing status</li>
<li><code>idx_staging_batch_id</code> - Batch processing</li>
<li><code>idx_staging_unprocessed_batch</code> - Composite (processed, batch_id)</li>
</ul>
<p><strong>tickets</strong> (10 indexes):</p>
<ul>
<li><code>idx_tickets_status</code> - Status filtering</li>
<li><code>idx_tickets_site</code> - Site grouping</li>
<li><code>idx_tickets_location</code> - Location filtering</li>
<li><code>idx_tickets_xt</code> - XT number lookups</li>
<li>Plus 6 auto-created indexes for: date_submitted, date_due, hexagon_ticket, service_now_ticket, site_id, location_id</li>
</ul>
<p><strong>vulnerabilities (legacy)</strong> (4 indexes):</p>
<ul>
<li><code>idx_vulnerabilities_hostname</code> - Hostname lookups</li>
<li><code>idx_vulnerabilities_severity</code> - Severity filtering</li>
<li><code>idx_vulnerabilities_cve</code> - CVE lookups</li>
<li><code>idx_vulnerabilities_import</code> - Import batch tracking</li>
</ul>
<p><strong>vendor_daily_totals</strong> (3 indexes):</p>
<ul>
<li><code>idx_vendor_daily_scan_date</code> - Date-based queries</li>
<li><code>idx_vendor_daily_vendor</code> - Vendor-based queries</li>
<li><code>idx_vendor_daily_composite</code> - Composite (vendor, scan_date)</li>
</ul>
<p><strong>kev_status</strong> (4 indexes):</p>
<ul>
<li><code>idx_kev_status_cve_id</code> - CVE lookups</li>
<li><code>idx_kev_status_date_added</code> - Chronological queries</li>
<li><code>idx_kev_status_due_date</code> - Deadline tracking</li>
<li><code>idx_kev_status_ransomware</code> - Partial index (WHERE known_ransomware_use = 1)</li>
</ul>
<p><strong>Vendor Intelligence</strong> (7 indexes):</p>
<ul>
<li>Cisco advisories: <code>idx_cisco_advisories_cve</code>, <code>idx_cisco_advisories_synced</code></li>
<li>Cisco fixed versions: <code>idx_cisco_fixed_versions_cve</code>, <code>idx_cisco_fixed_versions_os_family</code>, <code>idx_cisco_fixed_versions_composite</code></li>
<li>Palo Alto advisories: <code>idx_palo_advisories_cve</code>, <code>idx_palo_advisories_synced</code></li>
</ul>
<p><strong>Security &amp; Audit</strong> (6 indexes):</p>
<ul>
<li><code>idx_audit_logs_category</code> - Category filtering</li>
<li><code>idx_audit_logs_timestamp</code> - Chronological queries</li>
<li><code>idx_audit_logs_user_id</code> - User activity tracking</li>
<li><code>idx_audit_logs_category_timestamp</code> - Composite (category, timestamp DESC)</li>
<li><code>idx_audit_logs_user_timestamp</code> - Composite (user_id, timestamp DESC)</li>
<li><code>idx_audit_logs_request_id</code> - Request correlation</li>
</ul>
<p><strong>Template Tables</strong> (9 indexes total):</p>
<ul>
<li>Email templates: <code>idx_email_templates_name</code>, <code>idx_email_templates_active</code>, <code>idx_email_templates_category</code></li>
<li>Ticket templates: <code>idx_ticket_templates_name</code>, <code>idx_ticket_templates_category</code>, <code>idx_ticket_templates_active</code></li>
<li>Vulnerability templates: <code>idx_vulnerability_templates_name</code>, <code>idx_vulnerability_templates_category</code>, <code>idx_vulnerability_templates_active</code></li>
</ul>
<p><strong>Authentication &amp; User Management</strong> (4 indexes):</p>
<ul>
<li>Users: <code>idx_users_username</code>, <code>idx_users_email</code></li>
<li>User preferences: <code>idx_user_preferences_user_id</code>, <code>idx_user_preferences_key</code></li>
</ul>
<p><strong>Other Indexes</strong> (3 indexes):</p>
<ul>
<li><code>idx_ticket_vulns_ticket</code> - Junction table (ticket_id)</li>
<li><code>idx_ticket_vulns_vuln</code> - Junction table (vulnerability_id)</li>
<li><code>idx_sync_metadata_type_time</code> - Composite (sync_type, sync_time DESC)</li>
</ul>
<blockquote>
<p>Note: The legacy <code>vulnerabilities</code> table remains ONLY for backup/export endpoints (<code>/api/backup/vulnerabilities</code>, <code>/api/backup/all</code>). All imports and dashboards use the rollover trio (<code>vulnerability_snapshots</code>, <code>vulnerabilities_current</code>, <code>vulnerability_daily_totals</code>).</p>
</blockquote>
<hr>
<h2>Modal Aggregation Architecture (v1.0.6+)</h2><h3>Universal Aggregation Keys</h3><p>The modal system uses strategic field selection for data aggregation:</p>
<table>
<thead>
<tr>
<th>Modal Type</th>
<th>Aggregation Key</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td>Vulnerability Modal</td>
<td><code>description</code> field</td>
<td>Groups all devices affected by same vulnerability</td>
<td>CVE-2017-3881 shows 24 affected devices</td>
</tr>
<tr>
<td>Device Modal</td>
<td><code>hostname</code> field (normalized)</td>
<td>Groups all vulnerabilities affecting same device</td>
<td>grimesnswan03 shows 12 vulnerabilities</td>
</tr>
</tbody></table>
<h3>Data Relationships</h3><p><strong>Vulnerability -&gt; Device Aggregation</strong>:</p>
<ul>
<li>Query: <code>SELECT * FROM vulnerabilities_current WHERE description = ?</code></li>
<li>Groups by hostname to show unique devices affected</li>
<li>Displays device count, IP addresses, and affected services</li>
</ul>
<p><strong>Device -&gt; Vulnerability Aggregation</strong>:</p>
<ul>
<li>Query: <code>SELECT * FROM vulnerabilities_current WHERE hostname = ?</code></li>
<li>Groups by description/CVE to show unique vulnerabilities</li>
<li>Displays vulnerability count, severity distribution, and VPR totals</li>
</ul>
<h3>Aggregation Benefits</h3><ul>
<li><strong>Complete Visibility</strong>: Users see full impact scope (all 24 devices for a CVE, all 12 vulnerabilities for a device)</li>
<li><strong>Data Consistency</strong>: Aggregation keys ensure reliable grouping across different data imports</li>
<li><strong>Performance</strong>: Indexed fields (<code>description</code>, <code>hostname</code>) enable efficient aggregation queries</li>
<li><strong>Modal State Management</strong>: Proper Bootstrap integration prevents modal layering issues</li>
</ul>
<hr>
<h2>Unique Key Generation Logic (Summary)</h2><p><code>unique_key = normalize(hostname)|CVE</code> when CVE present; fallback to <code>normalize(hostname)|plugin_id|truncated(description)</code>; final fallback uses description + VPR score. Host normalization collapses domain suffixes and validates IP addresses.</p>
<hr>
<h2>Schema Drift Notes</h2><ul>
<li><code>schema.sql</code> no longer reflects live tables (kept for historical reference only).</li>
<li>Runtime adds columns (<code>vendor</code>, <code>vulnerability_date</code>, <code>state</code>, <code>import_date</code>, <code>notes</code>) to legacy <code>vulnerabilities</code> table if missing.</li>
<li>Two UNIQUE indexes (<code>idx_vulnerabilities_unique_scan</code> / <code>_v2</code>) ensure per-scan dedupe in legacy ingestion path.</li>
<li>Future work: unify attribute naming (<code>vendor_reference</code> vs <code>vendor</code>).</li>
</ul>
<hr>
<h2>Planned Enhancements</h2><table>
<thead>
<tr>
<th>Area</th>
<th>Planned Change</th>
</tr>
</thead>
<tbody><tr>
<td>Normalization</td>
<td>Resolve duplication between <code>vendor</code> / <code>vendor_reference</code>.</td>
</tr>
<tr>
<td>Integrity</td>
<td>Add CHECK constraints for severity enumeration.</td>
</tr>
<tr>
<td>Archival</td>
<td>Partition snapshots by month (optional) when size grows.</td>
</tr>
<tr>
<td>Migration</td>
<td>Deprecate legacy <code>vulnerabilities</code> table after full UI refactor.</td>
</tr>
<tr>
<td>Index Tuning</td>
<td>Add composite index (severity, scan_date) if trend queries increase.</td>
</tr>
</tbody></table>
<hr>
<p>The above reflects the database as inspected on the current build date. Regenerate this document after structural changes or migration scripts are introduced.</p>
<hr>
<p><em>Last Updated: 2025-10-22 | Version: v1.1.0 | Schema: HEX-324 Consolidation | Audit: DOCS-64</em></p>

    <!-- Note: This file is intentionally minimal. The full page scaffold, header, footer, and scripts
             are provided by docs-html/index.html. Content generated using this template will be
             fetched and injected into #content-container by docs-html/js/docs-portal-v2.js. -->
</section>

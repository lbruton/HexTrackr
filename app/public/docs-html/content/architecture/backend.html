<!-- Fragment template for documentation content injected by docs-tabler.js -->
<section class="doc-fragment">
    <h1>Backend Architecture</h1><p>The backend is a modular Node.js/Express application providing REST endpoints, rollover ingestion, documentation delivery, and SQLite persistence. It serves the static frontend pages (<code>tickets.html</code>, <code>vulnerabilities.html</code>) and the generated documentation portal (<code>/docs-html</code>).</p>
<hr>
<h2>Key Characteristics</h2><ul>
<li><strong>Modular Architecture</strong>: <code>server.js</code> (~831 lines) orchestrates modular components across multiple directories.</li>
<li><strong>Separation of Concerns</strong>: Controllers, services, routes, and configuration are cleanly separated.</li>
<li><strong>Unified Delivery</strong>: API + static assets + docs from one process.</li>
<li><strong>Embedded DB</strong>: Single SQLite file (<code>data/hextrackr.db</code>). No external service dependency.</li>
<li><strong>Security Utilities</strong>: Extracted <code>PathValidator</code> class for safe file operations + security headers.</li>
</ul>
<hr>
<h2>Core Components</h2><table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Location</th>
</tr>
</thead>
<tbody><tr>
<td><code>server.js</code> (~831 lines)</td>
<td>Main application runtime (orchestration + initialization)</td>
<td><code>/app/public/</code></td>
</tr>
<tr>
<td><strong>Controllers</strong></td>
<td>Business logic (mixed patterns - see Controller Patterns section)</td>
<td><code>/app/controllers/</code></td>
</tr>
<tr>
<td><strong>Services</strong></td>
<td>Data access and business services</td>
<td><code>/app/services/</code></td>
</tr>
<tr>
<td><strong>Routes</strong></td>
<td>Express route definitions</td>
<td><code>/app/routes/</code></td>
</tr>
<tr>
<td><strong>Configuration</strong></td>
<td>Database, middleware, websocket configs</td>
<td><code>/app/config/</code></td>
</tr>
<tr>
<td><strong>Utilities</strong></td>
<td>PathValidator, ProgressTracker, helpers, seedEmailTemplates</td>
<td><code>/app/utils/</code></td>
</tr>
<tr>
<td><code>init-database.js</code></td>
<td>Bootstrap base schema &amp; indexes</td>
<td><code>/app/public/scripts/</code></td>
</tr>
<tr>
<td>Rate Limiting</td>
<td>Cache-aware throttling (60 req/15min prod, 10,000 req/1min dev)</td>
<td>Express middleware</td>
</tr>
</tbody></table>
<h3>Module Organization</h3><table>
<thead>
<tr>
<th>Directory</th>
<th>Contents</th>
<th>Pattern</th>
</tr>
</thead>
<tbody><tr>
<td><code>/app/controllers/</code></td>
<td>13 controller modules</td>
<td>Singleton (8), Constructor (3), Module Exports (1), Functional (1)</td>
</tr>
<tr>
<td><code>/app/services/</code></td>
<td>20 service modules</td>
<td>Functional exports with dependency injection</td>
</tr>
<tr>
<td><code>/app/routes/</code></td>
<td>15 route definition files</td>
<td>Express router pattern</td>
</tr>
<tr>
<td><code>/app/config/</code></td>
<td>5 configuration modules</td>
<td>Module exports</td>
</tr>
<tr>
<td><code>/app/middleware/</code></td>
<td>5 middleware modules</td>
<td>Express middleware pattern</td>
</tr>
<tr>
<td><code>/app/utils/</code></td>
<td>5 utility modules</td>
<td>Static class methods and helper functions</td>
</tr>
</tbody></table>
<h3>Controller Files</h3><table>
<thead>
<tr>
<th>Controller</th>
<th>Pattern</th>
<th>Methods</th>
<th>Dependency Injection</th>
</tr>
</thead>
<tbody><tr>
<td><code>vulnerabilityController.js</code></td>
<td>Singleton</td>
<td>14 static methods</td>
<td><code>initialize(db, progressTracker)</code></td>
</tr>
<tr>
<td><code>ticketController.js</code></td>
<td>Singleton</td>
<td>7 static methods</td>
<td><code>initialize(db)</code></td>
</tr>
<tr>
<td><code>backupController.js</code></td>
<td>Singleton</td>
<td>6 static methods</td>
<td><code>initialize(db)</code></td>
</tr>
<tr>
<td><code>templateController.js</code></td>
<td>Singleton</td>
<td>7 static methods</td>
<td><code>initialize(db)</code></td>
</tr>
<tr>
<td><code>authController.js</code></td>
<td>Singleton</td>
<td>5 static methods</td>
<td><code>initialize(db)</code></td>
</tr>
<tr>
<td><code>preferencesController.js</code></td>
<td>Singleton</td>
<td>7 static methods</td>
<td><code>initialize(db)</code></td>
</tr>
<tr>
<td><code>kevController.js</code></td>
<td>Constructor</td>
<td>7 instance methods</td>
<td><code>constructor(db)</code></td>
</tr>
<tr>
<td><code>ciscoController.js</code></td>
<td>Constructor</td>
<td>6 instance methods</td>
<td><code>constructor(db, preferencesService)</code></td>
</tr>
<tr>
<td><code>paloAltoController.js</code></td>
<td>Constructor</td>
<td>6 instance methods</td>
<td><code>constructor(db, preferencesService)</code></td>
</tr>
<tr>
<td><code>docsController.js</code></td>
<td>Module Exports</td>
<td>2 exported functions</td>
<td>Instance created internally, methods exported as wrappers</td>
</tr>
<tr>
<td><code>importController.js</code></td>
<td>Functional</td>
<td>6 exported functions</td>
<td><code>setProgressTracker(tracker)</code></td>
</tr>
<tr>
<td><code>locationController.js</code></td>
<td>Singleton</td>
<td>3 static methods</td>
<td><code>initialize(db)</code></td>
</tr>
<tr>
<td><code>auditLogController.js</code></td>
<td>Singleton</td>
<td>3 static methods</td>
<td><code>initialize()</code></td>
</tr>
</tbody></table>
<h3>Service Files</h3><table>
<thead>
<tr>
<th>Service</th>
<th>Purpose</th>
<th>Key Methods</th>
</tr>
</thead>
<tbody><tr>
<td><code>databaseService.js</code></td>
<td>Core database operations</td>
<td><code>getDb()</code>, <code>runQuery()</code>, <code>transaction()</code>, <code>startAutoVacuum()</code></td>
</tr>
<tr>
<td><code>authService.js</code> <em>(v1.0.46+)</em></td>
<td>Authentication and session management</td>
<td><code>authenticateUser()</code>, <code>validateSession()</code>, <code>changePassword()</code></td>
</tr>
<tr>
<td><code>vulnerabilityService.js</code></td>
<td>Vulnerability CRUD operations</td>
<td><code>getVulnerabilities()</code>, <code>createVulnerability()</code>, <code>streamExport()</code></td>
</tr>
<tr>
<td><code>vulnerabilityStatsService.js</code></td>
<td>Statistics and aggregations</td>
<td><code>getStats()</code>, <code>getTrends()</code>, <code>getVendorStats()</code></td>
</tr>
<tr>
<td><code>ticketService.js</code></td>
<td>Ticket CRUD operations</td>
<td><code>getTickets()</code>, <code>createTicket()</code>, <code>updateTicket()</code></td>
</tr>
<tr>
<td><code>templateService.js</code> <em>(v1.0.46+)</em></td>
<td>Email template management</td>
<td><code>getTemplates()</code>, <code>createTemplate()</code>, <code>updateTemplate()</code></td>
</tr>
<tr>
<td><code>preferencesService.js</code> <em>(v1.0.46+)</em></td>
<td>User preferences CRUD</td>
<td><code>getPreferences()</code>, <code>updatePreferences()</code>, <code>getPreference()</code>, <code>setPreference()</code></td>
</tr>
<tr>
<td><code>kevService.js</code> <em>(v1.0.22+)</em></td>
<td>CISA KEV integration</td>
<td><code>syncKevData()</code>, <code>getSyncStatus()</code>, <code>getKevByCve()</code></td>
</tr>
<tr>
<td><code>ciscoAdvisoryService.js</code> <em>(v1.0.63+, HEX-141)</em></td>
<td>Cisco PSIRT advisory integration</td>
<td><code>syncCiscoAdvisories()</code>, <code>getSyncStatus()</code>, <code>getCiscoCredentials()</code></td>
</tr>
<tr>
<td><code>paloAltoService.js</code> <em>(v1.0.63+, HEX-209)</em></td>
<td>Palo Alto Security Advisory integration</td>
<td><code>syncPaloAdvisories()</code>, <code>getSyncStatus()</code>, <code>fetchPaloAdvisories()</code></td>
</tr>
<tr>
<td><code>hostnameParserService.js</code></td>
<td>Hostname parsing and normalization</td>
<td><code>parseHostname()</code>, <code>extractDomain()</code>, <code>normalizeHostname()</code></td>
</tr>
<tr>
<td><code>importService.js</code></td>
<td>Import business logic</td>
<td><code>processVulnerabilitiesWithLifecycle()</code>, <code>bulkLoadToStagingTable()</code></td>
</tr>
<tr>
<td><code>backupService.js</code></td>
<td>Backup/restore operations</td>
<td><code>getBackupStats()</code>, <code>restoreBackup()</code>, <code>exportData()</code></td>
</tr>
<tr>
<td><code>docsService.js</code></td>
<td>Documentation statistics</td>
<td><code>computeStats()</code>, <code>computeApiEndpoints()</code></td>
</tr>
<tr>
<td><code>fileService.js</code></td>
<td>File system operations</td>
<td><code>readFile()</code>, <code>writeFile()</code>, <code>validatePath()</code></td>
</tr>
<tr>
<td><code>progressService.js</code></td>
<td>WebSocket progress tracking</td>
<td><code>createSession()</code>, <code>updateProgress()</code>, <code>completeSession()</code></td>
</tr>
<tr>
<td><code>validationService.js</code></td>
<td>Input validation and sanitization</td>
<td><code>validateVulnerability()</code>, <code>sanitizeInput()</code>, <code>validateTicket()</code></td>
</tr>
<tr>
<td><code>loggingService.js</code> <em>(v1.0.67+, HEX-254)</em></td>
<td>Centralized logging with encrypted audit trail</td>
<td><code>initialize()</code>, <code>info()</code>, <code>warn()</code>, <code>error()</code>, <code>audit()</code>, <code>debug()</code></td>
</tr>
<tr>
<td><code>cacheService.js</code> <em>(v1.0.46+)</em></td>
<td>Server-side caching with TTL</td>
<td><code>withCaching()</code>, <code>invalidateCache()</code>, <code>getCacheStats()</code></td>
</tr>
</tbody></table>
<hr>
<h2>Controller Patterns</h2><p>The backend uses three distinct controller patterns, balancing consistency with flexibility based on controller requirements:</p>
<h3>Singleton Pattern Controllers</h3><p>Eight controllers implement the singleton pattern (<code>VulnerabilityController</code>, <code>TicketController</code>, <code>BackupController</code>, <code>TemplateController</code>, <code>AuthController</code>, <code>PreferencesController</code>, <code>LocationController</code>, <code>AuditLogController</code>):</p>
<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VulnerabilityController</span> {
    <span class="hljs-keyword">static</span> instance = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">static</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params">database, progressTracker</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-property">instance</span>) {
            <span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VulnerabilityController</span>();
        }
        <span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-property">instance</span>.<span class="hljs-property">db</span> = database;
        <span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-property">instance</span>.<span class="hljs-property">progressTracker</span> = progressTracker;
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-property">instance</span>;
    }

    <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(<span class="hljs-params"></span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-property">instance</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Controller not initialized. Call initialize() first.&quot;</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-property">instance</span>;
    }

    <span class="hljs-comment">// All route methods are static and use getInstance()</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getStats</span>(<span class="hljs-params">req, res</span>) {
        <span class="hljs-keyword">const</span> controller = <span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-title function_">getInstance</span>();
        <span class="hljs-comment">// Implementation...</span>
    }
}</code></pre><p><strong>Characteristics:</strong></p>
<ul>
<li>Static <code>initialize()</code> method for dependency injection</li>
<li>Static <code>getInstance()</code> method for retrieving singleton</li>
<li>All route methods are static</li>
<li>Throws error if accessed before initialization</li>
</ul>
<h3>Constructor Pattern Controllers</h3><p>Three controllers use the constructor pattern (<code>KevController</code>, <code>CiscoController</code>, <code>PaloAltoController</code>). These controllers instantiate new instances via routes, providing flexibility for dependency injection:</p>
<p><strong>KevController (Constructor with factory function in routes):</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">KevController</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">db</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">kevService</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KevService</span>(db);
    }

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">syncKevData</span>(<span class="hljs-params">req, res</span>) {
        <span class="hljs-comment">// Instance method implementation</span>
    }
}

<span class="hljs-comment">// Route file uses factory function</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">db</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KevController</span>(db);
    <span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();
    router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/sync&quot;</span>, controller.<span class="hljs-property">syncKevData</span>.<span class="hljs-title function_">bind</span>(controller));
    <span class="hljs-keyword">return</span> router;
};</code></pre><p><strong>CiscoController &amp; PaloAltoController (Constructor with multiple dependencies):</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CiscoController</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">db, preferencesService</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ciscoAdvisoryService</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CiscoAdvisoryService</span>(db, preferencesService);
    }

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">syncCiscoAdvisories</span>(<span class="hljs-params">req, res</span>) {
        <span class="hljs-comment">// Instance method implementation</span>
    }
}

<span class="hljs-comment">// Route file instantiates with dependencies</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">db, preferencesService</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CiscoController</span>(db, preferencesService);
    <span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();
    router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/sync&quot;</span>, controller.<span class="hljs-property">syncCiscoAdvisories</span>.<span class="hljs-title function_">bind</span>(controller));
    <span class="hljs-keyword">return</span> router;
};</code></pre><p><strong>Characteristics:</strong></p>
<ul>
<li>Constructor-based dependency injection</li>
<li>Instance methods (not static)</li>
<li>Route files use factory functions that return configured routers</li>
<li>Flexible for controllers with varying dependencies</li>
</ul>
<h3>Module Exports Pattern Controllers</h3><p>One controller (<code>DocsController</code>) uses the module exports with internal instance pattern:</p>
<p><strong>DocsController (Module Exports with Internal Instance):</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DocsController</span> {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getStats</span>(<span class="hljs-params"></span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> docsService.<span class="hljs-title function_">computeStats</span>();
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">apiEndpoints</span>: stats.<span class="hljs-property">apiEndpoints</span>,
                <span class="hljs-attr">jsFunctions</span>: stats.<span class="hljs-property">jsFunctions</span>,
                <span class="hljs-attr">frameworks</span>: stats.<span class="hljs-property">frameworks</span>,
                <span class="hljs-attr">computedAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
            };
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;DocsController.getStats failed:&quot;</span>, error);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Failed to compute documentation statistics&quot;</span>);
        }
    }
}

<span class="hljs-comment">// Export controller instance for route handlers</span>
<span class="hljs-keyword">const</span> docsController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DocsController</span>();

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-attr">getStats</span>: <span class="hljs-function">() =&gt;</span> docsController.<span class="hljs-title function_">getStats</span>(),
    findDocsSectionForFilename
};</code></pre><p><strong>Route Usage:</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">DocsController</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../controllers/docsController&quot;</span>);

router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/stats&quot;</span>, requireAuth, <span class="hljs-title function_">async</span> (req, res) =&gt; {
    <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> <span class="hljs-title class_">DocsController</span>.<span class="hljs-title function_">getStats</span>();
    res.<span class="hljs-title function_">json</span>(stats);
});</code></pre><p><strong>Characteristics:</strong></p>
<ul>
<li>Class-based internally but exports wrapper functions</li>
<li>Single instance created within the module</li>
<li>Routes import and call exported functions directly (no factory pattern)</li>
<li>Simpler than constructor pattern when no dynamic dependencies needed</li>
<li>Hybrid approach: object-oriented internally, functional externally</li>
</ul>
<h3>Functional Pattern Controllers</h3><p>One controller (<code>ImportController</code>) uses functional exports:</p>
<p><strong>ImportController (Functional exports):</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">let</span> progressTracker = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">setProgressTracker</span>(<span class="hljs-params">tracker</span>) {
    progressTracker = tracker;
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">importVulnerabilities</span>(<span class="hljs-params">req, res</span>) {
    <span class="hljs-comment">// Direct function implementation</span>
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    setProgressTracker,
    importVulnerabilities,
    <span class="hljs-comment">// Other functions...</span>
};</code></pre><p><strong>Pattern Selection Guidelines:</strong></p>
<ul>
<li><strong>Singleton</strong>: Use for stateless controllers with global dependencies (database, progress tracker)</li>
<li><strong>Constructor</strong>: Use for controllers with varying dependencies or requiring multiple instances</li>
<li><strong>Functional</strong>: Legacy pattern retained for compatibility (ImportController)</li>
</ul>
<hr>
<h2>Initialization Sequence</h2><p><strong>CRITICAL</strong>: The initialization order is crucial for proper dependency injection. Controllers must be initialized BEFORE routes are imported.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initializeApplication</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// 1. Initialize database FIRST</span>
    <span class="hljs-keyword">await</span> databaseService.<span class="hljs-title function_">initialize</span>();
    <span class="hljs-keyword">const</span> db = databaseService.<span class="hljs-property">db</span>;
    <span class="hljs-variable language_">global</span>.<span class="hljs-property">db</span> = db;  <span class="hljs-comment">// Maintain compatibility</span>

    <span class="hljs-comment">// 2. Start auto-VACUUM scheduler (HEX-250: Database bloat prevention)</span>
    <span class="hljs-keyword">await</span> databaseService.<span class="hljs-title function_">startAutoVacuum</span>();

    <span class="hljs-comment">// 3. Initialize utilities</span>
    <span class="hljs-keyword">const</span> progressTracker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProgressTracker</span>(io);

    <span class="hljs-comment">// 4. Initialize ALL controllers with dependencies</span>
    <span class="hljs-comment">// ORDER MATTERS - initialize before importing routes!</span>
    <span class="hljs-comment">// Singleton pattern controllers</span>
    <span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-title function_">initialize</span>(db, progressTracker);
    <span class="hljs-title class_">TicketController</span>.<span class="hljs-title function_">initialize</span>(db);
    <span class="hljs-title class_">BackupController</span>.<span class="hljs-title function_">initialize</span>(db);
    <span class="hljs-title class_">TemplateController</span>.<span class="hljs-title function_">initialize</span>(db);
    <span class="hljs-title class_">AuthController</span>.<span class="hljs-title function_">initialize</span>(db);
    <span class="hljs-title class_">PreferencesController</span>.<span class="hljs-title function_">initialize</span>(db);

    <span class="hljs-comment">// Functional controllers</span>
    <span class="hljs-title class_">ImportController</span>.<span class="hljs-title function_">setProgressTracker</span>(progressTracker);

    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Constructor pattern controllers (KEV, Cisco, Palo Alto, Docs)</span>
    <span class="hljs-comment">// are instantiated directly in their route files, not here</span>

    <span class="hljs-comment">// 5. Seed data (if needed)</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">seedAllTemplates</span>(db);

    <span class="hljs-comment">// 6. Import route modules (loaded at top of file)</span>
    <span class="hljs-comment">// Routes are already imported as module dependencies:</span>
    <span class="hljs-comment">// const vulnerabilityRoutes = require(&quot;../routes/vulnerabilities&quot;);</span>
    <span class="hljs-comment">// const ticketRoutes = require(&quot;../routes/tickets&quot;);</span>
    <span class="hljs-comment">// const backupRoutes = require(&quot;../routes/backup&quot;);</span>
    <span class="hljs-comment">// const templateRoutes = require(&quot;../routes/templates&quot;);</span>
    <span class="hljs-comment">// const authRoutes = require(&quot;../routes/auth&quot;);</span>
    <span class="hljs-comment">// const preferencesRoutes = require(&quot;../routes/preferences&quot;);</span>
    <span class="hljs-comment">// const kevRoutes = require(&quot;../routes/kev&quot;);  // Factory function</span>
    <span class="hljs-comment">// const ciscoRoutes = require(&quot;../routes/cisco&quot;);  // Factory function (HEX-141)</span>
    <span class="hljs-comment">// const paloRoutes = require(&quot;../routes/palo-alto&quot;);  // Factory function (HEX-209)</span>
    <span class="hljs-comment">// const importRoutes = require(&quot;../routes/imports&quot;);</span>
    <span class="hljs-comment">// const docsRoutes = require(&quot;../routes/docs&quot;);</span>
    <span class="hljs-comment">// const deviceRoutes = require(&quot;../routes/devices&quot;);</span>

    <span class="hljs-comment">// 7. Mount routes on Express app</span>
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/docs&quot;</span>, docsRoutes);
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/backup&quot;</span>, backupRoutes);
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/vulnerabilities&quot;</span>, vulnerabilityRoutes);
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api&quot;</span>, importRoutes);  <span class="hljs-comment">// Import routes at root API level</span>
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/tickets&quot;</span>, ticketRoutes);
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/templates&quot;</span>, templateRoutes);
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/kev&quot;</span>, <span class="hljs-title function_">kevRoutes</span>(db));  <span class="hljs-comment">// Factory function with db</span>
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/cisco&quot;</span>, <span class="hljs-title function_">ciscoRoutes</span>(db, <span class="hljs-title class_">PreferencesController</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-property">preferencesService</span>));  <span class="hljs-comment">// HEX-141</span>
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/palo&quot;</span>, <span class="hljs-title function_">paloRoutes</span>(db, <span class="hljs-title class_">PreferencesController</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-property">preferencesService</span>));  <span class="hljs-comment">// HEX-209</span>
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/devices&quot;</span>, deviceRoutes);  <span class="hljs-comment">// HEX-101</span>
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/auth&quot;</span>, authRoutes);
    app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api/preferences&quot;</span>, preferencesRoutes);

    <span class="hljs-comment">// 8. Start server</span>
    server.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server running on port <span class="hljs-subst">${PORT}</span>`</span>);
    });

    <span class="hljs-comment">// 9. Start background sync workers (HEX-141, HEX-209)</span>
    <span class="hljs-title function_">startCiscoBackgroundSync</span>(db);  <span class="hljs-comment">// Cisco PSIRT advisory sync</span>
    <span class="hljs-comment">// Palo Alto sync is started within startCiscoBackgroundSync()</span>
}</code></pre><h3>Common Initialization Errors</h3><table>
<thead>
<tr>
<th>Error</th>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody><tr>
<td>&quot;Controller not initialized&quot;</td>
<td>Routes imported before controller initialization</td>
<td>Follow initialization sequence</td>
</tr>
<tr>
<td>&quot;Cannot read property &#39;db&#39; of undefined&quot;</td>
<td>Controller accessed before <code>initialize()</code> called</td>
<td>Ensure <code>initialize()</code> called first</td>
</tr>
<tr>
<td>&quot;progressTracker is null&quot;</td>
<td>ImportController used before <code>setProgressTracker()</code></td>
<td>Call <code>setProgressTracker()</code> during init</td>
</tr>
<tr>
<td>Empty API responses</td>
<td>Database not initialized before controllers</td>
<td>Await database initialization</td>
</tr>
</tbody></table>
<h3>PathValidator Security Class</h3><pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PathValidator</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">validatePath</span>(<span class="hljs-params">filePath</span>) {
    <span class="hljs-comment">// Path normalization</span>
    <span class="hljs-keyword">const</span> normalizedPath = path.<span class="hljs-title function_">normalize</span>(filePath);

    <span class="hljs-comment">// Traversal attack prevention</span>
    <span class="hljs-keyword">if</span> (normalizedPath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;../&quot;</span>) || normalizedPath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;..\\&quot;</span>)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Path traversal detected&quot;</span>);
    }

    <span class="hljs-comment">// Component validation</span>
    <span class="hljs-keyword">const</span> pathComponents = normalizedPath.<span class="hljs-title function_">split</span>(path.<span class="hljs-property">sep</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> component <span class="hljs-keyword">of</span> pathComponents) {
      <span class="hljs-keyword">if</span> (component === <span class="hljs-string">&quot;..&quot;</span> || (component === <span class="hljs-string">&quot;.&quot;</span> &amp;&amp; pathComponents.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Invalid path component&quot;</span>);
      }
    }

    <span class="hljs-keyword">return</span> normalizedPath;
  }
}</code></pre><p><strong>Security Features</strong>:</p>
<ul>
<li>Path normalization before validation</li>
<li>Directory traversal attack prevention</li>
<li>Component-level validation</li>
<li>Safe file operation wrappers</li>
<li>Exception-based error handling</li>
</ul>
<hr>
<h2>Middleware & Infrastructure</h2><table>
<thead>
<tr>
<th>Concern</th>
<th>Implementation</th>
<th>Details</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Trust Proxy</strong> <em>(CRITICAL)</em></td>
<td><code>app.set(&quot;trust proxy&quot;, true)</code></td>
<td><strong>ALWAYS enabled</strong> - Required for nginx reverse proxy, enables HTTPS detection</td>
</tr>
<tr>
<td><strong>Session Management</strong> <em>(v1.0.46+)</em></td>
<td><code>express-session</code> + SQLite store</td>
<td>24-hour expiry (30 days with Remember Me), HTTPS-only cookies</td>
</tr>
<tr>
<td><strong>Authentication</strong> <em>(v1.0.46+)</em></td>
<td>Argon2id + <code>requireAuth</code> middleware</td>
<td>46+ protected endpoints, account lockout after 5 failed attempts</td>
</tr>
<tr>
<td><strong>CSRF Protection</strong> <em>(v1.0.46+)</em></td>
<td><code>csrf-sync</code> (Synchronizer Token Pattern)</td>
<td>Token-based protection for all state-changing requests</td>
</tr>
<tr>
<td><strong>CORS</strong></td>
<td><code>cors()</code> with dynamic validation</td>
<td><strong>HTTPS-only</strong> - Rejects HTTP origins, allows same-origin requests</td>
</tr>
<tr>
<td><strong>Rate Limiting</strong></td>
<td><code>express-rate-limit</code> with cache awareness</td>
<td><strong>Production</strong>: 60 req/15min per IP, <strong>Development</strong>: 10,000 req/1min (cache hits excluded). <strong>Note</strong>: Current production deployment uses development limits pending performance testing.</td>
</tr>
<tr>
<td><strong>Compression</strong></td>
<td><code>compression()</code></td>
<td><strong>Conditional</strong>: Only if <code>TRUST_PROXY !== &quot;true&quot;</code> (avoids double compression with nginx)</td>
</tr>
<tr>
<td><strong>Parsing</strong></td>
<td><code>express.json</code> &amp; <code>express.urlencoded</code></td>
<td>100MB limit for request bodies (CSV imports)</td>
</tr>
<tr>
<td><strong>Uploads</strong></td>
<td><code>multer</code></td>
<td>CSV import only, 100MB cap, MIME type validation (<code>text/csv</code>)</td>
</tr>
<tr>
<td><strong>Security Headers</strong></td>
<td>Custom middleware</td>
<td><code>X-Content-Type-Options: nosniff</code>, <code>X-Frame-Options: DENY</code>, <code>X-XSS-Protection: 1; mode=block</code></td>
</tr>
<tr>
<td><strong>Static Assets</strong></td>
<td><code>express.static</code></td>
<td>Serves root, <code>docs-html/</code>, <code>dev-docs-html/</code>, and <code>/config</code> directories</td>
</tr>
<tr>
<td><strong>Error Handling</strong></td>
<td>Global error handler</td>
<td>Catches unhandled errors, formats responses, logs details</td>
</tr>
</tbody></table>
<hr>
<h2>Authentication & Security *(v1.0.46+)*</h2><h3>Authentication System</h3><p>HexTrackr implements enterprise-grade authentication with Argon2id password hashing and SQLite session storage.</p>
<p><strong>Key Features</strong>:</p>
<ul>
<li><strong>Password Hashing</strong>: Argon2id (timing-safe comparison) - industry standard for password security</li>
<li><strong>Session Storage</strong>: SQLite-backed sessions with 24-hour expiry (30 days with Remember Me)</li>
<li><strong>Account Lockout</strong>: 5 failed attempts triggers 15-minute lockout</li>
<li><strong>Secure Cookies</strong>: HTTPS-only, HttpOnly, SameSite=lax</li>
<li><strong>Session Validation</strong>: Every protected request validates session</li>
</ul>
<p><strong>Authentication Flow</strong>:</p>
<div class="mermaid">sequenceDiagram
    participant C as Client
    participant S as Server
    participant A as AuthService
    participant D as Database

    C-&gt;&gt;S: POST /api/auth/login {username, password, rememberMe}
    S-&gt;&gt;A: authenticateUser(username, password)
    A-&gt;&gt;D: SELECT user WHERE username = ?
    D--&gt;&gt;A: User record
    A-&gt;&gt;A: Check account lockout status
    A-&gt;&gt;A: Verify password with Argon2id
    alt Password valid
        A-&gt;&gt;D: Reset failed attempts
        A-&gt;&gt;D: Update last login
        A--&gt;&gt;S: User (without password hash)
        S-&gt;&gt;S: Create session (req.session.userId)
        S--&gt;&gt;C: 200 OK {success: true, user: {...}}
    else Password invalid
        A-&gt;&gt;D: Increment failed attempts
        A--&gt;&gt;S: null
        S--&gt;&gt;C: 401 Unauthorized
    end</div><p><strong>Protected Routes</strong>:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Middleware protects 46 endpoints</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/stats&quot;</span>, requireAuth, <span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-property">getStats</span>);
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/import&quot;</span>, requireAuth, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">&quot;csvFile&quot;</span>), <span class="hljs-title class_">VulnerabilityController</span>.<span class="hljs-property">importCSV</span>);</code></pre><p><strong>requireAuth Middleware</strong>:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">requireAuth</span>(<span class="hljs-params">req, res, next</span>) {
    <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span> || !req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span>) {
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({
            <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;Authentication required&quot;</span>,
            <span class="hljs-attr">authenticated</span>: <span class="hljs-literal">false</span>
        });
    }
    req.<span class="hljs-property">user</span> = {
        <span class="hljs-attr">id</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span>,
        <span class="hljs-attr">username</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>,
        <span class="hljs-attr">role</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">role</span>
    };
    <span class="hljs-title function_">next</span>();
}</code></pre><h3>CSRF Protection</h3><p>HexTrackr implements CSRF protection using the Synchronizer Token Pattern via <code>csrf-sync</code>.</p>
<p><strong>Configuration</strong>:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { csrfSynchronisedProtection, generateToken } = <span class="hljs-title function_">csrfSync</span>({
    <span class="hljs-attr">getTokenFromRequest</span>: <span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> req.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;x-csrf-token&quot;</span>] ||
               req.<span class="hljs-property">body</span>?.<span class="hljs-property">_csrf</span> ||
               req.<span class="hljs-property">query</span>?.<span class="hljs-property">_csrf</span>;
    },
    <span class="hljs-attr">ignoredMethods</span>: [<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;HEAD&quot;</span>, <span class="hljs-string">&quot;OPTIONS&quot;</span>],
    <span class="hljs-attr">getTokenFromState</span>: <span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> req.<span class="hljs-property">session</span>.<span class="hljs-property">csrfToken</span>,
    <span class="hljs-attr">storeTokenInState</span>: <span class="hljs-function">(<span class="hljs-params">req, token</span>) =&gt;</span> { req.<span class="hljs-property">session</span>.<span class="hljs-property">csrfToken</span> = token; },
    <span class="hljs-attr">size</span>: <span class="hljs-number">128</span>  <span class="hljs-comment">// Token size in bits</span>
});</code></pre><p><strong>Public Endpoints</strong> (Excluded from CSRF):</p>
<ul>
<li><code>/api/auth/login</code> - Login endpoint (needs token before auth)</li>
<li><code>/api/auth/csrf</code> - Token retrieval endpoint</li>
<li><code>/api/auth/status</code> - Status check endpoint</li>
</ul>
<p><strong>Client-Side Usage</strong>:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// 1. Fetch CSRF token</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/api/auth/csrf&quot;</span>, { <span class="hljs-attr">credentials</span>: <span class="hljs-string">&quot;include&quot;</span> });
<span class="hljs-keyword">const</span> { csrfToken } = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

<span class="hljs-comment">// 2. Include in request headers</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/api/vulnerabilities&quot;</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">&quot;X-CSRF-Token&quot;</span>: csrfToken },
    <span class="hljs-attr">credentials</span>: <span class="hljs-string">&quot;include&quot;</span>,
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
});</code></pre><h3>Trust Proxy Configuration</h3><p><strong>Setting</strong>: <code>app.set(&quot;trust proxy&quot;, true)</code> - <strong>ALWAYS ENABLED</strong></p>
<p><strong>Critical Importance</strong>:</p>
<ul>
<li>Allows Express to read <code>X-Forwarded-Proto</code> header from nginx</li>
<li>Enables secure cookies with HTTPS termination at nginx</li>
<li>Required for authentication system to function correctly</li>
<li><strong>WITHOUT THIS</strong>: Authentication will fail (cookies not set over HTTP)</li>
</ul>
<p><strong>Network Flow</strong>:</p>
<pre><code class="language-">Client → HTTPS (443) → nginx → HTTP (8080) → Express
         Sets header:    Reads header:
         X-Forwarded-Proto: https</code></pre><h3>Session Configuration</h3><p><strong>Backend</strong> (<code>app/middleware/auth.js</code>):</p>
<pre><code class="language-javascript"><span class="hljs-title function_">session</span>({
    <span class="hljs-attr">store</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">SQLiteStore</span>({
        <span class="hljs-attr">client</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-string">&quot;app/data/sessions.db&quot;</span>),
        <span class="hljs-attr">expired</span>: { <span class="hljs-attr">clear</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">intervalMs</span>: <span class="hljs-number">900000</span> }  <span class="hljs-comment">// 15-min cleanup</span>
    }),
    <span class="hljs-attr">secret</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">SESSION_SECRET</span>,  <span class="hljs-comment">// REQUIRED (32+ chars)</span>
    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;hextrackr.sid&quot;</span>,
    <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">cookie</span>: {
        <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>,        <span class="hljs-comment">// HTTPS only (browsers enforce)</span>
        <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,      <span class="hljs-comment">// No JavaScript access</span>
        <span class="hljs-attr">sameSite</span>: <span class="hljs-string">&quot;lax&quot;</span>,     <span class="hljs-comment">// Allow top-level navigation</span>
        <span class="hljs-attr">maxAge</span>: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>  <span class="hljs-comment">// 24 hours (30 days with Remember Me)</span>
    },
    <span class="hljs-attr">proxy</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// ALWAYS true - required for nginx reverse proxy</span>
})</code></pre><p><strong>Environment Variable Validation</strong> (<code>app/middleware/auth.js:13-22</code>):</p>
<pre><code class="language-javascript"><span class="hljs-keyword">if</span> (!process.<span class="hljs-property">env</span>.<span class="hljs-property">SESSION_SECRET</span> || process.<span class="hljs-property">env</span>.<span class="hljs-property">SESSION_SECRET</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">32</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;❌ CRITICAL: SESSION_SECRET is missing or too short!&quot;</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// Server refuses to start</span>
}</code></pre><p><strong>Generate SESSION_SECRET</strong>:</p>
<pre><code class="language-bash">node -e <span class="hljs-string">&quot;console.log(require(&#x27;crypto&#x27;).randomBytes(32).toString(&#x27;hex&#x27;))&quot;</span></code></pre><hr>
<h2>Persistence & Schema Evolution</h2><ul>
<li><strong>Initialization</strong>: If DB missing, runs <code>scripts/init-database.js</code>.</li>
<li><strong>Runtime Evolution</strong>: Idempotent <code>ALTER TABLE</code> adds new columns (<code>vendor</code>, <code>vulnerability_date</code>, <code>state</code>, <code>import_date</code>, etc.) to legacy tables for backward compatibility.</li>
<li><strong>Rollover Tables</strong>: Created on startup if absent (<code>vulnerability_snapshots</code>, <code>vulnerabilities_current</code>, <code>vulnerability_daily_totals</code>).</li>
</ul>
<p>See: <a href="#architecture/data-model">Data Model</a> for exhaustive schema &amp; index inventory.</p>
<hr>
<h2>Vulnerability Rollover Workflow</h2><p>Purpose: Maintain real-time deduplicated active set + full historical timeline + fast daily aggregates.</p>
<h3>CSV Import (Rollover Path)</h3><div class="mermaid">sequenceDiagram
    participant User
    participant API as server.js
    participant DB as SQLite

    User-&gt;&gt;API: POST /api/vulnerabilities/import (multipart/form-data + optional scanDate)
    API-&gt;&gt;API: Parse CSV (PapaParse, filter empty rows)
    API-&gt;&gt;DB: INSERT vulnerability_imports
    API-&gt;&gt;DB: UPDATE vulnerabilities_current (mark potentially stale)
    loop Each row (sequential to prevent race conditions)
        API-&gt;&gt;API: Map + generate unique_key
        API-&gt;&gt;DB: INSERT vulnerability_snapshots
        API-&gt;&gt;DB: INSERT or UPDATE vulnerabilities_current
    end
    API-&gt;&gt;DB: DELETE stale rows (not seen in this scan)
    API-&gt;&gt;DB: INSERT OR REPLACE vulnerability_daily_totals
    API--&gt;&gt;User: { importId, insertCount, updateCount, removedStale, scanDate, performanceMetrics }</div><blockquote>
<p><strong>Staging importer</strong>: <code>POST /api/vulnerabilities/import-staging</code> follows the same steps but first bulk loads data into <code>vulnerability_staging</code> and streams <code>ProgressTracker</code> events (<code>progress-update</code>, <code>progress-complete</code>, <code>progress-error</code>).</p>
</blockquote>
<h3>Enhanced Deduplication System</h3><p>HexTrackr implements a sophisticated 4-tier unique key generation strategy:</p>
<p><strong>Tier 1: Asset ID + Plugin ID</strong> (Highest Reliability)</p>
<pre><code class="language-javascript"><span class="hljs-keyword">if</span> (mapped.<span class="hljs-property">assetId</span> &amp;&amp; mapped.<span class="hljs-property">pluginId</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`asset:<span class="hljs-subst">${mapped.assetId}</span>|plugin:<span class="hljs-subst">${mapped.pluginId}</span>`</span>;
}</code></pre><p><strong>Tier 2: CVE + Hostname/IP</strong> (CVE-based)</p>
<pre><code class="language-javascript"><span class="hljs-keyword">if</span> (mapped.<span class="hljs-property">cve</span> &amp;&amp; mapped.<span class="hljs-property">cve</span>.<span class="hljs-title function_">trim</span>()) {
  <span class="hljs-keyword">const</span> hostIdentifier = normalizedIP || normalizedHostname;
  <span class="hljs-keyword">return</span> <span class="hljs-string">`cve:<span class="hljs-subst">${mapped.cve.trim()}</span>|host:<span class="hljs-subst">${hostIdentifier}</span>`</span>;
}</code></pre><p><strong>Tier 3: Plugin ID + Hostname/IP + Vendor</strong> (User-requested approach)</p>
<pre><code class="language-javascript"><span class="hljs-keyword">if</span> (mapped.<span class="hljs-property">pluginId</span> &amp;&amp; mapped.<span class="hljs-property">pluginId</span>.<span class="hljs-title function_">trim</span>()) {
  <span class="hljs-keyword">const</span> hostIdentifier = normalizedIP || normalizedHostname;
  <span class="hljs-keyword">const</span> vendor = mapped.<span class="hljs-property">vendor</span> || <span class="hljs-string">&quot;unknown&quot;</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">`plugin:<span class="hljs-subst">${mapped.pluginId.trim()}</span>|host:<span class="hljs-subst">${hostIdentifier}</span>|vendor:<span class="hljs-subst">${vendor}</span>`</span>;
}</code></pre><p><strong>Tier 4: Description Hash + Hostname/IP</strong> (Fallback)</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> descriptionHash = <span class="hljs-title function_">createDescriptionHash</span>(mapped.<span class="hljs-property">description</span>);
<span class="hljs-keyword">const</span> hostIdentifier = normalizedIP || normalizedHostname;
<span class="hljs-keyword">return</span> <span class="hljs-string">`desc:<span class="hljs-subst">${descriptionHash}</span>|host:<span class="hljs-subst">${hostIdentifier}</span>`</span>;</code></pre><h3>Key Safeguards</h3><table>
<thead>
<tr>
<th>Risk</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody><tr>
<td>Row duplication in batch</td>
<td>In-memory <code>Set</code> of processed unique_keys</td>
</tr>
<tr>
<td>Race conditions</td>
<td>Explicit sequential loop with <code>processNextRow(index)</code> pattern</td>
</tr>
<tr>
<td>Data drift</td>
<td>Historical record preserved in snapshots before updates</td>
</tr>
<tr>
<td>Performance</td>
<td>Indexes on <code>unique_key</code>, <code>scan_date</code>, severities</td>
</tr>
<tr>
<td><strong>Key conflicts</strong></td>
<td><strong>4-tier unique key generation with reliability scoring</strong></td>
</tr>
<tr>
<td><strong>Memory leaks</strong></td>
<td><strong>Session-based processing with automatic cleanup</strong></td>
</tr>
<tr>
<td><strong>Hostname variations</strong></td>
<td><strong>Hostname normalization (domain stripping, case insensitive)</strong></td>
</tr>
<tr>
<td><strong>IP address formats</strong></td>
<td><strong>IP normalization and validation</strong></td>
</tr>
</tbody></table>
<hr>
<h2>API Surface (High-Level)</h2><table>
<thead>
<tr>
<th>Domain</th>
<th>Endpoints</th>
<th>Authentication</th>
<th>Documentation</th>
</tr>
</thead>
<tbody><tr>
<td>Health</td>
<td>1 endpoint</td>
<td>Public</td>
<td>System health check</td>
</tr>
<tr>
<td>Authentication <em>(v1.0.46+)</em></td>
<td>6 endpoints</td>
<td>Mixed</td>
<td>Login, logout, status, CSRF, profile, password change</td>
</tr>
<tr>
<td>Vulnerabilities</td>
<td>18+ endpoints</td>
<td><code>requireAuth</code></td>
<td>CRUD, stats, trends, import/export, vendor stats</td>
</tr>
<tr>
<td>Imports</td>
<td>13+ endpoints</td>
<td><code>requireAuth</code></td>
<td>CSV/JSON imports, progress tracking</td>
</tr>
<tr>
<td>Tickets</td>
<td>5+ endpoints</td>
<td><code>requireAuth</code></td>
<td>Ticket CRUD operations</td>
</tr>
<tr>
<td>Backup/Restore</td>
<td>9+ endpoints</td>
<td><code>requireAuth</code></td>
<td>Backup, restore, JSON/ZIP exports</td>
</tr>
<tr>
<td>KEV <em>(v1.0.22+)</em></td>
<td>7+ endpoints</td>
<td><code>requireAuth</code></td>
<td>CISA KEV sync, status, lookup</td>
</tr>
<tr>
<td>Cisco PSIRT <em>(v1.0.63+, HEX-141)</em></td>
<td>6+ endpoints</td>
<td><code>requireAuth</code></td>
<td>Cisco advisory sync, status, credentials, lookup</td>
</tr>
<tr>
<td>Palo Alto Security <em>(v1.0.63+, HEX-209)</em></td>
<td>6+ endpoints</td>
<td><code>requireAuth</code></td>
<td>Palo Alto advisory sync, status, lookup</td>
</tr>
<tr>
<td>Templates <em>(v1.0.46+)</em></td>
<td>7+ endpoints</td>
<td><code>requireAuth</code></td>
<td>Email template management</td>
</tr>
<tr>
<td>Preferences <em>(v1.0.46+)</em></td>
<td>7+ endpoints</td>
<td><code>requireAuth</code></td>
<td>User preferences CRUD</td>
</tr>
<tr>
<td>Devices <em>(HEX-101)</em></td>
<td>1 endpoint</td>
<td><code>requireAuth</code></td>
<td>Device statistics with vendor breakdown</td>
</tr>
<tr>
<td>Documentation</td>
<td>2 endpoints</td>
<td>Public</td>
<td>Stats and portal delivery</td>
</tr>
</tbody></table>
<h3>API Endpoint Summary</h3><ul>
<li><strong>Total Endpoints</strong>: 85+ REST endpoints across 15 route modules</li>
<li><strong>Protected Endpoints</strong>: 46+ endpoints with <code>requireAuth</code> middleware</li>
<li><strong>Public Endpoints</strong>: 9+ endpoints (health, auth, docs)</li>
<li><strong>Import System</strong>: 13+ dedicated import endpoints with progress tracking</li>
<li><strong>External Integrations</strong>: CISA KEV, Cisco PSIRT, Palo Alto Security advisories</li>
<li><strong>WebSocket</strong>: Real-time progress tracking on same port as REST API (8080)</li>
<li><strong>Rate Limited</strong>: Production: 60 req/15min (standard), Development: 10,000 req/1min (cache hits excluded)</li>
<li><strong>Current State</strong>: Production deployment uses development limits (10,000 req/1min) due to card view data loading requirements. Performance testing planned to determine optimal production limits.</li>
</ul>
<hr>
<h2>Real-time Communication (WebSocket)</h2><h3>ProgressTracker Architecture</h3><p>HexTrackr implements a sophisticated WebSocket-based progress tracking system through the <code>ProgressTracker</code> class:</p>
<ul>
<li><strong>Port</strong>: Same as REST API (8080) - WebSocket runs on the same HTTP/HTTPS server instance</li>
<li><strong>Library</strong>: Socket.io with enhanced session management and authentication</li>
<li><strong>Session Management</strong>: UUID-based sessions with metadata tracking</li>
<li><strong>Authentication</strong>: WebSocket handshake validates Express session cookies</li>
<li><strong>Throttling</strong>: 100ms minimum interval between progress events</li>
<li><strong>Auto-cleanup</strong>: 30-minute session timeout with automatic garbage collection</li>
</ul>
<p><strong>Note</strong>: <code>WEBSOCKET_PORT = 8988</code> in constants.js is a planned/legacy value, not currently used. The WebSocket server shares the same port as the REST API.</p>
<h3>ProgressTracker Features</h3><pre><code class="language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProgressTracker</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">io</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sessions</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventThrottle</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">THROTTLE_INTERVAL</span> = <span class="hljs-number">100</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">SESSION_CLEANUP_INTERVAL</span> = <span class="hljs-number">30</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;
  }
}</code></pre><p><strong>Key Capabilities</strong>:</p>
<ul>
<li>Session-based progress tracking with unique identifiers</li>
<li>Throttled event emission to prevent client overload</li>
<li>Metadata persistence for operation context</li>
<li>Automatic session cleanup for memory management</li>
<li>Error handling with graceful degradation</li>
</ul>
<h3>WebSocket Events</h3><table>
<thead>
<tr>
<th>Event Type</th>
<th>Purpose</th>
<th>Throttled</th>
</tr>
</thead>
<tbody><tr>
<td><code>import_progress</code></td>
<td>CSV import progress updates</td>
<td>Yes (100ms)</td>
</tr>
<tr>
<td><code>import_complete</code></td>
<td>Import operation completion</td>
<td>No</td>
</tr>
<tr>
<td><code>import_error</code></td>
<td>Import operation errors</td>
<td>No</td>
</tr>
<tr>
<td><code>session_created</code></td>
<td>New session establishment</td>
<td>No</td>
</tr>
<tr>
<td><code>session_cleanup</code></td>
<td>Session removal notification</td>
<td>No</td>
</tr>
</tbody></table>
<h3>Session Lifecycle</h3><div class="mermaid">sequenceDiagram
    participant Client
    participant ProgressTracker
    participant Import as Import Process

    Client-&gt;&gt;ProgressTracker: Connect to WebSocket
    ProgressTracker-&gt;&gt;ProgressTracker: createSession(metadata)
    ProgressTracker--&gt;&gt;Client: session_created event

    Import-&gt;&gt;ProgressTracker: updateProgress(sessionId, progress)
    ProgressTracker-&gt;&gt;ProgressTracker: throttleCheck()
    alt Progress not throttled
        ProgressTracker--&gt;&gt;Client: import_progress event
    end

    Import-&gt;&gt;ProgressTracker: completeSession(sessionId)
    ProgressTracker--&gt;&gt;Client: import_complete event
    ProgressTracker-&gt;&gt;ProgressTracker: cleanup(sessionId)</div><p>For more details, see the <a href="#reference/websocket">WebSocket Protocol documentation</a>.</p>
<hr>
<h2>Pagination Flow (Current Vulnerabilities)</h2><div class="mermaid">sequenceDiagram
    participant UI
    participant API as server.js
    participant DB as SQLite
    UI-&gt;&gt;API: GET /api/vulnerabilities?page=1&limit=50
    API-&gt;&gt;DB: SELECT filtered rows FROM vulnerabilities_current LIMIT/OFFSET
    DB--&gt;&gt;API: Row batch
    API-&gt;&gt;DB: SELECT COUNT(*) (same filters)
    DB--&gt;&gt;API: Total
    API--&gt;&gt;UI: { data, pagination }</div><hr>
<h2>Legacy vs Rollover Paths</h2><table>
<thead>
<tr>
<th>Aspect</th>
<th>Legacy <code>vulnerabilities</code></th>
<th>Rollover Tables</th>
</tr>
</thead>
<tbody><tr>
<td>Purpose</td>
<td>Early ingestion &amp; export</td>
<td>Current production analytics</td>
</tr>
<tr>
<td>Dedupe</td>
<td>Unique per (hostname, cve, import_date) index</td>
<td>Algorithmic unique_key with hostname normalization</td>
</tr>
<tr>
<td>History</td>
<td>Implicit (one row per scan)</td>
<td>Explicit snapshots + daily aggregates</td>
</tr>
<tr>
<td>Future</td>
<td>To be deprecated</td>
<td>Strategic direction</td>
</tr>
</tbody></table>
<hr>
<h2>Utility Endpoints</h2><ul>
<li><strong><code>GET /health</code></strong>: <code>{ status, version, db, uptime }</code></li>
<li><strong><code>GET /api/docs/stats</code></strong>: Counts routes + approximates function definitions.</li>
<li><strong>Backup</strong>: Returns structured JSON (vulnerabilities legacy + tickets) or combined.</li>
</ul>
<hr>
<h2>Security & Hardening</h2><h3>Current Security Implementations</h3><table>
<thead>
<tr>
<th>Concern</th>
<th>Implementation</th>
<th>Details</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Path Traversal</strong></td>
<td><code>PathValidator</code> class</td>
<td>Comprehensive path validation and safe file operations</td>
</tr>
<tr>
<td><strong>Rate Limiting</strong></td>
<td>Express rate limit middleware</td>
<td>60 requests per 15-minute window (production standard), 10,000 requests per 1-minute window (development), cache hits excluded. Production currently uses development limits pending optimization.</td>
</tr>
<tr>
<td><strong>Upload Security</strong></td>
<td>Multer with size limits</td>
<td>50MB cap with file type validation</td>
</tr>
<tr>
<td><strong>XSS Prevention</strong></td>
<td>Security headers</td>
<td><code>X-Content-Type-Options</code>, <code>X-Frame-Options</code>, <code>X-XSS-Protection</code></td>
</tr>
<tr>
<td><strong>SQL Injection</strong></td>
<td>Parameterized queries</td>
<td>All database operations use prepared statements</td>
</tr>
<tr>
<td><strong>CORS Protection</strong></td>
<td>Configurable CORS</td>
<td>Default: all origins (configurable for production)</td>
</tr>
<tr>
<td><strong>Input Sanitization</strong></td>
<td>DOMPurify integration</td>
<td>Client-side XSS prevention</td>
</tr>
</tbody></table>
<h3>PathValidator Security Features</h3><pre><code class="language-javascript"><span class="hljs-comment">// Safe file operations with built-in validation</span>
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeReadFileSync</span>(filePath, options)
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeWriteFileSync</span>(filePath, data, options)
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeReaddirSync</span>(dirPath, options)
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeStatSync</span>(filePath)
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeExistsSync</span>(filePath)
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeUnlinkSync</span>(filePath)</code></pre><p><strong>Protection Mechanisms</strong>:</p>
<ul>
<li>Path normalization before validation</li>
<li>Directory traversal detection (<code>../</code>, <code>..\\</code>)</li>
<li>Component-level path validation</li>
<li>Exception-based error handling</li>
<li>Graceful fallbacks for invalid paths</li>
</ul>
<h3>Rate Limiting Configuration</h3><p><strong>Configuration</strong> (<code>app/config/middleware.js</code>):</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> rateLimit = {
    <span class="hljs-attr">windowMs</span>: <span class="hljs-variable constant_">RATE_LIMIT_WINDOW_MS</span>,  <span class="hljs-comment">// Dynamic: 15min (prod) / 1min (dev)</span>
    <span class="hljs-attr">max</span>: <span class="hljs-variable constant_">RATE_LIMIT_MAX_REQUESTS</span>,    <span class="hljs-comment">// 60 (prod) / 10000 (dev)</span>
    <span class="hljs-attr">message</span>: <span class="hljs-variable constant_">RATE_LIMIT_MESSAGE</span>,
    <span class="hljs-attr">standardHeaders</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">legacyHeaders</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">validate</span>: { <span class="hljs-attr">trustProxy</span>: <span class="hljs-literal">false</span> }  <span class="hljs-comment">// Disable validation - we trust nginx reverse proxy</span>
};</code></pre><p><strong>Constants</strong> (<code>app/utils/constants.js</code>):</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">IS_PRODUCTION</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;production&quot;</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RATE_LIMIT_WINDOW_MS</span> = <span class="hljs-variable constant_">IS_PRODUCTION</span> ? <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span> : <span class="hljs-number">1</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>; <span class="hljs-comment">// 15 min (prod) / 1 min (dev)</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RATE_LIMIT_MAX_REQUESTS</span> = <span class="hljs-variable constant_">IS_PRODUCTION</span> ? <span class="hljs-number">60</span> : <span class="hljs-number">10000</span>; <span class="hljs-comment">// 60 (prod) / 10000 (dev) - cache HITs excluded</span></code></pre><p><strong>Cache-Aware Rate Limiting</strong>: With the introduction of <code>cacheService.js</code> (v1.0.46+), rate limits were reduced from 100 to 60 requests per window (40% reduction) because cached responses are excluded from rate limiting.</p>
<p><strong>Current Production Configuration</strong>: Production deployment currently uses development limits (10,000 req/1min) due to high data volume requirements from card view components. Performance testing is planned to determine optimal production limits without impacting user experience.</p>
<h3>Future Security Enhancements</h3><table>
<thead>
<tr>
<th>Concern</th>
<th>Status</th>
<th>Planned Enhancement</th>
</tr>
</thead>
<tbody><tr>
<td><del>Authentication</del></td>
<td>✅ <strong>IMPLEMENTED (v1.0.46+)</strong></td>
<td>Session-based auth with Argon2id, SQLite sessions, 46+ protected endpoints</td>
</tr>
<tr>
<td>API Security</td>
<td>Planned</td>
<td>API key authentication for external integrations</td>
</tr>
<tr>
<td>Audit Logging</td>
<td>Planned</td>
<td>Central audit logging of security events and rejections</td>
</tr>
<tr>
<td><del>TLS/HTTPS</del></td>
<td>✅ <strong>IMPLEMENTED</strong></td>
<td>HTTPS support via nginx reverse proxy with X-Forwarded-Proto</td>
</tr>
<tr>
<td>Input Validation</td>
<td>Partial</td>
<td>JSON schema (Ajv) enforcement for all API endpoints</td>
</tr>
<tr>
<td>Structured Logging</td>
<td>Planned</td>
<td>Structured JSON logging with request IDs and correlation</td>
</tr>
<tr>
<td>Vulnerability Scanning</td>
<td>Planned</td>
<td>Automated dependency vulnerability scanning (Codacy integration available)</td>
</tr>
<tr>
<td>Secret Management</td>
<td>Partial</td>
<td>Environment-based secrets via <code>.env</code> (rotation not automated)</td>
</tr>
</tbody></table>
<hr>
<h2>Planned Enhancements</h2><h3>Observability & Monitoring</h3><table>
<thead>
<tr>
<th>Area</th>
<th>Enhancement</th>
<th>Priority</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Metrics</strong></td>
<td>Prometheus metrics (import latency, row counts, session tracking)</td>
<td>High</td>
</tr>
<tr>
<td><strong>Tracing</strong></td>
<td>OpenTelemetry integration for distributed tracing</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Health Checks</strong></td>
<td>Enhanced health endpoints with dependency checking</td>
<td>High</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>APM integration for bottleneck identification</td>
<td>Medium</td>
</tr>
</tbody></table>
<h3>Architecture & Modularity</h3><table>
<thead>
<tr>
<th>Area</th>
<th>Enhancement</th>
<th>Priority</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Modularization</strong></td>
<td>Extract ProgressTracker, PathValidator, and rollover modules</td>
<td>High</td>
</tr>
<tr>
<td><strong>Microservices</strong></td>
<td>Split WebSocket server into separate service</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Database</strong></td>
<td>PostgreSQL migration for scalability</td>
<td>Low</td>
</tr>
<tr>
<td><strong>Caching</strong></td>
<td>Redis integration for session and data caching</td>
<td>Medium</td>
</tr>
</tbody></table>
<h3>Data Quality & Validation</h3><table>
<thead>
<tr>
<th>Area</th>
<th>Enhancement</th>
<th>Priority</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Schema Validation</strong></td>
<td>JSON schema (Ajv) enforcement for all API endpoints</td>
<td>High</td>
</tr>
<tr>
<td><strong>CVE Validation</strong></td>
<td>Real-time CVE format and existence validation</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Severity Normalization</strong></td>
<td>Automatic severity enumeration mapping</td>
<td>High</td>
</tr>
<tr>
<td><strong>Data Quality Scoring</strong></td>
<td>Automated data quality metrics and reporting</td>
<td>Medium</td>
</tr>
</tbody></table>
<h3>Legacy Migration</h3><table>
<thead>
<tr>
<th>Area</th>
<th>Enhancement</th>
<th>Status</th>
<th>Priority</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Legacy Deprecation</strong></td>
<td>Retire legacy vulnerabilities table and endpoints</td>
<td>On Hold</td>
<td>Low</td>
</tr>
<tr>
<td><strong>Data Migration</strong></td>
<td>Automated migration from legacy to rollover architecture</td>
<td>On Hold</td>
<td>Low</td>
</tr>
<tr>
<td><strong>API Versioning</strong></td>
<td>Implement API versioning for backward compatibility</td>
<td>Not Started</td>
<td>Medium</td>
</tr>
</tbody></table>
<p><strong>Note</strong>: Legacy <code>vulnerabilities</code> table remains in active use alongside the rollover architecture (<code>vulnerabilities_current</code>, <code>vulnerability_snapshots</code>). Full deprecation requires careful migration planning to ensure data continuity.</p>
<h3>Testing & Quality Assurance</h3><table>
<thead>
<tr>
<th>Area</th>
<th>Enhancement</th>
<th>Priority</th>
</tr>
</thead>
<tbody><tr>
<td><strong>E2E Testing</strong></td>
<td>Playwright integration tests for all major workflows</td>
<td>High</td>
</tr>
<tr>
<td><strong>API Contract Testing</strong></td>
<td>OpenAPI-based contract validation</td>
<td>High</td>
</tr>
<tr>
<td><strong>Load Testing</strong></td>
<td>Automated performance testing with realistic data volumes</td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Security Testing</strong></td>
<td>Automated security scanning and penetration testing</td>
<td>High</td>
</tr>
</tbody></table>
<hr>
<h2>Summary</h2><p>The backend favors simplicity (single process, embedded DB) while implementing a robust rollover pipeline for vulnerability lifecycle tracking. Incremental improvements will focus on modularity, observability, and deprecating legacy ingestion paths.</p>

    <!-- Note: This file is intentionally minimal. The full page scaffold, header, footer, and scripts
             are provided by docs-html/index.html. Content generated using this template will be
             fetched and injected into #content-container by docs-html/js/docs-portal-v2.js. -->
</section>

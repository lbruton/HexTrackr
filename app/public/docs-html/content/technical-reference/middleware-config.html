<!-- Fragment template for documentation content injected by docs-tabler.js -->
<section class="doc-fragment">
    <h1>Middleware &amp; Configuration Reference</h1>
<p>This document covers the middleware pipeline and configuration modules that provide the infrastructure for HexTrackr&#39;s backend.</p>
<h2>Middleware Pipeline</h2>
<p>Middleware executes in the order it&#39;s registered in <code>server.js</code>. Each middleware can modify the request, response, or pass control to the next middleware.</p>
<h3>Execution Order</h3>
<pre><code class="language-javascript"><span class="hljs-comment">// server.js middleware registration order</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());                    <span class="hljs-comment">// 1. CORS headers</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">compression</span>());              <span class="hljs-comment">// 2. Response compression</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">limit</span>: <span class="hljs-string">&quot;100mb&quot;</span> }));     <span class="hljs-comment">// 3. JSON parsing</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> })); <span class="hljs-comment">// 4. URL encoding</span>
app.<span class="hljs-title function_">use</span>(securityMiddleware);        <span class="hljs-comment">// 5. Security headers</span>
app.<span class="hljs-title function_">use</span>(loggingMiddleware);          <span class="hljs-comment">// 6. Request logging</span>
app.<span class="hljs-title function_">use</span>(rateLimiter);               <span class="hljs-comment">// 7. Rate limiting</span>
app.<span class="hljs-title function_">use</span>(validationMiddleware);      <span class="hljs-comment">// 8. Input validation</span>
<span class="hljs-comment">// Routes registered here</span>
app.<span class="hljs-title function_">use</span>(errorHandler);              <span class="hljs-comment">// Last: Error handling</span></code></pre><h2>Middleware Modules</h2>
<h3>Security Middleware</h3>
<p><strong>Location</strong>: <code>/app/middleware/security.js</code></p>
<p>Applies security headers and protections to all responses.</p>
<h4>Implementation</h4>
<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">securityMiddleware</span>(<span class="hljs-params">req, res, next</span>) {
    <span class="hljs-comment">// Security headers</span>
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;X-Content-Type-Options&quot;</span>, <span class="hljs-string">&quot;nosniff&quot;</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;X-Frame-Options&quot;</span>, <span class="hljs-string">&quot;DENY&quot;</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;X-XSS-Protection&quot;</span>, <span class="hljs-string">&quot;1; mode=block&quot;</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Strict-Transport-Security&quot;</span>, <span class="hljs-string">&quot;max-age=31536000; includeSubDomains&quot;</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Content-Security-Policy&quot;</span>, <span class="hljs-string">&quot;default-src &#x27;self&#x27;&quot;</span>);

    <span class="hljs-comment">// Remove sensitive headers</span>
    res.<span class="hljs-title function_">removeHeader</span>(<span class="hljs-string">&quot;X-Powered-By&quot;</span>);
    res.<span class="hljs-title function_">removeHeader</span>(<span class="hljs-string">&quot;Server&quot;</span>);

    <span class="hljs-title function_">next</span>();
};</code></pre><h4>Headers Applied</h4>
<table>
<thead>
<tr>
<th>Header</th>
<th>Value</th>
<th>Purpose</th>
</tr>
</thead>
<tbody><tr>
<td><code>X-Content-Type-Options</code></td>
<td><code>nosniff</code></td>
<td>Prevents MIME sniffing</td>
</tr>
<tr>
<td><code>X-Frame-Options</code></td>
<td><code>DENY</code></td>
<td>Prevents clickjacking</td>
</tr>
<tr>
<td><code>X-XSS-Protection</code></td>
<td><code>1; mode=block</code></td>
<td>Enables XSS protection</td>
</tr>
<tr>
<td><code>Strict-Transport-Security</code></td>
<td><code>max-age=31536000</code></td>
<td>Forces HTTPS</td>
</tr>
<tr>
<td><code>Content-Security-Policy</code></td>
<td><code>default-src &#39;self&#39;</code></td>
<td>Restricts resource loading</td>
</tr>
</tbody></table>
<hr>
<h3>Logging Middleware</h3>
<p><strong>Location</strong>: <code>/app/middleware/logging.js</code></p>
<p>Logs all incoming requests and outgoing responses.</p>
<h4>Implementation</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> morgan = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;morgan&quot;</span>);

<span class="hljs-comment">// Custom format for detailed logging</span>
<span class="hljs-keyword">const</span> customFormat = <span class="hljs-string">&quot;:method :url :status :response-time ms - :res[content-length]&quot;</span>;

<span class="hljs-comment">// Development logging (detailed)</span>
<span class="hljs-keyword">const</span> developmentLogger = <span class="hljs-title function_">morgan</span>(<span class="hljs-string">&quot;dev&quot;</span>);

<span class="hljs-comment">// Production logging (combined)</span>
<span class="hljs-keyword">const</span> productionLogger = <span class="hljs-title function_">morgan</span>(<span class="hljs-string">&quot;combined&quot;</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;production&quot;</span>
    ? productionLogger
    : developmentLogger;</code></pre><h4>Log Format</h4>
<p><strong>Development</strong>:</p>
<pre><code class="language-">GET /api/vulnerabilities 200 45.123 ms - 2048
POST /api/tickets 201 23.456 ms - 512</code></pre><p><strong>Production</strong> (Combined Log Format):</p>
<pre><code class="language-">192.168.1.1 - - [15/Mar/2024:10:00:00 +0000] &quot;GET /api/vulnerabilities HTTP/1.1&quot; 200 2048 &quot;https://example.com&quot; &quot;Mozilla/5.0&quot;</code></pre><hr>
<h3>Error Handler Middleware</h3>
<p><strong>Location</strong>: <code>/app/middleware/errorHandler.js</code></p>
<p>Centralized error handling for all routes.</p>
<h4>Implementation</h4>
<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">errorHandler</span>(<span class="hljs-params">err, req, res, next</span>) {
    <span class="hljs-comment">// Log error</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error: <span class="hljs-subst">${err.message}</span>`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">stack</span>);

    <span class="hljs-comment">// Determine status code</span>
    <span class="hljs-keyword">const</span> statusCode = err.<span class="hljs-property">statusCode</span> || err.<span class="hljs-property">status</span> || <span class="hljs-number">500</span>;

    <span class="hljs-comment">// Prepare error response</span>
    <span class="hljs-keyword">const</span> errorResponse = {
        <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">error</span>: err.<span class="hljs-property">message</span> || <span class="hljs-string">&quot;Internal Server Error&quot;</span>,
        <span class="hljs-attr">code</span>: err.<span class="hljs-property">code</span> || <span class="hljs-string">&quot;INTERNAL_ERROR&quot;</span>
    };

    <span class="hljs-comment">// Add stack trace in development</span>
    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;development&quot;</span>) {
        errorResponse.<span class="hljs-property">stack</span> = err.<span class="hljs-property">stack</span>;
    }

    <span class="hljs-comment">// Send error response</span>
    res.<span class="hljs-title function_">status</span>(statusCode).<span class="hljs-title function_">json</span>(errorResponse);
};</code></pre><h4>Error Types Handled</h4>
<table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Response</th>
</tr>
</thead>
<tbody><tr>
<td>ValidationError</td>
<td>400</td>
<td>Bad Request with validation details</td>
</tr>
<tr>
<td>UnauthorizedError</td>
<td>401</td>
<td>Unauthorized access</td>
</tr>
<tr>
<td>ForbiddenError</td>
<td>403</td>
<td>Forbidden resource</td>
</tr>
<tr>
<td>NotFoundError</td>
<td>404</td>
<td>Resource not found</td>
</tr>
<tr>
<td>ConflictError</td>
<td>409</td>
<td>Resource conflict</td>
</tr>
<tr>
<td>InternalError</td>
<td>500</td>
<td>Internal server error</td>
</tr>
</tbody></table>
<hr>
<h3>Validation Middleware</h3>
<p><strong>Location</strong>: <code>/app/middleware/validation.js</code></p>
<p>Input validation for request data.</p>
<h4>Implementation</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">ValidationService</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../services/validationService&quot;</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">validationMiddleware</span>(<span class="hljs-params">req, res, next</span>) {
    <span class="hljs-comment">// Skip validation for GET requests</span>
    <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> === <span class="hljs-string">&quot;GET&quot;</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>();
    }

    <span class="hljs-comment">// Validate based on route</span>
    <span class="hljs-keyword">const</span> route = req.<span class="hljs-property">path</span>;

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (route.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;/vulnerabilities&quot;</span>)) {
            <span class="hljs-title class_">ValidationService</span>.<span class="hljs-title function_">validateVulnerability</span>(req.<span class="hljs-property">body</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (route.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;/tickets&quot;</span>)) {
            <span class="hljs-title class_">ValidationService</span>.<span class="hljs-title function_">validateTicket</span>(req.<span class="hljs-property">body</span>);
        }

        <span class="hljs-comment">// Sanitize all input</span>
        req.<span class="hljs-property">body</span> = <span class="hljs-title class_">ValidationService</span>.<span class="hljs-title function_">sanitizeInput</span>(req.<span class="hljs-property">body</span>);

        <span class="hljs-title function_">next</span>();
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-title function_">next</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValidationError</span>(error.<span class="hljs-property">message</span>));
    }
};</code></pre><hr>
<h2>Configuration Modules</h2>
<h3>Database Configuration</h3>
<p><strong>Location</strong>: <code>/app/config/database.js</code></p>
<p>Database connection and initialization settings.</p>
<h4>Configuration</h4>
<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-comment">// Database file location</span>
    <span class="hljs-attr">path</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_PATH</span> || <span class="hljs-string">&quot;./data/hextrackr.db&quot;</span>,

    <span class="hljs-comment">// Connection options</span>
    <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">verbose</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;development&quot;</span>,
        <span class="hljs-attr">fileMustExist</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>
    },

    <span class="hljs-comment">// Pool settings (future enhancement)</span>
    <span class="hljs-attr">pool</span>: {
        <span class="hljs-attr">min</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">max</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">idleTimeoutMillis</span>: <span class="hljs-number">30000</span>
    },

    <span class="hljs-comment">// Backup settings</span>
    <span class="hljs-attr">backup</span>: {
        <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">interval</span>: <span class="hljs-string">&quot;daily&quot;</span>,
        <span class="hljs-attr">retention</span>: <span class="hljs-number">7</span>,
        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;./backups/&quot;</span>
    },

    <span class="hljs-comment">// Migration settings</span>
    <span class="hljs-attr">migrations</span>: {
        <span class="hljs-attr">directory</span>: <span class="hljs-string">&quot;./migrations&quot;</span>,
        <span class="hljs-attr">tableName</span>: <span class="hljs-string">&quot;schema_migrations&quot;</span>
    }
};</code></pre><h4>Environment Variables</h4>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>DB_PATH</code></td>
<td><code>./data/hextrackr.db</code></td>
<td>Database file location</td>
</tr>
<tr>
<td><code>DB_VERBOSE</code></td>
<td><code>false</code></td>
<td>Enable SQL logging</td>
</tr>
<tr>
<td><code>DB_TIMEOUT</code></td>
<td><code>5000</code></td>
<td>Connection timeout (ms)</td>
</tr>
<tr>
<td><code>DB_BACKUP_ENABLED</code></td>
<td><code>true</code></td>
<td>Enable automatic backups</td>
</tr>
</tbody></table>
<hr>
<h3>Middleware Configuration</h3>
<p><strong>Location</strong>: <code>/app/config/middleware.js</code></p>
<p>Centralized middleware configuration.</p>
<h4>Configuration</h4>
<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-comment">// CORS settings</span>
    <span class="hljs-attr">cors</span>: {
        <span class="hljs-attr">origin</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">CORS_ORIGIN</span> || <span class="hljs-string">&quot;*&quot;</span>,
        <span class="hljs-attr">credentials</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">optionsSuccessStatus</span>: <span class="hljs-number">204</span>,
        <span class="hljs-attr">methods</span>: [<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-string">&quot;PUT&quot;</span>, <span class="hljs-string">&quot;DELETE&quot;</span>, <span class="hljs-string">&quot;OPTIONS&quot;</span>],
        <span class="hljs-attr">allowedHeaders</span>: [<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;Authorization&quot;</span>]
    },

    <span class="hljs-comment">// Rate limiting</span>
    <span class="hljs-attr">rateLimit</span>: {
        <span class="hljs-attr">windowMs</span>: <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 15 minutes</span>
        <span class="hljs-attr">max</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// requests per window</span>
        <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;Too many requests from this IP&quot;</span>,
        <span class="hljs-attr">standardHeaders</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">legacyHeaders</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">skip</span>: <span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> {
            <span class="hljs-comment">// Skip rate limiting for health checks</span>
            <span class="hljs-keyword">return</span> req.<span class="hljs-property">path</span> === <span class="hljs-string">&quot;/health&quot;</span>;
        }
    },

    <span class="hljs-comment">// File upload (Multer)</span>
    <span class="hljs-attr">upload</span>: {
        <span class="hljs-attr">dest</span>: <span class="hljs-string">&quot;uploads/&quot;</span>,
        <span class="hljs-attr">limits</span>: {
            <span class="hljs-attr">fileSize</span>: <span class="hljs-number">100</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>, <span class="hljs-comment">// 100MB</span>
            <span class="hljs-attr">files</span>: <span class="hljs-number">1</span>
        },
        <span class="hljs-attr">fileFilter</span>: <span class="hljs-function">(<span class="hljs-params">req, file, cb</span>) =&gt;</span> {
            <span class="hljs-comment">// Only allow CSV files for imports</span>
            <span class="hljs-keyword">if</span> (file.<span class="hljs-property">mimetype</span> === <span class="hljs-string">&quot;text/csv&quot;</span>) {
                <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title function_">cb</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Only CSV files allowed&quot;</span>));
            }
        }
    },

    <span class="hljs-comment">// Compression</span>
    <span class="hljs-attr">compression</span>: {
        <span class="hljs-attr">level</span>: <span class="hljs-number">6</span>,
        <span class="hljs-attr">threshold</span>: <span class="hljs-number">1024</span>,
        <span class="hljs-attr">filter</span>: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
            <span class="hljs-comment">// Don&#x27;t compress responses with this request header</span>
            <span class="hljs-keyword">if</span> (req.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;x-no-compression&quot;</span>]) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-comment">// Use compression filter function</span>
            <span class="hljs-keyword">return</span> compression.<span class="hljs-title function_">filter</span>(req, res);
        }
    },

    <span class="hljs-comment">// JSON parsing</span>
    <span class="hljs-attr">json</span>: {
        <span class="hljs-attr">limit</span>: <span class="hljs-string">&quot;100mb&quot;</span>,
        <span class="hljs-attr">strict</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;application/json&quot;</span>
    },

    <span class="hljs-comment">// URL encoding</span>
    <span class="hljs-attr">urlencoded</span>: {
        <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">limit</span>: <span class="hljs-string">&quot;100mb&quot;</span>,
        <span class="hljs-attr">parameterLimit</span>: <span class="hljs-number">10000</span>
    }
};</code></pre><hr>
<h3>Server Configuration</h3>
<p><strong>Location</strong>: <code>/app/config/server.js</code></p>
<p>Express server and application settings.</p>
<h4>Configuration</h4>
<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-comment">// Server settings</span>
    <span class="hljs-attr">port</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">8080</span>,
    <span class="hljs-attr">host</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">HOST</span> || <span class="hljs-string">&quot;0.0.0.0&quot;</span>,

    <span class="hljs-comment">// Express settings</span>
    <span class="hljs-attr">express</span>: {
        <span class="hljs-attr">trustProxy</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">jsonSpaces</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;development&quot;</span> ? <span class="hljs-number">2</span> : <span class="hljs-number">0</span>,
        <span class="hljs-attr">caseSensitiveRouting</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">strictRouting</span>: <span class="hljs-literal">false</span>
    },

    <span class="hljs-comment">// Static file serving</span>
    <span class="hljs-attr">static</span>: {
        <span class="hljs-attr">root</span>: <span class="hljs-string">&quot;./app/public&quot;</span>,
        <span class="hljs-attr">options</span>: {
            <span class="hljs-attr">index</span>: [<span class="hljs-string">&quot;index.html&quot;</span>],
            <span class="hljs-attr">maxAge</span>: <span class="hljs-string">&quot;1d&quot;</span>,
            <span class="hljs-attr">etag</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">lastModified</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">setHeaders</span>: <span class="hljs-function">(<span class="hljs-params">res, path</span>) =&gt;</span> {
                <span class="hljs-comment">// Cache control for different file types</span>
                <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&quot;.html&quot;</span>)) {
                    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Cache-Control&quot;</span>, <span class="hljs-string">&quot;no-cache&quot;</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&quot;.js&quot;</span>) || path.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&quot;.css&quot;</span>)) {
                    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Cache-Control&quot;</span>, <span class="hljs-string">&quot;public, max-age=86400&quot;</span>);
                }
            }
        }
    },

    <span class="hljs-comment">// Session settings (future enhancement)</span>
    <span class="hljs-attr">session</span>: {
        <span class="hljs-attr">secret</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">SESSION_SECRET</span> || <span class="hljs-string">&quot;change-this-secret&quot;</span>,
        <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">cookie</span>: {
            <span class="hljs-attr">secure</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;production&quot;</span>,
            <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">maxAge</span>: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span> <span class="hljs-comment">// 24 hours</span>
        }
    },

    <span class="hljs-comment">// Monitoring</span>
    <span class="hljs-attr">monitoring</span>: {
        <span class="hljs-attr">healthCheckPath</span>: <span class="hljs-string">&quot;/health&quot;</span>,
        <span class="hljs-attr">metricsPath</span>: <span class="hljs-string">&quot;/metrics&quot;</span>,
        <span class="hljs-attr">readinessPath</span>: <span class="hljs-string">&quot;/ready&quot;</span>,
        <span class="hljs-attr">livenessPath</span>: <span class="hljs-string">&quot;/alive&quot;</span>
    }
};</code></pre><hr>
<h3>WebSocket Configuration</h3>
<p><strong>Location</strong>: <code>/app/config/websocket.js</code></p>
<p>Socket.io WebSocket server configuration.</p>
<h4>Configuration</h4>
<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-comment">// WebSocket server settings</span>
    <span class="hljs-attr">port</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">WS_PORT</span> || <span class="hljs-number">8988</span>,

    <span class="hljs-comment">// Socket.io options</span>
    <span class="hljs-attr">socketIO</span>: {
        <span class="hljs-attr">cors</span>: {
            <span class="hljs-attr">origin</span>: <span class="hljs-string">&quot;*&quot;</span>,
            <span class="hljs-attr">methods</span>: [<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]
        },
        <span class="hljs-attr">transports</span>: [<span class="hljs-string">&quot;websocket&quot;</span>, <span class="hljs-string">&quot;polling&quot;</span>],
        <span class="hljs-attr">pingTimeout</span>: <span class="hljs-number">60000</span>,
        <span class="hljs-attr">pingInterval</span>: <span class="hljs-number">25000</span>,
        <span class="hljs-attr">maxHttpBufferSize</span>: <span class="hljs-number">1e6</span>
    },

    <span class="hljs-comment">// Progress tracking</span>
    <span class="hljs-attr">progress</span>: {
        <span class="hljs-attr">throttleInterval</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// ms between updates</span>
        <span class="hljs-attr">sessionTimeout</span>: <span class="hljs-number">30</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 30 minutes</span>
        <span class="hljs-attr">cleanupInterval</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 5 minutes</span>
        <span class="hljs-attr">maxSessions</span>: <span class="hljs-number">1000</span>
    },

    <span class="hljs-comment">// Event configuration</span>
    <span class="hljs-attr">events</span>: {
        <span class="hljs-attr">connection</span>: <span class="hljs-string">&quot;connection&quot;</span>,
        <span class="hljs-attr">disconnect</span>: <span class="hljs-string">&quot;disconnect&quot;</span>,
        <span class="hljs-attr">importProgress</span>: <span class="hljs-string">&quot;import-progress&quot;</span>,
        <span class="hljs-attr">importComplete</span>: <span class="hljs-string">&quot;import-complete&quot;</span>,
        <span class="hljs-attr">importError</span>: <span class="hljs-string">&quot;import-error&quot;</span>,
        <span class="hljs-attr">sessionCreated</span>: <span class="hljs-string">&quot;session-created&quot;</span>,
        <span class="hljs-attr">sessionCleanup</span>: <span class="hljs-string">&quot;session-cleanup&quot;</span>
    },

    <span class="hljs-comment">// Room configuration</span>
    <span class="hljs-attr">rooms</span>: {
        <span class="hljs-attr">imports</span>: <span class="hljs-string">&quot;import-room&quot;</span>,
        <span class="hljs-attr">monitoring</span>: <span class="hljs-string">&quot;monitoring-room&quot;</span>,
        <span class="hljs-attr">admin</span>: <span class="hljs-string">&quot;admin-room&quot;</span>
    }
};</code></pre><h2>Configuration Loading</h2>
<h3>Environment-based Configuration</h3>
<pre><code class="language-javascript"><span class="hljs-comment">// Load environment-specific config</span>
<span class="hljs-keyword">const</span> env = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> || <span class="hljs-string">&quot;development&quot;</span>;
<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">`./config.<span class="hljs-subst">${env}</span>.js`</span>);

<span class="hljs-comment">// Merge with defaults</span>
<span class="hljs-keyword">const</span> finalConfig = {
    ...defaultConfig,
    ...config
};</code></pre><h3>Configuration Validation</h3>
<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">validateConfig</span>(<span class="hljs-params">config</span>) {
    <span class="hljs-comment">// Check required fields</span>
    <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">database</span>.<span class="hljs-property">path</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Database path is required&quot;</span>);
    }

    <span class="hljs-comment">// Validate port</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">server</span>.<span class="hljs-property">port</span> &lt; <span class="hljs-number">1</span> || config.<span class="hljs-property">server</span>.<span class="hljs-property">port</span> &gt; <span class="hljs-number">65535</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Invalid port number&quot;</span>);
    }

    <span class="hljs-comment">// Validate file size limits</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">middleware</span>.<span class="hljs-property">upload</span>.<span class="hljs-property">limits</span>.<span class="hljs-property">fileSize</span> &gt; <span class="hljs-number">500</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&quot;File size limit exceeds recommended 500MB&quot;</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}</code></pre><h2>Utility Modules</h2>
<h3>PathValidator</h3>
<p><strong>Location</strong>: <code>/app/utils/PathValidator.js</code></p>
<p>Comprehensive path validation and safe file operations.</p>
<h4>Static Methods</h4>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>Returns</th>
</tr>
</thead>
<tbody><tr>
<td><code>validatePath(path)</code></td>
<td>Validates and normalizes path</td>
<td>Safe path string</td>
</tr>
<tr>
<td><code>safeReadFileSync(path, options)</code></td>
<td>Safely reads file</td>
<td>File content</td>
</tr>
<tr>
<td><code>safeWriteFileSync(path, data, options)</code></td>
<td>Safely writes file</td>
<td>Success boolean</td>
</tr>
<tr>
<td><code>safeReaddirSync(path, options)</code></td>
<td>Safely lists directory</td>
<td>File array</td>
</tr>
<tr>
<td><code>safeStatSync(path)</code></td>
<td>Safely gets file stats</td>
<td>Stats object</td>
</tr>
<tr>
<td><code>safeExistsSync(path)</code></td>
<td>Safely checks existence</td>
<td>Boolean</td>
</tr>
<tr>
<td><code>safeUnlinkSync(path)</code></td>
<td>Safely deletes file</td>
<td>Success boolean</td>
</tr>
</tbody></table>
<hr>
<h3>ProgressTracker</h3>
<p><strong>Location</strong>: <code>/app/utils/ProgressTracker.js</code></p>
<p>Session-based progress tracking for long operations.</p>
<h4>Methods</h4>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>Parameters</th>
</tr>
</thead>
<tbody><tr>
<td><code>createSession(metadata)</code></td>
<td>Creates tracking session</td>
<td>Session metadata</td>
</tr>
<tr>
<td><code>createSessionWithId(id, metadata)</code></td>
<td>Creates session with specific ID</td>
<td>ID, metadata</td>
</tr>
<tr>
<td><code>updateProgress(sessionId, progress, message)</code></td>
<td>Updates progress</td>
<td>ID, percentage, message</td>
</tr>
<tr>
<td><code>completeSession(sessionId, result)</code></td>
<td>Marks session complete</td>
<td>ID, result data</td>
</tr>
<tr>
<td><code>errorSession(sessionId, error)</code></td>
<td>Marks session failed</td>
<td>ID, error details</td>
</tr>
<tr>
<td><code>getSession(sessionId)</code></td>
<td>Gets session details</td>
<td>Session ID</td>
</tr>
<tr>
<td><code>cleanupSessions()</code></td>
<td>Removes old sessions</td>
<td>None</td>
</tr>
</tbody></table>
<hr>
<h3>Constants</h3>
<p><strong>Location</strong>: <code>/app/utils/constants.js</code></p>
<p>Application-wide constants and enumerations.</p>
<pre><code class="language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-comment">// Severity levels</span>
    <span class="hljs-attr">SEVERITY</span>: {
        <span class="hljs-attr">CRITICAL</span>: <span class="hljs-string">&quot;Critical&quot;</span>,
        <span class="hljs-attr">HIGH</span>: <span class="hljs-string">&quot;High&quot;</span>,
        <span class="hljs-attr">MEDIUM</span>: <span class="hljs-string">&quot;Medium&quot;</span>,
        <span class="hljs-attr">LOW</span>: <span class="hljs-string">&quot;Low&quot;</span>
    },

    <span class="hljs-comment">// Ticket status</span>
    <span class="hljs-attr">TICKET_STATUS</span>: {
        <span class="hljs-attr">OPEN</span>: <span class="hljs-string">&quot;Open&quot;</span>,
        <span class="hljs-attr">IN_PROGRESS</span>: <span class="hljs-string">&quot;In Progress&quot;</span>,
        <span class="hljs-attr">RESOLVED</span>: <span class="hljs-string">&quot;Resolved&quot;</span>,
        <span class="hljs-attr">CLOSED</span>: <span class="hljs-string">&quot;Closed&quot;</span>
    },

    <span class="hljs-comment">// Import status</span>
    <span class="hljs-attr">IMPORT_STATUS</span>: {
        <span class="hljs-attr">PENDING</span>: <span class="hljs-string">&quot;pending&quot;</span>,
        <span class="hljs-attr">PROCESSING</span>: <span class="hljs-string">&quot;processing&quot;</span>,
        <span class="hljs-attr">COMPLETED</span>: <span class="hljs-string">&quot;completed&quot;</span>,
        <span class="hljs-attr">FAILED</span>: <span class="hljs-string">&quot;failed&quot;</span>
    },

    <span class="hljs-comment">// File types</span>
    <span class="hljs-attr">FILE_TYPES</span>: {
        <span class="hljs-attr">CSV</span>: <span class="hljs-string">&quot;text/csv&quot;</span>,
        <span class="hljs-title class_">JSON</span>: <span class="hljs-string">&quot;application/json&quot;</span>,
        <span class="hljs-attr">XML</span>: <span class="hljs-string">&quot;application/xml&quot;</span>
    },

    <span class="hljs-comment">// API versions</span>
    <span class="hljs-attr">API_VERSION</span>: <span class="hljs-string">&quot;v1&quot;</span>,

    <span class="hljs-comment">// Pagination</span>
    <span class="hljs-attr">DEFAULT_PAGE_SIZE</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">MAX_PAGE_SIZE</span>: <span class="hljs-number">1000</span>,

    <span class="hljs-comment">// Cache TTL (seconds)</span>
    <span class="hljs-attr">CACHE_TTL</span>: {
        <span class="hljs-attr">SHORT</span>: <span class="hljs-number">60</span>,
        <span class="hljs-attr">MEDIUM</span>: <span class="hljs-number">300</span>,
        <span class="hljs-attr">LONG</span>: <span class="hljs-number">3600</span>
    }
};</code></pre><hr>
<h3>Helpers</h3>
<p><strong>Location</strong>: <code>/app/utils/helpers.js</code></p>
<p>Utility functions used throughout the application.</p>
<h4>Key Functions</h4>
<table>
<thead>
<tr>
<th>Function</th>
<th>Purpose</th>
<th>Parameters</th>
<th>Returns</th>
</tr>
</thead>
<tbody><tr>
<td><code>mapVulnerabilityRow(row, importId)</code></td>
<td>Maps CSV to DB schema</td>
<td>CSV row, import ID</td>
<td>Mapped object</td>
</tr>
<tr>
<td><code>generateUniqueKey(vulnerability)</code></td>
<td>Generates dedup key</td>
<td>Vuln object</td>
<td>Unique key string</td>
</tr>
<tr>
<td><code>normalizeHostname(hostname)</code></td>
<td>Normalizes hostname</td>
<td>Hostname string</td>
<td>Normalized string</td>
</tr>
<tr>
<td><code>normalizeIP(ip)</code></td>
<td>Normalizes IP address</td>
<td>IP string</td>
<td>Normalized IP</td>
</tr>
<tr>
<td><code>createDescriptionHash(text)</code></td>
<td>Creates text hash</td>
<td>Description text</td>
<td>Hash string</td>
</tr>
<tr>
<td><code>formatDate(date, format)</code></td>
<td>Formats date</td>
<td>Date, format string</td>
<td>Formatted date</td>
</tr>
<tr>
<td><code>parseCSVDate(dateStr)</code></td>
<td>Parses CSV dates</td>
<td>Date string</td>
<td>Date object</td>
</tr>
<tr>
<td><code>calculateVPRScore(cvss, age, exploited)</code></td>
<td>Calculates VPR</td>
<td>CVSS, age, bool</td>
<td>VPR score</td>
</tr>
</tbody></table>
<h2>Initialization Flow</h2>
<div class="mermaid">sequenceDiagram
    participant Server as server.js
    participant Config as Configuration
    participant MW as Middleware
    participant DB as Database
    participant Routes as Routes

    Server-&gt;&gt;Config: Load configurations
    Config--&gt;&gt;Server: Configuration objects

    Server-&gt;&gt;DB: Initialize database
    DB--&gt;&gt;Server: Database connection

    Server-&gt;&gt;MW: Register middleware
    MW-&gt;&gt;MW: Security headers
    MW-&gt;&gt;MW: CORS
    MW-&gt;&gt;MW: Compression
    MW-&gt;&gt;MW: Body parsing
    MW-&gt;&gt;MW: Logging
    MW-&gt;&gt;MW: Rate limiting
    MW--&gt;&gt;Server: Middleware chain ready

    Server-&gt;&gt;Routes: Mount route handlers
    Routes--&gt;&gt;Server: Routes registered

    Server-&gt;&gt;MW: Register error handler (last)
    MW--&gt;&gt;Server: Error handler ready

    Server-&gt;&gt;Server: Start listening on port</div><h2>Best Practices</h2>
<h3>Middleware Development</h3>
<ol>
<li><strong>Order Matters</strong>: Place middleware in correct order</li>
<li><strong>Error Handling</strong>: Always call <code>next(error)</code> for errors</li>
<li><strong>Async Operations</strong>: Use <code>async/await</code> or promises</li>
<li><strong>Performance</strong>: Keep middleware lightweight</li>
<li><strong>Documentation</strong>: Document side effects</li>
</ol>
<h3>Configuration Management</h3>
<ol>
<li><strong>Environment Variables</strong>: Use for sensitive data</li>
<li><strong>Validation</strong>: Validate all configuration on startup</li>
<li><strong>Defaults</strong>: Provide sensible defaults</li>
<li><strong>Documentation</strong>: Document all configuration options</li>
<li><strong>Type Safety</strong>: Consider using JSON schema</li>
</ol>
<h3>Security Considerations</h3>
<ol>
<li><strong>Input Validation</strong>: Validate all user input</li>
<li><strong>Path Traversal</strong>: Use PathValidator for file operations</li>
<li><strong>Rate Limiting</strong>: Apply to all endpoints</li>
<li><strong>Headers</strong>: Set security headers appropriately</li>
<li><strong>Secrets</strong>: Never commit secrets to repository</li>
</ol>

    <!-- Note: This file is intentionally minimal. The full page scaffold, header, footer, and scripts
             are provided by docs-html/index.html. Content generated using this template will be
             fetched and injected into #content-container by docs-html/js/docs-portal-v2.js. -->
</section>

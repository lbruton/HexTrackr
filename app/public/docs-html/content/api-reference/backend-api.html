<!-- Fragment template for documentation content injected by docs-tabler.js -->
<section class="doc-fragment">
    <h1>Backend API Reference</h1><blockquote>
<p>Complete reference for HexTrackr&#39;s backend architecture, including controllers, services, routes, and server configuration</p>
</blockquote>
<blockquote>
<p><strong>Current Version</strong>: v1.1.6 (see <code>package.json</code> for latest version)</p>
<p>Historical &quot;Since:&quot; annotations throughout this document indicate when features were first introduced.</p>
</blockquote>
<h2>Overview</h2><p>HexTrackr&#39;s backend follows a modular Express.js architecture with clear separation of concerns:</p>
<ul>
<li><strong>Controllers</strong> handle HTTP requests and responses</li>
<li><strong>Services</strong> contain business logic and data access</li>
<li><strong>Routes</strong> define API endpoints and middleware</li>
<li><strong>Server</strong> orchestrates initialization and dependency injection</li>
</ul>
<p>All components use the singleton pattern for consistent state management across the application.</p>
<hr>
<h2 id="controllers">Controllers</h2><p>Controllers handle incoming HTTP requests, validate input, coordinate with services, and return responses. Each controller follows the singleton pattern for dependency injection.</p>
<h3>VulnerabilityController</h3><p><strong>Location:</strong> <code>app/controllers/vulnerabilityController.js</code></p>
<p>The primary controller for vulnerability management, handling everything from CRUD operations to complex CSV imports and statistical analysis.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Full CRUD operations for vulnerability records</li>
<li>CSV import with progress tracking (supports Tenable, Qualys formats)</li>
<li>Real-time statistics and VPR score calculations</li>
<li>Bulk operations for data management</li>
<li>Integration with WebSocket for live updates</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td><code>/api/vulnerabilities/stats</code></td>
<td>Returns comprehensive statistics including severity distribution and trends</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities</code></td>
<td>Lists vulnerabilities with filtering, sorting, and pagination</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/:id</code></td>
<td>Get single vulnerability by ID</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/count</code></td>
<td>Filtered vulnerability counts (HEX-112 Phase 2)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/kev-stats</code></td>
<td>KEV-specific statistics (HEX-112 Phase 2)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/vendor-stats</code></td>
<td>Vendor distribution statistics (HEX-112 Phase 2)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/top-devices</code></td>
<td>Top affected devices by vulnerability count (HEX-112 Phase 2)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/cvss-distribution</code></td>
<td>CVSS score distribution (HEX-112 Phase 2)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/severity-distribution</code></td>
<td>Severity counts by level (HEX-112 Phase 2)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/recent</code></td>
<td>Recent vulnerabilities feed (HEX-112 Phase 2)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/export</code></td>
<td>Streaming CSV export with filters (HEX-112 Phase 2)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/vulnerabilities/last-import</code></td>
<td>Last CSV import date (HEX-240)</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/vulnerabilities</code></td>
<td>Creates new vulnerability record</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/api/vulnerabilities/:id</code></td>
<td>Updates existing vulnerability</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/api/vulnerabilities/:id</code></td>
<td>Deletes specific vulnerability</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/vulnerabilities/bulk-delete</code></td>
<td>Bulk delete vulnerabilities by IDs</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/vulnerabilities/import</code></td>
<td>Imports CSV file with progress tracking</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/api/vulnerabilities/all</code></td>
<td>Clears all vulnerability data</td>
</tr>
</tbody></table>
<p><strong>HEX-112 Pagination Enhancements (Since v1.0.50):</strong></p>
<p>The HEX-112 Phase 2 endpoints enable efficient pagination and statistics calculation without loading all vulnerabilities client-side:</p>
<ul>
<li><strong>Performance</strong>: Reduces client-side data transfer from 30k+ records to targeted results</li>
<li><strong>Filtering</strong>: All endpoints support query parameters for vendor, severity, KEV status</li>
<li><strong>Caching</strong>: Server-side caching reduces database load</li>
<li><strong>Streaming</strong>: Export endpoint streams results for memory efficiency</li>
</ul>
<h3>TicketController</h3><p><strong>Location:</strong> <code>app/controllers/ticketController.js</code></p>
<p>Manages support tickets and associated device tracking with XT# generation and device navigation.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Complete ticket lifecycle management</li>
<li>Device association tracking (stored as JSON)</li>
<li>Status workflow (Open → In Progress → Closed)</li>
<li>Priority-based sorting and filtering</li>
<li>XT# ticket number generation (HEX-196)</li>
<li>Device-based ticket lookup and navigation (HEX-203)</li>
<li>Batch device lookup for performance optimization</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td><code>/api/tickets</code></td>
<td>Lists all tickets with device information</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/tickets/:id</code></td>
<td>Gets specific ticket details</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/tickets/next-xt-number</code></td>
<td>Generate next XT ticket number (HEX-196)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/tickets/by-device/:hostname</code></td>
<td>Get all tickets for specific device (HEX-203)</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/tickets/batch-device-lookup</code></td>
<td>Batch device ticket lookup (HEX-203)</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/tickets</code></td>
<td>Creates new ticket</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/api/tickets/:id</code></td>
<td>Updates ticket information</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/api/tickets/:id/devices</code></td>
<td>Updates associated devices</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/api/tickets/:id</code></td>
<td>Deletes ticket (soft delete with deleted_at)</td>
</tr>
</tbody></table>
<p><strong>XT# Ticket System (Since v1.0.58 - HEX-196):</strong></p>
<ul>
<li><strong>Format</strong>: <code>XT-####</code> (e.g., XT-0001, XT-0042)</li>
<li><strong>Auto-generation</strong>: <code>/next-xt-number</code> returns next available number</li>
<li><strong>Soft Delete</strong>: Deleted tickets preserve XT# to prevent reuse</li>
<li><strong>Purpose</strong>: Provides human-friendly ticket reference for coordination</li>
</ul>
<p><strong>Device Navigation (Since v1.0.60 - HEX-203):</strong></p>
<ul>
<li><strong>Single Device</strong>: <code>/by-device/:hostname</code> returns all tickets for a device</li>
<li><strong>Batch Lookup</strong>: <code>/batch-device-lookup</code> accepts array of hostnames for efficient N+1 query reduction</li>
<li><strong>Performance</strong>: Reduces 100+ individual requests to single SQL query with IN clause</li>
</ul>
<h3>ImportController</h3><p><strong>Location:</strong> <code>app/controllers/importController.js</code><br><strong>Base Paths:</strong> <code>/api/vulnerabilities</code>, <code>/api/import</code></p>
<p>Handles CSV and JSON file imports from vulnerability scanners with lifecycle management and batch processing.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Multi-format CSV support (Tenable, Qualys, Rapid7)</li>
<li>JSON-based import for programmatic uploads</li>
<li>Automatic scan date extraction from filenames</li>
<li>Progress tracking via WebSocket</li>
<li>Staging mode for large files (&gt;10,000 rows)</li>
<li>Duplicate detection and merging</li>
<li>Vulnerability lifecycle management (active, grace_period, resolved)</li>
<li>Import history tracking</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td><code>/api/vulnerabilities/import</code></td>
<td>Standard vulnerability CSV import (primary endpoint)</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/vulnerabilities/import-staging</code></td>
<td>Staged CSV import for large files</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/import/vulnerabilities</code></td>
<td>JSON-based vulnerability import</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/import/tickets</code></td>
<td>JSON-based ticket import</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/import</code></td>
<td>Generic import handler</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/imports</code></td>
<td>Import history with status tracking</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/import/progress/:sessionId</code></td>
<td>Real-time import progress by session ID</td>
</tr>
</tbody></table>
<p><strong>Import Workflow:</strong></p>
<ol>
<li><strong>CSV Upload</strong> - File uploaded to <code>/api/vulnerabilities/import</code> or <code>/import-staging</code></li>
<li><strong>Staging</strong> - Data loaded into <code>vulnerability_staging</code> table for validation</li>
<li><strong>Processing</strong> - Batch processing (1000 records at a time) with deduplication</li>
<li><strong>Lifecycle</strong> - Tracks vulnerability state (active → grace_period → resolved)</li>
<li><strong>Statistics</strong> - Calculates daily totals with VPR aggregation</li>
<li><strong>Progress</strong> - Real-time updates via WebSocket</li>
</ol>
<p><strong>Supported Import Types:</strong></p>
<ul>
<li><strong>CSV</strong>: Tenable, Qualys, Rapid7 formats</li>
<li><strong>JSON</strong>: Programmatic uploads with structured data</li>
</ul>
<h3>BackupController</h3><p><strong>Location:</strong> <code>app/controllers/backupController.js</code></p>
<p>Database backup and restoration management with modern ZIP export capabilities.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Timestamped backup creation</li>
<li>Compression support for large databases</li>
<li>Backup rotation and cleanup</li>
<li>Validation before restoration</li>
<li>ZIP export for data portability (vulnerabilities, tickets, complete backups)</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td><code>/api/backup/create</code></td>
<td>Creates new backup</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/backup/list</code></td>
<td>Lists available backups</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/backup/restore</code></td>
<td>Restores from backup</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/api/backup/:filename</code></td>
<td>Deletes backup file</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/backup/export/vulnerabilities</code></td>
<td>Export vulnerabilities as ZIP archive</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/backup/export/tickets</code></td>
<td>Export tickets as ZIP archive</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/backup/export/all</code></td>
<td>Export complete backup as ZIP archive</td>
</tr>
</tbody></table>
<p><strong>ZIP Export Features:</strong></p>
<ul>
<li><strong>Format</strong>: Standard ZIP archive with JSON/CSV data</li>
<li><strong>Use Cases</strong>: Data portability, external analysis, compliance reporting</li>
<li><strong>Streaming</strong>: Large datasets streamed for memory efficiency</li>
</ul>
<h3>DocsController</h3><p><strong>Location:</strong> <code>app/controllers/docsController.js</code></p>
<p>Serves documentation portal and API documentation.</p>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td><code>/api/docs/stats</code></td>
<td>Documentation coverage statistics</td>
</tr>
</tbody></table>
<h3>KevController</h3><p><strong>Location:</strong> <code>app/controllers/kevController.js</code><br><strong>Since:</strong> v1.0.22</p>
<p>Manages CISA Known Exploited Vulnerabilities (KEV) integration and synchronization.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Automatic daily synchronization with CISA KEV catalog</li>
<li>Conflict detection and resolution for concurrent sync requests</li>
<li>Comprehensive error handling and retry logic</li>
<li>Real-time sync status tracking</li>
<li>Integration with vulnerability matching system</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td><code>/api/kev/sync</code></td>
<td>Trigger manual KEV synchronization from CISA</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/kev/status</code></td>
<td>Get current sync status and statistics</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/kev/check-autosync</code></td>
<td>Check if auto-sync needed based on schedule</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/kev/stats</code></td>
<td>KEV dashboard statistics</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/kev/all</code></td>
<td>Get all KEV vulnerabilities from catalog</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/kev/matched</code></td>
<td>Get matched KEVs in current environment</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/kev/:cveId</code></td>
<td>Get KEV details for specific CVE</td>
</tr>
</tbody></table>
<p><strong>Rate Limiting:</strong></p>
<ul>
<li><code>/sync</code> endpoint: 3 requests per 5 minutes (prevents API abuse)</li>
</ul>
<h3>CiscoController</h3><p><strong>Location:</strong> <code>app/controllers/ciscoController.js</code><br><strong>Since:</strong> v1.0.63</p>
<p>Manages Cisco PSIRT (Product Security Incident Response Team) advisory integration for Cisco device vulnerabilities.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Automatic synchronization with Cisco PSIRT API</li>
<li>CVE-to-advisory matching for Cisco devices</li>
<li>Fix availability tracking and remediation guidance</li>
<li>Sync status monitoring and error handling</li>
<li>Integration with vulnerability classification system</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td><code>/api/cisco/sync</code></td>
<td>Trigger Cisco PSIRT advisory synchronization</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/cisco/status</code></td>
<td>Get sync status and advisory statistics</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/cisco/check-autosync</code></td>
<td>Check if auto-sync needed based on schedule</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/cisco/advisory/:cveId</code></td>
<td>Get Cisco advisory details for specific CVE</td>
</tr>
</tbody></table>
<p><strong>Rate Limiting:</strong></p>
<ul>
<li><code>/sync</code> endpoint: 10 requests per 10 minutes</li>
</ul>
<p><strong>Advisory Integration:</strong></p>
<ul>
<li>Matches CVEs to official Cisco advisories</li>
<li>Provides fix availability status</li>
<li>Links to vendor security bulletins</li>
<li>Tracks affected Cisco product versions</li>
</ul>
<h3>PaloAltoController</h3><p><strong>Location:</strong> <code>app/controllers/paloAltoController.js</code><br><strong>Since:</strong> v1.0.63</p>
<p>Manages Palo Alto Networks security advisory integration for Palo Alto device vulnerabilities.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Automatic synchronization with Palo Alto Security Advisory API</li>
<li>CVE-to-advisory matching for Palo Alto devices</li>
<li>Fix availability tracking and remediation guidance</li>
<li>Sync status monitoring and error handling</li>
<li>Integration with vulnerability classification system</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td><code>/api/palo/sync</code></td>
<td>Trigger Palo Alto advisory synchronization</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/palo/status</code></td>
<td>Get sync status and advisory statistics</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/palo/check-autosync</code></td>
<td>Check if auto-sync needed based on schedule</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/palo/advisory/:cveId</code></td>
<td>Get Palo Alto advisory details for specific CVE</td>
</tr>
</tbody></table>
<p><strong>Rate Limiting:</strong></p>
<ul>
<li><code>/sync</code> endpoint: 10 requests per 10 minutes</li>
</ul>
<p><strong>Advisory Integration:</strong></p>
<ul>
<li>Matches CVEs to official Palo Alto advisories</li>
<li>Provides fix availability status</li>
<li>Links to vendor security bulletins</li>
<li>Tracks affected Palo Alto product versions</li>
</ul>
<h3>AuthController</h3><p><strong>Location:</strong> <code>app/controllers/authController.js</code><br><strong>Since:</strong> v1.0.46</p>
<p>Handles user authentication, session management, and security features including CSRF protection and account lockout.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Argon2id Password Hashing</strong> - Industry-standard secure password storage with timing-safe comparison</li>
<li><strong>Session Management</strong> - SQLite-backed session store with configurable expiration (24h/30d)</li>
<li><strong>Account Lockout Protection</strong> - 5 failed login attempts trigger 15-minute lockout</li>
<li><strong>CSRF Token Generation</strong> - Stateless double-submit cookie pattern for state-changing requests</li>
<li><strong>Profile Management</strong> - User profile retrieval and password change functionality</li>
</ul>
<p><strong>Security Architecture:</strong></p>
<ul>
<li>Passwords hashed with Argon2id (time cost: 2, memory cost: 19MB, parallelism: 1)</li>
<li>Sessions stored in SQLite with automatic cleanup of expired sessions</li>
<li>Failed login attempts tracked per username with automatic expiry</li>
<li>Trust proxy enabled for nginx reverse proxy X-Forwarded-Proto headers</li>
<li>Secure cookies require HTTPS in production</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Auth Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td><code>/api/auth/login</code></td>
<td>❌ Public</td>
<td>Authenticate user with username/password</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/auth/logout</code></td>
<td>✅ Protected</td>
<td>End user session and clear cookies</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/auth/status</code></td>
<td>❌ Public</td>
<td>Check current authentication status</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/auth/csrf</code></td>
<td>❌ Public</td>
<td>Retrieve CSRF token for forms</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/auth/change-password</code></td>
<td>✅ Protected</td>
<td>Update user password (requires current password)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/auth/profile</code></td>
<td>✅ Protected</td>
<td>Get current user profile information</td>
</tr>
</tbody></table>
<p><strong>Login Request Example:</strong></p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">POST</span> /api/auth/login
<span class="hljs-title class_">Content</span>-<span class="hljs-title class_">Type</span>: application/json

{
  <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,
  <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;secure-password&quot;</span>
}</code></pre><p><strong>Login Response (Success):</strong></p>
<pre><code class="language-javascript">{
  <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;user&quot;</span>: {
    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,
    <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;admin@hextrackr.local&quot;</span>,
    <span class="hljs-string">&quot;created_at&quot;</span>: <span class="hljs-string">&quot;2025-10-04T12:00:00.000Z&quot;</span>
  },
  <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Login successful&quot;</span>
}</code></pre><p><strong>Login Response (Account Locked):</strong></p>
<pre><code class="language-javascript">{
  <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Account temporarily locked due to too many failed login attempts. Please try again in 15 minutes.&quot;</span>,
  <span class="hljs-string">&quot;lockoutRemaining&quot;</span>: <span class="hljs-number">892</span> <span class="hljs-comment">// seconds</span>
}</code></pre><p><strong>Status Check Response:</strong></p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">GET</span> /api/auth/status

{
  <span class="hljs-string">&quot;authenticated&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;user&quot;</span>: {
    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,
    <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;admin@hextrackr.local&quot;</span>
  }
}</code></pre><p><strong>Change Password Request:</strong></p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">POST</span> /api/auth/change-password
<span class="hljs-title class_">Content</span>-<span class="hljs-title class_">Type</span>: application/json
X-<span class="hljs-variable constant_">CSRF</span>-<span class="hljs-title class_">Token</span>: &lt;token-<span class="hljs-keyword">from</span>-csrf-endpoint&gt;

{
  <span class="hljs-string">&quot;currentPassword&quot;</span>: <span class="hljs-string">&quot;old-password&quot;</span>,
  <span class="hljs-string">&quot;newPassword&quot;</span>: <span class="hljs-string">&quot;new-secure-password&quot;</span>
}</code></pre><h3>PreferencesController</h3><p><strong>Location:</strong> <code>app/controllers/preferencesController.js</code><br><strong>Since:</strong> v1.0.48</p>
<p>Manages user-specific preferences and application settings with flexible JSON value storage.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>User-scoped preference management (isolated per user)</li>
<li>Flexible JSON value storage for complex data structures</li>
<li>Transaction support for atomic bulk updates</li>
<li>Automatic timestamp tracking (created_at, updated_at)</li>
<li>Validation for preference key format and value structure</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Auth Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td><code>/api/preferences</code></td>
<td>✅ Protected</td>
<td>Get all preferences for current user</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/preferences/:key</code></td>
<td>✅ Protected</td>
<td>Get specific preference by key</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/preferences/count</code></td>
<td>✅ Protected</td>
<td>Get preference count for current user</td>
</tr>
<tr>
<td>HEAD</td>
<td><code>/api/preferences/:key</code></td>
<td>✅ Protected</td>
<td>Check if preference exists (returns 200 or 404)</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/preferences</code></td>
<td>✅ Protected</td>
<td>Create new preference</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/api/preferences/:key</code></td>
<td>✅ Protected</td>
<td>Update existing preference</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/api/preferences/:key</code></td>
<td>✅ Protected</td>
<td>Delete specific preference</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/preferences/bulk</code></td>
<td>✅ Protected</td>
<td>Bulk update multiple preferences (transaction)</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/api/preferences</code></td>
<td>✅ Protected</td>
<td>Delete all user preferences</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/preferences/reset</code></td>
<td>✅ Protected</td>
<td>Reset preferences to defaults</td>
</tr>
</tbody></table>
<p><strong>Preference Object Structure:</strong></p>
<pre><code class="language-javascript">{
  <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,
  <span class="hljs-string">&quot;user_id&quot;</span>: <span class="hljs-number">1</span>,
  <span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-string">&quot;dashboard.theme&quot;</span>,
  <span class="hljs-string">&quot;value&quot;</span>: {<span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;dark&quot;</span>, <span class="hljs-string">&quot;accent&quot;</span>: <span class="hljs-string">&quot;blue&quot;</span>},
  <span class="hljs-string">&quot;created_at&quot;</span>: <span class="hljs-string">&quot;2025-10-04T12:00:00.000Z&quot;</span>,
  <span class="hljs-string">&quot;updated_at&quot;</span>: <span class="hljs-string">&quot;2025-10-04T14:30:00.000Z&quot;</span>
}</code></pre><p><strong>Common Preference Keys:</strong></p>
<ul>
<li><code>dashboard.theme</code> - UI theme settings</li>
<li><code>dashboard.defaultView</code> - Default dashboard view (grid/cards)</li>
<li><code>vulnerabilities.filters</code> - Saved filter configurations</li>
<li><code>notifications.enabled</code> - Notification preferences</li>
<li><code>export.defaultFormat</code> - Default export format</li>
</ul>
<p><strong>Bulk Update Example:</strong></p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">POST</span> /api/preferences/bulk
<span class="hljs-title class_">Content</span>-<span class="hljs-title class_">Type</span>: application/json
X-<span class="hljs-variable constant_">CSRF</span>-<span class="hljs-title class_">Token</span>: &lt;token&gt;

{
  <span class="hljs-string">&quot;preferences&quot;</span>: [
    {<span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-string">&quot;dashboard.theme&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>: {<span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;dark&quot;</span>}},
    {<span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-string">&quot;dashboard.defaultView&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;grid&quot;</span>},
    {<span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-string">&quot;notifications.enabled&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-literal">true</span>}
  ]
}</code></pre><h3>TemplateController</h3><p><strong>Location:</strong> <code>app/controllers/templateController.js</code><br><strong>Since:</strong> v1.0.21</p>
<p>Manages email and ticket templates for consistent communication and ticket creation.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Template CRUD operations for email and ticket templates</li>
<li>Variable substitution system for dynamic content</li>
<li>Template categories (email, ticket, notification)</li>
<li>Version tracking for template changes</li>
<li>Default template management</li>
</ul>
<p><strong>Main Endpoints:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Auth Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td><code>/api/templates</code></td>
<td>✅ Protected</td>
<td>List all templates</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/templates/:id</code></td>
<td>✅ Protected</td>
<td>Get specific template</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/templates/by-name/:name</code></td>
<td>✅ Protected</td>
<td>Get template by name (alternative lookup)</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/templates</code></td>
<td>✅ Protected</td>
<td>Create new template</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/templates/:id/preview</code></td>
<td>✅ Protected</td>
<td>Preview template with data (non-destructive)</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/api/templates/:id</code></td>
<td>✅ Protected</td>
<td>Update template</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/api/templates/:id</code></td>
<td>✅ Protected</td>
<td>Delete template</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/templates/category/:category</code></td>
<td>✅ Protected</td>
<td>Get templates by category</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/templates/:id/render</code></td>
<td>✅ Protected</td>
<td>Render template with variables</td>
</tr>
</tbody></table>
<p><strong>Template Object Structure:</strong></p>
<pre><code class="language-javascript">{
  <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,
  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Critical Vulnerability Alert&quot;</span>,
  <span class="hljs-string">&quot;category&quot;</span>: <span class="hljs-string">&quot;email&quot;</span>,
  <span class="hljs-string">&quot;subject&quot;</span>: <span class="hljs-string">&quot;Critical Vulnerability Detected: {{cve_id}}&quot;</span>,
  <span class="hljs-string">&quot;body&quot;</span>: <span class="hljs-string">&quot;A critical vulnerability has been detected...&quot;</span>,
  <span class="hljs-string">&quot;variables&quot;</span>: [<span class="hljs-string">&quot;cve_id&quot;</span>, <span class="hljs-string">&quot;hostname&quot;</span>, <span class="hljs-string">&quot;severity&quot;</span>],
  <span class="hljs-string">&quot;created_at&quot;</span>: <span class="hljs-string">&quot;2025-10-04T12:00:00.000Z&quot;</span>,
  <span class="hljs-string">&quot;updated_at&quot;</span>: <span class="hljs-string">&quot;2025-10-04T14:30:00.000Z&quot;</span>
}</code></pre><hr>
<h2 id="services">Services</h2><p>Services encapsulate business logic and data access. They are injected into controllers during initialization.</p>
<h3>VulnerabilityService</h3><p><strong>Location:</strong> <code>app/services/vulnerabilityService.js</code></p>
<p>Core service for vulnerability data operations.</p>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Database CRUD operations</li>
<li>CSV parsing and field mapping</li>
<li>Data validation and sanitization</li>
<li>Batch processing for imports</li>
<li>Snapshot creation for historical tracking</li>
</ul>
<p><strong>Key Methods:</strong></p>
<ul>
<li><code>getAll()</code> - Retrieve vulnerabilities with filters</li>
<li><code>getById(id)</code> - Get single vulnerability by ID</li>
<li><code>getCount(filters)</code> - Filtered vulnerability counts (HEX-112)</li>
<li><code>getKevStats(filters)</code> - KEV-specific statistics (HEX-112)</li>
<li><code>getVendorStats(filters)</code> - Vendor distribution statistics (HEX-112)</li>
<li><code>getTopAffectedDevices(filters, limit)</code> - Top devices by vulnerability count (HEX-112)</li>
<li><code>getCvssDistribution(filters)</code> - CVSS score distribution (HEX-112)</li>
<li><code>getSeverityDistribution(filters)</code> - Severity counts by level (HEX-112)</li>
<li><code>getRecentVulnerabilities(filters, limit)</code> - Recent vulnerabilities feed (HEX-112)</li>
<li><code>streamExport(filters)</code> - Streaming CSV export (HEX-112)</li>
<li><code>getLastImportDate()</code> - Last CSV import date (HEX-240)</li>
<li><code>create()</code> - Add new vulnerability</li>
<li><code>update()</code> - Modify existing record</li>
<li><code>delete()</code> - Remove vulnerability</li>
<li><code>bulkDelete(ids)</code> - Bulk delete vulnerabilities by IDs</li>
<li><code>importBatch()</code> - Process CSV data in chunks</li>
<li><code>createSnapshot()</code> - Save point-in-time state</li>
</ul>
<h3>VulnerabilityStatsService</h3><p><strong>Location:</strong> <code>app/services/vulnerabilityStatsService.js</code></p>
<p>Analytics and reporting for vulnerability data.</p>
<p><strong>Capabilities:</strong></p>
<ul>
<li>VPR (Vulnerability Priority Rating) calculation</li>
<li>Severity distribution analysis</li>
<li>Trend analysis over time periods</li>
<li>Top vulnerabilities by risk</li>
<li>Plugin family categorization</li>
<li>Host-based vulnerability grouping</li>
</ul>
<h3>TicketService</h3><p><strong>Location:</strong> <code>app/services/ticketService.js</code></p>
<p>Ticket management and device tracking with XT# generation and device navigation.</p>
<p><strong>Features:</strong></p>
<ul>
<li>Full ticket CRUD operations</li>
<li>Device list management (JSON storage)</li>
<li>Status transition validation</li>
<li>Priority-based operations</li>
<li>Automatic timestamp management</li>
<li>XT# ticket number generation (HEX-196)</li>
<li>Device-based ticket lookup (HEX-203)</li>
<li>Batch device lookup for performance</li>
</ul>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>getAll()</code> - Retrieve all tickets</li>
<li><code>getById(id)</code> - Get specific ticket</li>
<li><code>generateNextXTNumber()</code> - Generate next XT# (HEX-196)</li>
<li><code>getTicketsByDevice(hostname)</code> - Get tickets for device (HEX-203)</li>
<li><code>getTicketsByDeviceBatch(hostnames)</code> - Batch device lookup (HEX-203)</li>
<li><code>create(ticketData)</code> - Create new ticket</li>
<li><code>update(id, ticketData)</code> - Update ticket</li>
<li><code>delete(id)</code> - Soft delete ticket (sets deleted_at)</li>
<li><code>updateDevices(id, devices)</code> - Update device associations</li>
</ul>
<h3>ImportService</h3><p><strong>Location:</strong> <code>app/services/importService.js</code></p>
<p>Vendor CSV import processing with lifecycle management and batch operations.</p>
<p><strong>Capabilities:</strong></p>
<ul>
<li>CSV parsing with PapaParse</li>
<li>Field mapping and transformation</li>
<li>Data type conversion and validation</li>
<li>Batch processing with configurable size (1000 records)</li>
<li>Vulnerability lifecycle management (active, grace_period, resolved)</li>
<li>Deduplication using hostname and plugin_id</li>
<li>Daily totals calculation with VPR aggregation</li>
<li>Staging table for atomic imports</li>
<li>Progress tracking with WebSocket integration</li>
<li>Multi-vendor support (Tenable, Cisco, Qualys)</li>
</ul>
<p><strong>Key Functions:</strong></p>
<ul>
<li><code>processStagingToFinalTables()</code> - Batch processes staged data to production tables</li>
<li><code>calculateAndStoreDailyTotalsEnhanced()</code> - Calculates per-scan-date statistics with VPR</li>
<li><code>bulkLoadToStagingTable()</code> - High-performance bulk import to staging</li>
<li><code>extractDateFromFilename()</code> - Smart date extraction from various filename formats</li>
</ul>
<h3>BackupService</h3><p><strong>Location:</strong> <code>app/services/backupService.js</code></p>
<p>Database backup and restore operations.</p>
<p><strong>Features:</strong></p>
<ul>
<li>SQLite database copying</li>
<li>Timestamp-based naming</li>
<li>Compression with zlib</li>
<li>Integrity validation</li>
<li>Restore rollback on failure</li>
</ul>
<h3>ProgressService</h3><p><strong>Location:</strong> <code>app/services/progressService.js</code></p>
<p>Real-time progress tracking for long operations.</p>
<p><strong>Features:</strong></p>
<ul>
<li>Operation registration and tracking</li>
<li>Percentage calculation</li>
<li>ETA estimation</li>
<li>WebSocket event emission</li>
<li>Multi-operation support</li>
</ul>
<h3>DatabaseService</h3><p><strong>Location:</strong> <code>app/services/databaseService.js</code></p>
<p>Database connection and query management.</p>
<p><strong>Responsibilities:</strong></p>
<ul>
<li>Connection pooling</li>
<li>Query execution</li>
<li>Transaction management</li>
<li>Schema migrations</li>
<li>Error handling and retry logic</li>
</ul>
<h3>ValidationService</h3><p><strong>Location:</strong> <code>app/services/validationService.js</code></p>
<p>Input validation and sanitization.</p>
<p><strong>Security Features:</strong></p>
<ul>
<li>SQL injection prevention</li>
<li>XSS protection</li>
<li>Path traversal blocking</li>
<li>Type validation</li>
<li>Range checking</li>
</ul>
<h3>FileService</h3><p><strong>Location:</strong> <code>app/services/fileService.js</code></p>
<p>Secure file operations.</p>
<p><strong>Features:</strong></p>
<ul>
<li>Upload handling with Multer</li>
<li>File type verification</li>
<li>Size limit enforcement</li>
<li>Temporary file cleanup</li>
<li>Path validation</li>
</ul>
<h3>CacheService</h3><p><strong>Location:</strong> <code>app/services/cacheService.js</code><br><strong>Since:</strong> v1.0.42</p>
<p>Multi-tier caching service for optimizing API response times and reducing database load.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Three specialized cache zones with independent TTL configurations</li>
<li>Server-side caching (NodeCache) with configurable expiration</li>
<li>Browser cache control via HTTP headers</li>
<li>Cache hit/miss tracking for monitoring</li>
<li>Automatic cache invalidation on data changes</li>
<li>Clone-based storage to prevent cache mutations</li>
</ul>
<p><strong>Cache Zones:</strong></p>
<table>
<thead>
<tr>
<th>Zone</th>
<th>TTL</th>
<th>Use Case</th>
<th>Max Keys</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Stats Cache</strong></td>
<td>5 minutes</td>
<td>Severity counts, VPR totals, dashboard statistics</td>
<td>100</td>
</tr>
<tr>
<td><strong>Trends Cache</strong></td>
<td>10 minutes</td>
<td>Historical data, dashboard cards, trend analysis</td>
<td>100</td>
</tr>
<tr>
<td><strong>Vulnerability Cache</strong></td>
<td>10 minutes</td>
<td>Full vulnerability lists, device statistics</td>
<td>50</td>
</tr>
</tbody></table>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>withCaching(res, cacheType, cacheKey, serverTTL, handler, browserTTL)</code> - Universal caching wrapper for route handlers</li>
<li><code>getStats(key)</code> / <code>setStats(key, value, ttl)</code> - Stats cache operations</li>
<li><code>getTrends(key)</code> / <code>setTrends(key, value, ttl)</code> - Trends cache operations</li>
<li><code>getVulnerabilities(key)</code> / <code>setVulnerabilities(key, value, ttl)</code> - Vulnerability cache operations</li>
<li><code>invalidate(zone)</code> - Clear specific cache zone on data changes</li>
<li><code>getCacheStats()</code> - Retrieve hit/miss statistics for monitoring</li>
</ul>
<p><strong>Usage Example:</strong></p>
<pre><code class="language-javascript"><span class="hljs-comment">// In controller route handler</span>
<span class="hljs-keyword">await</span> cacheService.<span class="hljs-title function_">withCaching</span>(res, <span class="hljs-string">&quot;stats&quot;</span>, <span class="hljs-string">&quot;device_statistics&quot;</span>, <span class="hljs-number">300</span>, <span class="hljs-title function_">async</span> () =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> vulnerabilityService.<span class="hljs-title function_">getDeviceStatistics</span>();
}, <span class="hljs-number">60</span>); <span class="hljs-comment">// Server: 5min, Browser: 60s</span></code></pre><p><strong>Cache Headers:</strong></p>
<ul>
<li><code>X-Cache: HIT</code> - Response served from cache</li>
<li><code>X-Cache: MISS</code> - Response generated fresh, now cached</li>
<li><code>Cache-Control: public, max-age=&lt;browserTTL&gt;, must-revalidate</code> - Browser caching directive</li>
</ul>
<h3>KevService</h3><p><strong>Location:</strong> <code>app/services/kevService.js</code><br><strong>Since:</strong> v1.0.22</p>
<p>CISA Known Exploited Vulnerabilities data management and synchronization.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Daily automatic synchronization with CISA KEV API</li>
<li>CVE-based vulnerability matching and flagging</li>
<li>Sync status tracking and error handling</li>
<li>Local KEV catalog caching for performance</li>
<li>Integration with vulnerability database</li>
</ul>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>syncKevData()</code> - Fetch and process CISA KEV catalog</li>
<li><code>getSyncStatus()</code> - Current synchronization status</li>
<li><code>getKevByCve(cveId)</code> - Retrieve KEV details for specific CVE</li>
<li><code>matchVulnerabilities()</code> - Update vulnerability KEV flags</li>
<li><code>scheduleAutoSync()</code> - Configure automatic sync intervals</li>
</ul>
<h3>AuthService</h3><p><strong>Location:</strong> <code>app/services/authService.js</code><br><strong>Since:</strong> v1.0.46</p>
<p>Core authentication logic including password verification, session management, and account security.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Argon2id Password Hashing</strong> - Time cost: 2, Memory cost: 19456KB, Parallelism: 1</li>
<li><strong>Timing-Safe Password Comparison</strong> - Prevents timing attacks during verification</li>
<li><strong>Failed Login Tracking</strong> - In-memory store with automatic expiry (15 minutes)</li>
<li><strong>Account Lockout Management</strong> - 5 attempts trigger 15-minute lockout</li>
<li><strong>Session Lifecycle</strong> - Creation, validation, destruction with configurable TTL</li>
</ul>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>verifyPassword(username, password)</code> - Authenticate user credentials with lockout check</li>
<li><code>hashPassword(password)</code> - Generate Argon2id hash for new passwords</li>
<li><code>createSession(userId, username)</code> - Initialize user session</li>
<li><code>validateSession(sessionId)</code> - Verify active session</li>
<li><code>destroySession(sessionId)</code> - End user session</li>
<li><code>checkAccountLockout(username)</code> - Verify if account is locked</li>
<li><code>recordFailedLogin(username)</code> - Increment failed login counter</li>
<li><code>resetFailedLogins(username)</code> - Clear failed login tracking on success</li>
</ul>
<p><strong>Security Configuration:</strong></p>
<pre><code class="language-javascript"><span class="hljs-comment">// Argon2id parameters</span>
{
  <span class="hljs-attr">type</span>: argon2.<span class="hljs-property">argon2id</span>,
  <span class="hljs-attr">timeCost</span>: <span class="hljs-number">2</span>,        <span class="hljs-comment">// Number of iterations</span>
  <span class="hljs-attr">memoryCost</span>: <span class="hljs-number">19456</span>,  <span class="hljs-comment">// Memory in KB (19MB)</span>
  <span class="hljs-attr">parallelism</span>: <span class="hljs-number">1</span>,     <span class="hljs-comment">// Number of threads</span>
  <span class="hljs-attr">hashLength</span>: <span class="hljs-number">32</span>      <span class="hljs-comment">// Output hash length</span>
}

<span class="hljs-comment">// Account lockout policy</span>
{
  <span class="hljs-attr">maxAttempts</span>: <span class="hljs-number">5</span>,
  <span class="hljs-attr">lockoutDuration</span>: <span class="hljs-number">900000</span>  <span class="hljs-comment">// 15 minutes in ms</span>
}</code></pre><p><strong>Failed Login Tracking:</strong></p>
<pre><code class="language-javascript">{
  <span class="hljs-attr">username</span>: {
    <span class="hljs-attr">attempts</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">firstAttempt</span>: <span class="hljs-number">1696435200000</span>,
    <span class="hljs-attr">lastAttempt</span>: <span class="hljs-number">1696435260000</span>
  }
}</code></pre><h3>PreferencesService</h3><p><strong>Location:</strong> <code>app/services/preferencesService.js</code><br><strong>Since:</strong> v1.0.48</p>
<p>User preference management with flexible JSON value storage and transaction support.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>User-scoped preference isolation (each user has independent preferences)</li>
<li>JSON value serialization/deserialization for complex data structures</li>
<li>Transaction support for atomic bulk updates</li>
<li>Automatic timestamp management (created_at, updated_at)</li>
<li>Key validation and sanitization</li>
</ul>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>getUserPreferences(userId)</code> - Retrieve all preferences for user</li>
<li><code>getPreference(userId, key)</code> - Get specific preference value</li>
<li><code>setPreference(userId, key, value)</code> - Create or update preference</li>
<li><code>deletePreference(userId, key)</code> - Remove specific preference</li>
<li><code>bulkUpdatePreferences(userId, preferences)</code> - Atomic multi-preference update (transaction)</li>
<li><code>resetToDefaults(userId)</code> - Clear all preferences and restore defaults</li>
<li><code>validatePreferenceKey(key)</code> - Ensure key follows naming convention</li>
</ul>
<p><strong>Transaction Pattern:</strong></p>
<pre><code class="language-javascript"><span class="hljs-comment">// Bulk update uses SQLite transaction for atomicity</span>
db.<span class="hljs-title function_">transaction</span>(<span class="hljs-function">() =&gt;</span> {
  preferences.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">{key, value}</span>) =&gt;</span> {
    db.<span class="hljs-title function_">prepare</span>(<span class="hljs-string">&#x27;INSERT OR REPLACE INTO preferences...&#x27;</span>).<span class="hljs-title function_">run</span>(userId, key, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));
  });
});</code></pre><h3>DocsService</h3><p><strong>Location:</strong> <code>app/services/docsService.js</code><br><strong>Since:</strong> v1.0.38</p>
<p>Documentation statistics and coverage analysis.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>JSDoc coverage calculation</li>
<li>File type distribution analysis</li>
<li>Documentation completeness metrics</li>
<li>API endpoint inventory</li>
</ul>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>getDocumentationStats()</code> - Calculate comprehensive documentation metrics</li>
<li><code>analyzeJSDocCoverage()</code> - Determine percentage of documented functions</li>
<li><code>getFileTypeCounts()</code> - Breakdown of file types in codebase</li>
<li><code>getEndpointInventory()</code> - List all API routes with documentation status</li>
</ul>
<h3>CiscoAdvisoryService</h3><p><strong>Location:</strong> <code>app/services/ciscoAdvisoryService.js</code><br><strong>Since:</strong> v1.0.63</p>
<p>Cisco PSIRT API integration for security advisory synchronization and CVE matching.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Cisco PSIRT API client with authentication</li>
<li>CVE-to-advisory matching for Cisco devices</li>
<li>Advisory database management (cisco_advisories table)</li>
<li>Sync status tracking and error handling</li>
<li>Fix availability determination</li>
</ul>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>syncAdvisories()</code> - Fetch latest advisories from Cisco PSIRT API</li>
<li><code>getAdvisoryByCve(cveId)</code> - Retrieve Cisco advisory for specific CVE</li>
<li><code>getSyncStatus()</code> - Current sync status and statistics</li>
<li><code>matchVulnerabilities()</code> - Update vulnerability records with Cisco advisory IDs</li>
<li><code>checkAutoSync()</code> - Determine if auto-sync is needed based on schedule</li>
</ul>
<p><strong>API Integration:</strong></p>
<ul>
<li><strong>Endpoint</strong>: Cisco PSIRT OpenVuln API</li>
<li><strong>Authentication</strong>: OAuth 2.0 client credentials</li>
<li><strong>Rate Limiting</strong>: 10 requests per 10 minutes</li>
<li><strong>Data Format</strong>: JSON responses with advisory metadata</li>
</ul>
<h3>PaloAltoService</h3><p><strong>Location:</strong> <code>app/services/paloAltoService.js</code><br><strong>Since:</strong> v1.0.63</p>
<p>Palo Alto Networks Security Advisory API integration for vulnerability tracking.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Palo Alto Security Advisory API client</li>
<li>CVE-to-advisory matching for Palo Alto devices</li>
<li>Advisory database management (palo_advisories table)</li>
<li>Sync status tracking and error handling</li>
<li>Fix availability determination</li>
</ul>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>syncAdvisories()</code> - Fetch latest advisories from Palo Alto API</li>
<li><code>getAdvisoryByCve(cveId)</code> - Retrieve Palo Alto advisory for specific CVE</li>
<li><code>getSyncStatus()</code> - Current sync status and statistics</li>
<li><code>matchVulnerabilities()</code> - Update vulnerability records with Palo Alto advisory IDs</li>
<li><code>checkAutoSync()</code> - Determine if auto-sync is needed based on schedule</li>
</ul>
<p><strong>API Integration:</strong></p>
<ul>
<li><strong>Endpoint</strong>: Palo Alto Security Advisory API</li>
<li><strong>Rate Limiting</strong>: 10 requests per 10 minutes</li>
<li><strong>Data Format</strong>: JSON responses with advisory metadata</li>
</ul>
<hr>
<h2 id="routes">Routes</h2><p>Route modules define API endpoints and apply middleware.</p>
<h3>Vulnerability Routes</h3><p><strong>File:</strong> <code>app/routes/vulnerabilities.js</code><br><strong>Base Path:</strong> <code>/api/vulnerabilities</code></p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">GET</span>    /stats                 <span class="hljs-comment">// Statistics dashboard data (supports vendor filtering)</span>
<span class="hljs-variable constant_">GET</span>    /recent-trends         <span class="hljs-comment">// Historical vulnerability trends (supports vendor filtering)</span>
<span class="hljs-variable constant_">GET</span>    /                      <span class="hljs-comment">// List vulnerabilities</span>
<span class="hljs-variable constant_">POST</span>   /                      <span class="hljs-comment">// Create vulnerability</span>
<span class="hljs-variable constant_">PUT</span>    /:id                   <span class="hljs-comment">// Update vulnerability</span>
<span class="hljs-variable constant_">DELETE</span> /:id                   <span class="hljs-comment">// Delete vulnerability</span>
<span class="hljs-variable constant_">POST</span>   /<span class="hljs-keyword">import</span>                <span class="hljs-comment">// Import CSV</span>
<span class="hljs-variable constant_">POST</span>   /<span class="hljs-keyword">import</span>/staging        <span class="hljs-comment">// Staged import</span>
<span class="hljs-variable constant_">GET</span>    /<span class="hljs-keyword">import</span>/progress/:id   <span class="hljs-comment">// Import progress</span>
<span class="hljs-variable constant_">DELETE</span> /all                   <span class="hljs-comment">// Clear all data</span></code></pre><p><strong>Vendor Filtering (Since v1.0.53):</strong></p>
<p>The <code>/stats</code> and <code>/recent-trends</code> endpoints support vendor-based filtering via query parameter:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Get statistics for all vendors (default)</span>
<span class="hljs-variable constant_">GET</span> /api/vulnerabilities/stats

<span class="hljs-comment">// Get statistics for Cisco devices only</span>
<span class="hljs-variable constant_">GET</span> /api/vulnerabilities/stats?vendor=<span class="hljs-variable constant_">CISCO</span>

<span class="hljs-comment">// Get statistics for Palo Alto devices</span>
<span class="hljs-variable constant_">GET</span> /api/vulnerabilities/stats?vendor=<span class="hljs-title class_">Palo</span>%20Alto

<span class="hljs-comment">// Get statistics for other vendors</span>
<span class="hljs-variable constant_">GET</span> /api/vulnerabilities/stats?vendor=<span class="hljs-title class_">Other</span></code></pre><p><strong>Vendor Values:</strong></p>
<ul>
<li>`` (empty) - All vendors (default)</li>
<li><code>CISCO</code> - Cisco Systems devices</li>
<li><code>Palo Alto</code> - Palo Alto Networks devices</li>
<li><code>Other</code> - All other vendors</li>
</ul>
<p><strong>Response Format (with vendor filter):</strong></p>
<pre><code class="language-javascript">{
  <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;stats&quot;</span>: {
    <span class="hljs-string">&quot;vendor&quot;</span>: <span class="hljs-string">&quot;CISCO&quot;</span>,  <span class="hljs-comment">// null if no filter applied</span>
    <span class="hljs-string">&quot;total&quot;</span>: <span class="hljs-number">1245</span>,
    <span class="hljs-string">&quot;vprTotal&quot;</span>: <span class="hljs-number">8934.5</span>,
    <span class="hljs-string">&quot;severityCounts&quot;</span>: {
      <span class="hljs-string">&quot;Critical&quot;</span>: <span class="hljs-number">45</span>,
      <span class="hljs-string">&quot;High&quot;</span>: <span class="hljs-number">234</span>,
      <span class="hljs-string">&quot;Medium&quot;</span>: <span class="hljs-number">456</span>,
      <span class="hljs-string">&quot;Low&quot;</span>: <span class="hljs-number">510</span>
    },
    <span class="hljs-string">&quot;hasKev&quot;</span>: <span class="hljs-number">12</span>
  }
}</code></pre><h3>Ticket Routes</h3><p><strong>File:</strong> <code>app/routes/tickets.js</code><br><strong>Base Path:</strong> <code>/api/tickets</code></p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">GET</span>    /                      <span class="hljs-comment">// List tickets</span>
<span class="hljs-variable constant_">GET</span>    /:id                   <span class="hljs-comment">// Get ticket</span>
<span class="hljs-variable constant_">POST</span>   /                      <span class="hljs-comment">// Create ticket</span>
<span class="hljs-variable constant_">PUT</span>    /:id                   <span class="hljs-comment">// Update ticket</span>
<span class="hljs-variable constant_">PUT</span>    /:id/devices           <span class="hljs-comment">// Update devices</span>
<span class="hljs-variable constant_">DELETE</span> /:id                   <span class="hljs-comment">// Delete ticket</span></code></pre><h3>Import Routes</h3><p><strong>File:</strong> <code>app/routes/imports.js</code><br><strong>Base Path:</strong> <code>/api/import</code></p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">POST</span>   /vulnerabilities       <span class="hljs-comment">// Import vulnerabilities</span>
<span class="hljs-variable constant_">GET</span>    /progress/:id          <span class="hljs-comment">// Check progress</span></code></pre><h3>Backup Routes</h3><p><strong>File:</strong> <code>app/routes/backup.js</code><br><strong>Base Path:</strong> <code>/api/backup</code></p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">POST</span>   /create                <span class="hljs-comment">// Create backup</span>
<span class="hljs-variable constant_">GET</span>    /list                  <span class="hljs-comment">// List backups</span>
<span class="hljs-variable constant_">POST</span>   /restore               <span class="hljs-comment">// Restore backup</span>
<span class="hljs-variable constant_">DELETE</span> /:filename             <span class="hljs-comment">// Delete backup</span></code></pre><h3>KEV Routes</h3><p><strong>File:</strong> <code>app/routes/kev.js</code><br><strong>Base Path:</strong> <code>/api/kev</code><br><strong>Since:</strong> v1.0.22</p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">POST</span>   /sync                  <span class="hljs-comment">// Manual KEV synchronization</span>
<span class="hljs-variable constant_">GET</span>    /status                <span class="hljs-comment">// Sync status and statistics</span>
<span class="hljs-variable constant_">GET</span>    /vulnerability/:cveId  <span class="hljs-comment">// KEV details for specific CVE</span></code></pre><h3>Authentication Routes</h3><p><strong>File:</strong> <code>app/routes/auth.js</code><br><strong>Base Path:</strong> <code>/api/auth</code><br><strong>Since:</strong> v1.0.46</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Public endpoints (no authentication required)</span>
<span class="hljs-variable constant_">POST</span>   /login                 <span class="hljs-comment">// User login with username/password</span>
<span class="hljs-variable constant_">GET</span>    /status                <span class="hljs-comment">// Check authentication status</span>
<span class="hljs-variable constant_">GET</span>    /csrf                  <span class="hljs-comment">// Get CSRF token for forms</span>

<span class="hljs-comment">// Protected endpoints (require authentication)</span>
<span class="hljs-variable constant_">POST</span>   /logout                <span class="hljs-comment">// User logout (clears session)</span>
<span class="hljs-variable constant_">POST</span>   /change-password       <span class="hljs-comment">// Update user password</span>
<span class="hljs-variable constant_">GET</span>    /profile               <span class="hljs-comment">// Get current user profile</span></code></pre><p><strong>Middleware:</strong></p>
<ul>
<li><code>requireAuth</code> applied to <code>/logout</code>, <code>/change-password</code>, <code>/profile</code></li>
<li>CSRF validation required for all POST requests except <code>/login</code></li>
</ul>
<h3>Preferences Routes</h3><p><strong>File:</strong> <code>app/routes/preferences.js</code><br><strong>Base Path:</strong> <code>/api/preferences</code><br><strong>Since:</strong> v1.0.48<br><strong>Authentication:</strong> All endpoints require <code>requireAuth</code> middleware</p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">GET</span>    /                      <span class="hljs-comment">// Get all user preferences</span>
<span class="hljs-variable constant_">GET</span>    /:key                  <span class="hljs-comment">// Get specific preference</span>
<span class="hljs-variable constant_">POST</span>   /                      <span class="hljs-comment">// Create new preference</span>
<span class="hljs-variable constant_">PUT</span>    /:key                  <span class="hljs-comment">// Update existing preference</span>
<span class="hljs-variable constant_">DELETE</span> /:key                  <span class="hljs-comment">// Delete specific preference</span>
<span class="hljs-variable constant_">POST</span>   /bulk                  <span class="hljs-comment">// Bulk update preferences (transaction)</span>
<span class="hljs-variable constant_">DELETE</span> /                      <span class="hljs-comment">// Delete all user preferences</span>
<span class="hljs-variable constant_">POST</span>   /reset                 <span class="hljs-comment">// Reset to default preferences</span></code></pre><p><strong>CSRF Protection:</strong> All state-changing operations (POST, PUT, DELETE) require valid CSRF token</p>
<h3>Template Routes</h3><p><strong>File:</strong> <code>app/routes/templates.js</code><br><strong>Base Path:</strong> <code>/api/templates</code><br><strong>Since:</strong> v1.0.21<br><strong>Authentication:</strong> All endpoints require <code>requireAuth</code> middleware</p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">GET</span>    /                      <span class="hljs-comment">// List all templates</span>
<span class="hljs-variable constant_">GET</span>    /:id                   <span class="hljs-comment">// Get specific template</span>
<span class="hljs-variable constant_">POST</span>   /                      <span class="hljs-comment">// Create new template</span>
<span class="hljs-variable constant_">PUT</span>    /:id                   <span class="hljs-comment">// Update template</span>
<span class="hljs-variable constant_">DELETE</span> /:id                   <span class="hljs-comment">// Delete template</span>
<span class="hljs-variable constant_">GET</span>    /category/:category    <span class="hljs-comment">// Get templates by category</span>
<span class="hljs-variable constant_">POST</span>   /:id/render            <span class="hljs-comment">// Render template with variables</span></code></pre><p><strong>CSRF Protection:</strong> All state-changing operations require valid CSRF token</p>
<h3>Device Routes</h3><p><strong>File:</strong> <code>app/routes/devices.js</code><br><strong>Base Path:</strong> <code>/api/devices</code><br><strong>Since:</strong> v1.0.42</p>
<pre><code class="language-javascript"><span class="hljs-variable constant_">GET</span>    /stats                 <span class="hljs-comment">// Aggregated device statistics with vulnerability counts</span></code></pre><p><strong>Device Statistics Response Format:</strong></p>
<pre><code class="language-javascript">{
  <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">devices</span>: [
    {
      <span class="hljs-attr">hostname</span>: <span class="hljs-string">&quot;server01&quot;</span>,
      <span class="hljs-attr">totalVulnerabilities</span>: <span class="hljs-number">245</span>,
      <span class="hljs-attr">totalVpr</span>: <span class="hljs-number">1234.5</span>,
      <span class="hljs-attr">severityCounts</span>: { <span class="hljs-title class_">Critical</span>: <span class="hljs-number">12</span>, <span class="hljs-title class_">High</span>: <span class="hljs-number">45</span>, <span class="hljs-title class_">Medium</span>: <span class="hljs-number">88</span>, <span class="hljs-title class_">Low</span>: <span class="hljs-number">100</span> },
      <span class="hljs-attr">hasKev</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-comment">// ... more devices</span>
  ],
  <span class="hljs-attr">count</span>: <span class="hljs-number">42</span>
}</code></pre><p><strong>Purpose:</strong> Replaces client-side device processing that required loading all 30k+ vulnerabilities. Provides pre-calculated device statistics for efficient device card rendering. Server-side aggregation reduces client memory usage and improves performance.</p>
<p><strong>Caching:</strong></p>
<ul>
<li>Server cache: 5 minutes (300s) via CacheService stats zone</li>
<li>Browser cache: 60 seconds via Cache-Control headers</li>
<li>Cache headers: <code>X-Cache: HIT/MISS</code> for monitoring</li>
</ul>
<hr>
<h2 id="server">Server Configuration</h2><h3>Main Server</h3><p><strong>File:</strong> <code>app/public/server.js</code></p>
<p>The main server file orchestrates the entire application using a modular initialization sequence.</p>
<p><strong>Initialization Order:</strong></p>
<ol>
<li>Environment configuration loading</li>
<li>Database connection establishment</li>
<li>Controller initialization with dependencies</li>
<li>Service layer configuration</li>
<li>Route registration</li>
<li>WebSocket server setup</li>
<li>Static file serving</li>
<li>Error handling middleware</li>
</ol>
<p><strong>Core Configuration:</strong></p>
<pre><code class="language-javascript"><span class="hljs-comment">// Server settings</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">8080</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">HOST</span> = <span class="hljs-string">&quot;0.0.0.0&quot;</span>;

<span class="hljs-comment">// Security middleware</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">helmet</span>());
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">compression</span>());
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">limit</span>: <span class="hljs-string">&quot;50mb&quot;</span> }));

<span class="hljs-comment">// CORS configuration</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>({
    <span class="hljs-attr">origin</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ALLOWED_ORIGINS</span>?.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;,&quot;</span>) || [<span class="hljs-string">&quot;http://localhost:8080&quot;</span>],
    <span class="hljs-attr">credentials</span>: <span class="hljs-literal">true</span>
}));

<span class="hljs-comment">// Rate limiting</span>
<span class="hljs-keyword">const</span> limiter = <span class="hljs-title function_">rateLimit</span>({
    <span class="hljs-attr">windowMs</span>: <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 15 minutes</span>
    <span class="hljs-attr">max</span>: <span class="hljs-number">100</span> <span class="hljs-comment">// limit each IP to 100 requests</span>
});</code></pre><h3>WebSocket Integration</h3><p>Real-time communication for progress updates and live data.</p>
<p><strong>Events:</strong></p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Direction</th>
<th>Purpose</th>
</tr>
</thead>
<tbody><tr>
<td><code>import-progress</code></td>
<td>Server→Client</td>
<td>Import progress updates</td>
</tr>
<tr>
<td><code>vulnerability-added</code></td>
<td>Server→Client</td>
<td>New vulnerability notification</td>
</tr>
<tr>
<td><code>operation-complete</code></td>
<td>Server→Client</td>
<td>Operation completion</td>
</tr>
<tr>
<td><code>error</code></td>
<td>Server→Client</td>
<td>Error notifications</td>
</tr>
</tbody></table>
<hr>
<h2 id="database">Database Schema</h2><h3>Tables</h3><h4>vulnerabilities</h4><p>Primary table for vulnerability data with vendor classification and advisory integration.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Auto-incrementing ID</td>
</tr>
<tr>
<td>plugin_id</td>
<td>TEXT</td>
<td>Scanner plugin identifier</td>
</tr>
<tr>
<td>cve</td>
<td>TEXT</td>
<td>CVE identifier</td>
</tr>
<tr>
<td>cvss</td>
<td>REAL</td>
<td>CVSS score</td>
</tr>
<tr>
<td>risk</td>
<td>TEXT</td>
<td>Risk level (Critical/High/Medium/Low)</td>
</tr>
<tr>
<td>host</td>
<td>TEXT</td>
<td>Affected host</td>
</tr>
<tr>
<td>protocol</td>
<td>TEXT</td>
<td>Network protocol</td>
</tr>
<tr>
<td>port</td>
<td>INTEGER</td>
<td>Port number</td>
</tr>
<tr>
<td>name</td>
<td>TEXT</td>
<td>Vulnerability name</td>
</tr>
<tr>
<td>synopsis</td>
<td>TEXT</td>
<td>Brief description</td>
</tr>
<tr>
<td>description</td>
<td>TEXT</td>
<td>Full description</td>
</tr>
<tr>
<td>solution</td>
<td>TEXT</td>
<td>Remediation steps</td>
</tr>
<tr>
<td>plugin_output</td>
<td>TEXT</td>
<td>Scanner output</td>
</tr>
<tr>
<td>vpr_score</td>
<td>REAL</td>
<td>VPR score</td>
</tr>
<tr>
<td>scan_date</td>
<td>TEXT</td>
<td>Scan timestamp</td>
</tr>
<tr>
<td><strong>vendor</strong></td>
<td><strong>TEXT</strong></td>
<td><strong>Vendor classification (CISCO, Palo Alto, Other) - HEX-241</strong></td>
</tr>
<tr>
<td><strong>has_kev</strong></td>
<td><strong>INTEGER</strong></td>
<td><strong>KEV flag (0/1 boolean) - v1.0.22</strong></td>
</tr>
<tr>
<td><strong>cisco_advisory_id</strong></td>
<td><strong>TEXT</strong></td>
<td><strong>Cisco PSIRT advisory ID - v1.0.63</strong></td>
</tr>
<tr>
<td><strong>palo_advisory_id</strong></td>
<td><strong>TEXT</strong></td>
<td><strong>Palo Alto advisory ID - v1.0.63</strong></td>
</tr>
<tr>
<td><strong>lifecycle_status</strong></td>
<td><strong>TEXT</strong></td>
<td><strong>active/grace_period/resolved - Import lifecycle</strong></td>
</tr>
<tr>
<td><strong>last_seen_date</strong></td>
<td><strong>TEXT</strong></td>
<td><strong>Last appearance in scan - Lifecycle tracking</strong></td>
</tr>
<tr>
<td><strong>resolved_date</strong></td>
<td><strong>TEXT</strong></td>
<td><strong>Resolution timestamp - Lifecycle tracking</strong></td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Record creation</td>
</tr>
<tr>
<td>updated_at</td>
<td>TEXT</td>
<td>Last modification</td>
</tr>
</tbody></table>
<h4>tickets</h4><p>Support ticket tracking with XT# system and soft delete.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Auto-incrementing ID</td>
</tr>
<tr>
<td><strong>xt_number</strong></td>
<td><strong>TEXT</strong></td>
<td><strong>XT# identifier (XT-0001, XT-0042) - HEX-196</strong></td>
</tr>
<tr>
<td>title</td>
<td>TEXT</td>
<td>Ticket title</td>
</tr>
<tr>
<td>description</td>
<td>TEXT</td>
<td>Full description</td>
</tr>
<tr>
<td>status</td>
<td>TEXT</td>
<td>Open/In Progress/Closed</td>
</tr>
<tr>
<td>priority</td>
<td>TEXT</td>
<td>Low/Medium/High/Critical</td>
</tr>
<tr>
<td>devices</td>
<td>TEXT</td>
<td>JSON array of devices</td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Creation timestamp</td>
</tr>
<tr>
<td>updated_at</td>
<td>TEXT</td>
<td>Last update</td>
</tr>
<tr>
<td>closed_at</td>
<td>TEXT</td>
<td>Closure timestamp</td>
</tr>
<tr>
<td><strong>deleted_at</strong></td>
<td><strong>TEXT</strong></td>
<td><strong>Soft delete timestamp - HEX-196</strong></td>
</tr>
</tbody></table>
<h4>users</h4><p>User authentication and profile data <strong>(Since v1.0.46 - HEX-133)</strong>.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Auto-incrementing user ID</td>
</tr>
<tr>
<td>username</td>
<td>TEXT NOT NULL UNIQUE</td>
<td>Login username</td>
</tr>
<tr>
<td>password_hash</td>
<td>TEXT NOT NULL</td>
<td>Argon2id password hash</td>
</tr>
<tr>
<td>email</td>
<td>TEXT</td>
<td>User email address</td>
</tr>
<tr>
<td>role</td>
<td>TEXT</td>
<td>User role (admin, user)</td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Account creation timestamp</td>
</tr>
<tr>
<td>updated_at</td>
<td>TEXT</td>
<td>Last profile update</td>
</tr>
</tbody></table>
<h4>sessions</h4><p>SQLite session store for authentication <strong>(Since v1.0.46)</strong>.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>sid</td>
<td>TEXT PRIMARY KEY</td>
<td>Session ID (primary key)</td>
</tr>
<tr>
<td>sess</td>
<td>TEXT NOT NULL</td>
<td>JSON session data</td>
</tr>
<tr>
<td>expired</td>
<td>INTEGER NOT NULL</td>
<td>Expiration timestamp (Unix epoch)</td>
</tr>
</tbody></table>
<h4>preferences</h4><p>User preference storage with JSON values <strong>(Since v1.0.48 - HEX-138)</strong>.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Auto-incrementing ID</td>
</tr>
<tr>
<td>user_id</td>
<td>INTEGER NOT NULL</td>
<td>Foreign key to users table</td>
</tr>
<tr>
<td>key</td>
<td>TEXT NOT NULL</td>
<td>Preference key (dot notation)</td>
</tr>
<tr>
<td>value</td>
<td>TEXT</td>
<td>JSON-serialized preference value</td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Creation timestamp</td>
</tr>
<tr>
<td>updated_at</td>
<td>TEXT</td>
<td>Last modification</td>
</tr>
</tbody></table>
<p><strong>Indexes:</strong> <code>(user_id, key)</code> UNIQUE</p>
<h4>templates</h4><p>Template system for emails and tickets <strong>(Since v1.0.21)</strong>.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Auto-incrementing ID</td>
</tr>
<tr>
<td>name</td>
<td>TEXT NOT NULL</td>
<td>Template name</td>
</tr>
<tr>
<td>category</td>
<td>TEXT</td>
<td>email, ticket, notification</td>
</tr>
<tr>
<td>subject</td>
<td>TEXT</td>
<td>Email subject or ticket title</td>
</tr>
<tr>
<td>body</td>
<td>TEXT NOT NULL</td>
<td>Template content with variables</td>
</tr>
<tr>
<td>variables</td>
<td>TEXT</td>
<td>JSON array of variable names</td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Creation timestamp</td>
</tr>
<tr>
<td>updated_at</td>
<td>TEXT</td>
<td>Last modification</td>
</tr>
</tbody></table>
<h4>kev_catalog</h4><p>CISA Known Exploited Vulnerabilities catalog <strong>(Since v1.0.22)</strong>.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Auto-incrementing ID</td>
</tr>
<tr>
<td>cve_id</td>
<td>TEXT NOT NULL UNIQUE</td>
<td>CVE identifier</td>
</tr>
<tr>
<td>vendor_project</td>
<td>TEXT</td>
<td>Vendor name</td>
</tr>
<tr>
<td>product</td>
<td>TEXT</td>
<td>Product name</td>
</tr>
<tr>
<td>vulnerability_name</td>
<td>TEXT</td>
<td>KEV vulnerability name</td>
</tr>
<tr>
<td>date_added</td>
<td>TEXT</td>
<td>CISA addition date</td>
</tr>
<tr>
<td>short_description</td>
<td>TEXT</td>
<td>Brief description</td>
</tr>
<tr>
<td>required_action</td>
<td>TEXT</td>
<td>Remediation action</td>
</tr>
<tr>
<td>due_date</td>
<td>TEXT</td>
<td>Remediation deadline</td>
</tr>
<tr>
<td>known_ransomware</td>
<td>INTEGER</td>
<td>Ransomware campaign flag (0/1)</td>
</tr>
<tr>
<td>notes</td>
<td>TEXT</td>
<td>Additional notes</td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Record creation</td>
</tr>
<tr>
<td>updated_at</td>
<td>TEXT</td>
<td>Last sync update</td>
</tr>
</tbody></table>
<h4>cisco_advisories</h4><p>Cisco PSIRT security advisories <strong>(Since v1.0.63)</strong>.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Auto-incrementing ID</td>
</tr>
<tr>
<td>advisory_id</td>
<td>TEXT NOT NULL UNIQUE</td>
<td>Cisco advisory ID</td>
</tr>
<tr>
<td>cve_id</td>
<td>TEXT</td>
<td>CVE identifier</td>
</tr>
<tr>
<td>advisory_title</td>
<td>TEXT</td>
<td>Advisory title</td>
</tr>
<tr>
<td>publication_url</td>
<td>TEXT</td>
<td>Link to Cisco advisory</td>
</tr>
<tr>
<td>sir</td>
<td>TEXT</td>
<td>Security Impact Rating (Critical/High/Medium/Low)</td>
</tr>
<tr>
<td>first_published</td>
<td>TEXT</td>
<td>Publication date</td>
</tr>
<tr>
<td>last_updated</td>
<td>TEXT</td>
<td>Last update date</td>
</tr>
<tr>
<td>status</td>
<td>TEXT</td>
<td>Advisory status</td>
</tr>
<tr>
<td>version</td>
<td>TEXT</td>
<td>Advisory version</td>
</tr>
<tr>
<td>cwe_id</td>
<td>TEXT</td>
<td>CWE identifier</td>
</tr>
<tr>
<td>product_names</td>
<td>TEXT</td>
<td>JSON array of affected products</td>
</tr>
<tr>
<td>summary</td>
<td>TEXT</td>
<td>Advisory summary</td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Record creation</td>
</tr>
<tr>
<td>updated_at</td>
<td>TEXT</td>
<td>Last sync update</td>
</tr>
</tbody></table>
<h4>palo_advisories</h4><p>Palo Alto Networks security advisories <strong>(Since v1.0.63)</strong>.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Auto-incrementing ID</td>
</tr>
<tr>
<td>advisory_id</td>
<td>TEXT NOT NULL UNIQUE</td>
<td>Palo Alto advisory ID</td>
</tr>
<tr>
<td>cve_id</td>
<td>TEXT</td>
<td>CVE identifier</td>
</tr>
<tr>
<td>advisory_title</td>
<td>TEXT</td>
<td>Advisory title</td>
</tr>
<tr>
<td>publication_url</td>
<td>TEXT</td>
<td>Link to Palo Alto advisory</td>
</tr>
<tr>
<td>severity</td>
<td>TEXT</td>
<td>Severity rating</td>
</tr>
<tr>
<td>publication_date</td>
<td>TEXT</td>
<td>Publication date</td>
</tr>
<tr>
<td>last_updated</td>
<td>TEXT</td>
<td>Last update date</td>
</tr>
<tr>
<td>affected_products</td>
<td>TEXT</td>
<td>JSON array of affected products</td>
</tr>
<tr>
<td>summary</td>
<td>TEXT</td>
<td>Advisory summary</td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Record creation</td>
</tr>
<tr>
<td>updated_at</td>
<td>TEXT</td>
<td>Last sync update</td>
</tr>
</tbody></table>
<h4>vendor_patterns</h4><p>Hostname patterns for vendor classification <strong>(Since v1.0.63 - HEX-241)</strong>.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Auto-incrementing ID</td>
</tr>
<tr>
<td>pattern</td>
<td>TEXT NOT NULL UNIQUE</td>
<td>Hostname pattern (regex or literal)</td>
</tr>
<tr>
<td>vendor</td>
<td>TEXT NOT NULL</td>
<td>Vendor name (CISCO, Palo Alto)</td>
</tr>
<tr>
<td>description</td>
<td>TEXT</td>
<td>Pattern description</td>
</tr>
<tr>
<td>priority</td>
<td>INTEGER DEFAULT 0</td>
<td>Matching priority (higher first)</td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Record creation</td>
</tr>
<tr>
<td>updated_at</td>
<td>TEXT</td>
<td>Last modification</td>
</tr>
</tbody></table>
<h4>vulnerability_imports</h4><p>Import operation tracking.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>INTEGER PRIMARY KEY</td>
<td>Import ID</td>
</tr>
<tr>
<td>filename</td>
<td>TEXT</td>
<td>Source filename</td>
</tr>
<tr>
<td>scan_date</td>
<td>TEXT</td>
<td>Scan date</td>
</tr>
<tr>
<td>total_items</td>
<td>INTEGER</td>
<td>Total records</td>
</tr>
<tr>
<td>processed_items</td>
<td>INTEGER</td>
<td>Processed count</td>
</tr>
<tr>
<td>status</td>
<td>TEXT</td>
<td>pending/processing/completed/failed</td>
</tr>
<tr>
<td>created_at</td>
<td>TEXT</td>
<td>Start time</td>
</tr>
<tr>
<td>completed_at</td>
<td>TEXT</td>
<td>End time</td>
</tr>
</tbody></table>
<hr>
<h2>Error Handling</h2><p>Consistent error handling across all endpoints:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Success response</span>
{
    <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;data&quot;</span>: { <span class="hljs-comment">/* response data */</span> },
    <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Operation completed&quot;</span>
}

<span class="hljs-comment">// Error response</span>
{
    <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;Error message&quot;</span>,
    <span class="hljs-string">&quot;details&quot;</span>: <span class="hljs-string">&quot;Detailed error information (dev mode only)&quot;</span>
}</code></pre><p><strong>HTTP Status Codes:</strong></p>
<ul>
<li><code>200</code> - Success</li>
<li><code>201</code> - Created</li>
<li><code>400</code> - Bad request</li>
<li><code>401</code> - Unauthorized</li>
<li><code>404</code> - Not found</li>
<li><code>500</code> - Server error</li>
</ul>
<hr>
<h2>Security</h2><h3>Authentication System (Since v1.0.46)</h3><p><strong>Architecture:</strong> Session-based authentication with SQLite session store</p>
<p><strong>Core Components:</strong></p>
<h4>Password Security</h4><ul>
<li><strong>Hashing Algorithm:</strong> Argon2id (winner of Password Hashing Competition)</li>
<li><strong>Timing-Safe Comparison:</strong> Prevents timing attacks during credential verification</li>
<li><strong>Parameters:</strong><ul>
<li>Time cost: 2 iterations</li>
<li>Memory cost: 19456 KB (19 MB)</li>
<li>Parallelism: 1 thread</li>
<li>Hash length: 32 bytes</li>
</ul>
</li>
</ul>
<h4>Session Management</h4><ul>
<li><strong>Storage:</strong> SQLite database (<code>sessions</code> table)</li>
<li><strong>Expiration:</strong> 24 hours (remember me: 30 days)</li>
<li><strong>Cookie Settings:</strong><ul>
<li><code>httpOnly: true</code> - Prevents XSS access to cookies</li>
<li><code>secure: true</code> - HTTPS only (production)</li>
<li><code>sameSite: &#39;lax&#39;</code> - CSRF protection</li>
</ul>
</li>
<li><strong>Automatic Cleanup:</strong> Expired sessions removed on startup and periodically</li>
</ul>
<h4>Account Lockout Protection</h4><ul>
<li><strong>Failed Attempts:</strong> 5 consecutive failures</li>
<li><strong>Lockout Duration:</strong> 15 minutes</li>
<li><strong>Tracking:</strong> In-memory store with automatic expiry</li>
<li><strong>Reset:</strong> Successful login clears failed attempt counter</li>
</ul>
<h4>CSRF Protection</h4><ul>
<li><strong>Method:</strong> Double-submit cookie pattern</li>
<li><strong>Token Endpoint:</strong> <code>GET /api/auth/csrf</code></li>
<li><strong>Required For:</strong> All state-changing requests (POST, PUT, DELETE)</li>
<li><strong>Validation:</strong> Automatic via <code>csrf-sync</code> middleware</li>
<li><strong>Excluded Routes:</strong> <code>/api/auth/login</code> (CSRF token needed for form)</li>
</ul>
<h4>Protected Endpoints</h4><p>All API endpoints require authentication (<code>requireAuth</code> middleware) <strong>except</strong>:</p>
<ul>
<li><code>POST /api/auth/login</code> - Public (login endpoint)</li>
<li><code>GET /api/auth/status</code> - Public (status check)</li>
<li><code>GET /api/auth/csrf</code> - Public (token retrieval)</li>
</ul>
<p><strong>Protected Endpoint Categories:</strong></p>
<ul>
<li>All <code>/api/vulnerabilities/*</code> endpoints</li>
<li>All <code>/api/tickets/*</code> endpoints</li>
<li>All <code>/api/preferences/*</code> endpoints</li>
<li>All <code>/api/templates/*</code> endpoints</li>
<li>All <code>/api/backup/*</code> endpoints</li>
<li>All <code>/api/kev/*</code> endpoints</li>
<li>All <code>/api/devices/*</code> endpoints</li>
</ul>
<h3>Trust Proxy Configuration</h3><p><strong>Setting:</strong> <code>app.set(&#39;trust proxy&#39;, true)</code></p>
<p><strong>Purpose:</strong> Enable Express to trust nginx reverse proxy headers</p>
<p><strong>Why Critical:</strong></p>
<ul>
<li>Allows reading <code>X-Forwarded-Proto</code> header to detect HTTPS</li>
<li>Enables secure cookies with HTTPS termination at nginx</li>
<li>Required for authentication system to function correctly</li>
<li>Without this, all authentication will fail (cookies not set)</li>
</ul>
<p><strong>Network Flow:</strong></p>
<pre><code class="language-text">Client → HTTPS (443) → nginx → HTTP (8080) → Express
         Sets header:    Reads header:
         X-Forwarded-Proto: https</code></pre><h3>Input Validation</h3><ul>
<li>All file paths validated with PathValidator</li>
<li>SQL queries use parameterized statements (prepared statements)</li>
<li>HTML content escaped before storage</li>
<li>File uploads restricted by type and size</li>
<li>User input sanitized to prevent injection attacks</li>
</ul>
<h3>Rate Limiting</h3><p>Configurable per-endpoint limits to prevent abuse and brute force attacks.</p>
<p><strong>Endpoint-Specific Rate Limits:</strong></p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Window</th>
<th>Max Requests</th>
<th>Purpose</th>
</tr>
</thead>
<tbody><tr>
<td><code>/api/kev/sync</code></td>
<td>5 minutes</td>
<td>3</td>
<td>Prevent KEV API abuse</td>
</tr>
<tr>
<td><code>/api/cisco/sync</code></td>
<td>10 minutes</td>
<td>10</td>
<td>Prevent Cisco PSIRT API abuse</td>
</tr>
<tr>
<td><code>/api/palo/sync</code></td>
<td>10 minutes</td>
<td>10</td>
<td>Prevent Palo Alto API abuse</td>
</tr>
<tr>
<td>Global (all endpoints)</td>
<td>15 minutes</td>
<td>100</td>
<td>General brute force protection</td>
</tr>
</tbody></table>
<p><strong>Implementation:</strong></p>
<ul>
<li>Uses <code>express-rate-limit</code> middleware</li>
<li>IP-based tracking for distributed systems</li>
<li>Returns <code>429 Too Many Requests</code> when limit exceeded</li>
<li>Rate limit headers included in responses:<ul>
<li><code>X-RateLimit-Limit</code> - Maximum requests allowed</li>
<li><code>X-RateLimit-Remaining</code> - Requests remaining</li>
<li><code>X-RateLimit-Reset</code> - Timestamp when limit resets</li>
</ul>
</li>
</ul>
<h3>CORS Policy</h3><p>Whitelist-based origin control with credentials support.</p>
<hr>
<h2>Environment Variables</h2><pre><code class="language-bash"><span class="hljs-comment"># Server Configuration</span>
PORT=8080
HOST=0.0.0.0
NODE_ENV=production

<span class="hljs-comment"># Database</span>
DATABASE_PATH=data/hextrackr.db

<span class="hljs-comment"># Security &amp; Authentication (Since v1.0.46)</span>
SESSION_SECRET=&lt;your-32-byte-hex-string&gt;  <span class="hljs-comment"># REQUIRED - Cryptographically secure random string</span>
TRUST_PROXY=<span class="hljs-literal">true</span>                          <span class="hljs-comment"># REQUIRED - Enable for nginx reverse proxy</span>
ALLOWED_ORIGINS=http://localhost:8080

<span class="hljs-comment"># File Handling</span>
MAX_FILE_SIZE=100MB
UPLOAD_DIR=uploads
BACKUP_DIR=backups

<span class="hljs-comment"># Features</span>
ENABLE_WEBSOCKET=<span class="hljs-literal">true</span>
ENABLE_COMPRESSION=<span class="hljs-literal">true</span></code></pre><p><strong>Critical Environment Variables:</strong></p>
<h3>SESSION_SECRET (Required)</h3><p><strong>Purpose:</strong> Cryptographic key for signing session cookies</p>
<p><strong>Requirements:</strong></p>
<ul>
<li><strong>Minimum length:</strong> 32 characters (64 recommended)</li>
<li><strong>Format:</strong> Hexadecimal string or random alphanumeric</li>
<li><strong>Security:</strong> Must be kept secret, never committed to version control</li>
</ul>
<p><strong>Generate Secure Secret:</strong></p>
<pre><code class="language-bash"><span class="hljs-comment"># Using Node.js crypto module (recommended)</span>
node -e <span class="hljs-string">&quot;console.log(require(&#x27;crypto&#x27;).randomBytes(32).toString(&#x27;hex&#x27;))&quot;</span>

<span class="hljs-comment"># Using OpenSSL</span>
openssl rand -hex 32</code></pre><p><strong>Server Behavior:</strong></p>
<ul>
<li>Server <strong>refuses to start</strong> if SESSION_SECRET is missing</li>
<li>Server <strong>refuses to start</strong> if SESSION_SECRET is less than 32 characters</li>
<li>Error message: <code>&quot;CRITICAL: SESSION_SECRET must be at least 32 characters&quot;</code></li>
</ul>
<h3>TRUST_PROXY (Required for HTTPS)</h3><p><strong>Purpose:</strong> Enable Express to trust nginx reverse proxy headers</p>
<p><strong>Value:</strong> <code>true</code> or <code>1</code></p>
<p><strong>Why Required:</strong></p>
<ul>
<li>Allows Express to read <code>X-Forwarded-Proto</code> header from nginx</li>
<li>Enables secure cookies to work correctly with HTTPS termination</li>
<li>Required for authentication system to detect HTTPS connections</li>
<li>Without this, authentication cookies will not be set correctly</li>
</ul>
<p><strong>Architecture:</strong></p>
<pre><code class="language-text">Browser (HTTPS 443) → nginx → Express (HTTP 8080)
                        ↓
            Sets X-Forwarded-Proto: https
                        ↓
        Express reads header via trust proxy</code></pre>
    <!-- Note: This file is intentionally minimal. The full page scaffold, header, footer, and scripts
             are provided by docs-html/index.html. Content generated using this template will be
             fetched and injected into #content-container by docs-html/js/docs-portal-v2.js. -->
</section>

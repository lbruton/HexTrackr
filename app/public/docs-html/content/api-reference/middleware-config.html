<!-- Fragment template for documentation content injected by docs-tabler.js -->
<section class="doc-fragment">
    <h1>Middleware & Configuration Reference</h1><blockquote>
<p>Complete documentation for HexTrackr&#39;s middleware pipeline and configuration modules</p>
</blockquote>
<h2>Overview</h2><p>HexTrackr&#39;s middleware layer provides authentication, security, logging, and request processing capabilities. The middleware stack enforces authentication on all protected routes, applies CSRF protection, implements rate limiting, and provides comprehensive error handling.</p>
<p><strong>Critical Architecture Note</strong>: HexTrackr <strong>ALWAYS</strong> runs behind an nginx reverse proxy with SSL/TLS termination. The <code>trust proxy</code> setting is always enabled to support secure sessions and proper IP detection.</p>
<hr>
<h2 id="execution-order">Middleware Execution Order</h2><p>Understanding middleware order is critical - middleware executes top-to-bottom, and authentication/security depend on correct ordering.</p>
<p><strong>Complete Middleware Stack</strong> (from <code>app/public/server.js</code>):</p>
<ol>
<li><strong>Trust Proxy</strong> (line 78) - Enable Express to read nginx headers (<code>X-Forwarded-Proto</code>, <code>X-Forwarded-For</code>)</li>
<li><strong>WebSocket Authentication</strong> (lines 101-123) - Session-based authentication for WebSocket handshakes</li>
<li><strong>CORS</strong> (line 189) - Cross-origin resource sharing for API access (HTTPS-only)</li>
<li><strong>Session Management</strong> (line 190) - SQLite session store with secure cookies</li>
<li><strong>Body Parsing</strong> (lines 194-195) - JSON and URL-encoded request bodies (100MB limit)</li>
<li><strong>CSRF Protection</strong> (lines 200-224) - Double-submit cookie pattern (excludes login/status/csrf endpoints)</li>
<li><strong>Rate Limiting</strong> (line 226) - <code>/api/*</code> routes only (60 requests per 15 min, cache-aware)</li>
<li><strong>Compression</strong> (line 232) - Gzip/deflate (only if NOT behind nginx)</li>
<li><strong>Security Headers</strong> (lines 236-241) - Custom headers (X-Content-Type-Options, X-Frame-Options, X-XSS-Protection)</li>
<li><strong>Static File Serving</strong> - Documentation portal, JSDoc, public assets (<strong>blocks <code>/data</code> directory</strong>)</li>
<li><strong>Route Handlers</strong> - API endpoints with authentication middleware</li>
<li><strong>Global Error Handler</strong> - Catches all unhandled errors</li>
</ol>
<hr>
<h2 id="authentication">Authentication & Security Middleware</h2><h3>Session Management (`sessionMiddleware`)</h3><p><strong>Location:</strong> <code>app/middleware/auth.js</code> (lines 18-44)<br><strong>Since:</strong> v1.0.46 (HEX-133, HEX-128)</p>
<p>SQLite-backed session management with secure cookies requiring HTTPS.</p>
<p><strong>Configuration:</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> sessionMiddleware = <span class="hljs-title function_">session</span>({
    <span class="hljs-attr">store</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqliteStore</span>({
        <span class="hljs-attr">client</span>: db,              <span class="hljs-comment">// better-sqlite3 connection</span>
        <span class="hljs-attr">tableName</span>: <span class="hljs-string">&quot;sessions&quot;</span>,   <span class="hljs-comment">// Session table name</span>
        <span class="hljs-attr">ttl</span>: <span class="hljs-number">86400000</span>           <span class="hljs-comment">// 24 hours in milliseconds</span>
    }),
    <span class="hljs-attr">secret</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">SESSION_SECRET</span>,  <span class="hljs-comment">// REQUIRED: 32+ characters</span>
    <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">cookie</span>: {
        <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>,            <span class="hljs-comment">// HTTPS REQUIRED (HEX-128)</span>
        <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,          <span class="hljs-comment">// Prevents XSS access</span>
        <span class="hljs-attr">sameSite</span>: <span class="hljs-string">&quot;lax&quot;</span>,         <span class="hljs-comment">// CSRF protection</span>
        <span class="hljs-attr">maxAge</span>: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>  <span class="hljs-comment">// 24 hours</span>
    },
    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;hextrackr.sid&quot;</span>,
    <span class="hljs-attr">proxy</span>: <span class="hljs-literal">true</span>                  <span class="hljs-comment">// ALWAYS true (nginx reverse proxy)</span>
});</code></pre><p><strong>Critical Requirements:</strong></p>
<ol>
<li><p><strong>SESSION_SECRET</strong> environment variable:</p>
<ul>
<li><strong>Minimum length</strong>: 32 characters (server validates on startup)</li>
<li><strong>Generation</strong>: <code>node -e &quot;console.log(require(&#39;crypto&#39;).randomBytes(32).toString(&#39;hex&#39;))&quot;</code></li>
<li><strong>Security</strong>: Never commit to version control</li>
<li><strong>Server behavior</strong>: Refuses to start if missing or too short</li>
</ul>
</li>
<li><p><strong>HTTPS Requirement</strong> (HEX-128 Fix):</p>
<ul>
<li><code>secure: true</code> means cookies ONLY sent over HTTPS</li>
<li>Sessions will NOT work over HTTP (browsers reject cookies)</li>
<li>Development access: <code>https://localhost</code> or <code>https://dev.hextrackr.com</code></li>
<li>Production access: <code>https://hextrackr.com</code></li>
<li><strong>Never use HTTP</strong> - authentication will silently fail</li>
</ul>
</li>
<li><p><strong>Trust Proxy</strong> (always enabled):</p>
<ul>
<li><code>proxy: true</code> tells Express to trust nginx reverse proxy</li>
<li>Required for Express to read <code>X-Forwarded-Proto: https</code> header</li>
<li>Without this, Express thinks connection is HTTP (breaks secure cookies)</li>
<li>See <a href="#trust-proxy">Trust Proxy Configuration</a> section</li>
</ul>
</li>
</ol>
<p><strong>Session Store:</strong></p>
<ul>
<li><strong>Database</strong>: SQLite at <code>app/data/sessions.db</code></li>
<li><strong>Table</strong>: <code>sessions</code> (auto-created)</li>
<li><strong>Cleanup</strong>: Every 15 minutes (900000ms)</li>
<li><strong>Structure</strong>: Session ID (primary key), data (JSON), expiry (timestamp)</li>
</ul>
<h3>WebSocket Session Authentication</h3><p><strong>Location:</strong> <code>app/public/server.js</code> (lines 101-123)<br><strong>Since:</strong> v1.0.46</p>
<p>Secure WebSocket connections require session-based authentication at handshake time.</p>
<p><strong>Implementation:</strong></p>
<pre><code class="language-javascript">io.<span class="hljs-property">engine</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> isHandshake = req.<span class="hljs-property">_query</span>.<span class="hljs-property">sid</span> === <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">if</span> (!isHandshake) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(); <span class="hljs-comment">// Skip auth for polling requests</span>
    }

    <span class="hljs-comment">// Apply session middleware during handshake</span>
    <span class="hljs-title function_">sessionMiddleware</span>(req, res, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(err);

        <span class="hljs-comment">// Check if user is authenticated</span>
        <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span> || !req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Authentication required&quot;</span>));
        }

        <span class="hljs-title function_">next</span>();
    });
});</code></pre><p><strong>Security Features:</strong></p>
<ul>
<li>Authentication <strong>only on handshake</strong> (when <code>sid</code> is undefined)</li>
<li>Subsequent polling requests skip auth check (performance optimization)</li>
<li>Reuses session middleware for consistent auth logic</li>
<li>Unauthenticated connections are rejected with error</li>
<li>Session username is logged on successful handshake</li>
</ul>
<p><strong>WebSocket Events:</strong></p>
<ul>
<li><code>join-progress</code> - Join progress tracking room</li>
<li><code>leave-progress</code> - Leave progress tracking room</li>
<li><code>progress</code> - Progress updates (throttled to 100ms)</li>
<li><code>complete</code> - Operation completed</li>
<li><code>error</code> - Operation failed</li>
</ul>
<h3>Authentication Protection (`requireAuth`)</h3><p><strong>Location:</strong> <code>app/middleware/auth.js</code> (lines 52-68)<br><strong>Since:</strong> v1.0.46</p>
<p>Route protection middleware that enforces authentication on protected endpoints.</p>
<p><strong>Behavior:</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">requireAuth</span> = (<span class="hljs-params">req, res, next</span>) =&gt; {
    <span class="hljs-comment">// Check for active session</span>
    <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span> || !req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span>) {
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({
            <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;Authentication required&quot;</span>
        });
    }

    <span class="hljs-comment">// Attach user object to request</span>
    req.<span class="hljs-property">user</span> = {
        <span class="hljs-attr">id</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span>,
        <span class="hljs-attr">username</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>,
        <span class="hljs-attr">role</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">role</span> || <span class="hljs-string">&quot;user&quot;</span>
    };

    <span class="hljs-title function_">next</span>();
};</code></pre><p><strong>Usage Pattern:</strong></p>
<pre><code class="language-javascript"><span class="hljs-comment">// Protect API routes with requireAuth</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/logout&quot;</span>, requireAuth, <span class="hljs-title class_">AuthController</span>.<span class="hljs-property">logout</span>);
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/change-password&quot;</span>, requireAuth, <span class="hljs-title class_">AuthController</span>.<span class="hljs-property">changePassword</span>);
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/profile&quot;</span>, requireAuth, <span class="hljs-title class_">AuthController</span>.<span class="hljs-property">getProfile</span>);
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/preferences&quot;</span>, requireAuth, <span class="hljs-title class_">PreferencesController</span>.<span class="hljs-property">getAll</span>);</code></pre><p><strong>Protected Endpoint Categories:</strong></p>
<ul>
<li>All <code>/api/vulnerabilities/*</code> endpoints</li>
<li>All <code>/api/tickets/*</code> endpoints</li>
<li>All <code>/api/preferences/*</code> endpoints</li>
<li>All <code>/api/templates/*</code> endpoints</li>
<li>All <code>/api/backup/*</code> endpoints</li>
<li>All <code>/api/kev/*</code> endpoints (sync, status)</li>
<li>All <code>/api/devices/*</code> endpoints</li>
</ul>
<p><strong>Public Endpoints</strong> (no authentication required):</p>
<ul>
<li><code>POST /api/auth/login</code> - User login</li>
<li><code>GET /api/auth/status</code> - Check authentication status</li>
<li><code>GET /api/auth/csrf</code> - Get CSRF token</li>
</ul>
<h3>Extended Session ("Remember Me")</h3><p><strong>Location:</strong> <code>app/middleware/auth.js</code> (lines 75-79)<br><strong>Since:</strong> v1.0.46</p>
<p>Extends session duration to 30 days when user checks &quot;Remember Me&quot; on login.</p>
<p><strong>Usage:</strong></p>
<pre><code class="language-javascript"><span class="hljs-comment">// In login controller after successful authentication</span>
<span class="hljs-keyword">if</span> (req.<span class="hljs-property">body</span>.<span class="hljs-property">rememberMe</span>) {
    <span class="hljs-title function_">extendSession</span>(req);  <span class="hljs-comment">// Sets maxAge to 30 days</span>
}</code></pre><hr>
<h2 id="csrf">CSRF Protection</h2><p><strong>Library:</strong> <code>csrf-sync</code><br><strong>Implementation:</strong> <code>app/public/server.js</code> (lines 200-212)<br><strong>Since:</strong> v1.0.46</p>
<p>Double-submit cookie pattern for CSRF protection on all state-changing requests.</p>
<p><strong>Configuration:</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { csrfSynchronisedProtection, generateToken } = <span class="hljs-title function_">csrfSync</span>({
    <span class="hljs-attr">getTokenFromRequest</span>: <span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> req.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;x-csrf-token&quot;</span>] ||
               req.<span class="hljs-property">body</span>?.<span class="hljs-property">_csrf</span> ||
               req.<span class="hljs-property">query</span>?.<span class="hljs-property">_csrf</span>;
    },
    <span class="hljs-attr">ignoredMethods</span>: [<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;HEAD&quot;</span>, <span class="hljs-string">&quot;OPTIONS&quot;</span>],
    <span class="hljs-attr">getTokenFromState</span>: <span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> req.<span class="hljs-property">session</span>.<span class="hljs-property">csrfToken</span>,
    <span class="hljs-attr">storeTokenInState</span>: <span class="hljs-function">(<span class="hljs-params">req, token</span>) =&gt;</span> {
        req.<span class="hljs-property">session</span>.<span class="hljs-property">csrfToken</span> = token;
    },
    <span class="hljs-attr">size</span>: <span class="hljs-number">128</span>  <span class="hljs-comment">// Token size in bits</span>
});</code></pre><p><strong>Token Generation Endpoint:</strong></p>
<pre><code class="language-javascript"><span class="hljs-comment">// GET /api/auth/csrf</span>
{
    <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;csrfToken&quot;</span>: <span class="hljs-string">&quot;abc123...&quot;</span>  <span class="hljs-comment">// 128-bit token</span>
}</code></pre><p><strong>Client Integration:</strong></p>
<p><strong>Step 1</strong>: Get CSRF token before state-changing requests:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/api/auth/csrf&quot;</span>);
<span class="hljs-keyword">const</span> { csrfToken } = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();</code></pre><p><strong>Step 2</strong>: Include token in subsequent requests:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Option 1: HTTP Header (recommended)</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/api/vulnerabilities&quot;</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,
        <span class="hljs-string">&quot;X-CSRF-Token&quot;</span>: csrfToken
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
});

<span class="hljs-comment">// Option 2: Request body</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/api/vulnerabilities&quot;</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span> },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ ...data, <span class="hljs-attr">_csrf</span>: csrfToken })
});

<span class="hljs-comment">// Option 3: Query parameter</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/vulnerabilities?_csrf=<span class="hljs-subst">${csrfToken}</span>`</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
});</code></pre><p><strong>Exempted Endpoints</strong> (no CSRF token required):</p>
<ul>
<li><code>POST /api/auth/login</code> - Initial login (token retrieved after)</li>
<li><code>GET /api/auth/csrf</code> - Token generation endpoint</li>
<li><code>GET /api/auth/status</code> - Status check</li>
</ul>
<p><strong>All other POST/PUT/DELETE requests require valid CSRF token.</strong></p>
<hr>
<h2 id="trust-proxy">Trust Proxy Configuration</h2><p><strong>Setting:</strong> <code>app.set(&quot;trust proxy&quot;, true)</code><br><strong>Location:</strong> <code>app/public/server.js</code> (line 78)<br><strong>Since:</strong> v1.0.46 (HEX-128 Fix)</p>
<p><strong>Critical Importance</strong>: HexTrackr <strong>ALWAYS</strong> runs behind nginx reverse proxy. Trust proxy is <strong>ALWAYS</strong> enabled.</p>
<p><strong>Why This Matters:</strong></p>
<ol>
<li><p><strong>HTTPS Detection</strong>:</p>
<ul>
<li>nginx terminates SSL/TLS on port 443</li>
<li>nginx forwards HTTP to Express on port 8080</li>
<li>nginx sets <code>X-Forwarded-Proto: https</code> header</li>
<li>Express needs <code>trust proxy: true</code> to read this header</li>
<li>Without this, Express thinks connection is HTTP → secure cookies fail</li>
</ul>
</li>
<li><p><strong>Session Security</strong> (HEX-128):</p>
<ul>
<li>Session cookies have <code>secure: true</code> flag (HTTPS only)</li>
<li>If Express doesn&#39;t detect HTTPS, cookies aren&#39;t set</li>
<li>User appears logged in (frontend) but session doesn&#39;t work (backend)</li>
<li><strong>Result</strong>: Silent authentication failure</li>
</ul>
</li>
<li><p><strong>Rate Limiting</strong>:</p>
<ul>
<li>Rate limiting needs real client IP (not nginx IP)</li>
<li>nginx sets <code>X-Forwarded-For</code> header with client IP</li>
<li>Express needs <code>trust proxy: true</code> to read this header</li>
<li>Without this, all requests appear from nginx&#39;s IP → rate limit breaks</li>
</ul>
</li>
</ol>
<p><strong>Network Flow:</strong></p>
<pre><code class="language-text">Client (192.168.1.100)
    ↓ HTTPS (443)
nginx (reverse proxy)
    ↓ Sets headers:
    ↓   X-Forwarded-Proto: https
    ↓   X-Forwarded-For: 192.168.1.100
    ↓ HTTP (8080)
Express (with trust proxy: true)
    ↓ Reads headers
    ↓ req.protocol = &quot;https&quot;
    ↓ req.ip = &quot;192.168.1.100&quot;
Session cookies work ✅
Rate limiting works ✅</code></pre><p><strong>Related Settings:</strong></p>
<pre><code class="language-javascript"><span class="hljs-comment">// Session middleware (app/middleware/auth.js:43)</span>
<span class="hljs-attr">proxy</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// Trust proxy for session security</span>

<span class="hljs-comment">// Rate limiting (app/middleware/security.js:161)</span>
<span class="hljs-attr">trust</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">// Trust proxy for IP detection</span></code></pre><hr>
<h2 id="security">Security Middleware</h2><h3>PathValidator Class</h3><p><strong>Location:</strong> <code>app/middleware/security.js</code> (lines 36-131)<br><strong>Since:</strong> v1.0.22</p>
<p>Prevents path traversal attacks in file operations.</p>
<p><strong>Safe File Operation Methods:</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">PathValidator</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../middleware/security&quot;</span>);

<span class="hljs-comment">// Safe file read (throws on path traversal)</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> content = <span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeReadFileSync</span>(userProvidedPath);
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// error.message: &quot;Path traversal detected&quot; or &quot;Invalid file path&quot;</span>
}

<span class="hljs-comment">// Other safe methods:</span>
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeWriteFileSync</span>(filePath, data, options)
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeReaddirSync</span>(dirPath, options)
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeStatSync</span>(filePath)
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeExistsSync</span>(filePath)
<span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeUnlinkSync</span>(filePath)</code></pre><p><strong>Security Features:</strong></p>
<ul>
<li>Checks for <code>../</code> and <code>..\\</code> patterns</li>
<li>Validates all path components</li>
<li>Throws errors on path traversal attempts</li>
<li>Normalizes paths before operations</li>
</ul>
<h3>Security Headers Middleware</h3><p><strong>Location:</strong> <code>app/middleware/security.js</code> (lines 172-185)<br><strong>Applied:</strong> All responses</p>
<p><strong>Headers Set:</strong></p>
<pre><code class="language-javascript">{
    <span class="hljs-string">&quot;X-Content-Type-Options&quot;</span>: <span class="hljs-string">&quot;nosniff&quot;</span>,      <span class="hljs-comment">// Prevent MIME sniffing</span>
    <span class="hljs-string">&quot;X-Frame-Options&quot;</span>: <span class="hljs-string">&quot;DENY&quot;</span>,                <span class="hljs-comment">// Prevent clickjacking</span>
    <span class="hljs-string">&quot;X-XSS-Protection&quot;</span>: <span class="hljs-string">&quot;1; mode=block&quot;</span>       <span class="hljs-comment">// Legacy XSS protection</span>
}</code></pre><p><strong>Note</strong>: HexTrackr does <strong>NOT</strong> use Helmet.js (custom headers instead).</p>
<h3>Rate Limiting</h3><p><strong>Location:</strong> <code>app/middleware/security.js</code> (lines 153-182)<br><strong>Applied:</strong> <code>/api/*</code> routes only</p>
<p><strong>Configuration:</strong></p>
<pre><code class="language-javascript">{
    <span class="hljs-attr">windowMs</span>: <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,  <span class="hljs-comment">// 15 minutes (production) / 1 minute (development)</span>
    <span class="hljs-attr">max</span>: <span class="hljs-number">60</span>,                   <span class="hljs-comment">// 60 requests per window (production) / 10000 (development)</span>
    <span class="hljs-attr">standardHeaders</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// Send rate limit info in headers</span>
    <span class="hljs-attr">legacyHeaders</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">trust</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>,         <span class="hljs-comment">// Trust proxy for client IP</span>
    <span class="hljs-comment">// Cache-aware: Cache HITs are excluded from rate limiting (zero server load)</span>
    <span class="hljs-attr">skip</span>: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> cacheHeader = res.<span class="hljs-title function_">getHeader</span>(<span class="hljs-string">&quot;X-Cache&quot;</span>);
        <span class="hljs-keyword">return</span> cacheHeader &amp;&amp; (cacheHeader.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;HIT&quot;</span>) || cacheHeader.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;HIT-LARGE-QUERY&quot;</span>));
    }
}</code></pre><h3>CORS Middleware</h3><p><strong>Location:</strong> <code>app/middleware/security.js</code> (lines 138-145)<br><strong>Configuration Source:</strong> <code>utils/constants.js</code> (lines 14-25)</p>
<p><strong>HTTPS-Only Security:</strong> CORS dynamically allows <strong>ONLY HTTPS connections</strong> - all HTTP origins are rejected.</p>
<p><strong>Settings:</strong></p>
<pre><code class="language-javascript">{
    <span class="hljs-attr">origin</span>: <span class="hljs-variable constant_">CORS_ORIGINS</span>,      <span class="hljs-comment">// Dynamic function: allows HTTPS, rejects HTTP</span>
    <span class="hljs-attr">methods</span>: <span class="hljs-variable constant_">CORS_METHODS</span>,     <span class="hljs-comment">// Allowed HTTP methods</span>
    <span class="hljs-attr">allowedHeaders</span>: <span class="hljs-variable constant_">CORS_HEADERS</span>,  <span class="hljs-comment">// Allowed headers</span>
    <span class="hljs-attr">credentials</span>: <span class="hljs-literal">true</span>          <span class="hljs-comment">// Allow cookies</span>
}</code></pre><p><strong>CORS_ORIGINS Function (constants.js:14-25):</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CORS_ORIGINS</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">origin, callback</span>) {
    <span class="hljs-comment">// Allow same-origin requests (no origin header)</span>
    <span class="hljs-keyword">if</span> (!origin) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>); }

    <span class="hljs-comment">// Allow any HTTPS connection</span>
    <span class="hljs-keyword">if</span> (origin.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;https://&quot;</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">// Reject all HTTP connections</span>
    <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Only HTTPS connections allowed&quot;</span>));
};</code></pre><p><strong>Security Impact:</strong></p>
<ul>
<li>All HTTP origins are <strong>rejected</strong> with error: &quot;Only HTTPS connections allowed&quot;</li>
<li>HTTPS requirement is enforced at the CORS layer (prevents HTTP API access)</li>
<li>Same-origin requests (no <code>Origin</code> header) are allowed (server-to-server)</li>
</ul>
<h3>Input Validation Middleware</h3><p><strong>Location:</strong> <code>app/middleware/security.js</code> (lines 282-304)</p>
<p>Validates query parameters for injection attacks.</p>
<p><strong>Checks:</strong></p>
<ul>
<li>SQL injection patterns: <code>[&#39;&quot;;&lt;&gt;]</code></li>
<li>XSS patterns: <code>&lt;script|javascript:|vbscript:|onload=|onerror=</code></li>
</ul>
<hr>
<h2 id="validation">Validation Middleware</h2><p><strong>Location:</strong> <code>app/middleware/validation.js</code></p>
<h3>Generic Validation Factory</h3><p><strong>Function:</strong> <code>createValidationMiddleware(validatorFn, sourceProperty)</code><br><strong>Lines:</strong> 23-53</p>
<p>Creates custom validation middleware for any request property.</p>
<p><strong>Usage:</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { createValidationMiddleware } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../middleware/validation&quot;</span>);

<span class="hljs-comment">// Create custom validator</span>
<span class="hljs-keyword">const</span> validateCustomInput = <span class="hljs-title function_">createValidationMiddleware</span>(
    <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> errors = [];
        <span class="hljs-keyword">if</span> (!data.<span class="hljs-property">field1</span>) errors.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;field1 is required&quot;</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: errors.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>, errors };
    },
    <span class="hljs-string">&quot;body&quot;</span>  <span class="hljs-comment">// Validate req.body</span>
);

<span class="hljs-comment">// Use in route</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/custom&quot;</span>, validateCustomInput, customController);</code></pre><h3>File Upload Middleware</h3><p><strong>CSV Upload</strong> (<code>csvUpload</code>):</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Lines 63-87</span>
{
    <span class="hljs-attr">destination</span>: <span class="hljs-string">&quot;uploads/&quot;</span>,
    <span class="hljs-attr">fileSize</span>: <span class="hljs-number">100</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,  <span class="hljs-comment">// 100MB</span>
    <span class="hljs-attr">allowedTypes</span>: [<span class="hljs-string">&quot;text/csv&quot;</span>, <span class="hljs-string">&quot;application/csv&quot;</span>, <span class="hljs-string">&quot;text/plain&quot;</span>, <span class="hljs-string">&quot;application/vnd.ms-excel&quot;</span>],
    <span class="hljs-attr">allowedExtensions</span>: [<span class="hljs-string">&quot;.csv&quot;</span>, <span class="hljs-string">&quot;.txt&quot;</span>]
}</code></pre><p><strong>JSON Upload</strong> (<code>jsonUpload</code>):</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Lines 92-114</span>
{
    <span class="hljs-attr">destination</span>: <span class="hljs-string">&quot;uploads/&quot;</span>,
    <span class="hljs-attr">fileSize</span>: <span class="hljs-number">100</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,  <span class="hljs-comment">// 100MB</span>
    <span class="hljs-attr">allowedTypes</span>: [<span class="hljs-string">&quot;application/json&quot;</span>, <span class="hljs-string">&quot;text/json&quot;</span>, <span class="hljs-string">&quot;text/plain&quot;</span>],
    <span class="hljs-attr">allowedExtensions</span>: [<span class="hljs-string">&quot;.json&quot;</span>]
}</code></pre><h3>Request Body Validators</h3><ul>
<li><strong><code>validateTicketInput</code></strong> (lines 157-160) - Ticket creation/update</li>
<li><strong><code>validateVulnerabilityInput</code></strong> (lines 165-168) - Vulnerability creation/update</li>
<li><strong><code>validateCSVImportData(type)</code></strong> (lines 173-219) - CSV import validation</li>
</ul>
<h3>Query Parameter Validators</h3><ul>
<li><strong><code>validatePaginationParams</code></strong> (lines 228-247) - Sanitizes <code>page</code> and <code>limit</code></li>
<li><strong><code>validateDateRangeParams</code></strong> (lines 252-295) - Validates date ranges</li>
<li><strong><code>validateSearchQuery</code></strong> (lines 414-440) - Sanitizes search queries (200 char max)</li>
<li><strong><code>validateFilterParams</code></strong> (lines 445-481) - Validates severity/status/vendor filters</li>
<li><strong><code>validateVendorParam</code></strong> (lines 383-405) - Sanitizes vendor parameter</li>
</ul>
<h3>ID Parameter Validators</h3><ul>
<li><strong><code>validateNumericId(paramName)</code></strong> (lines 304-339) - Validates positive integer IDs</li>
</ul>
<hr>
<h2 id="error-handling">Error Handling Middleware</h2><p><strong>Location:</strong> <code>app/middleware/errorHandler.js</code></p>
<h3>Global Error Handler</h3><p><strong>Function:</strong> <code>globalErrorHandler(err, req, res, next)</code><br><strong>Lines:</strong> 14-78</p>
<p>Centralized error handler for all uncaught errors.</p>
<p><strong>Features:</strong></p>
<ul>
<li>Error context logging (method, URL, userAgent, timestamp, sessionId)</li>
<li>Error type detection (ValidationError, CastError, SQLITE_ errors, path traversal)</li>
<li>Environment-aware error details (verbose in development)</li>
<li>Prevents double response if headers already sent</li>
</ul>
<p><strong>Error Type Mapping:</strong></p>
<pre><code class="language-javascript"><span class="hljs-title class_">ValidationError</span> → <span class="hljs-number">400</span> <span class="hljs-title class_">Bad</span> <span class="hljs-title class_">Request</span>
<span class="hljs-title class_">CastError</span> → <span class="hljs-number">400</span> <span class="hljs-title class_">Bad</span> <span class="hljs-title class_">Request</span>
<span class="hljs-variable constant_">SQLITE_CONSTRAINT</span> → <span class="hljs-number">400</span> <span class="hljs-title class_">Bad</span> <span class="hljs-title class_">Request</span>
<span class="hljs-variable constant_">SQLITE_BUSY</span> → <span class="hljs-number">503</span> <span class="hljs-title class_">Service</span> <span class="hljs-title class_">Unavailable</span>
<span class="hljs-variable constant_">SQLITE_CORRUPT</span> → <span class="hljs-number">500</span> <span class="hljs-title class_">Internal</span> <span class="hljs-title class_">Server</span> <span class="hljs-title class_">Error</span>
<span class="hljs-title class_">Path</span> traversal → <span class="hljs-number">403</span> <span class="hljs-title class_">Forbidden</span>
<span class="hljs-title class_">Custom</span> err.<span class="hljs-property">statusCode</span> → <span class="hljs-title class_">Uses</span> provided code
<span class="hljs-title class_">Default</span> → <span class="hljs-number">500</span> <span class="hljs-title class_">Internal</span> <span class="hljs-title class_">Server</span> <span class="hljs-title class_">Error</span></code></pre><h3>404 Handler</h3><p><strong>Function:</strong> <code>notFoundHandler(req, res)</code><br><strong>Lines:</strong> 85-108</p>
<p><strong>Development Mode</strong>: Includes list of available routes for debugging</p>
<h3>Error Formatters</h3><p><strong>Database Errors</strong> (<code>formatDatabaseError</code>):</p>
<pre><code class="language-javascript"><span class="hljs-comment">// Lines 115-135</span>
<span class="hljs-variable constant_">SQLITE_CONSTRAINT</span> → <span class="hljs-string">&quot;Database constraint violation&quot;</span>
<span class="hljs-variable constant_">SQLITE_BUSY</span> → <span class="hljs-string">&quot;Database is busy&quot;</span>
<span class="hljs-variable constant_">SQLITE_LOCKED</span> → <span class="hljs-string">&quot;Database is locked&quot;</span>
<span class="hljs-variable constant_">SQLITE_CORRUPT</span> → <span class="hljs-string">&quot;Database corruption detected&quot;</span>
<span class="hljs-string">&quot;no such table&quot;</span> → <span class="hljs-string">&quot;Database may need initialization&quot;</span>
<span class="hljs-string">&quot;no such column&quot;</span> → <span class="hljs-string">&quot;Database may need migration&quot;</span></code></pre><p><strong>Validation Errors</strong> (<code>formatValidationError</code>):</p>
<ul>
<li>Lines 142-160</li>
<li>Supports multiple validation errors, Joi-style errors, single errors</li>
</ul>
<h3>Specialized Error Handlers</h3><ul>
<li><strong><code>asyncErrorHandler(fn)</code></strong> (lines 167-171) - Wrapper for async route handlers</li>
<li><strong><code>handleDatabaseError(err, res, operation, context)</code></strong> (lines 181-202)</li>
<li><strong><code>handleFileError(err, res, operation)</code></strong> (lines 211-240)</li>
<li><strong><code>handleCSVError(err, res)</code></strong> (lines 247-263)</li>
<li><strong><code>handleValidationError(message, res, details)</code></strong> (lines 271-285)</li>
</ul>
<p><strong>Async Error Handler Usage:</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { asyncErrorHandler } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../middleware/errorHandler&quot;</span>);

router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/async-route&quot;</span>, <span class="hljs-title function_">asyncErrorHandler</span>(<span class="hljs-title function_">async</span> (req, res) =&gt; {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">someAsyncOperation</span>();
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, data });
    <span class="hljs-comment">// Errors automatically caught and passed to global error handler</span>
}));</code></pre><hr>
<h2 id="logging">Logging Middleware</h2><p><strong>Location:</strong> <code>app/middleware/logging.js</code></p>
<h3>LoggingManager Class</h3><p><strong>Lines:</strong> 18-203</p>
<p>Structured logging with environment-aware log levels and performance monitoring.</p>
<p><strong>Log Levels:</strong></p>
<pre><code class="language-javascript"><span class="hljs-title function_">ERROR</span> (<span class="hljs-number">0</span>): <span class="hljs-title class_">Always</span> logged
<span class="hljs-title function_">WARN</span>  (<span class="hljs-number">1</span>): <span class="hljs-title class_">Production</span> <span class="hljs-keyword">default</span>
<span class="hljs-title function_">INFO</span>  (<span class="hljs-number">2</span>): <span class="hljs-title class_">Informational</span>
<span class="hljs-title function_">DEBUG</span> (<span class="hljs-number">3</span>): <span class="hljs-title class_">Development</span> <span class="hljs-keyword">default</span></code></pre><p><strong>Core Methods:</strong></p>
<pre><code class="language-javascript"><span class="hljs-comment">// Basic logging</span>
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">error</span>(message, data, requestId)
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">warn</span>(message, data, requestId)
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">info</span>(message, data, requestId)
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">debug</span>(message, data, requestId)

<span class="hljs-comment">// Performance timing</span>
<span class="hljs-keyword">const</span> timerId = <span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">startTimer</span>(<span class="hljs-string">&quot;operation&quot;</span>, requestId);
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">endTimer</span>(timerId, additionalData);  <span class="hljs-comment">// Warns if &gt;1000ms</span>

<span class="hljs-comment">// Database operation logging</span>
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">logDatabaseOperation</span>(operation, query, duration, error, requestId);
<span class="hljs-comment">// Warns if duration &gt; 500ms</span>

<span class="hljs-comment">// Batch progress logging</span>
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">logBatchProgress</span>(operation, current, total, stats, requestId);
<span class="hljs-comment">// Logs every 10% or 1000 items</span>

<span class="hljs-comment">// Import/export logging</span>
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">logImportProgress</span>(phase, stats, requestId);
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">logImportCompletion</span>(operation, finalStats, duration, requestId);

<span class="hljs-comment">// Memory monitoring</span>
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">logMemoryUsage</span>(operation, requestId);

<span class="hljs-comment">// Performance summary</span>
<span class="hljs-title class_">LoggingManager</span>.<span class="hljs-title function_">logPerformanceSummary</span>(operation, stats, requestId);</code></pre><h3>Request Logging Middleware</h3><p><strong>Function:</strong> <code>requestLoggingMiddleware(req, res, next)</code><br><strong>Lines:</strong> 212-251</p>
<p><strong>Features:</strong></p>
<ul>
<li>Generates unique requestId (16-char hex)</li>
<li>Logs incoming request with IP and User-Agent</li>
<li>Logs response with statusCode, duration, contentLength</li>
<li>Warns on 4xx/5xx responses or slow requests (&gt;2000ms)</li>
</ul>
<p><strong>Log Format:</strong></p>
<pre><code class="language-text">[2025-10-09 15:15:00] INFO [abc123def4567890] GET /api/vulnerabilities 200 45ms 2048 bytes
[2025-10-09 15:15:01] WARN [fedcba0987654321] POST /api/import 500 1523ms - Error: File too large</code></pre><h3>Error Logging Middleware</h3><p><strong>Function:</strong> <code>errorLoggingMiddleware(err, req, res, next)</code><br><strong>Lines:</strong> 257-276</p>
<p>Logs all errors with request context before passing to global error handler.</p>
<p><strong>Note</strong>: HexTrackr does <strong>NOT</strong> use Morgan (custom LoggingManager instead).</p>
<hr>
<h2 id="configuration">Configuration Modules</h2><h3>Middleware Configuration</h3><p><strong>Location:</strong> <code>app/config/middleware.js</code></p>
<p><strong>Exported Configurations:</strong></p>
<ol>
<li><strong><code>cors</code></strong> (lines 31-36) - CORS settings from constants</li>
<li><strong><code>rateLimit</code></strong> (lines 42-48) - Rate limiting settings</li>
<li><strong><code>bodyParser</code></strong> (lines 54-62) - JSON/URL-encoded parsing (50MB limit)</li>
<li><strong><code>upload</code></strong> (lines 68-80) - Multer file upload settings</li>
<li><strong><code>security</code></strong> (lines 86-92) - Security headers</li>
<li><strong><code>compression</code></strong> (lines 98-104) - Gzip/deflate settings</li>
<li><strong><code>websocket</code></strong> (lines 110-116) - Socket.io CORS</li>
</ol>
<hr>
<h2 id="environment">Environment Variables</h2><h3>Required Variables</h3><table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Validation</th>
</tr>
</thead>
<tbody><tr>
<td><code>SESSION_SECRET</code></td>
<td>Session encryption key</td>
<td><strong>REQUIRED</strong>: 32+ characters, server exits if missing</td>
</tr>
<tr>
<td><code>PORT</code></td>
<td>Server port</td>
<td>Default: <code>8080</code></td>
</tr>
<tr>
<td><code>DATABASE_PATH</code></td>
<td>SQLite file path</td>
<td>Default: <code>app/data/hextrackr.db</code></td>
</tr>
</tbody></table>
<h3>Optional Variables</h3><table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td><code>NODE_ENV</code></td>
<td>Environment mode</td>
<td><code>production</code></td>
</tr>
<tr>
<td><code>TRUST_PROXY</code></td>
<td>Trust proxy mode</td>
<td><code>true</code> (ALWAYS in code)</td>
</tr>
<tr>
<td><code>ALLOWED_ORIGINS</code></td>
<td>CORS whitelist (comma-separated)</td>
<td>Dynamic HTTPS-only function</td>
</tr>
<tr>
<td><code>MAX_FILE_SIZE</code></td>
<td>Upload size limit</td>
<td><code>100MB</code></td>
</tr>
<tr>
<td><code>RATE_LIMIT_WINDOW</code></td>
<td>Rate limit window (ms)</td>
<td><code>900000</code> (15 min prod) / <code>60000</code> (1 min dev)</td>
</tr>
<tr>
<td><code>RATE_LIMIT_MAX</code></td>
<td>Max requests per window</td>
<td><code>60</code> (prod) / <code>10000</code> (dev)</td>
</tr>
</tbody></table>
<hr>
<h2 id="sessions">Session Management Details</h2><p><strong>Store</strong>: SQLite database (<code>app/data/sessions.db</code>)<br><strong>Table</strong>: <code>sessions</code> (auto-created)<br><strong>Cleanup</strong>: Every 15 minutes (900000ms)</p>
<p><strong>Session Object Structure:</strong></p>
<pre><code class="language-javascript">{
    <span class="hljs-attr">userId</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;admin&quot;</span>,
    <span class="hljs-attr">role</span>: <span class="hljs-string">&quot;user&quot;</span>,
    <span class="hljs-attr">csrfToken</span>: <span class="hljs-string">&quot;abc123...&quot;</span>,  <span class="hljs-comment">// CSRF token stored in session</span>
    <span class="hljs-attr">cookie</span>: {
        <span class="hljs-attr">originalMaxAge</span>: <span class="hljs-number">86400000</span>,  <span class="hljs-comment">// 24 hours (or 30 days if Remember Me)</span>
        <span class="hljs-attr">expires</span>: <span class="hljs-string">&quot;2025-10-10T15:15:00.000Z&quot;</span>,
        <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">sameSite</span>: <span class="hljs-string">&quot;lax&quot;</span>
    }
}</code></pre><p><strong>Note</strong>: HexTrackr uses <strong>SQLite session store only</strong>. Redis is NOT supported.</p>
<hr>
<h2 id="security-practices">Security Best Practices</h2><h3>Input Validation</h3><p>All user input validated using multiple layers:</p>
<ol>
<li><strong>Type Checking</strong>: Ensure correct data types</li>
<li><strong>Range Validation</strong>: Check numeric ranges</li>
<li><strong>Pattern Matching</strong>: Regex for formats (email, URL, CVE)</li>
<li><strong>Sanitization</strong>: Remove/escape dangerous characters</li>
<li><strong>Length Limits</strong>: Prevent buffer overflows</li>
</ol>
<h3>SQL Injection Prevention</h3><p>All database queries use parameterized statements:</p>
<pre><code class="language-javascript"><span class="hljs-comment">// ✅ Safe query</span>
db.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;SELECT * FROM users WHERE id = ?&quot;</span>, [userId]);

<span class="hljs-comment">// ❌ DANGEROUS - never use string concatenation</span>
<span class="hljs-comment">// db.get(&quot;SELECT * FROM users WHERE id = &quot; + userId);</span></code></pre><h3>Path Traversal Prevention</h3><pre><code class="language-javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">PathValidator</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../middleware/security&quot;</span>);

<span class="hljs-comment">// ✅ Always validate file paths</span>
<span class="hljs-keyword">const</span> safePath = <span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">validatePath</span>(userInput);
<span class="hljs-keyword">const</span> content = <span class="hljs-title class_">PathValidator</span>.<span class="hljs-title function_">safeReadFileSync</span>(safePath);</code></pre><hr>
<p><strong>Version</strong>: 1.0.66<br><strong>Last Updated</strong>: 2025-10-16</p>

    <!-- Note: This file is intentionally minimal. The full page scaffold, header, footer, and scripts
             are provided by docs-html/index.html. Content generated using this template will be
             fetched and injected into #content-container by docs-html/js/docs-portal-v2.js. -->
</section>

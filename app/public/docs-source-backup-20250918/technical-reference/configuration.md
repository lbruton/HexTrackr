# Configuration Documentation

Complete guide to all configurable aspects of HexTrackr, including environment variables, runtime settings, and security parameters.

---

## Environment Configuration

### Core Server Settings

#### Application Server

```bash
# Primary application server configuration
PORT=8989                          # HTTP server port (default: 8989)
HOST=0.0.0.0                      # Server bind address (default: 0.0.0.0)
NODE_ENV=production               # Environment mode (development|production|test)
PROCESS_TITLE=hextrackr-server    # Process title for monitoring
```

#### Database Configuration

```bash
# SQLite database settings
DB_PATH=./data/hextrackr.db       # Database file location
DB_TIMEOUT=30000                  # Query timeout in milliseconds
DB_BUSY_TIMEOUT=10000             # Busy timeout for locked database
DB_WAL_MODE=true                  # Enable Write-Ahead Logging for performance
DB_PRAGMA_SYNCHRONOUS=NORMAL      # Synchronous mode (OFF|NORMAL|FULL|EXTRA)
DB_PRAGMA_CACHE_SIZE=10000        # Cache size in pages (-10000 = 10MB)
```

#### WebSocket Server

```bash
# Real-time communication settings
WEBSOCKET_PORT=8988               # WebSocket server port
WS_PING_INTERVAL=25000           # Ping interval in milliseconds
WS_PING_TIMEOUT=20000            # Ping timeout in milliseconds
WS_MAX_CONNECTIONS=100           # Maximum concurrent WebSocket connections
WS_COMPRESSION=true              # Enable WebSocket compression
```

---

### Security Configuration

#### Rate Limiting

```bash
# API rate limiting configuration
RATE_LIMIT_WINDOW_MS=900000      # Rate limit window (15 minutes in ms)
RATE_LIMIT_MAX_REQUESTS=100      # Max requests per window per IP
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false  # Count successful requests
RATE_LIMIT_SKIP_FAILED_REQUESTS=false      # Count failed requests
RATE_LIMIT_HEADERS=true          # Include rate limit headers in responses
```

#### CORS Settings

```bash
# Cross-Origin Resource Sharing
CORS_ORIGIN=*                    # Allowed origins (* for all, or specific URLs)
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS  # Allowed HTTP methods
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Requested-With  # Allowed headers
CORS_CREDENTIALS=false           # Allow credentials (cookies, auth headers)
CORS_MAX_AGE=86400              # Preflight cache time in seconds
```

#### File Upload Security

```bash
# File upload restrictions
MAX_UPLOAD_SIZE=52428800         # Maximum file size (50MB in bytes)
UPLOAD_DIR=./app/public/uploads  # Upload directory path
ALLOWED_EXTENSIONS=csv,json,xlsx # Comma-separated allowed file extensions
UPLOAD_CLEANUP_AGE=86400000     # Auto-cleanup age in milliseconds (24 hours)
UPLOAD_VIRUS_SCAN=false         # Enable virus scanning (requires ClamAV)
```

#### Session Management

```bash
# Session configuration
SESSION_SECRET=<auto-generated>   # Session encryption key (auto-generated if missing)
SESSION_NAME=hextrackr.sid       # Session cookie name
SESSION_COOKIE_MAX_AGE=86400000  # Cookie expiration (24 hours in ms)
SESSION_COOKIE_SECURE=false      # Secure cookie flag (true for HTTPS only)
SESSION_COOKIE_HTTP_ONLY=true    # HTTP-only cookie flag
SESSION_COOKIE_SAME_SITE=lax     # SameSite cookie attribute
```

---

### Application Features

#### Data Processing

```bash
# CSV import and processing
CSV_CHUNK_SIZE=1000              # Rows processed per batch
CSV_MAX_COLUMNS=50               # Maximum columns per CSV
CSV_SKIP_EMPTY_LINES=true        # Skip empty lines during import
CSV_TRIM_WHITESPACE=true         # Trim whitespace from values
CSV_VALIDATE_HEADERS=true        # Validate expected column headers
```

#### Vulnerability Management

```bash
# Vulnerability data handling
VULN_CACHE_TTL=300000           # Cache TTL in milliseconds (5 minutes)
VULN_BATCH_SIZE=100             # Batch size for bulk operations
VULN_AUTO_CLEANUP_DAYS=365      # Auto-cleanup resolved vulnerabilities (days)
VULN_ENABLE_ROLLOVER=true       # Enable rollover table architecture
VULN_ROLLOVER_RETENTION_DAYS=90 # Historical data retention period
```

#### Ticket Management

```bash
# Support ticket configuration
TICKET_AUTO_ASSIGN=false        # Auto-assign tickets to users
TICKET_DEFAULT_PRIORITY=Medium  # Default priority (Low|Medium|High|Critical)
TICKET_AUTO_CLOSE_DAYS=30      # Auto-close resolved tickets after N days
TICKET_ENABLE_EMAIL_NOTIFICATIONS=false  # Email notifications (requires SMTP)
```

---

### Performance Tuning

#### Caching Configuration

```bash
# Application caching settings
CACHE_ENABLED=true              # Enable application-level caching
CACHE_DEFAULT_TTL=300000        # Default cache TTL in milliseconds
CACHE_MAX_SIZE=100              # Maximum cache entries
CACHE_CHECK_PERIOD=60000        # Cache cleanup interval in milliseconds
```

#### Response Compression

```bash
# HTTP compression settings
COMPRESSION_ENABLED=true        # Enable response compression
COMPRESSION_LEVEL=6             # Compression level (1-9, higher = more compression)
COMPRESSION_THRESHOLD=1024      # Minimum response size to compress (bytes)
COMPRESSION_FILTER=text/*,application/json,application/javascript  # MIME types
```

#### Static Asset Serving

```bash
# Static file configuration
STATIC_CACHE_MAX_AGE=86400000   # Cache-Control max-age for static assets
STATIC_ETAG=true                # Enable ETag headers
STATIC_LAST_MODIFIED=true       # Enable Last-Modified headers
STATIC_INDEX=false              # Disable directory indexing
```

---

### Monitoring & Logging

#### Application Logging

```bash
# Logging configuration
LOG_LEVEL=info                  # Logging level (error|warn|info|debug|trace)
LOG_FORMAT=combined             # Log format (combined|common|dev|short|tiny)
LOG_DESTINATION=console         # Log destination (console|file|syslog)
LOG_FILE_PATH=./logs/hextrackr.log  # Log file path (if LOG_DESTINATION=file)
LOG_FILE_MAX_SIZE=10485760      # Log file max size in bytes (10MB)
LOG_FILE_MAX_FILES=5            # Number of log files to retain
```

#### Health Check Configuration

```bash
# Health monitoring settings
HEALTH_CHECK_ENABLED=true       # Enable /health endpoint
HEALTH_CHECK_DB=true           # Include database connectivity check
HEALTH_CHECK_WEBSOCKET=true    # Include WebSocket server check
HEALTH_CHECK_DISK_SPACE=true   # Include disk space check
HEALTH_CHECK_MEMORY=true       # Include memory usage check
```

#### Metrics Collection

```bash
# Performance metrics
METRICS_ENABLED=false          # Enable metrics collection
METRICS_ENDPOINT=/metrics      # Metrics endpoint path
METRICS_INCLUDE_DEFAULT=true   # Include default Node.js metrics
METRICS_INCLUDE_HTTP=true      # Include HTTP request metrics
```

---

### Documentation Portal

#### Documentation Generation

```bash
# Documentation system configuration
DOCS_ENABLED=true              # Enable documentation portal
DOCS_AUTO_REFRESH=true         # Auto-refresh docs on markdown changes
DOCS_BUILD_ON_START=false      # Build documentation on server startup
DOCS_SOURCE_DIR=./app/public/docs-source    # Documentation source directory
DOCS_OUTPUT_DIR=./app/public/docs-html      # Generated documentation output
DOCS_TEMPLATE_PATH=./app/public/docs-html/template.html  # HTML template
```

#### Content Management

```bash
# Documentation content settings
DOCS_ENABLE_SEARCH=true        # Enable documentation search
DOCS_ENABLE_TOC=true          # Enable table of contents generation
DOCS_SYNTAX_HIGHLIGHTING=true  # Enable code syntax highlighting
DOCS_MERMAID_DIAGRAMS=true    # Enable Mermaid diagram rendering
DOCS_MATH_RENDERING=false     # Enable MathJax/KaTeX rendering
```

---

### Development Settings

#### Development Mode Features

```bash
# Development-only configuration
DEV_AUTO_RELOAD=true           # Enable auto-reload on file changes
DEV_DETAILED_ERRORS=true       # Show detailed error messages
DEV_CORS_RELAXED=true          # Relaxed CORS for development
DEV_CACHE_DISABLED=true        # Disable caching in development
DEV_MOCK_DATA=false            # Use mock data instead of database
```

#### Debug Configuration

```bash
# Debugging settings
DEBUG_SQL_QUERIES=false        # Log SQL queries to console
DEBUG_WEBSOCKET_EVENTS=false   # Log WebSocket events
DEBUG_REQUEST_TIMING=false     # Log request processing times
DEBUG_MEMORY_USAGE=false       # Log memory usage periodically
```

---

## Runtime Configuration

### Application-Level Settings

These settings can be modified through the settings modal or configuration files:

#### UI Preferences

- **Theme**: `light` | `dark` | `auto` (follows system preference)
- **Grid Page Size**: `25` | `50` | `100` | `200` rows per page
- **Chart Type Preferences**: Default chart types for different data views
- **Auto-refresh Interval**: Dashboard refresh rate in seconds

#### Data Display Settings

- **Date Format**: ISO 8601, US format, European format
- **Number Format**: Decimal places, thousands separator
- **Timezone**: UTC, Local, or specific timezone
- **Language**: Currently English only, prepared for i18n

#### Export Settings

- **CSV Delimiter**: Comma, semicolon, tab
- **Include Headers**: Boolean flag for CSV exports
- **Date Range**: Default date ranges for exports
- **File Naming**: Template for exported file names

---

## Security Hardening Options

### Additional Security Headers

```bash
# Security header configuration
SECURITY_HSTS_ENABLED=true                    # HTTP Strict Transport Security
SECURITY_HSTS_MAX_AGE=31536000               # HSTS max age in seconds
SECURITY_CONTENT_TYPE_NOSNIFF=true           # X-Content-Type-Options: nosniff
SECURITY_FRAME_OPTIONS=DENY                  # X-Frame-Options setting
SECURITY_XSS_PROTECTION=1; mode=block        # X-XSS-Protection header
SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin  # Referrer-Policy
```

### Input Validation

```bash
# Input validation settings
VALIDATION_MAX_STRING_LENGTH=1000            # Maximum string field length
VALIDATION_MAX_ARRAY_SIZE=100               # Maximum array size
VALIDATION_SANITIZE_HTML=true               # Enable HTML sanitization
VALIDATION_STRICT_JSON=true                 # Strict JSON parsing
```

### Audit Logging

```bash
# Security audit logging
AUDIT_LOG_ENABLED=false                     # Enable security audit logging
AUDIT_LOG_FAILED_LOGINS=true               # Log failed authentication attempts
AUDIT_LOG_FILE_UPLOADS=true                # Log file upload activities
AUDIT_LOG_DATA_EXPORTS=true                # Log data export activities
AUDIT_LOG_ADMIN_ACTIONS=true               # Log administrative actions
```

---

## Configuration Management

### Environment File Priority

1. Command line arguments (highest priority)
2. `.env.local` file
3. `.env.production` or `.env.development` (based on NODE_ENV)
4. `.env` file
5. Default values (lowest priority)

### Configuration Validation

All configuration values are validated at startup:

- **Type checking**: Ensures correct data types
- **Range validation**: Checks numeric ranges and limits
- **Format validation**: Validates formats (URLs, file paths, etc.)
- **Dependency validation**: Ensures compatible option combinations

### Hot Reload Support

Some configuration changes can be applied without restart:

- Log level changes
- Cache TTL adjustments
- Rate limit modifications
- Feature flag toggles

### Configuration Backup

```bash
# Generate current configuration dump
npm run config:dump > config-backup.json

# Validate configuration file
npm run config:validate

# Show configuration with sources
npm run config:show
```

---

## Production Deployment Settings

### Recommended Production Values

```bash
NODE_ENV=production
LOG_LEVEL=warn
COMPRESSION_ENABLED=true
STATIC_CACHE_MAX_AGE=2592000000    # 30 days
CORS_ORIGIN=https://yourdomain.com
SESSION_COOKIE_SECURE=true
SECURITY_HSTS_ENABLED=true
DB_WAL_MODE=true
CACHE_ENABLED=true
```

### Docker Environment

```yaml
# docker-compose.yml environment variables
environment:
  - NODE_ENV=production
  - PORT=8989
  - WEBSOCKET_PORT=8988
  - DB_PATH=/data/hextrackr.db
  - UPLOAD_DIR=/data/uploads
  - LOG_DESTINATION=console
```

### Kubernetes ConfigMap Example

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: hextrackr-config
data:
  NODE_ENV: "production"
  PORT: "8989"
  WEBSOCKET_PORT: "8988"
  LOG_LEVEL: "warn"
  COMPRESSION_ENABLED: "true"
  CACHE_ENABLED: "true"
```

This configuration documentation provides complete transparency about all configurable aspects of HexTrackr, essential for security reviews and operational deployment planning.

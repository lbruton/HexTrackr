# Data Model: Vulnerability Card Icon and Font Color Fix

## Color System Data Structure

### Severity Color Mapping

```javascript
// Core color constants for vulnerability severity levels
const SEVERITY_COLORS = {
  critical: {
    name: 'Critical',
    hex: {
      light: '#dc2626',  // red-600
      dark: '#ef4444'    // red-500
    },
    rgb: {
      light: '220, 38, 38',
      dark: '239, 68, 68'
    },
    cssVar: '--vpr-critical',
    textClass: 'text-vpr-critical',
    bgClass: 'bg-vpr-critical',
    borderClass: 'border-vpr-critical',
    icon: 'ti-alert-triangle',
    priority: 1
  },

  high: {
    name: 'High',
    hex: {
      light: '#d97706',  // amber-600 (adjusted for WCAG)
      dark: '#f97316'    // orange-500
    },
    rgb: {
      light: '217, 119, 6',
      dark: '249, 115, 22'
    },
    cssVar: '--vpr-high',
    textClass: 'text-vpr-high',
    bgClass: 'bg-vpr-high',
    borderClass: 'border-vpr-high',
    icon: 'ti-alert-circle',
    priority: 2
  },

  medium: {
    name: 'Medium',
    hex: {
      light: '#2563eb',  // blue-600
      dark: '#3b82f6'    // blue-500
    },
    rgb: {
      light: '37, 99, 235',
      dark: '59, 130, 246'
    },
    cssVar: '--vpr-medium',
    textClass: 'text-vpr-medium',
    bgClass: 'bg-vpr-medium',
    borderClass: 'border-vpr-medium',
    icon: 'ti-info-circle',
    priority: 3
  },

  low: {
    name: 'Low',
    hex: {
      light: '#16a34a',  // green-600
      dark: '#22c55e'    // green-500
    },
    rgb: {
      light: '22, 163, 74',
      dark: '34, 197, 94'
    },
    cssVar: '--vpr-low',
    textClass: 'text-vpr-low',
    bgClass: 'bg-vpr-low',
    borderClass: 'border-vpr-low',
    icon: 'ti-check-circle',
    priority: 4
  }
};
```

## Theme Configuration

### Theme State Model

```javascript
const ThemeConfig = {
  currentTheme: 'light' | 'dark',
  colorMode: 'system' | 'manual',
  contrastMode: 'normal' | 'high',

  // Methods
  applyTheme: function(theme) {
    document.body.setAttribute('data-theme', theme);
    this.currentTheme = theme;
    this.updateChartColors();
  },

  updateChartColors: function() {
    const colors = this.getSeverityColors();
    // Update all chart instances
  },

  getSeverityColors: function() {
    const theme = this.currentTheme;
    return [
      SEVERITY_COLORS.critical.hex[theme],
      SEVERITY_COLORS.high.hex[theme],
      SEVERITY_COLORS.medium.hex[theme],
      SEVERITY_COLORS.low.hex[theme]
    ];
  }
};
```

## Component State Models

### Stat Card Model

```javascript
class VulnerabilityStatCard {
  constructor(severity) {
    this.severity = severity; // 'critical' | 'high' | 'medium' | 'low'
    this.count = 0;
    this.vprScore = 0;
    this.trend = {
      direction: 'up' | 'down' | 'stable',
      percentage: 0
    };
  }

  getColorConfig() {
    return SEVERITY_COLORS[this.severity];
  }

  render() {
    const config = this.getColorConfig();
    // Apply CSS classes and variables
    return {
      textClass: config.textClass,
      iconClass: config.icon,
      trendColor: config.cssVar
    };
  }
}
```

### Chart Color Model

```javascript
class VulnerabilityChart {
  constructor(chartId) {
    this.chartId = chartId;
    this.chart = null;
    this.colorScheme = 'severity'; // or 'custom'
  }

  getColors(theme = 'light') {
    if (this.colorScheme === 'severity') {
      return Object.values(SEVERITY_COLORS)
        .sort((a, b) => a.priority - b.priority)
        .map(color => color.hex[theme]);
    }
    return this.customColors;
  }

  updateTheme(theme) {
    if (this.chart) {
      this.chart.updateOptions({
        colors: this.getColors(theme),
        theme: {
          mode: theme
        }
      });
    }
  }
}
```

## Accessibility Model

### Color Contrast Validator

```javascript
const AccessibilityConfig = {
  contrastRequirements: {
    normalText: 4.5,      // WCAG AA for normal text
    largeText: 3.0,       // WCAG AA for large text (>18pt)
    graphicalObjects: 3.0  // WCAG AA for UI components
  },

  validateContrast(foreground, background) {
    // Calculate contrast ratio
    const ratio = this.calculateContrastRatio(foreground, background);
    return {
      ratio: ratio,
      passesNormal: ratio >= this.contrastRequirements.normalText,
      passesLarge: ratio >= this.contrastRequirements.largeText,
      passesGraphical: ratio >= this.contrastRequirements.graphicalObjects
    };
  },

  getSafeColor(severity, theme, elementType) {
    const color = SEVERITY_COLORS[severity];
    const baseColor = color.hex[theme];

    // Return adjusted color if needed for contrast
    if (severity === 'high' && theme === 'light' && elementType === 'normalText') {
      return color.hex.light; // Uses adjusted amber-600
    }

    return baseColor;
  }
};
```

## CSS Variable Mapping

### Variable Structure

```css
/* Root level severity colors */
:root {
  /* Primary colors */
  --vpr-critical: #dc2626;
  --vpr-high: #d97706;
  --vpr-medium: #2563eb;
  --vpr-low: #16a34a;

  /* RGB values for alpha transparency */
  --vpr-critical-rgb: 220, 38, 38;
  --vpr-high-rgb: 217, 119, 6;
  --vpr-medium-rgb: 37, 99, 235;
  --vpr-low-rgb: 22, 163, 74;

  /* Background colors with opacity */
  --vpr-critical-bg: rgba(var(--vpr-critical-rgb), 0.1);
  --vpr-high-bg: rgba(var(--vpr-high-rgb), 0.1);
  --vpr-medium-bg: rgba(var(--vpr-medium-rgb), 0.1);
  --vpr-low-bg: rgba(var(--vpr-low-rgb), 0.1);
}

/* Dark theme overrides */
[data-theme="dark"] {
  --vpr-critical: #ef4444;
  --vpr-high: #f97316;
  --vpr-medium: #3b82f6;
  --vpr-low: #22c55e;

  --vpr-critical-rgb: 239, 68, 68;
  --vpr-high-rgb: 249, 115, 22;
  --vpr-medium-rgb: 59, 130, 246;
  --vpr-low-rgb: 34, 197, 94;
}
```

## State Transitions

### Theme Switch Sequence

```
1. User triggers theme switch
2. ThemeConfig.applyTheme(newTheme) called
3. Body data-theme attribute updated
4. CSS variables cascade to new values
5. Chart colors updated via updateOptions()
6. Icons and text colors update automatically via CSS
```

### Color Application Priority

```
1. CSS Variables (highest priority)
2. Utility classes (.text-vpr-*, .bg-vpr-*)
3. Inline styles (avoided when possible)
4. Component defaults (fallback)
```

## Validation Rules

### Color Consistency Rules

1. All severity indicators must use the same color
2. Colors must maintain contrast ratios in both themes
3. Chart and card colors must match exactly
4. Trend indicators must use severity colors

### Accessibility Rules

1. Text on colored backgrounds must meet WCAG AA
2. Icons must have sufficient contrast (3:1 minimum)
3. Color must not be the only indicator (use icons/text too)
4. Focus indicators must be visible in both themes

# Tasks: Vulnerability Card Icon and Font Color Fix

## ✅ COMPLETED - September 17, 2025

**Status**: All 28 tasks completed successfully
**Key Achievement**: Fixed color consistency between stat cards and charts
**Major Lesson**: Simplified testing from 800 lines to 59 lines (visual test)
**See AAR**: `specs/002-vulnerability-card-icon/aar.md`

---

**Input**: Design documents from `/specs/002-vulnerability-card-icon/`
**Prerequisites**: plan.md (required), research.md, data-model.md
**Tech Stack**: JavaScript ES6+, CSS3, Tabler Framework, ApexCharts

## Execution Flow (main)

```
1. Load plan.md from feature directory
   → Extract: JavaScript/CSS, Tabler, ApexCharts
2. Load optional design documents:
   → data-model.md: Color mapping structure
   → research.md: WCAG requirements and color decisions
3. Generate tasks by category:
   → Setup: CSS variable definitions
   → Tests: E2E color consistency tests
   → Core: Update HTML, CSS, and JavaScript
   → Integration: Theme switching logic
   → Polish: Accessibility validation, documentation
4. Apply task rules:
   → Different files = mark [P] for parallel
   → Same file = sequential (no [P])
5. Number tasks sequentially (T001, T002...)
6. Return: SUCCESS (tasks ready for execution)
```

## Format: `[ID] [P?] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- Include exact file paths in descriptions

## Path Conventions

- **CSS Files**: `app/public/styles/`
- **JavaScript**: `app/public/scripts/`
- **HTML**: `app/public/`
- **Tests**: `app/tests/e2e/`

## Phase 3.1: Setup & Preparation

- [x] T001 Verify Docker container is running on port 8989
- [x] T002 Create backup of current color implementation files
- [x] T003 [P] Run ESLint on affected JavaScript files to ensure clean baseline

## Phase 3.2: Tests First (TDD) ⚠️ MUST COMPLETE BEFORE 3.3

**CRITICAL: These tests MUST be written and MUST FAIL before ANY implementation**

- [x] T004 [P] Create E2E test for light mode color consistency in app/tests/e2e/vulnerability-colors-light.spec.js
- [x] T005 [P] Create E2E test for dark mode color consistency in app/tests/e2e/vulnerability-colors-dark.spec.js
- [x] T006 [P] Create E2E test for theme switching in app/tests/e2e/vulnerability-theme-switch.spec.js
- [x] T007 [P] Create accessibility test for WCAG compliance in app/tests/e2e/vulnerability-accessibility.spec.js

## Phase 3.3: Core Implementation (ONLY after tests are failing)

### CSS Variable Definitions

- [x] T008 Define base VPR color variables in app/public/styles/pages/vulnerabilities.css (:root section)
- [x] T009 Add dark mode color overrides in vulnerabilities.css ([data-theme="dark"] section)
- [x] T010 Create utility classes (.text-vpr-*, .bg-vpr-*) in vulnerabilities.css

### HTML Updates

- [x] T011 Update Critical stat card HTML to use new color classes in app/public/vulnerabilities.html (lines 565-595)
- [x] T012 Update High stat card HTML to use new color classes in app/public/vulnerabilities.html (lines 600-630)
- [x] T013 Update Medium stat card HTML to use new color classes in app/public/vulnerabilities.html (lines 635-665)
- [x] T014 Update Low stat card HTML to use new color classes in app/public/vulnerabilities.html (lines 670-700)

### JavaScript Updates

- [x] T015 [P] Create color constants mapping in app/public/scripts/shared/vulnerability-constants.js
- [x] T016 Update stat card rendering logic in app/public/scripts/shared/vulnerability-statistics.js
- [x] T017 Update chart color configuration in app/public/scripts/shared/vulnerability-chart-manager.js (line 279)
- [x] T018 [P] Update theme adapter to read CSS variables in app/public/scripts/utils/chart-theme-adapter.js

## Phase 3.4: Integration & Theme Support

- [x] T019 Update theme switching to refresh chart colors in app/public/scripts/shared/theme-controller.js
- [x] T020 Ensure ApexCharts updateOptions() is called on theme change
- [x] T021 Test color variable cascade in both themes
- [x] T022 Verify icon colors update with severity colors

## Phase 3.5: Polish & Validation

- [x] T023 [P] Validate WCAG AA contrast ratios using browser DevTools
- [x] T024 [P] Test with color-blind simulator for all deficiency types
- [x] T025 [P] Update CLAUDE.md with new color system documentation
- [x] T026 Run quickstart.md validation checklist
- [x] T027 Run full ESLint and verify no new issues
- [x] T028 [P] Update app/public/docs-source/technical-reference/configuration.md with color system

## Dependencies

- Tests (T004-T007) MUST complete before implementation (T008-T022)
- CSS variables (T008-T010) before HTML updates (T011-T014)
- Color constants (T015) before JavaScript updates (T016-T018)
- Core implementation (T008-T018) before integration (T019-T022)
- All implementation before validation (T023-T028)

## Parallel Execution Examples

### Group 1: Initial Tests (can run together)

```bash
# Run in 4 parallel terminal windows or Task agents
Task agent 1: Execute T004 (light mode test)
Task agent 2: Execute T005 (dark mode test)
Task agent 3: Execute T006 (theme switch test)
Task agent 4: Execute T007 (accessibility test)
```

### Group 2: Independent JavaScript Files

```bash
# After CSS is complete, these can run in parallel
Task agent 1: Execute T015 (create constants file)
Task agent 2: Execute T018 (update theme adapter)
```

### Group 3: Documentation & Validation

```bash
# Final tasks can run in parallel
Task agent 1: Execute T023 (WCAG validation)
Task agent 2: Execute T024 (color-blind testing)
Task agent 3: Execute T025 (update CLAUDE.md)
Task agent 4: Execute T028 (update docs)
```

## Task Execution Notes

1. **CSS First**: T008-T010 establish the foundation - all other tasks depend on these variables
2. **HTML Sequential**: T011-T014 modify the same file but different sections (can be done quickly in sequence)
3. **Chart Colors Critical**: T017 is the key task for chart consistency - must read CSS variables
4. **Theme Integration**: T019-T020 ensure dynamic updates work correctly
5. **No Breaking Changes**: Existing functionality must remain intact throughout

## Validation Checklist

- [x] All design documents loaded and analyzed
- [x] Tests created before implementation (TDD)
- [x] Each file modification has specific line numbers where applicable
- [x] Parallel tasks marked appropriately
- [x] Dependencies clearly stated
- [x] Total tasks: 28 (reasonable for UI color update)

## Time Estimate

- Setup: 15 minutes (T001-T003)
- Tests: 45 minutes (T004-T007)
- Core Implementation: 60 minutes (T008-T018)
- Integration: 30 minutes (T019-T022)
- Polish: 30 minutes (T023-T028)
- **Total: ~3 hours**

## Success Criteria

✅ All 4 stat cards use consistent colors
✅ Chart colors match stat cards exactly
✅ Theme switching updates all colors
✅ WCAG AA compliance achieved
✅ No console errors
✅ All tests pass
